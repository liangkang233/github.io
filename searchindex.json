{"categories":[{"title":"Core","uri":"https://liangkang233.github.io/categories/core/"},{"title":"å­¦ä¹ ","uri":"https://liangkang233.github.io/categories/%E5%AD%A6%E4%B9%A0/"},{"title":"å·¥å…·","uri":"https://liangkang233.github.io/categories/%E5%B7%A5%E5%85%B7/"},{"title":"æ‚è°ˆ","uri":"https://liangkang233.github.io/categories/%E6%9D%82%E8%B0%88/"},{"title":"ç¼–ç¨‹","uri":"https://liangkang233.github.io/categories/%E7%BC%96%E7%A8%8B/"},{"title":"è®°å½•","uri":"https://liangkang233.github.io/categories/%E8%AE%B0%E5%BD%95/"}],"posts":[{"content":"é¢˜å¤–è¯ è¿‡å¹´ç©äº†ä¸‹é™¶ç¬›ï¼Œå…¥é—¨çœŸçš„å¾ˆå¿«ğŸ¥³ã€‚ å¤åˆ»äº†(æ¯åŸä½œ)ä»™å‰‘bgmå›æ¢¦æ¸¸ä»™ å®å¯æ¢¦æœªç™½é•‡ ã€‚è¿™ä¸ªç½‘ç«™ä¸é”™ï¼Œå¯ä»¥æŠŠé™¶ç¬›çš„ä¼´å¥å–å‡ºæ¥\nè¯•å¹ä¸‹å¡å°”è¾¾çš„bgm èƒŒæ™¯ æ‘†çƒ‚åˆ°ç°åœ¨ç©ç–¯äº†ï¼Œæ”¶æ”¶å¿ƒå‡†å¤‡æ¯•ä¸šçš„äº‹ã€‚å…¶ä¸­ç”¨åˆ°äº†ä¸€ä¸ªMetiså·¥å…·åŒ…ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸²è¡Œå›¾åˆ†å‰²å·¥å…·ï¼Œå¯ä»¥ç”¨äºå°†å¸¦æƒå€¼çš„æ— å‘å›¾è¿›è¡Œå¹³è¡¡åˆ†å‰²ã€‚è¯¥å·¥å…·åŒ…éå¸¸ç»å…¸ï¼Œä½¿ç”¨C/C++ç¼–å†™ï¼Œä½¿ç”¨æ•™ç¨‹1ã€‚\nMetiså®˜æ–¹æ‰‹å†Œäº†è§£äº›å¤§æ¦‚å·¥ä½œåŸç†ã€‚å®˜æ–¹æ‰‹å†Œä¸­ä»‹ç»Meis(æœºç¿»)ï¼š\næ‰¾åˆ°é«˜åº¦éç»“æ„åŒ–å›¾çš„è‰¯å¥½åˆ’åˆ†çš„ç®—æ³•å¯¹äºåœ¨ä¸²è¡Œå’Œå¹¶è¡Œè®¡ç®—æœºä¸Šä¸ºè®¸å¤šåº”ç”¨é¢†åŸŸçš„å¹¿æ³›é—®é¢˜å¼€å‘æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆè‡³å…³é‡è¦ã€‚ä¾‹å¦‚ï¼Œåœ¨å¹¶è¡Œè®¡ç®—æœºä¸Šè¿›è¡Œå¤§è§„æ¨¡æ•°å€¼æ¨¡æ‹Ÿï¼Œä¾‹å¦‚é‚£äº›åŸºäºæœ‰é™å…ƒæ–¹æ³•çš„æ•°å€¼æ¨¡æ‹Ÿï¼Œéœ€è¦å°†æœ‰é™å…ƒç½‘æ ¼åˆ†å¸ƒåˆ°å¤„ç†å™¨ä¸Šã€‚è¿™ç§åˆ†å¸ƒå¿…é¡»ä½¿åˆ†é…ç»™æ¯ä¸ªå¤„ç†å™¨çš„å…ƒç´ æ•°é‡ç›¸åŒï¼Œå¹¶ä¸”åˆ†é…ç»™ä¸åŒå¤„ç†å™¨çš„ç›¸é‚»å…ƒç´ æ•°é‡æœ€å°åŒ–ã€‚\nç¬¬ä¸€ä¸ªæ¡ä»¶çš„ç›®æ ‡æ˜¯å¹³è¡¡å¤„ç†å™¨ä¹‹é—´çš„è®¡ç®—ã€‚ç¬¬äºŒä¸ªæ¡ä»¶çš„ç›®æ ‡æ˜¯æœ€å°åŒ–ç”±äºå°†ç›¸é‚»å…ƒç´ æ”¾ç½®åˆ°ä¸åŒå¤„ç†å™¨è€Œå¯¼è‡´çš„é€šä¿¡ã€‚å›¾åˆ’åˆ†å¯ä»¥æˆåŠŸåœ°æ»¡è¶³è¿™äº›æ¡ä»¶ï¼Œé¦–å…ˆç”¨å›¾å¯¹æœ‰é™å…ƒç½‘æ ¼è¿›è¡Œå»ºæ¨¡ï¼Œç„¶åå°†å…¶åˆ’åˆ†ä¸ºç›¸ç­‰çš„éƒ¨åˆ†ã€‚å›¾åˆ’åˆ†ç®—æ³•ä¹Ÿç”¨äºè®¡ç®—ç¨€ç–çŸ©é˜µçš„å¡«å……å‡å°‘é¡ºåºã€‚å½“ç›´æ¥æ–¹æ³•ç”¨äºæ±‚è§£çº¿æ€§æ–¹ç¨‹ç»„çš„ç¨€ç–ç³»ç»Ÿæ—¶ï¼Œè¿™äº›å‡å°‘å¡«å……é¡ºåºæ˜¯æœ‰ç”¨çš„ã€‚ä¸€ä¸ªè‰¯å¥½çš„ç¨€ç–çŸ©é˜µçš„æ’åºæå¤§åœ°å‡å°‘äº†å†…å­˜çš„æ•°é‡ä»¥åŠè§£å†³æ–¹ç¨‹ç»„æ‰€éœ€çš„æ—¶é—´ã€‚æ­¤å¤–ï¼Œç”±å›¾åˆ’åˆ†ç®—æ³•äº§ç”Ÿçš„å¡«å……å‡å°‘æ’åºç‰¹åˆ«é€‚åˆäºå¹¶è¡Œç›´æ¥åˆ†è§£ï¼Œå› ä¸ºå®ƒä»¬åœ¨åˆ†è§£é˜¶æ®µå¯¼è‡´äº†é«˜åº¦çš„å¹¶å‘æ€§ã€‚\nå›¾åˆ’åˆ†ä¹Ÿç”¨äºè§£å†³è®¸å¤šé¢†åŸŸå‡ºç°çš„ä¼˜åŒ–é—®é¢˜ï¼Œå¦‚è¶…å¤§è§„æ¨¡é›†æˆç”µè·¯(VLSI)çš„è®¾è®¡ã€å­˜å‚¨å’Œè®¿é—®ç£ç›˜ä¸Šçš„ç©ºé—´æ•°æ®åº“ã€è¿è¾“ç®¡ç†å’Œæ•°æ®æŒ–æ˜\nMetiså±äºofflineç±»å‹çš„è¾¹åˆ†å‰²ï¼ŒåŸºç¡€å›¾åˆ†å‰²çš„çŸ¥è¯†ä»‹ç»è¯·çœ‹è¿™ç¯‡åšå®¢2ã€‚ ç®€è¨€ä¹‹ï¼Œæ— å‘å›¾çš„åˆ†å‰²æŒ‰ç…§åˆ‡å‰²æ–¹å¼åˆ†ä¸ºè¾¹åˆ†å‰²(ç‚¹åˆ†åŒº)å’Œç‚¹åˆ†å‰²(è¾¹åˆ†åŒº)ï¼Œå³åˆ‡å‰²å›¾æ—¶ï¼Œæ¥ç¡®å®šæ˜¯åˆ‡å‰²çš„ç‚¹æˆ–è¾¹ã€‚ å…¶ä¸­ä¸€æ¬¡æ€§å°†å›¾å¯¼å…¥è¿›è¡Œåˆ†åŒºåˆ‡å‰²çš„å±äºé™æ€offlineç±»å‹ï¼Œå¦åˆ™å±äºæµå¼streamingç±»å‹ã€‚ æµå¼çš„å¥½å¤„åœ¨äºå¯¹äºå¤§è§„æ¨¡çš„å›¾å¤„ç†æ‰€éœ€çš„å†…å­˜å°†æ›´å°ã€‚\nè‡³äºæµå¼çš„å›¾åˆ†å‰²ä¹‹ç±»çš„ï¼Œå¯ä»¥é˜…è¯»è¿™äº›æ–‡ç« 3 4ï¼Œæœ¬äººåªæ˜¯åº”ç”¨å®è·µï¼Œæ²¡æœ‰åšæ·±å…¥ç ”ç©¶ã€‚\nå®è·µ è¿™é‡Œä½¿ç”¨PythonåŒ…è£…çš„pymetisè¿›è¡Œç½‘ç»œå›¾åˆ†å‰²ã€‚\nç›´æ¥ pip install pymetis å³å¯å®‰è£…ã€‚pymetisä½¿ç”¨ pymetis.part_graph(part, xadj=xadj, adjncy=adjncy, eweights=eweights) æ¥å°†æ‹“æ‰‘å›¾è¿›è¡Œåˆ†å‰²ã€‚ç”±äºè¯¥åŒ…ä»…ä»…æ˜¯metisçš„APIå°è£…ï¼Œåº•å±‚è°ƒç”¨çš„éƒ½æ˜¯åŸç‰ˆçš„apiï¼Œä¿®æ”¹ç®—æ³•æ—¶éœ€è¦ç›´æ¥ä¿®æ”¹metisä»£ç ï¼Œåªæ˜¯ä½¿ç”¨çš„è¯çœ‹çœ‹æ‰‹å†Œå°±è¡Œã€‚\nä¸ºäº†åç»­çš„å›¾åˆ†å‰²æ¯”è¾ƒç›´è§‚ï¼Œæˆ‘è¿™é‡Œä¼šé€šè¿‡ neworkx åŒ…å±•ç¤ºäº†ï¼Œæ„å»ºç±»my_graphã€‚å…¶å¯ä»¥éšæœºç”Ÿæˆè‡ªå®šä¹‰çš„ç¡®å®šç”ŸæˆèŠ‚ç‚¹ä¸ªæ•°ã€é“¾è·¯å¯†åº¦çš„ç½‘ç»œæ‹“æ‰‘ã€‚ä¸ºäº†ç›´è§‚å±•ç¤ºå›¾é“¾è·¯æƒé‡ï¼Œé€šè¿‡get_weight_dictå°†é“¾è·¯æƒé‡ä¸å…¶æ‹“æ‰‘å›¾é•¿åº¦æ­£ç›¸å…³ï¼Œæ‹“æ‰‘å›¾Gå°†ä¿å­˜ä¸ºgmlæ ¼å¼ï¼Œè¯¥å›¾æ ¼å¼èƒ½å¤Ÿä¿å­˜èŠ‚ç‚¹ã€é“¾è·¯æƒé‡ã€‚\nå›¾åˆ†å‰²åŠæ„å»º from functools import cmp_to_key import matplotlib.pyplot as plt import networkx as nx import numpy as np import math, sys import string, pymetis class my_graph(): @classmethod def get_weight_dict(self, edges, pos)-\u0026gt; list : # ä¼ å…¥é“¾è·¯å’ŒèŠ‚ç‚¹ä½ç½® edges pos æ ¹æ®è·ç¦» * 66 æ±‚æ•´æ•°è¾“å‡ºæƒå€¼ æ³¨æ„æƒå€¼ä¸å¯ä¸º0 return [ (i, j, max(math.floor(66 * math.hypot(pos[i][0] - pos[j][0], pos[i][1] - pos[j][1])), 1)) for i, j in edges] @classmethod def creat(self, node_count=8, radius = 0.3, seed = 1, weight=True, save_file:string=None) -\u0026gt; nx.Graph: \u0026quot;\u0026quot;\u0026quot; @node_count ç½‘ç»œèŠ‚ç‚¹ä¸ªæ•°ï¼Œåœ¨ç”»å¸ƒä¸Šéšæœºç”Ÿæˆè¿™äº›èŠ‚ç‚¹çš„ä½ç½® @radius ç½‘ç»œèŠ‚ç‚¹è¿æ¥é˜ˆå€¼ï¼Œå½“è·ç¦»å°äºè¯¥å€¼ç”Ÿæˆé“¾è·¯ @seed éšæœºç§å­ @weight æ˜¯å¦è®¾å®šé“¾è·¯æƒå€¼ @save æ˜¯å¦ä¿å­˜è¯¥é‚»æ¥è¡¨æ•°æ® \u0026quot;\u0026quot;\u0026quot; # H = G.copy() # https://en.wikipedia.org/wiki/Random_geometric_graph ç”Ÿæˆéšæœºå›¾ G:nx.Graph = nx.random_geometric_graph(node_count, radius=radius, seed=seed) if weight: pos = nx.get_node_attributes(G, \u0026quot;pos\u0026quot;) # æŒ‰ç…§è·ç¦»è®¡ç®—å¹¶æ·»åŠ æƒé‡ G.add_weighted_edges_from(self.get_weight_dict(G.edges(), pos)) if save_file: nx.write_gml(G, save_file) self.G = G return G @classmethod def get_csr_data(self, G:nx.Graph): edges = [(i, j, G.adj[i][j]['weight']) for i,j in G.edges()] edgesList = edges + [(j, i, w) for i, j, w in edges]# é“¾è·¯æœ‰ä¸¤ç§å½¢å¼ 12 21 è¿™é‡Œæ‰‹åŠ¨å¤åˆ¶ä¸€ä»½ cmp = lambda t1,t2 : t1[1]-t2[1] if t1[0]==t2[0] else t1[0]-t2[0] edgesList.sort(key = cmp_to_key(cmp)) # æŒ‰ç…§å…ƒç»„å‰ä¸¤ä¸ªå…ƒç´ å¤§å°æ’ä¸‹åº adjncy = [j for i,j,w in edgesList] eweights = [w for i,j,w in edgesList] xadj, xid = [0, ], 0 # æ³¨æ„ xadjå¿…é¡»æŒ‰ç…§ èŠ‚ç‚¹ [0, n) é¡ºåºè¯»å–ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸å­˜åœ¨é“¾è·¯åˆ™æ–°idä¸‹æ ‡ä¸å˜ if not edgesList is []: for i in range(1, len(edgesList)): while xid \u0026lt; edgesList[i][0]: xadj.append(i) xid += 1 # if edgesList[i-1][0] != edgesList[i][0]: # è¿™æ ·ä¼šé—æ¼æ²¡æœ‰é“¾è·¯çš„èŠ‚ç‚¹ # xadj.append(i) xadj.append(len(edgesList)) #len(adj) == len(edgesList)+1 return (xadj, adjncy, eweights) @classmethod def mypart_graph(self, G:nx.Graph, part = 3): xadj, adjncy, eweights = my_graph.get_csr_data(G) n_cuts, membership = pymetis.part_graph(part, xadj=xadj, adjncy=adjncy, eweights=eweights) nodes_parts = [] for p in range(part): nodes_parts.append(np.argwhere(np.array(membership) == p).ravel()) print(f\u0026quot; xadj = {xadj}\\n adjncy = {adjncy}\\n edgesList = {eweights}\u0026quot;) #åˆ†åŒºéªŒè¯æ‰“å° for debug print(f\u0026quot;n_cuts: {n_cuts}, membership: {membership}, nodes_parts:{nodes_parts}\u0026quot;) return nodes_parts å›¾ç»˜åˆ¶ æ™®é€šæ— å‘æ‹“æ‰‘å›¾åŠå…¶é‚»æ¥çŸ©é˜µå¦‚ä¸‹æ‰€ç¤ºï¼š\næ˜¾ç„¶ï¼Œä½¿ç”¨é‚»æ¥çŸ©é˜µå­˜å‚¨çš„è¾¹æƒæœ‰ä¸€åŠä»¥ä¸Šçš„é‡å¤ç©ºé—´ï¼Œæ‰€ä»¥metiså°†å›¾G=(V,E)å‹ç¼©ä¸ºCSRæ ¼å¼æ¥è¿›è¡Œå¤„ç†ï¼Œå…¶åŒ…å«4ä¸ªæ•°ç»„ï¼šxadjã€adjncyæ¥æè¿°å›¾çš„æ‹“æ‰‘ï¼Œadjwgtä¸adjncyç»‘å®šé¡ºåºå­˜å‚¨è¾¹æƒé‡ã€vwgtæ•°ç»„ä¸‹æ ‡å¯¹åº”é¡¶ç‚¹åºå·å­˜å‚¨ç‚¹æƒé‡ã€‚è¿™é‡Œä½¿ç”¨get_csr_dataæ¥å°†å›¾Gè½¬åŒ–ä¸ºCSRæ ¼å¼ã€‚\nvwgt = [1,1,1,1,1,1,1,1] xadj = [0,4,8,13,17,20,23,26,32] adjncy = [2,4,5,7,2,3,6,7,0,1,3,6,7,1,2,6,7,0,5,7,0,4,7,1,2,3,0,1,2,3,4,5] adjwgt = [11,1,9,7,5,3,8,9,11,5,2,4,10,3,2,4,10,1,9,7,9,9,6,8,4,4,7,9,10,10,7,6] adjncyæ¯ä¸€ä½å‚¨å­˜æ‹“æ‰‘å›¾çš„ç›®çš„èŠ‚ç‚¹åºå·ï¼Œå…¶å¯¹åº”è¾¹æƒé‡å­˜å‚¨äºadjwgtï¼Œadjncyå€¼ä»£è¡¨ç›¸è¿çš„ç›®çš„èŠ‚ç‚¹åºå·ï¼ŒæºèŠ‚ç‚¹é»˜è®¤ä»0å¼€å§‹ã€‚è€ŒæºèŠ‚ç‚¹çš„åˆ‡æ¢å°±æ˜¯ç”±xadjæ¥å†³å®šçš„ã€‚ä¾‹å¦‚æ­¤å›¾ä¸­ï¼Œxadjç¬¬1ä¸ªå…ƒç´ ä¸º0ï¼Œç¬¬2ä¸ªå…ƒç´ ä¸º4(é¦–å…ƒç´ å›ºæœ‰å­˜åœ¨ï¼Œè¯¥æ•°ç»„å¤§å°ä¸ºèŠ‚ç‚¹æ•°n+1)ï¼Œè¯´æ˜adjncyä¸­ä¸‹æ ‡ä»0åˆ°3çš„è¾¹çš„æºèŠ‚ç‚¹éƒ½æ˜¯0ï¼Œç›®çš„èŠ‚ç‚¹ä¸ºå€¼2ï¼Œ4ï¼Œ5,æƒé‡ä¸º11ï¼Œ1ï¼Œ9ã€‚xadjç¬¬3ä¸ªå…ƒç´ ä¸º8è¯´æ˜adjncyä¸‹æ ‡4åˆ°7çš„è¾¹æºèŠ‚ç‚¹ä¸º1ï¼Œç›®çš„èŠ‚ç‚¹ä¸ºæ•°ç»„å€¼ï¼Œä¹‹åçš„å€¼ç±»æ¯”å³å¯ã€‚å…¶ä¸­éœ€è¦æ³¨æ„ï¼Œå½“æŸä¸ªèŠ‚ç‚¹ä¸å­˜åœ¨å°†å…¶æƒé‡è®¾ç½®ä¸º0ï¼ŒèŠ‚ç‚¹ç›¸é‚»è¾¹ä¸å­˜åœ¨æ—¶è¦å°†adjncyç›¸é‚»èŠ‚ç‚¹ç½®ä¸ºç›¸åŒå€¼ï¼Œä¸èƒ½ç›´æ¥è·³è¿‡è¯¥ç‚¹ã€‚\næ³¨æ„è½¬æ¢CSRæ—¶ n1-n2 ä¸n2-n1 é“¾è·¯åŒå‘éƒ½è¦è€ƒè™‘ï¼Œæˆ‘è¿™é‡Œæ¼”ç¤ºæ˜¯ç›´æ¥å°†networkçš„å›¾Gè¿›è¡Œè½¬æ¢ï¼Œè¿™é‡Œæ ¹æ®ä½ ç”¨é€”è‡ªå·±æ”¹ã€‚\nè‡³äºå‡½æ•° mypart_graph å°±æ˜¯è°ƒç”¨metisåŸæœ‰apiè¿›è¡Œåˆ†å‰²ï¼ŒMETIS_PartGraphRecursiveæ˜¯å¤šå±‚çº§é€’å½’åˆ’åˆ†APIï¼Œè€ŒMETIS_PartGraphKwayæ˜¯å¤šå±‚çº§K-wayåˆ’åˆ†ã€‚å‰è€…é€‚åˆç½‘ç»œåˆ†åŒºå°äº8ï¼Œå¦åˆ™é€‚ç”¨åè€…ã€‚pymetisçš„part_graphå‡½æ•°ä¸­çš„recursiveå‚æ•°boolä¹Ÿæ˜¯æ ¹æ®åˆ†åŒºæ˜¯å¦å¤§äº8è¿™ä¸ªå€¼æ¥ç¡®å®šå…·ä½“çš„åˆ†å‰²apiï¼Œå¯ä»¥è‡ªå·±ä¼ å…¥ã€‚å¦‚æœæœ‰æƒ³ä¼˜åŒ–metisæˆ–å¯¹éƒ¨åˆ†åŠŸèƒ½ä¿®æ”¹ï¼Œå¯ä»¥å» pymetis_code/src/metis/* ä¸­ä¿®æ”¹æºç ï¼Œè¿›è¡Œmakeç¼–è¯‘æ–°ä»£ç ä¼šè‡ªåŠ¨é‡æ–°å®‰è£…pymetisæŒ‡å®šåº“ã€‚\nåé¢å°±ä½¿ç”¨networkçš„drawç›¸å…³æ¨¡å—ç»˜åˆ¶ä¸‹ï¼Œä¸Šè¿°çš„éšæœºæ‹“æ‰‘åˆ†åŒºç»“æœå§ã€‚\nç»˜åˆ¶ç½‘ç»œå›¾çš„ç±»ä»£ç :\nclass graph_draw(): \u0026quot;\u0026quot;\u0026quot; by@lk233 è®¾è®¡äº†åŸºç¡€çš„ ä¿å­˜ è§£æçš„ç½‘ç»œå›¾ç±»ï¼Œç»˜åˆ¶å®Œæ¯•åä½¿ç”¨ plt.show() å³å¯ \u0026quot;\u0026quot;\u0026quot; def __init__(self, G=None, path:string=None) -\u0026gt; None: \u0026quot;\u0026quot;\u0026quot; åˆå§‹åŒ–è¯¥ç±»éœ€è¦ä¼ å…¥ pltçš„ç»˜åˆ¶åæ ‡ç³»ax è‹¥ä¼ å…¥äº†è·¯å¾„åˆ™è§£æè¯¥è·¯å¾„é‚»æ¥è¡¨ å¦åˆ™ä½¿ç”¨ä¼ å…¥çš„G \u0026quot;\u0026quot;\u0026quot; self.G = G if not path is None: self.G=nx.read_gml(path, label=\u0026quot;id\u0026quot;) #é»˜è®¤è§£ælable å¾—å‡ºçš„æ˜¯str def getG(self): return self.G def draw(self, ax, enable_lable=True, fs=6, ns=50, w=0.4) -\u0026gt; None: # Draw the route G:nx.Graph = self.G pos = nx.get_node_attributes(G, \u0026quot;pos\u0026quot;) weight_labels = {(u, v): str(d[\u0026quot;weight\u0026quot;]) for u, v, d in G.edges.data()} if enable_lable: G.edges.data nx.draw_networkx_edge_labels( G, pos, ax=ax, edge_labels=weight_labels, # å°†(n1 n2 w)å½¢å¼çš„æƒé‡è½¬lableä¼ å…¥ alpha=0.8, font_size=10, #å¤§å›¾ä¸æ¨èç”»æƒé‡ ) nx.draw_networkx( G, pos, ax = ax, with_labels=True, node_shape='o', #å®šä¹‰èŠ‚ç‚¹å½¢çŠ¶ font_size=fs, #èŠ‚ç‚¹æ ‡å·size #ä¸Šç™¾èŠ‚ç‚¹å¤§å›¾æ¨èå€¼ # font_size=24, #èŠ‚ç‚¹æ ‡å·size #å°å›¾ç”¨ # node_color='white', node_color='lightblue', edge_color=\u0026quot;black\u0026quot;, # alpha=0.5, #é€æ˜åº¦ node_size=ns, #èŠ‚ç‚¹size #ä¸Šç™¾èŠ‚ç‚¹å¤§å›¾æ¨èå€¼4 # node_size=600, #èŠ‚ç‚¹size #å°å›¾ç”¨ # linewidths=4, width=w, ) # æŒ‰ç…§é¢œè‰²åˆ’åˆ†åˆ†åŒº def draw_node(self, ax, node_lists, ns): node_color = [\u0026quot;gold\u0026quot;, \u0026quot;limegreen\u0026quot;, \u0026quot;violet\u0026quot;, \u0026quot;limered\u0026quot;, \u0026quot;limeblue\u0026quot;, \u0026quot;darkorange\u0026quot;] G:nx.Graph = self.G index = 0 for nodelist in node_lists: print(nodelist, node_color[index]) nx.draw_networkx_nodes(G, nx.get_node_attributes(G, \u0026quot;pos\u0026quot;), ax = ax, nodelist=nodelist, node_size=ns, node_color=node_color[index]) index = (index + 1) % len(node_color) æµ‹è¯•åŠè°ƒç”¨ä»£ç \ndef mytest_csr(): fig = plt.figure(figsize=(12,6)) ax = plt.subplot() G:nx.Graph = nx.Graph() G.add_edge(0, 1, weight=0.6) G.add_edge(0, 2, weight=0.2) G.add_edge(0, 3, weight=0.3) G.add_edge(2, 3, weight=0.1) G.add_edge(2, 4, weight=0.7) G.add_edge(2, 5, weight=0.9) pos = nx.spring_layout(G, seed=7) nx.set_node_attributes(G, pos, \u0026quot;pos\u0026quot;) xadj, adjncy, eweights = my_graph.get_csr_data(G) print(f\u0026quot; xadj = {xadj}\\n adjncy = {adjncy}\\n edgesList = {eweights}\u0026quot;) mydraw = graph_draw(G=G) mydraw.draw(ax) plt.show() exit()= if __name__ == \u0026quot;__main__\u0026quot;: # mytest_csr() # åˆ›å»ºå›¾ æµ‹è¯•Gè½¬æ¢CSRçš„æ­£ç¡®æ€§ ps = 3 # åˆ†åŒºæ•°é‡ node_count = 2000# èŠ‚ç‚¹æ•°é‡ radius = 0.05 # ç‚¹ä¹‹é—´è·ç¦»é˜ˆå€¼ ä¸¤ç‚¹é—´é“¾è·¯å¤§äºè¯¥å€¼ä¸äº§ç”Ÿé“¾è·¯ seed = 100 # éšæœºç§å­ fs = 24 # èŠ‚ç‚¹idå¤§å° 4 24 ns = 600 # èŠ‚ç‚¹å›¾æ ‡å¤§å° 60 600 w = 2 # é“¾è·¯ç²—ç»† 0.4 flag = True # æ˜¯å¦ç»˜åˆ¶çº¿æƒé‡ å¤§å›¾ä¸æ¨èç”»æƒé‡ save_file = f\u0026quot;node_count{node_count}_{seed}\u0026quot; read_flag = len(sys.argv) \u0026gt; 1 if read_flag: print(\u0026quot;read gml: save_file\u0026quot;) save_file = sys.argv[1] mydraw = graph_draw(path=save_file) else : mydraw = graph_draw( G=my_graph.creat(node_count, radius, seed, save_file=save_file+\u0026quot;.gml\u0026quot;)) G = mydraw.getG() # ç»˜åˆ¶åœ¨ä¸€å¼ å›¾ä¸Š # ax1 = plt.subplot(2,1,1) # ax2 = plt.subplot(2,1,2) fig = plt.figure(figsize=(8,8)) ax1 = plt.subplot() fig = plt.figure(figsize=(8,8)) ax2 = plt.subplot() mydraw.draw(ax1, enable_lable=flag, fs=fs, ns=ns, w=w) #åŸæ‹“æ‰‘å›¾ mydraw.draw(ax2, enable_lable=flag, fs=fs, ns=ns, w=w) #æ–°æ‹“æ‰‘å›¾ mydraw.draw_node(ax2, my_graph.mypart_graph(G, part=ps), ns=ns) plt.show() æ€»ç»“ 1000èŠ‚ç‚¹åˆ†å‰²ç»“æœå±•ç¤ºï¼Œä¸åŒé¢œè‰²ä»£è¡¨ä¸åŒåˆ†åŒºï¼š\nå½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨åŸºäºMPIçš„å¹¶è¡Œmetisï¼Œä¹Ÿæœ‰å°è£…åŒ…mgmetiså¯ä»¥ç”¨ï¼Œä¸å¾—ä¸æ„Ÿå¹pythonæ¯”c++ç¼–ç å¿«å¤ªå¤šäº†ï¼Œæ€§èƒ½ä¸Šä¹Ÿè¿˜è¡Œï¼Œä¹‹å‰ä¸²è¡Œçš„2000èŠ‚ç‚¹åŠ ä¸Šæ‰“å°ä¿¡æ¯ä¸åˆ°1så°±ç»˜åˆ¶å®Œäº†ã€‚ç”¨C++å†™å¯èƒ½æˆ‘ç°åœ¨è¿˜åœ¨åšå›¾å½¢åŒ–çš„å·¥ä½œã€‚ã€‚ã€‚\nå›å»Šè¯†è·¯. å›¾åˆ’åˆ†è½¯ä»¶Metisçš„ä½¿ç”¨\u0026ndash;çŸ¥ä¹ å›¾åˆ’åˆ†è½¯ä»¶Metisçš„ä½¿ç”¨\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nparadise. å›¾åˆ†å‰²Graph PartitioningæŠ€æœ¯æ€»ç»“-çŸ¥ä¹ å›¾åˆ†å‰²Graph PartitioningæŠ€æœ¯æ€»ç»“\u0026#160;\u0026#x21a9;\u0026#xfe0e;\néª‘å£«. æµå¼å›¾åˆ†å‰²\u0026ndash;éª‘å£«çš„ä¸ªäººç«™ç‚¹ æµå¼å›¾åˆ†å‰²\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nåƒæ©˜å­è¶æ—©. åŠ¨æ€å›¾åˆ’åˆ†å¤åˆ¶ç®—æ³•ï¼šLeopard\u0026ndash;çŸ¥ä¹ åŠ¨æ€å›¾åˆ’åˆ†å¤åˆ¶ç®—æ³•ï¼šLeopard\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","id":0,"section":"posts","summary":"é¢˜å¤–è¯ è¿‡å¹´ç©äº†ä¸‹é™¶ç¬›ï¼Œå…¥é—¨çœŸçš„å¾ˆå¿«ğŸ¥³ã€‚ å¤åˆ»äº†(æ¯åŸä½œ)ä»™å‰‘bgmå›æ¢¦æ¸¸ä»™ å®å¯æ¢¦æœªç™½é•‡ ã€‚è¿™ä¸ªç½‘ç«™ä¸é”™ï¼Œå¯ä»¥æŠŠé™¶ç¬›çš„ä¼´å¥å–å‡ºæ¥ è¯•å¹ä¸‹å¡å°”è¾¾çš„bg","tags":["Python","C/C++"],"title":"å›¾åˆ†å‰²å·¥å…·metis","uri":"https://liangkang233.github.io/2023/03/%E5%9B%BE%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7metis/","year":"2023"},{"content":"èƒŒæ™¯ æœ€è¿‘åœ¨åšå…³äº å®¹å™¨èµ„æºæ§åˆ¶ï¼Œæ‰€ä»¥å…·ä½“åˆ†æä¸‹lxcå®¹å™¨å’ŒCgroupsã€‚\nå…¶å®ä¹‹å‰å°±å·²ç»åšè¿‡ lxcå®¹å™¨ å’Œ dockerå®¹å™¨ çš„åŒºåˆ« å†…å®¹æ¢è®¨ï¼Œä¸è¿‡æ˜¯ç†è®ºä¸Šçš„é˜è¿°ï¼Œè¿™é‡Œæˆ‘å†ä»coreçš„å…·ä½“å®æ–½æ¥ä»‹ç»ä¸‹ã€‚\ncoreå†…lxcå®¹å™¨çš„å…·ä½“å®æ–½ é¦–å…ˆï¼Œdockerå®¹å™¨å®ç°çš„ä¸¤å¤§å…ƒç´ æ˜¯ namespace å’Œ Cgroups åšå®¹å™¨é—´å±æ€§éš”ç¦»å’Œèµ„æºæ§åˆ¶ã€‚\né¡¾åæ€ä¹‰ï¼Œlxcæ˜¯ linux contain çš„ç¼©å†™ï¼Œè¯´æ˜æ˜¯ç”±linuxå†…æ ¸å®ç°ï¼Œåšåˆ°èµ„æºçš„éš”ç¦»è¿™ä¸€å®¹å™¨çš„åŸºç¡€åŠŸèƒ½ã€‚è€Œcore æ­£æ˜¯ä½¿ç”¨ä¸€ç³»åˆ—linuxå†…æ ¸å®ç° iproute2 å°è£…çš„ netstatã€è™šæ‹Ÿç½‘ç»œè®¾å¤‡å‘½ä»¤æ„å»ºçš„å®¹å™¨çš„namespaceéš”ç¦»å’Œè™šæ‹Ÿé“¾è·¯ã€‚\nè‡³äºdockeræ˜¯ç”¨goå®ç°äº†è¿™äº›æ“ä½œæ¥å£ï¼Œå¹¶åœ¨ä¸åŒç³»ç»Ÿä¸Š(ä¾‹å¦‚windowsçš„wsl)è¿›è¡Œé€‚é…ï¼Œæ‰€ä»¥coreåªèƒ½è¿è¡Œåœ¨linuxå‘è¡Œç‰ˆä¸Šã€‚coreå¹¶æ²¡æœ‰å®ç°ä½¿ç”¨Cgroupsè¿›è¡Œç›¸å…³èµ„æºæ§åˆ¶æ“ä½œï¼Œç±»ä¼¼çš„dockerè‡ªå·±ç”¨goå®ç°äº†ï¼Œå½“ç„¶ docker çš„ namespace Cgroupsåº•å±‚è¿˜æ˜¯linuxå†…æ ¸æä¾›æ”¯æ’‘ã€‚\ncoreé‡Œlxcå®¹å™¨å’Œdockerå®¹å™¨çš„å…·ä½“å®ç°åŒºåˆ«ï¼š coreå†…çš„lxcé€šè¿‡ core/netns æ–‡ä»¶å¤¹å†…çš„ cè¯­è¨€å®ç°çš„ vnode æ¥è¿›è¡ŒåŸºç¡€çš„å®¹å™¨åˆ›å»ºï¼ˆåŠŸèƒ½ç±»ä¼¼ ip netns ç”Ÿæˆçš„æŒ‚è½½ç‚¹ä¸€èˆ¬æ˜¯/tmp/pycore.XXX/nXXX åˆå§‹ç›®å½•ä¸º /tmp/pycore.XXXX/nXXX.confï¼‰ï¼Œvcmdæ¥ä¸å®¹å™¨èŠ‚ç‚¹é€šä¿¡ä¸‹å‘æ‰§è¡Œcmdã€‚\nMount Namespace\néš”ç¦»æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šcoreä¸­ä¸ä¼šéš”ç¦»å…¨éƒ¨è·¯å¾„ï¼Œè€Œæ˜¯é»˜è®¤ä¸ä¸»æœºå…±äº«ã€‚åªæœ‰åœ¨èŠ‚ç‚¹çš„servicesé…ç½®äº†å¯¹åº”æŒ‚è½½ç‚¹æ—¶ï¼Œæ‰ä¼šæŒ‚è½½èŠ‚ç‚¹ç‹¬æœ‰ç›®å½•ã€‚ä¾‹å¦‚quaggaæœåŠ¡ä¸­ ä¸ºäº†éš”ç¦»ä¸åŒé…ç½®æ–‡ä»¶ï¼Œcoreä¼šæŒ‚è½½/usr/local/etc/quaggaæ–‡ä»¶å¤¹ã€‚\n# å®¹å™¨å†…æŸ¥è¯¢åˆ°æŒ‚è½½ç›®å½• root@n1:/tmp/pycore.34513/n1.conf# findmnt | grep quagga â”‚ â””â”€/run/quagga /dev/sda4[/pycore.34513/n1.conf/var.run.quagga] ext4 rw,relatime â””â”€/usr/local/etc/quagga /dev/sda4[/pycore.34513/n1.conf/usr.local.etc.quagga] ext4 rw,relatime # å®¿ä¸»ä¸»æœºæ— æ³•æŸ¥è¯¢åˆ°æŒ‚è½½ç›®å½• lk233@vm-5gc:~$ findmnt | grep quagga è€Œdockerç›®å½•æ¨¡å¼æ˜¯éš”ç¦»æ‰€æœ‰æ–‡ä»¶å¤¹ï¼Œé€šè¿‡UnionFSæ¥å®ç°ç›®å½•ä¸‹çš„å…¨éƒ¨éš”ç¦»ã€‚\nPID Namespace\néš”ç¦»è¿›ç¨‹IDã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šæ‰€æœ‰å®¹å™¨å†…è¿›ç¨‹éƒ½æ˜¯vnodeåˆ›å»ºè¿›ç¨‹çš„forkå­è¿›ç¨‹ï¼Œdockerå®¹å™¨ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œæ‰€ä»¥ dockerå®˜æ–¹æ–‡æ¡£ä¸æ¨èæŠŠå®¹å™¨å½“æˆè™šæ‹Ÿæœºç”¨éƒ¨ç½²å¤šä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªå®¹å™¨æ‰§è¡Œä¸€ä¸ªè¿›ç¨‹çš„æ€æƒ³ã€‚\nå…³äºpidçš„è¯¦ç»†ä»‹ç»å¯ä»¥çœ‹çœ‹è¿™ç¯‡åšå®¢ï¼Œæ€»ç»“å°±æ˜¯ï¼šç¬¬0å±‚çš„ pidå‘½åç©ºé—´æ˜¯initè¿›ç¨‹æ‰€åœ¨çš„å‘½åç©ºé—´ã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹æ‰€åœ¨çš„ pidå‘½åç©ºé—´ ä¸º Nï¼Œé‚£ä¹ˆå…¶åœ¨ 0 ~ N å±‚pidå‘½åç©ºé—´ éƒ½æœ‰ä¸€ä¸ªæ˜ å°„çš„å”¯ä¸€çš„pidå·ã€‚ä¹Ÿå°±æ˜¯è¯´ é«˜å±‚pidå‘½åç©ºé—´ çš„è¿›ç¨‹å¯¹ ä½å±‚pidå‘½åç©ºé—´ çš„è¿›ç¨‹æ˜¯å¯è§çš„ï¼Œä½†æ˜¯ ä½å±‚pidå‘½åç©ºé—´ çš„è¿›ç¨‹å¯¹ é«˜å±‚pidå‘½åç©ºé—´ çš„è¿›ç¨‹æ˜¯ä¸å¯è§çš„ã€‚ # å®¿ä¸»ä¸»æœºæ‰§è¡Œ lk233@vm-5gc:~/æ¡Œé¢/cgroups$ ps aux | grep zebra quagga 12397 0.0 0.0 27680 3160 ? Ss 11:32 0:00 /usr/sbin/zebra -d quagga 12450 0.0 0.0 27680 3116 ? Ss 11:32 0:00 /usr/sbin/zebra -d # å®¹å™¨å†…æ‰§è¡Œ root@n1:/tmp/pycore.36535/n1.conf# ps aux | grep zebra quagga 29 0.0 0.0 27680 3160 ? Ss 11:32 0:00 /usr/sbin/zebra -d ç½‘ç»œé“¾è·¯çš„åŒºåˆ«\ndockerç½‘ç»œæ¯”è¾ƒç®€å•ï¼Œæœ‰å››ç§ç½‘ç»œæ¨¡å¼ï¼š\nç½‘ç»œæ¨¡å¼ é…ç½® è¯´æ˜ bridgeæ¨¡å¼ | \u0026ndash;net=bridge | (é»˜è®¤æ¨¡å¼) æ­¤æ¨¡å¼ä¼šä¸ºæ¯ä¸€ä¸ªå®¹å™¨éš”ç¦»ç©ºé—´åï¼Œåˆ›å»ºveth pairä¸€ç«¯æ”¾å…¥å®¹å™¨è®¾ç½®IPç­‰ï¼Œå¦ä¸€ç«¯è¿æ¥åˆ°ä¸€ä¸ªdocker0è™šæ‹Ÿç½‘æ¡¥ï¼Œé€šè¿‡docker0ç½‘æ¡¥ä»¥åŠIptables natè¡¨é…ç½®ä¸å®¿ä¸»æœºç«¯å£æ˜ å°„ï¼Œç›¸äº’é€šä¿¡ã€‚ | hostæ¨¡å¼ | \u0026ndash;net=host | å®¹å™¨å’Œå®¿ä¸»æœºå…±äº«Network namespaceï¼Œå³ä¸éš”ç¦»ç½‘ç»œç©ºé—´ã€‚ | containeræ¨¡å¼ \u0026ndash;net=å®¹å™¨åæˆ–id å®¹å™¨å’Œå¦å¤–ä¸€ä¸ªå®¹å™¨å…±äº«Network namespaceã€‚ kubernetesä¸­çš„podå°±æ˜¯å¤šä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªNetwork namespaceã€‚ noneæ¨¡å¼ \u0026ndash;net=none è¯¥æ¨¡å¼å…³é—­äº†å®¹å™¨çš„ç½‘ç»œåŠŸèƒ½ï¼Œå³ä¸ä¸»æœºç½‘ç»œç©ºé—´éš”ç¦»å¼€ è€Œcoreå†…çš„lxcå®¹å™¨é»˜è®¤æ˜¯noneæ¨¡å¼ï¼Œç„¶åè‡ªå·±æ ¹æ®æ‹“æ‰‘åˆ›å»ºé“¾è·¯ï¼Œä½¿ç”¨veth pairã€ tap/tunã€bridgeç­‰ç½‘ç»œè™šæ‹Ÿè®¾å¤‡å®ç°ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªåŸºç¡€çš„ç‚¹å¯¹ç‚¹é“¾è·¯æ„å»ºã€‚\nIPC\tNamespace éš”ç¦»\nåŒºåˆ† System V IPC å’Œ POSIX æ¶ˆæ¯é˜Ÿåˆ—ã€‚\nNetwork Namespace\néš”ç¦»ç½‘ç»œè®¾å¤‡èµ„æºï¼Œä¾‹å¦‚ç«¯å£ã€ipåœ°å€ç­‰ã€‚\nUTS Namespace\néš”ç¦»ä¸»æœºåå’ŒåŸŸåã€‚\nUser Namespace\néš”ç¦»ç”¨æˆ·å’Œç”¨æˆ·ç»„ã€‚\nå…³äºCgroupsçš„ä½¿ç”¨ å‚è€ƒè¿™ç¯‡çŸ¥ä¹åšå®¢çš„ä»‹ç»ï¼Œå¤ç°äº†ä¸‹å¯¹coreå®¹å™¨çš„cpuã€å†…å­˜æ§åˆ¶ã€‚\nç›¸å…³æ¦‚å¿µä»‹ç» Cgroupså…¨ç§°Control Groupsï¼Œæ˜¯Linuxå†…æ ¸æä¾›çš„ç‰©ç†èµ„æºéš”ç¦»æœºåˆ¶ï¼Œé€šè¿‡è¿™ç§æœºåˆ¶ï¼Œå¯ä»¥å®ç°å¯¹Linuxè¿›ç¨‹æˆ–è€…è¿›ç¨‹ç»„çš„èµ„æºé™åˆ¶ã€éš”ç¦»å’Œç»Ÿè®¡åŠŸèƒ½ã€‚\næ¯”å¦‚å¯ä»¥é€šè¿‡cgroupé™åˆ¶ç‰¹å®šè¿›ç¨‹çš„èµ„æºä½¿ç”¨ï¼Œæ¯”å¦‚ä½¿ç”¨ç‰¹å®šæ•°ç›®çš„cpuæ ¸æ•°å’Œç‰¹å®šå¤§å°çš„å†…å­˜ï¼Œå¦‚æœèµ„æºè¶…é™çš„æƒ…å†µä¸‹ï¼Œä¼šè¢«æš‚åœæˆ–è€…æ€æ‰ã€‚\nCgroupæ˜¯äº2.6å†…æ ¸ç”±Googleå…¬å¸ä¸»å¯¼å¼•å…¥çš„ï¼Œå®ƒæ˜¯Linuxå†…æ ¸å®ç°èµ„æºè™šæ‹ŸåŒ–çš„æŠ€æœ¯åŸºçŸ³ï¼ŒLXC(Linux Containers)å’Œdockerå®¹å™¨æ‰€ç”¨åˆ°çš„èµ„æºéš”ç¦»æŠ€æœ¯ï¼Œæ­£æ˜¯Cgroupã€‚\nå­ç³»ç»Ÿ(subsystem): ä¸€ä¸ªå­ç³»ç»Ÿå…¶å®å°±æ˜¯ä¸€ç§èµ„æºçš„æ§åˆ¶å™¨ï¼Œåœ¨linuxä¸Šä¼šæŒ‚è½½åˆ°ä¾‹å¦‚ç›®å½•/sys/fs/cgroup/cpu/lk233_cpu_testä¸Šï¼ŒæŸ¥è¯¢å¯¹åº”æ–‡ä»¶å°±å¯ä»¥çœ‹åˆ°é…ç½®å’Œå½“å‰èµ„æºçš„å‚æ•°ï¼Œæ¯”å¦‚memoryå­ç³»ç»Ÿå¯ä»¥æ§åˆ¶è¿›ç¨‹å†…å­˜çš„ä½¿ç”¨ã€‚å­ç³»ç»Ÿéœ€è¦åŠ å…¥åˆ°æŸä¸ªå±‚çº§ï¼Œç„¶åè¯¥å±‚çº§çš„æ‰€æœ‰æ§åˆ¶ç»„ï¼Œå‡å—åˆ°è¿™ä¸ªå­ç³»ç»Ÿçš„æ§åˆ¶ã€‚\nä»»åŠ¡(task): åœ¨cgroupä¸­ï¼Œä»»åŠ¡å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚æ§åˆ¶ç»„(control group): cgroupçš„èµ„æºæ§åˆ¶æ˜¯ä»¥æ§åˆ¶ç»„çš„æ–¹å¼å®ç°ï¼Œæ§åˆ¶ç»„æŒ‡æ˜äº†èµ„æºçš„é…é¢é™åˆ¶ã€‚è¿›ç¨‹å¯ä»¥åŠ å…¥åˆ°æŸä¸ªæ§åˆ¶ç»„ï¼Œä¹Ÿå¯ä»¥è¿ç§»åˆ°å¦ä¸€ä¸ªæ§åˆ¶ç»„ã€‚æŸ¥è¯¢å¯¹åº”cat /sys/fs/cgroup/cpu/lk233_cpu_test/taskså³å¯çŸ¥é“è¯¥æ§åˆ¶ç»„åŒ…å«çš„å‚æ•°ã€‚\nå±‚çº§(hierarchy): æ§åˆ¶ç»„æœ‰å±‚çº§å…³ç³»ï¼Œç±»ä¼¼æ ‘çš„ç»“æ„ï¼Œå­èŠ‚ç‚¹çš„æ§åˆ¶ç»„ç»§æ‰¿çˆ¶æ§åˆ¶ç»„çš„å±æ€§(èµ„æºé…é¢ã€é™åˆ¶ç­‰)ã€‚çˆ¶å­é›† æœ‰å…³è” å­èµ„æºä¼šç»Ÿè®¡åˆ°çˆ¶level å¼ºåˆ¶ä¿®æ”¹çˆ¶çš„å°äºå­é™åˆ¶,å¯¹åº”çš„çˆ¶æˆ–å­ä¼šæ”¹ä¸ºé»˜è®¤å€¼(æ— é™åˆ¶)ã€‚ä½¿å¾—å±‚çº§ä»ä¸Šå¾€ä¸‹ ä¾ç…§æœ€å°çš„èµ„æºæ§åˆ¶ç»„æ¥ç®—ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œlimit_50æ§åˆ¶ç»„å°±æ˜¯lk233_cpu_testæ§åˆ¶ç»„çš„å­é›†åˆï¼Œå…¶å—åˆ°çˆ¶æ§åˆ¶ç»„çš„é™åˆ¶ã€‚\nlk233@vm-5gc:/sys/fs/cgroup/cpu/lk233_cpu_test$ tree . â”œâ”€â”€ cgroup.clone_children â”œâ”€â”€ cgroup.procs â”œâ”€â”€ cpuacct.XX â”œâ”€â”€ cpu.XX â”œâ”€â”€ limit_50 â”‚ â”œâ”€â”€ cgroup.clone_children | â”œâ”€â”€ cpuacct.XX | â”œâ”€â”€ cpu.XX #ç±»ä¼¼çˆ¶æ–‡ä»¶å¤¹å†…å®¹ â”‚ â””â”€â”€ tasks â”œâ”€â”€ notify_on_release â””â”€â”€ tasks å®é™…æµ‹è¯• ä¸»è¦åˆ†æä¸‹ cpu memoryç›¸å…³çš„å‚æ•°ï¼š\ncpuæ–‡ä»¶å¤¹å†…å®¹ï¼š lk233@vm-5gc:/sys/fs/cgroup/cpu/lk233_cpu_test/limit_50$ tree . â”œâ”€â”€ cgroup.clone_children â”œâ”€â”€ cgroup.procs â”œâ”€â”€ cpuacct.stat â”œâ”€â”€ cpuacct.usage â”œâ”€â”€ cpuacct.usage_all â”œâ”€â”€ cpuacct.usage_percpu â”œâ”€â”€ cpuacct.usage_percpu_sys â”œâ”€â”€ cpuacct.usage_percpu_user â”œâ”€â”€ cpuacct.usage_sys â”œâ”€â”€ cpuacct.usage_user â”œâ”€â”€ cpu.cfs_period_us â”œâ”€â”€ cpu.cfs_quota_us â”œâ”€â”€ cpu.shares â”œâ”€â”€ cpu.stat â”œâ”€â”€ cpu.uclamp.max â”œâ”€â”€ cpu.uclamp.min â”œâ”€â”€ notify_on_release â””â”€â”€ tasks cfsæ˜¯Completely Fair Schedulerçš„ç¼©å†™ï¼Œä»£è¡¨å®Œå…¨å…¬å¹³è°ƒåº¦ï¼Œrtæ˜¯RealTimeçš„ç¼©å†™ï¼Œå®ƒæ˜¯å®æ—¶è°ƒåº¦ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯cfsè°ƒåº¦æœºåˆ¶ã€‚\nå…·ä½“ä»‹ç»ï¼Œå¤§æ¦‚åˆ†ä¸ºä¸¤ç±»: cpu.XX : ç”¨æ¥é™åˆ¶cgroupçš„CPUä½¿ç”¨ç‡ cpuacct.XX : ç”¨æ¥ç»Ÿè®¡cgroupçš„CPUçš„ä½¿ç”¨ç‡ å¯ä»¥åˆ©ç”¨cpuacctçš„å€¼æ¥åšcpuæ€§èƒ½ç›‘æ§ï¼š cpuacct.usage: è¯¥cgroupä¸­æ‰€æœ‰ä»»åŠ¡æ€»å…±ä½¿ç”¨çš„CPUæ—¶é—´ï¼ˆnsçº³ç§’ï¼‰ cpuacct.stat: è¯¥cgroupä¸­æ‰€æœ‰ä»»åŠ¡æ€»å…±ä½¿ç”¨çš„CPUæ—¶é—´ï¼ŒåŒºåˆ†userå’Œsystemæ—¶é—´ã€‚ cpuacct.usage_percpu: è¯¥cgroupä¸­æ‰€æœ‰ä»»åŠ¡ä½¿ç”¨å„ä¸ªCPUæ ¸æ•°çš„æ—¶é—´ã€‚ è®¡ç®—cpuåˆ©ç”¨ç‡ç¤ºä¾‹ï¼š\n# 1. è·å–å½“å‰æ—¶é—´ï¼ˆçº³ç§’ï¼‰ tstart=$(date +%s%N) # 2. è·å–cpuacct.usage cstart=$(cat /xxx/cpuacct.usage) # 3. é—´éš”5sç»Ÿè®¡ä¸€ä¸‹ sleep 5 # 4. å†æ¬¡é‡‡ç‚¹ tstop=$(date +%s%N) cstop=$(cat /xxx/cpuacct.usage) # 5. è®¡ç®—åˆ©ç”¨ç‡ ($cstop - $cstart) / ($tstop - $tstart) * 100 memoryæ–‡ä»¶å¤¹å†…å®¹ï¼š lk233@vm-5gc:/sys/fs/cgroup/memory/lk233_cpu_test/limit_50$ tree . â”œâ”€â”€ cgroup.clone_children â”œâ”€â”€ cgroup.event_control â”œâ”€â”€ cgroup.procs â”œâ”€â”€ memory.failcnt â”œâ”€â”€ memory.force_empty â”œâ”€â”€ memory.kmem.failcnt â”œâ”€â”€ memory.kmem.limit_in_bytes â”œâ”€â”€ memory.kmem.max_usage_in_bytes â”œâ”€â”€ memory.kmem.slabinfo â”œâ”€â”€ memory.kmem.tcp.failcnt â”œâ”€â”€ memory.kmem.tcp.limit_in_bytes â”œâ”€â”€ memory.kmem.tcp.max_usage_in_bytes â”œâ”€â”€ memory.kmem.tcp.usage_in_bytes â”œâ”€â”€ memory.kmem.usage_in_bytes â”œâ”€â”€ memory.limit_in_bytes â”œâ”€â”€ memory.max_usage_in_bytes â”œâ”€â”€ memory.move_charge_at_immigrate â”œâ”€â”€ memory.numa_stat â”œâ”€â”€ memory.oom_control â”œâ”€â”€ memory.pressure_level â”œâ”€â”€ memory.soft_limit_in_bytes â”œâ”€â”€ memory.stat â”œâ”€â”€ memory.swappiness â”œâ”€â”€ memory.usage_in_bytes â”œâ”€â”€ memory.use_hierarchy â”œâ”€â”€ notify_on_release â””â”€â”€ tasks å†…å­˜çš„å…·ä½“å‚æ•°å°±ä¸èµ˜è¿° å…·ä½“å¯ä»¥çœ‹çŸ¥ä¹æˆ–google\nCgroupsèµ„æºæ“ä½œ åŸå§‹çš„æ–¹æ³•ï¼Œä¾‹å¦‚æˆ‘è¿™é‡Œé™åˆ¶cpuå ç”¨ä¸º50%ï¼Œå¯ä»¥å¦‚ä¸‹æ‰§è¡Œ\nsudo mkdir /sys/fs/cgroup/cpu/lk233_cpu_test/limit_50/ # åˆ›å»ºå¥½ç›®å½•åå°±ä¼šè‡ªåŠ¨æŒ‚è½½å¹¶ç”Ÿæˆå¯¹åº”æ§åˆ¶ç»„æ–‡ä»¶ sudo echo '100000' \u0026gt; test_cpu/cpu.cfs_period_us sudo echo '50000' \u0026gt; test_cpu/cpu.cfs_quota_us sudo echo è¿›ç¨‹pid \u0026gt;\u0026gt; /sys/fs/cgroup/cpu/lk233_cpu_test/limit_50/tasks å½“ç„¶ä¸å¿…å¦‚æ­¤åŸå§‹æ“ä½œï¼Œå¯ä»¥å¦‚ä¸‹sudo apt install cgroup-binä½¿ç”¨ä¸€äº›è‡ªåŠ¨åˆ›å»ºçš„å·¥å…·ï¼Œä¾‹å¦‚ä¸Šé¢çš„lk233_cpu_test æ˜¯ä¸€ä¸ªç®¡ç†ç»„ï¼Œç›´æ¥ç”¨ cgcreate åšä¹Ÿå¯ã€‚ï¼ˆåˆ›å»ºçš„åå­—éšæ„ï¼Œè¿™é‡Œå†…å­˜æ§åˆ¶ç»„æ— æ„çš„å‘½åä¸ºlk233_cpu_testäº†ğŸ˜‚ï¼‰\n# åˆ›å»ºæ§åˆ¶ç»„ sudo cgcreate -t $USER:$USER -a $USER:$USER -g cpu:lk233_cpu_test/limit_50 # ç”¨æ¥é…ç½®æ—¶é—´å‘¨æœŸé•¿åº¦ï¼Œå•ä½æ˜¯usï¼Œå–å€¼èŒƒå›´1000~1000000ï¼š1ms ~ 1s ç³»ç»Ÿæ€»æ—¶é—´ç‰‡ä¸º æ ¸å¿ƒæ•° * cpu.cfs_period_us cgset -r cpu.cfs_period_us=100000 lk233_cpu_test/limit_50 # è®¾ç½®å¯ç”¨CPUæ—¶é—´æ•°ï¼Œå•ä½usï¼Œæœ€å°å€¼ä¸º1000 cgset -r cpu.cfs_quota_us=50000 lk233_cpu_test/limit_50 # åˆ é™¤æ§åˆ¶ç»„ sudo cgdelete cpu:lk233_cpu_test/limit_50 # è¯»å–é…ç½®ç»„å‚æ•° cgget -g cpu:lk233_cpu_test/limit_50 # åŒç†å†…å­˜è®¾ç½®ä¸Šé™ä¸º100MB(å‚æ•°å•ä½ä¸ºå­—èŠ‚)çš„æ“ä½œç±»ä¼¼ å…·ä½“å¦‚ä¸‹æ‰€ç¤º sudo cgcreate -t $USER:$USER -a $USER:$USER -g memory:lk233_cpu_test/limit_50 cgset -r memory.limit_in_bytes=104857600 lk233_cpu_test/limit_50 æ‰§è¡Œç¨‹åº ç”±äºä»£ç åªè€ƒè™‘äº†çº¿ç¨‹çš„æƒ…å†µï¼Œlxcå®¹å™¨å†…è¿›ç¨‹æ˜¯forkå½¢å¼ï¼Œæ‰€ä»¥è¿™é‡Œä»£ç é‡Œæ·»åŠ äº†ä¸€ä¸ªforkçš„å‡½æ•°ã€‚ç¼–è¯‘è¯¥ç¨‹åºï¼Œè®°å¾—æ·»åŠ åŠ¨æ€åº“å‚æ•° g++ -o cpu_test cpu_test.cpp --std=c++11 -lpthread\nvoid test_cpu() { pid_t tid = syscall(SYS_gettid); printf(\u0026quot;cpu theard id is %d\\n\u0026quot;, tid); int total = 0; while (1) { ++total; } } void test_mem() { pid_t tid = syscall(SYS_gettid); printf(\u0026quot;mem theard id is %d\\n\u0026quot;, tid); int step = 10; int size = 20 * 1024 * 1024; // 20Mb for (int i = 0; i \u0026lt; step; ++i) { char* tmp = new char[size]; if (tmp == nullptr) { printf(\u0026quot;new error, %d MB memory is used\\n\u0026quot;, i*20); return; } printf(\u0026quot;tmp address is %p\\n\u0026quot;, tmp); memset(tmp, i, size); sleep(1); } printf(\u0026quot;thread: 200 MB memory is used\\n\u0026quot;); } int main(int argc, char** argv) { // è·‘cpuã€å†…å­˜çº¿ç¨‹ï¼Œå¹¶ä¸”forkå†…å­˜è¿›ç¨‹ pid_t tid = syscall(SYS_gettid); printf(\u0026quot;father theard id is %d\\n\u0026quot;, tid); std::thread t1(test_cpu); std::thread t2(test_mem); pid_t pid = fork(); if (pid \u0026lt; 0) { printf(\u0026quot;error\\n\u0026quot;); return 1; } else if (pid == 0) { printf(\u0026quot;fork success,this is son process: \u0026quot;); test_cpu(); } else { t1.join(); t2.join(); } return 0; } int main1(int argc, char** argv) { // è·‘ä¸¤ä¸ªcpuçº¿ç¨‹ pid_t tid = syscall(SYS_gettid); printf(\u0026quot;father theard id is %d\\n\u0026quot;, tid); std::thread t1(test_cpu); std::thread t2(test_cpu); t1.join(); t2.join(); return 0; } ç»“æœåˆ†æ æˆ‘ä»¬è‡ªå·±å»ºçš„æ§åˆ¶ç»„é‡å¯åä¼šä¸¢å¤± å¯ä»¥ç±»ä¼¼dockerçš„serviceé‡å¯åè‡ªåŠ¨åˆ›å»ºå¯¹åº”æ§åˆ¶ç»„\ncpuç›¸å…³çš„æ§åˆ¶æµ‹è¯•\ncpu_test å­çº¿ç¨‹test_cpuå‡½æ•°å¾ªç¯+1ä¼šå ç”¨æ‰€æœ‰cpuæ—¶é—´ç‰‡ï¼Œå®¹æ˜“æ˜¾ç¤ºè§‚å¯Ÿåˆ°ã€‚é¦–å…ˆæ³¨é‡Štest_memå†…å­˜ç›¸å…³çš„ä»£ç ã€‚é€šè¿‡ cgexec å®ç°æ‰§è¡Œè¯¥è¿›ç¨‹ç›´æ¥åŠ å…¥æ§åˆ¶ç»„cgexec -g cpu:lk233_cpu_test/limit_50 ./cpu_test\næœªè®¾ç½®æ§åˆ¶ç»„(ä¸»å‡½æ•°æ‰§è¡Œmain1æƒ…å†µ):\nç”±äºæˆ‘çš„linuxä¸»æœºæ˜¯åŒæ ¸çš„ï¼Œæ‰€ä»¥topå‘½ä»¤æŸ¥å‡ºæ¥çš„cpuå ç”¨è¾¾åˆ°200%ã€‚(ä¸¤ä¸ªcpuæ ¸è·‘æ»¡)\nè®¾ç½®æ§åˆ¶ç»„å\nå¯ä»¥çŸ¥é“æ§åˆ¶ç»„æ§åˆ¶cpuæ—¶é—´æ˜¯ç»Ÿè®¡åŠ å…¥åˆ°æ”¹ç»„çš„å…¨éƒ¨è¿›ç¨‹ã€çº¿ç¨‹å¹¶æ§åˆ¶ã€‚æ‰€ä»¥å‰é¢è®¾ç½®æ—¶é—´ç‰‡ä¸º50000ï¼Œå“ªæ€•æ˜¯ä¸¤ä¸ªçº¿ç¨‹ä¹Ÿåªå äº†50%ã€‚è¿™é‡Œ æ€»æ—¶é—´ç‰‡ä¸º cpu.cfs_period_us * 4 = 400000 cpuæœ€å¤§è·‘åˆ°400%ã€‚\næŸ¥è¯¢task cat /sys/fs/cgroup/cpu/lk233_cpu_test/limit_50/taskså¯ä»¥çœ‹åˆ°æœ‰å¤šå°‘è¿›ç¨‹åŠ å…¥è¯¥æ§åˆ¶ç»„ã€‚\nä½†æ˜¯è¿™é‡Œæˆ‘çœ‹åˆ°äº†ä¸¤ä¸ªpidï¼Œå¯æ˜¯æŒ‰ç…§æˆ‘ä»¬å¹³æ—¶çš„å­¦ä¹ ï¼Œä¸€ä¸ªè¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹å…¬ç”¨ä¸€ä¸ªpidã€‚æ‰€ä»¥æˆ‘è¯•ç€ä½¿ç”¨ attach å‘½ä»¤å°†è¿è¡Œçš„è¿›ç¨‹åŠ å…¥æ§åˆ¶ç»„çš„taskçœ‹çœ‹æ˜¯å¦ä¼šå˜æˆä¸¤ä¸ªã€‚\nå°†pidç»‘å…¥å¯¹åº”ç›®å½•taskï¼Œcgclassify -g cpu:lk233_cpu_test/limit_50 çº¿ç¨‹tid list æƒ³è¦åˆ é™¤æ§åˆ¶å¯ä»¥ç•™ä¸€ä¸ªæ²¡æœ‰é…ç½®çš„æ§åˆ¶ç»„ï¼Œå°†è¯¥è¿›ç¨‹ç§»æ¤è¿‡å»ã€‚ç»“æœæŸ¥è¯¢taskå‘ç°åªæœ‰ä¸€ä¸ªpidï¼Œä½†æ˜¯cpuèµ„æºå¹¶æ²¡æœ‰å—åˆ°æ§åˆ¶ã€‚è¯´æ˜æ´¾ç”Ÿçš„çº¿ç¨‹æ²¡æœ‰åŠ å…¥æ§åˆ¶ç»„ã€‚\nä¸€ç•ªæŸ¥è¯¢åï¼Œstackflowä¸Šçš„è¿™ä¸ªå›ç­”å¾ˆä¸é”™ã€‚\næ³¨æ„è¿™é‡Œçš„å¤šçº¿ç¨‹ pid ç”¨æˆ·æ€å­çº¿ç¨‹pid(çº¿ç¨‹ç»„tgid)çš„ç¡®ç›¸åŒ ä½†æ˜¯å†…æ ¸æ€ä¸åŒ(å«åš thread id, tid) æ‰€ä»¥æ·»åŠ taskè¿™é‡Œåªé™åˆ¶çˆ¶çº¿ç¨‹æ— æ•ˆ\n/* ç”¨æˆ·æ€çœ‹çš„æ˜¯ tgid å†…æ ¸æ€çœ‹çš„æ˜¯tid **USER VIEW** \u0026lt;-- PID 43 --\u0026gt;|\u0026lt;----------------- PID 42 -----------------\u0026gt; | | | +---------+ | | | process | | | __| tid=42 |__ | __(fork)__/ | tgid=42 | \\__(new thread)_ / | +---------+ | \\ +---------+ | | +---------+ | process | | | | process | | tid=43 | | | | tid=44 | | tgid=43 | | | | tgid=42 | +---------+ | | +---------+ | | \u0026lt;-- PID 43 --\u0026gt;|\u0026lt;--------- PID 42 ---------\u0026gt;|\u0026lt;--- PID 44 ---\u0026gt; **KERNEL VIEW** # å‘½ä»¤è¡Œä¸‹æŸ¥è¯¢ å¯ä»¥çœ‹åˆ°å­çº¿ç¨‹çš„tid pstree -p pid cpu_test(79426)â”€â”¬â”€{cpu_test}(79427) â””â”€{cpu_test}(79428) # ç¨‹åºä¸­ tgid: getpid() tid: syscall(SYS_gettid) çº¿ç¨‹id: pthread_self() # çº¿ç¨‹id æ˜¯ pthread åº“ç»´æŒçš„, æ•…æ­¤â€œIDâ€çš„ä½œç”¨åŸŸæ˜¯è¿›ç¨‹çº§è€Œéç³»ç»Ÿçº§ # æ‰€ä»¥å‰é¢çš„cppä»£ç æˆ‘ç›´æ¥æ·»åŠ äº†æ‰“å°tidçš„è¯­å¥ã€‚ æˆ‘åœ¨æ­¤ä¹‹åç»§ç»­æµ‹è¯•ï¼Œæœ€åå¾—å‡ºç»“è®ºï¼šæ·»åŠ å…¥æ§åˆ¶ç»„çš„è¿›ç¨‹ï¼Œæ— è®ºforkè¿˜æ˜¯å­çº¿ç¨‹éƒ½ä¼šè‡ªåŠ¨åŠ å…¥æ§åˆ¶ç»„ï¼Œåœ¨æ­¤ä¹‹å‰çš„ä¸ä¼šåŠ å…¥æ§åˆ¶ç»„ã€‚\nä¸‹é¢æ˜¯æˆ‘å°†coreé‡Œçš„lxcå®¹å™¨ç»‘å®šåˆ°æ§åˆ¶ç»„çš„ç»“æœ\nå†…å­˜ç›¸å…³çš„æ§åˆ¶æµ‹è¯•\nåœ¨topç»ˆç«¯ç•Œé¢ä¸‹è¾“å…¥hæŸ¥çœ‹å¸®åŠ©ã€‚æŒ‰Eåˆ‡æ¢å†…å­˜å•ä½ï¼Œ1å¼€å¯cpuæ ¸å¿ƒæŸ¥çœ‹ï¼ŒmæŸ¥çœ‹å†…å­˜è¯¦ç»†ä½¿ç”¨ã€‚\næ­£å¸¸å¯åŠ¨æ—¶ï¼Œå¯ä»¥çœ‹åˆ°å†…å­˜å ç”¨ä¸º 5917.914 * 3.4% = 201 mb\nå†…å­˜æ§åˆ¶ç»„ç±»ä¼¼cpuæ§åˆ¶ç»„åšæ³•ï¼Œè¿™é‡Œè¿›ç¨‹æ—¢åŠ å…¥cpuæ§åˆ¶ç»„ä¹ŸåŠ å…¥å†…å­˜æ§åˆ¶ç»„ã€‚\ncgexec -g cpu:lk233_cpu_test/limit_50 -g memory:lk233_cpu_test/limit_50 ./cpu_test\nç»“æœåˆ›å»ºå†…å­˜æ¡ˆä¾‹ä¼šåˆ›å»º200Mbï¼Œä½†æ˜¯æˆ‘é™åˆ¶äº†100mbä¼šæŠ¥é”™ä¹‹ç±»çš„ï¼Œä½†æ˜¯ä¸€åˆ‡æ­£å¸¸ï¼Œåªæ˜¯æ‰§è¡Œåé¢ç”³è¯·100mbæ—¶æ‰“å°è¯­å¥é€Ÿåº¦å˜æ…¢ã€‚\nä»”ç»†è§‚å¯Ÿåå‘ç°ï¼ŒåŸæ¥å†…å­˜ä¸å¤Ÿä»–å»ç”³è¯·è™šæ‹Ÿå†…å­˜å»äº†ï¼Œä»€ä¹ˆç²¾æ‰“ç»†ç®—å¤ŸğŸ™„\næˆ‘ä»¬ç»§ç»­ï¼Œçœ‹çœ‹è®¾ç½®ä¸ç”¨è™šæ‹Ÿå†…å­˜ å†…å­˜ä¸å¤Ÿåä¼šå‘ç”Ÿä»€ä¹ˆã€‚\ncgset -r memory.swappiness=0 lk233_cpu_test/limit_50\nç»“æœå°±æ˜¯ç»ˆç«¯ç›´æ¥æ‰“å° å·²æ€æ­»ï¼Œå¥½å®¶ä¼™ï¼ç„¶åçœ‹äº†è¿™ç¯‡æ–‡ç« å¯ä»¥é…ç½® oom_kill_disable åœ¨æ§åˆ¶ç»„å†…è¿›ç¨‹ç”³è¯·å†…å­˜ä¸è¶³æ—¶ç­‰å¾…è€Œä¸æ˜¯ç›´æ¥æ€æ­»\ncgset -r memory.oom_control=1 lk233_cpu_test/limit_50\næ€»ç»“ coreå†…çš„lxcå®¹å™¨æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨ cgclassify ç»‘å®šæ§åˆ¶ç»„çš„ï¼Œä¹‹åå¯ä»¥é’ˆå¯¹ä¸åŒéœ€æ±‚æå‰è‡ªåŠ¨åŒ–åˆ›å»ºæ§åˆ¶ç»„ã€‚ä¹Ÿå¯ä»¥åœ¨ç•Œé¢æ·»åŠ é€‰é¡¹æ¥å£ï¼Œä½¿ç”¨cpuacct.usageç­‰å‚æ•°è®¡ç®—cpuå ç”¨ï¼Œåšåˆ°å®æ—¶åˆ›å»ºæ§åˆ¶ç»„å¹¶å®ç°å®¹å™¨èµ„æºçš„æ§åˆ¶ä¸ç›‘å¬ã€‚\n","id":1,"section":"posts","summary":"èƒŒæ™¯ æœ€è¿‘åœ¨åšå…³äº å®¹å™¨èµ„æºæ§åˆ¶ï¼Œæ‰€ä»¥å…·ä½“åˆ†æä¸‹lxcå®¹å™¨å’ŒCgroupsã€‚ å…¶å®ä¹‹å‰å°±å·²ç»åšè¿‡ lxcå®¹å™¨ å’Œ dockerå®¹å™¨ çš„åŒºåˆ« å†…å®¹æ¢è®¨ï¼Œä¸è¿‡æ˜¯","tags":["linux","å®¹å™¨"],"title":"Cgroupsç®¡ç†lxcå®¹å™¨å°ç»“","uri":"https://liangkang233.github.io/2022/11/lxc%E5%AE%B9%E5%99%A8%E8%B5%84%E6%BA%90%E7%AE%A1%E6%8E%A7%E4%B8%8E%E6%9F%A5%E8%AF%A2/","year":"2022"},{"content":"èƒŒæ™¯ gRPCæ˜¯è°·æ­Œå¼€æºçš„ä¸€å¥—åŸºäºHttpå®ç°çš„rpcé€šè®¯æ¡†æ¶ï¼Œç”¨ protobuf å®ç°ä¼ è¾“æ•°æ®çš„å®šä¹‰,å…¶æ ¼å¼ç±»ä¼¼jsonã€‚ç”±äºå…¶å®ç°äº†å¤šå¹³å°ï¼Œåœ¨ä¸åŒç¼–ç¨‹è¯­è¨€ä¸Šç”¨ä¸€å¥— probuf æ•°æ®çš„å®šä¹‰å°±å¯ä»¥ç”Ÿæˆä¸åŒrpcè°ƒç”¨ å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ï¼Œä¸ç”¨è‡ªå·±å»å®ç°æœåŠ¡ç«¯çš„ç›‘å¬æ•°æ®æ ¡æ£€ç­‰ç­‰ï¼Œæ˜¯ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„å·¥å…·ã€‚\næˆ‘è¿™é‡Œéœ€è¦é‡‡ç”¨è¯¥å·¥å…·å¼€å‘ä¸€å¥— å¼‚æ­¥å¹¶å‘çš„è¿œç«¯è°ƒç”¨çš„ç¨‹åºï¼Œæ‰€ä»¥å¿«é€Ÿçš„å­¦äº†ä¸‹å…¶å·¥ä½œåŸç†ï¼Œå†™äº†ä¸ªç®€å•çš„å¼‚æ­¥é€šä¿¡çš„æ¨¡æ¿ã€‚\nå­¦ä¹ åŸºç¡€å››ç§é€šä¿¡æ–¹å¼è°ƒç”¨ ä¸»è¦æ˜¯çœ‹è¿™ç¯‡åšå®¢å’Œå®˜æ–¹Python gRPCæ•™ç¨‹ï¼Œå­¦ä¹ äº†Pythonçš„gRPCçš„ä½¿ç”¨æ–¹å¼ã€‚ç›¸æ¯”å®˜ç½‘ç»™çš„ä¾‹ç¨‹ï¼Œä»–è¿˜ç»™å‡ºäº† ä¸€ä¸ªç±»ä¼¼å¿ƒè·³ä¼ å‘¼çš„æœºåˆ¶ ç”¨æœåŠ¡ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚åŸæ–‡è§‚çœ‹éœ€è¦éªŒè¯ç ï¼Œæˆ‘è¿™é‡Œæœ‰æ‰“å°å‡ºçš„pdf\ngRPCçš„rpcè°ƒç”¨æœ‰å››ç§å·¥ä½œæ¨¡å¼ï¼š\nåŸºç¡€çš„RPCï¼Œå…¶ä¸­å®¢æˆ·ç«¯ä½¿ç”¨å­˜æ ¹å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ å¹¶ç­‰å¾…å“åº”è¿”å›ï¼Œå°±åƒæ­£å¸¸çš„å‡½æ•°è°ƒç”¨ä¸€æ ·ã€‚\nrpc GetFeature(Point) returns (Feature) {} å“åº”æµå¼å¤„ç† RPCï¼Œå…¶ä¸­å®¢æˆ·æœºå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚å¹¶è·å¾—ä¸€ä¸ªæµä»¥è¯»å–è¿”å›çš„æ¶ˆæ¯åºåˆ—ã€‚å®¢æˆ·ç«¯ä»è¿”å›çš„æµä¸­è¯»å–ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šçš„æ¶ˆæ¯\nrpc ListFeatures(Rectangle) returns (stream Feature) {} è¯·æ±‚æµå¼ RPCï¼Œå…¶ä¸­å®¢æˆ·ç«¯å†™å…¥ä¸€ç³»åˆ—æ¶ˆæ¯å¹¶å°†å®ƒä»¬å‘é€åˆ°æœåŠ¡å™¨ï¼ŒåŒæ ·ä½¿ç”¨æä¾›çš„æµã€‚ä¸€æ—¦å®¢æˆ·æœºå®Œæˆäº†æ¶ˆæ¯çš„å†™å…¥ï¼Œå®ƒå°†ç­‰å¾…æœåŠ¡å™¨è¯»å–æ‰€æœ‰æ¶ˆæ¯å¹¶è¿”å›å…¶å“åº”ã€‚\nrpc RecordRoute(stream Point) returns (RouteSummary) {} åŒå‘æµå¼ä¼ è¾“ RPCï¼Œè¿™ä¸¤ä¸ªæµæ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œå› æ­¤å®¢æˆ·æœºå’ŒæœåŠ¡å™¨å¯ä»¥æŒ‰ç…§å®ƒä»¬å–œæ¬¢çš„ä»»ä½•é¡ºåºè¿›è¡Œè¯»å†™:ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨å¯ä»¥ç­‰å¾…æ¥æ”¶æ‰€æœ‰å®¢æˆ·æœºæ¶ˆæ¯åå†å†™å…¥å…¶å“åº”ï¼Œæˆ–è€…å®ƒå¯ä»¥äº¤æ›¿è¯»å–ä¸€æ¡æ¶ˆæ¯ï¼Œç„¶åå†å†™å…¥ä¸€æ¡æ¶ˆæ¯ï¼Œæˆ–è€…å…¶ä»–è¯»å†™çš„ç»„åˆã€‚ä¿ç•™æ¯ä¸ªæµä¸­çš„æ¶ˆæ¯é¡ºåºã€‚\nrpc RouteChat(stream RouteNote) returns (stream RouteNote) {} åŸºç¡€çš„ä½¿ç”¨æˆ‘è¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°ï¼Œåªçœ‹çœ‹ä»–è¿™é‡Œæµçš„ä½¿ç”¨ã€‚ä¸è¿‡åšå®¢çš„ä»£ç ç›´æ¥ä½¿ç”¨æœ‰äº›é—®é¢˜ï¼Œæˆ‘è¿™è¾¹å®é™…æµ‹è¯•åçš„ä»£ç è´´å‡ºã€‚\nä»£ç ç»“æ„å’Œä»–ä¸€æ ·\n. â”œâ”€â”€ contact â”‚ â”œâ”€â”€ contact.proto â”‚ â””â”€â”€ __init__.py â”œâ”€â”€ contact_client.py â””â”€â”€ contact_server.py æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤python -m grpc_tools.protoc -I . --python_out=. --grpc_python_out=. contact/*.protoç”Ÿæˆ contact_pb2_grpcåŒ…å«äº†å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯çš„è°ƒç”¨å‡½æ•°ï¼Œcontact_pb2.py å°±æ˜¯messageæ•°æ®çš„å®šä¹‰ã€‚pythoné‡Œä¸ºäº†å¯ä»¥å®ç°ç±»ä¼¼ æµçš„ for in æ“ä½œä½¿ç”¨yieldæ¥æŠŠæµæ•°æ®å°è£…ã€‚ Python yield ä½¿ç”¨æµ…æ\nå®ƒä¾‹å­çš„åŒå‘æµæˆ‘å°±ä¸ä»‹ç»äº†ï¼Œè¿˜è›®æœ‰æ„æ€çš„çš„çœ‹çœ‹ä»–pythonæµçš„å®ç°ã€‚stubå°±æ˜¯å®¢æˆ·ç«¯ï¼Œserverå°±æ˜¯ grpc.serverã€‚\ncontact\\contact.proto:\nsyntax = \u0026quot;proto3\u0026quot;; // å®šä¹‰ä¸€ä¸ªæœåŠ¡ service Contact { // å®¢æˆ·ç«¯é€šä¿¡ç»™æœåŠ¡ç«¯ï¼Œé€šä¿¡æ–¹å¼å¯ä»¥éšæ„é€‰æ‹©ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©ç¬¬4ç§é€šä¿¡æ–¹å¼ rpc sendStatus (stream ClientMsg) returns (stream Result); // å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªç©ºæ¶ˆæ¯ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å°±èƒ½ç»™å®¢æˆ·ç«¯é€šä¿¡äº† rpc getTask (Empty) returns (stream ServerMsg); // å®¢æˆ·ç«¯æ¥å—å®ŒæœåŠ¡ç«¯æ¶ˆæ¯å¤„ç†å®Œåï¼Œå†å‘Šè¯‰æœåŠ¡ç«¯ã€‚è¿™ä¸ªtellResultä¹Ÿå¯ä»¥ä¸è¦ï¼Œçœ‹å…·ä½“éœ€æ±‚ rpc tellResult (stream Result) returns (Empty); } message ClientMsg { string msg = 1; } message ServerMsg { string task = 1; } message Empty { } message Result { string ret = 1; } contact_client.py\nimport logging import random import threading import time import grpc from contact import contact_pb2 from contact import contact_pb2_grpc # å…ˆåˆ¶é€ ä¸€äº›å®¢æˆ·ç«¯èƒ½å‘é€çš„æ•°æ® def make_some_data(): for i in range(10): print(f\u0026quot;å‘é€å½“å‰çŠ¶æ€ï¼š{i}\u0026quot;) yield contact_pb2.ClientMsg(msg=f\u0026quot;æ•°æ®:{i}\u0026quot;) def send_status(stub): # å¼€å¯ä¸€ä¸ªçº¿ç¨‹æ¯éš”60så‘é€å½“å‰æµ10ç»„çš„çŠ¶æ€åŒ… try: while True: status_response = stub.sendStatus(make_some_data()) for ret in status_response: print(ret.ret) print(\u0026quot;å‘é€å®Œæ¯•\u0026quot;) time.sleep(60) except Exception as e: print(f'err in send_status:{e}') return # æ¥æ”¶æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„ä»»åŠ¡ def get_task(stub): try: for task in stub.getTask(contact_pb2.Empty()): print(f\u0026quot;å®¢æˆ·ç«¯å·²æ¥æ”¶åˆ°æœåŠ¡ç«¯ä»»åŠ¡ï¼š{task.task}\\n\u0026quot;) # é¡ºä¾¿å†å‘Šè¯‰æœåŠ¡ç«¯æˆ‘å·²ç»æ¥æ”¶åˆ°ä½ å‘çš„ä»»åŠ¡ï¼Œä½ ä¸ç”¨æ‹…å¿ƒæˆ‘æ²¡æ¥æ”¶åˆ°å®ƒ yield contact_pb2.Result( ret=f\u0026quot;å®¢æˆ·ç«¯æ¥æ”¶åˆ°ä»»åŠ¡:{task.task}\u0026quot; ) except Exception as e: print(f'err:{e}') return def run(): with grpc.insecure_channel('localhost:55555') as channel: stub = contact_pb2_grpc.ContactStub(channel) threading.Thread(target=send_status, args=(stub,), daemon=True).start() while True: try: send_status(stub) # result = get_task(stub) # stub.tellResult(result) except grpc.RpcError as e: print(f\u0026quot;server connected out, please retry:{e.code()},{e.details()}\u0026quot;) except Exception as e: print(f'unknown err:{e}') finally: time.sleep(2) if __name__ == '__main__': run() contact_server.py (åŸºæœ¬æ²¡é—®é¢˜ï¼ŒæŠŠsendStatusçš„è¿”å›å€¼çš„Resultæ”¹ä¸ºretå³å¯)\nimport logging import random import time from concurrent import futures import grpc from contact import contact_pb2_grpc from contact import contact_pb2 class MyserverClass: def __init__(self) -\u0026gt; None: self.tasks = [] # æ³¨æ„æœåŠ¡ç«¯çš„å…·ä½“å®ç°å‡½æ•°æ˜¯åœ¨ç±»é‡Œé¢ def sendStatus(self, request_iterator, context): for note in request_iterator: ret=f\u0026quot;æœåŠ¡ç«¯æ¥æ”¶åˆ°æ¶ˆæ¯:{note.msg}\u0026quot; print(ret) yield contact_pb2.Result(ret = \u0026quot;æ¥è‡ªæœåŠ¡ç«¯çš„å“åº”: \u0026quot; + ret) # åœ¨ç±»åˆè¯•åŒ–çš„æ—¶å€™å®šä¹‰äº†ä¸€ä¸ªåˆ—è¡¨self.tasksæ¥å……å½“ä»»åŠ¡é˜Ÿåˆ— def getTask(self, request_iterator, context): print(\u0026quot;æœåŠ¡ç«¯å·²æ¥æ”¶åˆ°å®¢æˆ·ç«¯ä¸Šçº¿é€šçŸ¥ï¼Œå¼€å§‹å‘é€ä»»åŠ¡ç»™å®¢æˆ·ç«¯\\n\u0026quot;) last_index = 0 while True: print(\u0026quot;æœåŠ¡ç«¯å¼€å§‹å‘é€ä»»åŠ¡ç»™å®¢æˆ·ç«¯äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚\\n\u0026quot;) while len(self.tasks) \u0026gt; last_index: n = self.tasks[last_index] last_index += 1 yield n print(f'æœåŠ¡ç«¯å‘é€ç»™äº†å®¢æˆ·ç«¯ä»»åŠ¡ï¼š{n.task}##########\\n') # é¡ºä¾¿åˆ¶é€ äº›æœåŠ¡ç«¯çš„ä»»åŠ¡æ•°æ®ç”¨æ¥å¡«å……åˆ°ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢ for i in range(10): num = random.randint(100, 200) self.tasks.append(contact_pb2.ServerMsg( task=f\u0026quot;ä»»åŠ¡:{num}\u0026quot; )) time.sleep(40) def tellResult(self, request_iterator, context): for response in request_iterator: print(f\u0026quot;æˆ‘å·²ç»çŸ¥é“å®¢æˆ·ç«¯æ¥æ”¶åˆ°æˆ‘å‘è¿‡å»çš„ä»»åŠ¡:{response.ret}\u0026quot;) return contact_pb2.Empty() if __name__ == '__main__': server = grpc.server(futures.ThreadPoolExecutor(max_workers=10)) contact_pb2_grpc.add_ContactServicer_to_server( MyserverClass(), server) server.add_insecure_port('[::]:55555') server.start() server.wait_for_termination() å­¦ä¹ å¼‚æ­¥è°ƒç”¨ ç”±äºPythonçš„å¤šçº¿ç¨‹å®é™…ä¸Šæ˜¯ç±»ä¼¼åç¨‹çš„å®ç°ï¼Œæ‰€ä»¥å¯¹äºCPUå¯†é›†å‹ä»»åŠ¡ï¼Œå“ªæ€•ä½¿ç”¨å¹¶å‘å¤šçº¿ç¨‹å…¶æ€§èƒ½ç”±äºåŒæ­¥å µå¡ä¹Ÿç›¸å½“äºå•çº¿ç¨‹æ€§èƒ½ï¼Œè¿™ä¸ªç¼ºé™·å¯¼è‡´æˆ‘è¿™è¾¹ä¸€ä¸ªå·¥å…·æ€§èƒ½è¾¾åˆ°ç“¶é¢ˆï¼Œæ‰€ä»¥éœ€è¦è°ƒç”¨rpcæ—¶å¼‚æ­¥ä¸å µå¡ï¼Œä¹‹åå†é‡‡é›†ç»“æœã€‚\nå®˜ç½‘çš„æ•™ç¨‹ä¸­å°±æœ‰å…¶æ‰§è¡Œæ–¹å¼ï¼š\nroute_summary_future = stub.RecordRoute.future(point_iterator) route_summary = route_summary_future.result() å¯¹äº future result çš„api ä¾‹å¦‚ç­‰å¾…è¶…æ—¶ç­‰å‚æ•°å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ä½¿ç”¨æ–¹å¼ Search â€” gRPC Python 1.46.2 documentation\næœåŠ¡ç«¯æ·»åŠ send_cmdå®ç°ï¼Œç”¨éšæœºå€¼æ¨¡æ‹Ÿä¸åŒcmdæ‰§è¡Œè€—æ—¶ï¼š\ndef remoteCMD(self, request: contact_pb2.cmdRequest, context): try: t = random.randint(3, 10) print(f\u0026quot;æ‰§è¡Œ '{request.cmdStr}' éœ€è¦èŠ±è´¹{t}s\u0026quot;) time.sleep(t) print(f\u0026quot;response index: {request.index}\u0026quot;) return contact_pb2.cmdResponse( index = request.index, success = True, res = request.log, # res = request.cmd + æŠ¥é”™ä¿¡æ¯, ) except Exception as e: print(e) return å®¢æˆ·ç«¯æ·»åŠ send_cmdå®ç°ï¼Œå…¶æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼š\ndef send_cmd(stub: contact_pb2_grpc.ContactStub): try: func = [] for i in range(10): req = contact_pb2.cmdRequest( index = i, cmdStr = f\u0026quot;ip link add veth{i}\u0026quot;, log = f\u0026quot;PTP n1 - n{i}\u0026quot;, ) print(f\u0026quot;å‘é€æŒ‡ä»¤ index:{req.index}\u0026quot;) # response = stub.remoteCMD(req) # æ™®é€šåŒæ­¥å µå¡æ‰§è¡Œ response_future = stub.remoteCMD.future(req) func.append(response_future) # func[0].result() # è°ƒç”¨resultæ—¶å¦‚æœè¯¥requestæ”¶åˆ°responseå°±ç›´æ¥æ‰“å°å¦åˆ™å°±å µå¡ç­‰å¾…å…¶æ‰§è¡Œå®Œæˆ # for i in range(10): # a = func[i].result() # print(int(a.index)) except Exception as e: print(e) return def run(): with grpc.insecure_channel('localhost:55555') as channel: stub = contact_pb2_grpc.ContactStub(channel) while True: try: send_cmd(stub) time.sleep(100) # ä¸ç­‰å¾…ä¸€ä¼šï¼Œå®¢æˆ·ç«¯ç›´æ¥ç»“æŸæœåŠ¡ç«¯ä¸ä¼šè¿”å›å€¼äº† except grpc.RpcError as e: print(f\u0026quot;server connected out, please retry:{e.code()},{e.details()}\u0026quot;) except Exception as e: print(f'unknown err:{e}') finally: time.sleep(2) æ‰€ä»¥ï¼Œç”±æ­¤ç®€æ˜“demoå¯ä»¥çŸ¥é“ï¼Œå…ˆå‘é€å¼‚æ­¥çš„requestã€‚ç­‰éœ€è¦è°ƒç”¨å…¶ç»“æœæ—¶åœ¨è·å– response_futureçš„resultå³å¯ã€‚\npython logging è¿™é‡Œé¢å¤–æä¸€å˜´ pythonçš„ loggingè¿‡æ»¤å™¨\nå‚è€ƒè¿™ç¯‡åšå®¢å°±å¯ä»¥å®ç°ç®€å•çš„å¯¹ levelã€å‰ç¼€ä¹‹ç±»çš„æ•°æ®è¿‡æ»¤\n# ç»§æ‰¿ logging.Filter ç±»å¹¶é‡è½½filterå‡½æ•°å³å¯ï¼Œfilter() ä¸º trueè¡¨ç¤ºä¸è¾“å‡º class stringFilter(logging.Filter): def filter(self, record): if record.msg.find('123') == -1: return True return False logging.root.addFilter(logging.Filter(json)) # loggingé»˜è®¤æ‰§è¡Œçš„handleræ˜¯root å½“ç„¶ record æœ‰ç”¨çš„å‚æ•°è¿˜æœ‰è¿™äº› å¯ä»¥è‡ªå®šä¹‰è®¸å¤šæœ‰æ•ˆçš„ è¿‡æ»¤å™¨ï¼ŒnameæŒ‡çš„æ‰§è¡Œè¯¥å¤„çš„ç”¨æˆ·å\nrecord.filename record.funcName record.levelname record.module record.msg record.name record.pathname record.processName ä¹‹å‰é…ç½®loggingå‚æ•°(å‚æ•°è§£ææ•™ç¨‹)çš„æ—¶å€™éƒ½æ˜¯ ç›´æ¥åˆ›å»ºå¯¹åº”çš„ handler ï¼Œç„¶åç”¨ getLogger å–å‡ºhandlerï¼Œlogger = logging.getLogger(\u0026quot;console_logger\u0026quot;) ç°åœ¨æ‰å‘ç°ä¸ç”¨è¿™ä¹ˆéº»çƒ¦ï¼Œæ¯æ¬¡å¯¼ä¸€ä¸ªè‡ªå®šä¹‰çš„loggerã€‚å› ä¸ºç³»ç»Ÿé»˜è®¤çš„ logging.info('info message') å°±ä¼šæ‰¾rootçš„handlersï¼Œæˆ‘ä»¬æŠŠè‡ªå®šä¹‰çš„ handleråŠ å…¥rootç»„ä¸­å³å¯ï¼Œè¿™æ · ç›´æ¥ logging.info çš„è°ƒç”¨ã€‚é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š\n{ \u0026quot;version\u0026quot;: 1, \u0026quot;handlers\u0026quot;: { \u0026quot;console\u0026quot;: { \u0026quot;class\u0026quot;: \u0026quot;logging.StreamHandler\u0026quot;, \u0026quot;formatter\u0026quot;: \u0026quot;default\u0026quot;, \u0026quot;level\u0026quot;: \u0026quot;INFO\u0026quot;, \u0026quot;stream\u0026quot;: \u0026quot;ext://sys.stdout\u0026quot; }, \u0026quot;lktest\u0026quot;: { \u0026quot;class\u0026quot;: \u0026quot;logging.handlers.RotatingFileHandler\u0026quot;, \u0026quot;formatter\u0026quot;: \u0026quot;default\u0026quot;, \u0026quot;level\u0026quot;: \u0026quot;INFO\u0026quot;, \u0026quot;filename\u0026quot;: \u0026quot;/home/lk233/core/test.log\u0026quot;, \u0026quot;maxBytes\u0026quot;: 10485760, \u0026quot;backupCount\u0026quot;: 2 } }, \u0026quot;formatters\u0026quot;: { \u0026quot;default\u0026quot;: { \u0026quot;format\u0026quot;: \u0026quot;%(asctime)s - %(levelname)s - %(module)s:%(funcName)s - %(message)s\u0026quot; } }, \u0026quot;root\u0026quot;: { \u0026quot;level\u0026quot;: \u0026quot;DEBUG\u0026quot;, \u0026quot;handlers\u0026quot;: [\u0026quot;console\u0026quot;, \u0026quot;lktest\u0026quot;] } } ","id":2,"section":"posts","summary":"èƒŒæ™¯ gRPCæ˜¯è°·æ­Œå¼€æºçš„ä¸€å¥—åŸºäºHttpå®ç°çš„rpcé€šè®¯æ¡†æ¶ï¼Œç”¨ protobuf å®ç°ä¼ è¾“æ•°æ®çš„å®šä¹‰,å…¶æ ¼å¼ç±»ä¼¼jsonã€‚ç”±äºå…¶å®ç°äº†å¤šå¹³å°ï¼Œåœ¨ä¸åŒç¼–ç¨‹è¯­è¨€","tags":["Python"],"title":"gRPCæµã€å¼‚æ­¥é€šä¿¡","uri":"https://liangkang233.github.io/2022/10/grpc%E6%B5%81%E5%8F%8A%E5%BC%82%E6%AD%A5%E7%9A%84%E5%AD%A6%E4%B9%A0/","year":"2022"},{"content":"èƒŒæ™¯ æœ€è¿‘åˆ·Bç«™ çœ‹åˆ°æœ‰äººåˆ†äº«äº†ä¸ªæ¡Œé¢æ‘†ä»¶ï¼Œçœ‹äº†ä¸‹åˆ¶ä½œè¿‡ç¨‹ï¼ŒåŸä»¶ä¸å¤š ç„Šæ¥ä¹Ÿç®—ç®€å•ã€‚\næƒ³åˆ°ä¹‹å‰ä¹°çš„ GC9A01 ä¹Ÿæ²¡ç”¨ä¸Šï¼Œæ­£å¥½è‡ªå·±å¤åˆ»ä¸€ä¸ªæ¡Œé¢æ‘†ä»¶å§ã€‚\nè¯´å¹²å°±å¹²ï¼Œæ‰“å¼€ ç«‹åˆ›å•†åŸå¼€å§‹æ‰“æ¿ã€‚\nç¡¬ä»¶æ‰“æ¿åŠç„Šæ¥ Bom è¡¨ ID Name Designator Footprint Quantity BOM_Manufacturer Part BOM_Manufacturer BOM_Supplier Part 1 100nF C1,C4,C5,C7 C0603 4 CL21B104KBCNNNC SAMSUNG C1711 2 10uf C2,C3 C0603 2 CL21B104KBCNNNC SAMSUNG C1711 3 ORH-G35A LED2,LED3 LED0603-R-RD_BLUE 2 ORH-G35A Orient C205442 4 470 R1,R3 R0603 2 MFR0W4F4701A50 UniOhm C57204 5 12K R5 R0603 1 MFR0W4F4701A50 UniOhm C57204 6 TS-1086E-AC03526 SW1,SW2 SW-SMD_TS-1086E-AC03526 2 TS-1086E-AC03526 XUNPU C720473 7 GC9A01 TFT1 GC9A01_B 1 FPC_LH128RIG01 Limito NULL 8 KH-TYPE-C-16P TYPE-C1 USB-C-SMD_KH-TYPE-C-16P 1 KH-TYPE-C-16P Shenzhen Kinghelm Elec C709357 9 RT9013-33GB U2 SOT-23-5_L3.0-W1.7-P0.95-LS2.8-BR 1 RT9013-33GB RICHTEK C47773 10 ESP32-S-P U11 WIRELM-SMD_ESP32-S 1 ESP32-S-P null C2764350 11 CH340N U3 SOP-8_L5.0-W4.0-P1.27-LS6.0-BL 1 CH340N WCH(Jiangsu Qin Heng) C506813 è¿™é‡Œçš„ BOM è¡¨åœ¨å¦‚æœåœ¨å¯¼å…¥åˆ°ç«‹åˆ›å•†åŸæ—¶ ä¸çŸ¥åˆ°ä¸ºå•¥å°è£…ä¼šå˜æˆ 0805 çš„ï¼Œè¿˜å¥½ä¸‹å•å‰æ³¨æ„äº†ä¸‹ï¼Œåº”è¯¥æ˜¯ 0603çš„å°è£…ã€‚\nå¼€æºæ¿å­é“¾æ¥\npcbè®¾è®¡åŸºæœ¬å¯ä»¥ä¸å˜ï¼Œæˆ‘ä¸ºäº†ä¿è¯å®ƒä¸è¦è¿‡åšå°±æ²¡æ”¹ å…¶å®æ˜¯æ‡’å¾—æ”¹ ã€‚ç›´æ¥ç”¨è¿™ä¸ªåœ¨çº¿EDAæ“ä½œå¹¶æ‰“æ¿ä¸‹å•ï¼Œä¸ç”¨è£…ADå°±èƒ½æ”¹æ¿å­è¿˜æŒºæ–¹ä¾¿çš„ã€‚\næ³¨æ„çš„æ˜¯ è¿™ä¸ªèµ°çº¿æ˜¯æ²¡æœ‰æ¶‰åŠåˆ° åœ†å±çš„ LEDA è„šï¼ŒåŸè®¾è®¡è¯¥è„šé»˜è®¤æ¥é«˜ï¼Œæ‰€ä»¥åé¢çš„ä»£ç æ˜¯æ§åˆ¶ä¸äº†äº®åº¦çš„ã€‚ã€‚ã€‚\nåœ¨å®éªŒå®¤ç¿»äº†åŠå¤©æ‰¾åˆ°äº†çƒ™é“ï¼Œçœå»äº†ä¹°çƒ™é“ã€‚ å…¶ä»–ä¾‹å¦‚ é”¡è† Esp32æ¨¡å— å’Œ ç„Šè´´ç‰‡ç”¨çš„ç®€æ˜“åŠ çƒ­æ¿ ç­‰å™¨ä»¶ ç­‰äº†å¥½å‡ å¤©ä¹Ÿéƒ½åˆ°äº†ï¼Œå‡†å¤‡ç„Šæ¥ã€‚\nè¿™ä¸ªæ¿å­è®¾è®¡çš„ æ­£é¢æ²¡æœ‰å™¨ä»¶æœ€åç„Šæ¥ä¸Šå±å¹•å°±è¡Œäº†ï¼Œè´´å™¨ä»¶ åŠ çƒ­ç„Šé”¡è†è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚\næ³¨æ„ å‘å…‰äºŒæç®¡ åœ¨pcbä¸å°ä¸Š çŸ©å½¢çš„æ˜¯æ­£æï¼Œå…­è¾¹å½¢çš„æ˜¯è´Ÿæï¼Œä¸è¦åƒæˆ‘ç¬¬ä¸€å—æ¿å­ä¸€æ ·ç„Šåäº†ã€‚\nä¸Šæ¬¡ç„Šæ¿å­è¿˜æ˜¯æœ¬ç§‘çš„æ—¶å€™ï¼Œä¹Ÿç®—æ˜¯å¥½ä¹…æ²¡é—»é”¡ä¸çš„è‡­å‘³äº†ğŸ¤£\næ‰‹ç”Ÿäº†ï¼Œç„Šçš„å¾ˆçƒ‚ ç¬¬ä¸€ä¸ªå—æ¿å­ typecæ¯åº§æ²¡ç„Šå¥½çƒ§å…¥ä¸è¿›å»å›ºä»¶ï¼Œç¬¬äºŒå—ç„Šçš„ä¸é”™ æ¥å±å¹•æ—¶ä¸å°å¿ƒè¿é”¡å¤ªå¤šï¼Œä¹Ÿå¤±è´¥äº†ã€‚æœ€åç¬¬ä¸‰å—æ€»ç®—ç„Šæ¥æˆåŠŸ, è¿é”¡å¤„ç›´æ¥æ‹–ç„Šæå®šã€‚\nç¯å¢ƒæ­å»º Esp32 æœ‰å¾ˆå¤šå®ç”¨çš„ arduino åº“ï¼Œå¼€å‘èµ·æ¥æŒºæ–¹ä¾¿çš„ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹© vscode é›†æˆ çš„ PLatformIO æ¥å¼€å‘å·¥ç¨‹ï¼ŒæŠŠBç«™è€å“¥çš„ä»£ç å’Œåº“æ‹¿æ¥ç”¨ä¸‹åˆ›ä¸ªå·¥ç¨‹ã€‚ç”±äºåˆå§‹åŒ–åˆ›å»ºå·¥ç¨‹å¾ˆæ…¢ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½ ç¦»çº¿åŒ…\nç›¸å…³æ•™ç¨‹: PlatformIO+VScode+ESP32å¼€å‘ç¯å¢ƒæ­å»ºæ•™ç¨‹\nç›¸å…³æ¨¡å—åº“ä¹Ÿå¯ä»¥ ç›´æ¥ ä¸‹è½½ï¼Œå¦‚ä¸‹æ‰€ç¤º æŒ‰é”®å¼•è„šä¸º 25 å¯¹åº” GPIO16\næ·»åŠ äº†æŒ‰é”®æ¨¡å—ï¼Œå¯¹ä¸‹è½½æŒ‰é”®æ·»åŠ åˆ‡æ¢åŠŸèƒ½ã€‚ åƒå†™ C++ ç¨‹åºä¸€æ ·ç»™ button ç±» æ·»åŠ å¯¹åº” å•å‡» åŒå‡» çš„å›è°ƒå‡½æ•°ï¼Œ ç›¸å…³æ•™ç¨‹ã€‚èŠ¯ç‰‡çš„æ¨¡ç»„IOç¼–å·å’Œä»£ç é‡Œè®¾ç½®çš„gpioç¼–å·ä¸åŒï¼Œæœ€å¥½è®¾ç½®å‰æŸ¥ä¸‹ã€‚ä¾‹å¦‚ æ­¤å¤„æŒ‰é”®çš„IO\nPlarformIO åŒ…å«äº†ç¼–è¯‘ ä¸‹è½½ ä¸²å£è°ƒè¯•ç­‰åŠŸèƒ½ã€‚ ç‚¹å‡» -\u0026gt; æŒ‰é’®ç¼–è¯‘å¹¶ä¸‹è½½åï¼Œç¨‹åºæ˜¾ç¤ºçƒ§å½•é•¿æŒ‰ä¸‹è½½æŒ‰é’®å³å¯ä¸‹è½½å›ºä»¶ã€‚\næ³¨æ„ è¿™é‡Œçš„ä¸²å£åŠ©æ‰‹ ç¬¬ä¸€æ¬¡è¿›å…¥ éœ€è¦ä¸‹è½½æ’ä»¶å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ï¼Œè¿›å…¥å è¾“å…¥ ctrl t + ctrl h æ‰“å°å¸®åŠ©ä¿¡æ¯ã€‚ä¾‹å¦‚ä¿®æ”¹ è¿æ¥æ³¢ç‰¹ç‡ ä½¿ç”¨å‘½ä»¤ ctrl t + bã€‚å…¶å‘½ä»¤çš„å›æ˜¾ ä¿®æ”¹é»˜è®¤ rts ä¸º 0 ä¸åŒæ­¥ä¸²å£ç­‰æ­¤æ“ä½œï¼Œå¯ä»¥æ”¾åœ¨é…ç½®æ–‡ä»¶ platformio.ini ä¸­ï¼Œä»¥å…æ¯æ¬¡è¿›å…¥éœ€è¦ä¿®æ”¹ã€‚\nå®˜æ–¹ä¸²å£è®¾ç½®æ–‡æ¡£\nè¿™é‡Œæˆ‘å°±æ˜¯æ²¡è®¾ç½® rts = 0 å¯¼è‡´è¿›å…¥ä¸²å£ ç¨‹åºå°±å¡ä½åŒæ­¥ä¸å†æ‰§è¡Œäº†ã€‚\nå…¶æ¬¡æ˜¯ çƒ§å½•é—®é¢˜ é»˜è®¤flashè¿‡å° ç¼–è¯‘ä¼šæŠ¥é”™ï¼Œä¿®æ”¹ä¸‹åˆ†åŒºè¡¨å³å¯ï¼š\nplatformio.ini æ·»åŠ å¦‚ä¸‹å‚æ•° board_build.partitions = partition.csv partition.csv å†…å®¹ # Name, Type, SubType, Offset, Size, Flags nvs, data, nvs, 0x9000, 0x5000, otadata, data, ota, 0xe000, 0x2000, app0, app, ota_0, 0x10000, 0x300000, spiffs, data, spiffs, 0x310000,0xF0000, è½¯ä»¶æ¬è¿ å°†åŸæ¥çš„ä»£ç å°è£…äº†ä¸‹, Arduino ideä¸­ çš„å·¥ç¨‹æ–‡ä»¶ ino è½¬ä¸º cpp\nä¸»å‡½æ•°å¦‚ä¸‹æ‰€ç¤º:\n#include \u0026lt;Arduino.h\u0026gt; #include \u0026quot;mytools.h\u0026quot; //---------------åˆå§‹wifié…ç½®ä¿¡æ¯-------------------- const char ssid[] = \u0026quot;Xbox_Home\u0026quot;; // WIFIåç§° const char pass[] = \u0026quot;liangkang233\u0026quot;; // WIFIå¯†ç  int LCD_BL_PWM = 200; // å±å¹•äº®åº¦0-255 //---------------------------------------------------- static int last = -1; void setup() { Serial.begin(115200); key_setup(); tft_setup(); Smart_Config(ssid, pass); Serial.println(\u0026quot;Power your dreams!\u0026quot;); } void loop() { unsigned int now = get_flag(); if(last != now) { // åˆ‡æ¢æ¨¡å¼éœ€è¦å¯åŠ¨ æ¸…ç†å‡½æ•° å’Œ åˆå§‹åŒ–å‡½æ•° fun_clear(last); fun_setup(now); } fun_loop(now); last = now; } Arduino ä»£ç  åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå¯åŠ¨çš„åˆå§‹åŒ– ä»¥åŠ while å¾ªç¯æ‰§è¡Œ loop\nå‰©ä¸‹çš„ ä¸»è¦åˆ†ä¸ºå››éƒ¨åˆ†\nsrc\\mytools.cpp é›†æˆæ˜¾ç¤ºé©±åŠ¨ wifiå¾®ä¿¡é…ç½‘ æŒ‰é”®ç­‰åŠŸèƒ½æ¨¡å—ã€‚\nsrc\\getload.cpp å»ºç«‹HttpæœåŠ¡å™¨ï¼Œç›‘å¬ä¸Šä½æœºå‘é€çš„getè¯·æ±‚ ä»¥è§£æå¹¶å±•ç¤ºå½“å‰çŠ¶æ€ä¿¡æ¯ã€‚\nsrc\\myclock.cpp ä½¿ç”¨ udp å¥—æ¥å­—å’Œ httpè¯·æ±‚ è·å–ntpæœåŠ¡å™¨æ—¶é—´å¤©æ°”ç­‰ä¿¡æ¯ æ˜¾ç¤ºæ—¶é’Ÿã€‚ä¸Šä½æœºç¨‹åº\nsrc\\remote_display.cpp ä½¿ç”¨ tcp (å»ºè®®åç»­æ”¹è¿›ä¸ºudp) ä¼ è¾“jpgå›¾ç‰‡æµå¹¶åˆ·æ–°å±•ç¤ºã€‚ä¸Šä½æœºç¨‹åº\nå¸¸ç”¨å·¥å…· ä¹Ÿåˆ†äº«ä¸‹ï¼š\ngif è½¬ç¼–ç æ•°ç»„\njpg è½¬ 16è¿›åˆ¶ç¼–ç æ•°ç»„\nå±•ç¤ºåŠæ€»ç»“ ä½¿ç”¨æŒ‰é”®è¿›è¡ŒåŠŸèƒ½åˆ‡æ¢ï¼Œå•å‡»ä¸‹è½½æŒ‰é”® åˆ‡æ¢åˆ°ä¸‹ä¸€åŠŸèƒ½ï¼ŒåŒå‡»åˆ‡æ¢åˆ°ä¸Šä¸€åŠŸèƒ½ã€‚\ntfté©±åŠ¨åº“ å’Œ å…¶ä»– ç›¸å…³ä»£ç å·²ç»æ‰“åŒ…å¥½ æ‰˜ç®¡åˆ°githubä¸Šäº†\næ—¶é’ŸåŠŸèƒ½ æ— çº¿æŠ•å± æ˜¾ç¤ºpcä¸»æœºæ€§èƒ½å ç”¨ å¯æƒœçš„æ˜¯ æ¨¡ç»„å¾…æœºå°±å‘çƒ­ä¸¥é‡ï¼Œæ›´åˆ«è¯´è·‘ä¸Šä»£ç åäº†ã€‚åªèƒ½æ”¾åœ¨æ¡Œä¸Šå½“æ‘†ä»¶ä¸å¤ªå¥½æŠŠç©äº†ã€‚\næœ‰æœºä¼šçš„è¯ä¼šç»§ç»­æ”¹è‰¯ï¼Œè®¾è®¡ä¸ªå£³å­ æ•´æ¼‚äº®ç‚¹ã€‚\n","id":3,"section":"posts","summary":"èƒŒæ™¯ æœ€è¿‘åˆ·Bç«™ çœ‹åˆ°æœ‰äººåˆ†äº«äº†ä¸ªæ¡Œé¢æ‘†ä»¶ï¼Œçœ‹äº†ä¸‹åˆ¶ä½œè¿‡ç¨‹ï¼ŒåŸä»¶ä¸å¤š ç„Šæ¥ä¹Ÿç®—ç®€å•ã€‚ æƒ³åˆ°ä¹‹å‰ä¹°çš„ GC9A01 ä¹Ÿæ²¡ç”¨ä¸Šï¼Œæ­£å¥½è‡ªå·±å¤åˆ»ä¸€ä¸ªæ¡Œé¢æ‘†ä»¶å§ã€‚ è¯´å¹²å°±å¹²ï¼Œ","tags":["C/C++","å¼€å‘"],"title":"è¿·ä½ æ¡Œé¢æ‘†ä»¶","uri":"https://liangkang233.github.io/2022/08/%E6%A1%8C%E9%9D%A2%E6%91%86%E4%BB%B6/","year":"2022"},{"content":"æœ€è¿‘åœ¨å­¦ä¹ SRv6ç›¸å…³çš„çŸ¥è¯†, å®è·µæ–¹é¢å‚è€ƒè¿™ç¯‡ ä½¿ç”¨ mininetçš„ åšå®¢ã€‚æˆ‘è¿™é‡Œä½¿ç”¨ core å¹³å° æ­å»ºäº†ä¸ªç®€æ˜“åœºæ™¯ ä½“ä¼š SRv6 æ•´ä¸ªæ•°æ®çš„ipåŒ…çš„åŒ…è£…è§£æã€‚äºŒè€…éƒ½æ˜¯ä½¿ç”¨è½»é‡ lxcå®¹å™¨ æ¨¡æ‹Ÿ SRv6è·¯ç”±å™¨èŠ‚ç‚¹ï¼Œä½¿ç”¨quaggaæ„å»ºè·¯ç”±å™¨é—´çš„è·¯ç”±è¡¨ã€‚åœ¨å®è·µå‰ å…ˆå­¦ä¹ ç›¸å…³ç†è®ºçŸ¥è¯†ã€‚\nSRv6èƒŒæ™¯ åœ¨ç½‘ç»œå‘å±•åˆæœŸï¼Œipç½‘ç»œçš„æ— è¿æ¥å°½åŠ›è€Œä¸ºçš„è®¾è®¡ç†å¿µæˆ˜èƒœäº†ç±»å¦‚é‡‡ç”¨å›ºå®šé•¿åº¦ä¿¡å…ƒäº¤æ¢çš„ATMç­‰é¢å‘è¿æ¥çš„è®¾è®¡ç†å¿µçš„ä¼ è¾“æŠ€æœ¯ã€‚éšç€åç»­çš„ç½‘ç»œå‘å±•ï¼Œä¸ºäº†æ»¡è¶³IPç½‘ç»œQoSèƒ½åŠ›ï¼Œå¼€å‘äº†LANEï¼ŒIPoAç­‰ï¼Œå®Œæˆçš„æ¯”è¾ƒå¥½çš„æ˜¯ MPLS (Multiprotocol Label Switching)ã€‚å¯ä»¥æ”¯æ’‘TE (Traffic Engineering)ã€VPNå’ŒFRRç­‰æŠ€æœ¯ï¼Œå…¶è™šæ‹Ÿæ ‡ç­¾çš„çš„è®¾è®¡ä¸ºæ— è¿æ¥çš„IPç½‘ç»œä¿éšœQoSèƒ½åŠ›ï¼Œè¿˜å…·å¤‡IPè·¯ç”±çš„çµæ´»æ€§ã€‚\nä½†æ˜¯éšç€ç½‘ç»œå‘å±• IPv4åœ°å€è€—å°½éœ€è¦æ‰©å±•è‡³IPv6ï¼ŒMPLSæ— æ³•åŸºäºå…¨å±€è§†è§’åšå‡ºå…¨å±€æœ€ä¼˜ç½‘ç»œå†³ç­–ï¼Œæ•°æ®é¢ä¸æ§åˆ¶é¢çš„ç´§å¯†è€¦åˆç­‰é—®é¢˜ï¼Œé€æ¸æœ‰äº†SDNå³ä¸ºç½‘ç»œæä¾›å¯ç¼–ç¨‹èƒ½åŠ›çš„æƒ³æ³•ã€‚\nSRæŠ€æœ¯æ˜¯SDNç«äº‰å‹åŠ›ä¸‹çš„äº§ç‰©ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†æŠ¥æ–‡è½¬å‘è·¯å¾„åˆ‡å‰²ä¸ºä¸åŒçš„åˆ†æ®µï¼Œå¹¶åœ¨è·¯å¾„èµ·å§‹ç‚¹å¾€æŠ¥æ–‡ä¸­æ’å…¥åˆ†æ®µä¿¡æ¯ï¼Œä¸­é—´èŠ‚ç‚¹åªéœ€è¦æŒ‰ç…§æŠ¥æ–‡é‡Œæºå¸¦çš„åˆ†æ®µä¿¡æ¯è½¬å‘å³å¯ã€‚è¿™æ ·çš„è·¯å¾„åˆ†æ®µï¼Œç§°ä¹‹ä¸º â€œSegmentâ€ ï¼Œå¹¶é€šè¿‡SIDï¼ˆSegment Identifierï¼Œæ®µæ ‡è¯†ï¼‰æ¥æ ‡è¯†ã€‚æŠ¥æ–‡åœ¨SRæŠ€æœ¯çš„è½¬å‘è¿‡ç¨‹ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚ç”±ä¸Šå¯çŸ¥ï¼ŒSRæŠ€æœ¯å…³é”®åœ¨äºä¸¤ç‚¹ï¼šå¯¹è·¯å¾„è¿›è¡Œåˆ†æ®µ (Segment) ä»¥åŠåœ¨èµ·å§‹èŠ‚ç‚¹å¯¹è·¯å¾„è¿›è¡Œæ’åºæˆè¡¨ (Segment List) ï¼Œç¡®å®šå‡ºè¡Œè·¯å¾„ã€‚\nåœ¨SRæŠ€æœ¯ä¸­ï¼Œå°†ä»£è¡¨ä¸åŒåŠŸèƒ½çš„Segmentè¿›è¡Œç»„åˆï¼Œå¯ä»¥å®ç°å¯¹è·¯å¾„çš„ç¼–ç¨‹ï¼Œæ»¡è¶³ä¸åŒè·¯å¾„æœåŠ¡è´¨é‡çš„éœ€æ±‚ã€‚SRæŠ€æœ¯æ”¯æŒMPLSå’ŒIPv6ä¸¤ç§è½¬å‘å¹³é¢ï¼ŒåŸºäºMPLSè½¬å‘å¹³é¢çš„SRç§°ä¸º SR-MPLSï¼ˆSegment Routing MPLSï¼‰ï¼Œå…¶SIDä¸ºMPLSæ ‡ç­¾ï¼ˆLabelï¼‰ï¼›åŸºäºIPv6è½¬å‘å¹³é¢çš„SRç§°ä¸º SRv6 ï¼Œå…¶SIDä¸ºIPv6åœ°å€ã€‚\nSRv6 æŠ€æœ¯ä½¿å‘½ SRv6å…¼å®¹IPv6çš„è·¯ç”±è½¬å‘ï¼ŒåŸºäºIPå¯è¾¾æ€§æ›´åŠ å®¹æ˜“å®ç°ä¸åŒç½‘ç»œäº’è”ï¼Œä¸éœ€è¦åƒMPLSé‚£æ ·ä½¿ç”¨é¢å¤–ä¿¡ä»¤ï¼Œä¹Ÿä¸éœ€è¦å…¨ç½‘å‡çº§ã€‚ SRv6åŸºäºSRH ( Segment Routing Header, æ®µè·¯ç”±æ‰©å±•æŠ¥æ–‡å¤´)èƒ½å¤Ÿæ”¯æŒæ›´å¤šç§ç±»çš„å°è£…ï¼Œå¯ä»¥å¾ˆå¥½åœ°æ»¡è¶³æ–°ä¸šåŠ¡çš„å¤šæ ·åŒ–éœ€æ±‚ã€‚ SRv6å¯¹äºIPv6çš„äº²å’Œæ€§ä½¿å¾—å®ƒèƒ½å¤Ÿå°†IPæ‰¿è½½ç½‘ä¸æ”¯æŒIPv6çš„åº”ç”¨æ— ç¼èåˆåœ¨ä¸€èµ·ï¼Œé€šè¿‡ç½‘ç»œæ„ŸçŸ¥åº”ç”¨ï¼Œä½¿è¿è¥å•†å¯ä»¥æä¾›æ›´å¤šå¯èƒ½çš„å¢å€¼ä¸šåŠ¡ã€‚ SRv6çš„è®¾è®¡ SRv6å°†ç½‘ç»œæ¯”ä½œè®¡ç®—æœºï¼Œç±»æ¯”è®¡ç®—æœºç¼–ç¨‹ï¼Œå°†ç½‘ç»œæ‰¿è½½çš„ä¸šåŠ¡ç¿»è¯‘æˆå‘ç»™æ²¿é€”ç½‘ç»œè®¾å¤‡çš„ä¸€ç³»åˆ—è½¬å‘æŒ‡ä»¤ï¼Œä»è€Œå®ç°ç½‘ç»œç¼–ç¨‹ï¼Œæ»¡è¶³ä¸šåŠ¡çš„å®šåˆ¶åŒ–éœ€æ±‚ã€‚\nSRHè®¾è®¡\nä¸ºåŸºäºIPv6è½¬å‘å¹³é¢å®ç°SRæŠ€æœ¯ï¼Œåœ¨IPv6è·¯ç”±æ‰©å±•å¤´æ–°å¢SRHï¼ˆSegment Routing Headerï¼‰æ‰©å±•å¤´ï¼Œè¯¥æ‰©å±•å¤´æŒ‡å®šä¸€ä¸ªIPv6çš„æ˜¾å¼è·¯å¾„ï¼Œå­˜å‚¨IPv6çš„Segment Listä¿¡æ¯ã€‚Segment Listå³å¯¹æ®µå’Œç½‘ç»œèŠ‚ç‚¹è¿›è¡Œæœ‰åºæ’åˆ—å¾—åˆ°çš„ä¸€æ¡è½¬å‘è·¯å¾„ã€‚æŠ¥æ–‡è½¬å‘æ—¶ï¼Œä¾é  Segments Left å’Œ Segment List å­—æ®µå…±åŒå†³å®šIPv6ç›®çš„åœ°å€ï¼ˆIPv6 DAï¼‰ä¿¡æ¯ï¼Œä»è€ŒæŒ‡å¯¼æŠ¥æ–‡çš„è½¬å‘è·¯å¾„å’Œè¡Œä¸ºã€‚\nå­—æ®µå é•¿åº¦ å«ä¹‰ Next Header 8 bit æ ‡è¯†ç´§è·Ÿåœ¨SRHä¹‹åçš„æŠ¥æ–‡å¤´çš„ç±»å‹ã€‚å¸¸è§çš„å‡ ç§ç±»å‹å¦‚ä¸‹ã€‚4: IPv4å°è£…ã€‚41: IPv6å°è£…ã€‚43: IPv6 Routing Header.58: ICMPv6 (Internet Control Message Protocol version6)59: Next Headerä¸ºç©º Hdr Ext Len 8 bit SRHçš„é•¿åº¦ï¼ŒæŒ‡ä¸åŒ…æ‹¬å‰64 bit (å‰64 bitä¸ºå›ºå®šé•¿åº¦)çš„SRHçš„é•¿åº¦ Routing Type 8 bit æ ‡è¯†è·¯ç”±æ‰©å±•æŠ¥æ–‡å¤´ç±»å‹ï¼Œæ ‡è®°SRHçš„å€¼ä¸º4 Segments Left 8 bit å‰©ä½™çš„Segmentæ•°ç›®ï¼Œç®€ç§°SL Last Entry 8 bit segment List çš„æœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼• Flags 8 bit é¢„ç•™çš„æ ‡å¿—ä½ï¼Œç”¨äºç‰¹æ®Šçš„å¤„ç†ï¼Œæ¯”å¦‚OAM Tag 16 bit æ ‡è¯†åŒç»„æŠ¥æ–‡ Segment List[n] 128 * n bit Segment List ä¸­çš„ç¬¬nä¸ªSegment, Segment çš„å€¼æ˜¯IPv6åœ°å€çš„å½¢å¼ Optional TLV å¯å˜ å¯é€‰TLV (Type Length Value,ç±»å‹é•¿åº¦å€¼)éƒ¨åˆ†ï¼Œä¾‹å¦‚PaddingTLVå’ŒHMAC (Hash-based Message Authentication Code,æ•£åˆ—æ¶ˆæ¯è®¤è¯ç ) TLV Segment Listã€‚å¦‚å‰æ‰€è¿°ï¼Œå¯ä»¥å°†å¤šä¸ªSegmentç»„åˆèµ·æ¥ï¼Œå½¢æˆSRv6è·¯å¾„ï¼Œå³è·¯å¾„å¯ç¼–è¾‘ã€‚å¯¹SRv6 SID 128bitçš„è¿ç”¨ã€‚\nSRv6 Segmentå®šä¹‰äº†SRv6ç½‘ç»œç¼–ç¨‹ä¸­çš„ç½‘ç»œæŒ‡ä»¤ï¼ŒæŒ‡ç¤ºè¦å»å“ªï¼Œæ€ä¹ˆå»ã€‚æ ‡è¯†SRv6 Segmentçš„IDè¢«ç§°ä¸ºSRv6 SIDã€‚SRv6 SIDæ˜¯ä¸€ä¸ª128bitçš„å€¼ï¼Œä¸ºIPv6åœ°å€å½¢å¼ï¼Œç”±Locatorã€Functionå’ŒArgumentsä¸‰éƒ¨åˆ†ç»„æˆã€‚ä¸‹å›¾ä¸ºSIDæ„æˆ\nLocatorï¼šå…·æœ‰å®šä½åŠŸèƒ½ã€‚æä¾›IPv6çš„è·¯ç”±èƒ½åŠ›ï¼ŒæŠ¥æ–‡é€šè¿‡è¯¥å­—æ®µå®ç°å¯»å€è½¬å‘ã€‚æ­¤å¤–ï¼ŒLocatorå¯¹åº”çš„è·¯ç”±ä¹Ÿæ˜¯å¯èšåˆçš„ã€‚\nFunctionï¼šç”¨æ¥è¡¨è¾¾è¯¥è®¾å¤‡æŒ‡ä»¤è¦æ‰§è¡Œçš„è½¬å‘åŠ¨ä½œï¼Œä¸åŒçš„è½¬å‘è¡Œä¸ºç”±ä¸åŒçš„Functionæ¥è¡¨è¾¾ã€‚\nArgumentsï¼šå¯é€‰å­—æ®µï¼Œæ˜¯å¯¹Functionçš„è¡¥å……ï¼Œæ˜¯æŒ‡ä»¤åœ¨æ‰§è¡Œæ—¶å¯¹åº”çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°å¯èƒ½åŒ…å«æµã€æœåŠ¡æˆ–ä»»ä½•å…¶ä»–ç›¸å…³çš„ä¿¡æ¯ã€‚ SRv6çš„æ¯ä¸ªSegmentæ˜¯128bitï¼Œå¯ä»¥çµæ´»åˆ†ä¸ºå¤šæ®µï¼Œæ¯æ®µåŠŸèƒ½å’Œé•¿åº¦å¯ä»¥è‡ªå®šä¹‰ï¼Œç”±æ­¤å…·å¤‡çµæ´»ç¼–ç¨‹èƒ½åŠ›ï¼Œå³ä¸šåŠ¡å¯ç¼–è¾‘ã€‚\nSRv6 å·¥ä½œæµç¨‹ SRv6 ç½‘ç»œç§èŠ‚ç‚¹è§’è‰²åŸºæœ¬å¯ä»¥åˆ†ä¸ºä¸‰ç±»:\nSRv6 æºèŠ‚ç‚¹ï¼šç”ŸæˆSRv6æŠ¥æ–‡çš„æºèŠ‚ç‚¹ï¼Œå¦‚æœliståªåŒ…å«å•ä¸ªSIDï¼Œæ— éœ€å†æŠ¥æ–‡ä¸­æ·»åŠ SRHï¼Œåªè¦ ä¸­è½¬èŠ‚ç‚¹ï¼šä¸­è½¬èŠ‚ç‚¹æ˜¯SRv6æŠ¥æ–‡è½¬å‘è·¯å¾„ä¸Šä¸å‚ä¸SRv6æŠ¥æ–‡å¤„ç†çš„èŠ‚ç‚¹ã€‚å¯ä»¥æ˜¯æ™®é€šçš„IPv6èŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯æ”¯æŒSRv6èŠ‚ç‚¹ã€‚ SRv6 æ®µç«¯ç‚¹èŠ‚ç‚¹ï¼šåœ¨SRv6æŠ¥æ–‡è½¬å‘è¿‡ç¨‹ç§ï¼Œå¦‚æœèŠ‚ç‚¹æ¥æ”¶çš„IPv6åœ°å€æ˜¯ç›®çš„åœ°å€é…ç½®çš„SIDï¼Œåˆ™å‘½ä¸­æœ¬åœ°SIDå¤„ç†è¡¨ï¼Œè¿›è¡ŒEndPointå¤„ç†ã€‚ SRv6 æºèŠ‚ç‚¹æŒ‡ä»¤ä»‹ç»:\næºèŠ‚ç‚¹è¡Œä¸º åŠŸèƒ½ç®€è¿° H.Insert ä¸ºæ¥æ”¶åˆ°çš„IPæŠ¥æ–‡æ’å…¥SRH,å¹¶æŸ¥è¡¨è½¬å‘ H.Insert.Red ä¸ºæ¥æ”¶åˆ°çš„IPæŠ¥æ–‡æ’å…¥Reduced SRH,å¹¶æŸ¥è¡¨è½¬å‘ H.Encaps ä¸ºæ¥æ”¶åˆ°çš„IPæŠ¥æ–‡å°è£…å¤–å±‚IPv6æŠ¥æ–‡å¤´ä¸SRH,å¹¶æŸ¥è¡¨è½¬å‘ H.Encaps.Red ä¸ºæ¥æ”¶åˆ°çš„IPæŠ¥æ–‡å°è£…å¤–å±‚IPv6æŠ¥æ–‡å¤´ä¸Reduced SRH,å¹¶æŸ¥è¡¨è½¬å‘ H Encaps.L2 ä¸ºæ¥æ”¶åˆ°çš„äºŒå±‚æŠ¥æ–‡å°è£…å¤–å±‚IPv6æŠ¥æ–‡å¤´ä¸SRH,å¹¶æŸ¥è¡¨è½¬å‘ H.Encaps.L2.Red ä¸ºæ¥æ”¶åˆ°çš„äºŒå±‚æŠ¥æ–‡å°è£…å¤–å±‚IPv6æŠ¥æ–‡å¤´ä¸Reduced SRH,å¹¶æŸ¥è¡¨è½¬å‘ SRv6 æ®µç«¯ç‚¹æŒ‡ä»¤ä»‹ç»:\næŒ‡ä»¤ åŠŸèƒ½ç®€è¿° åº”ç”¨åœºæ™¯ End æŠŠä¸‹ä¸€ä¸ªSIDå¤åˆ¶åˆ°IPv6ç›®çš„åœ°å€ï¼Œè¿›è¡ŒæŸ¥è¡¨è½¬å‘ æŒ‡å®šèŠ‚ç‚¹è½¬å‘ï¼Œç›¸å½“äºSR-MPLSçš„èŠ‚ç‚¹æ ‡ç­¾ End.X æ ¹æ®æŒ‡å®šå‡ºæ¥å£è½¬å‘æŠ¥æ–‡ æŒ‡å®šå‡ºæ¥å£è½¬å‘ï¼Œç›¸å½“äºSR-MPLSçš„é‚»æ¥æ ‡ç­¾ End.T åœ¨æŒ‡å®šçš„IPv6è½¬å‘è¡¨ä¸­è¿›è¡ŒæŸ¥è¡¨å¹¶è½¬å‘æŠ¥æ–‡ ç”¨äºå¤šè½¬å‘è¡¨è½¬å‘åœºæ™¯ End.DX6 è§£å°è£…æŠ¥æ–‡ï¼Œå‘æŒ‡å®šçš„IPv6ä¸‰å±‚é‚»æ¥è½¬å‘ L3VPNv6åœºæ™¯ï¼Œé€šè¿‡æŒ‡å®šçš„IPv6é‚»æ¥è½¬å‘åˆ°CE (Customer Edge, ç”¨æˆ·ç½‘ç»œè¾¹ç¼˜è®¾å¤‡) End.DX4 è§£å°è£…æŠ¥æ–‡ï¼Œå‘æŒ‡å®šçš„IPv4ä¸‰å±‚é‚»æ¥è½¬å‘ L3VPNv4åœºæ™¯ï¼Œé€šè¿‡æŒ‡å®šçš„IPv4é‚»æ¥è½¬å‘åˆ°CE End.DT6 è§£å°è£…æŠ¥æ–‡ï¼Œ åœ¨æŒ‡å®šçš„IPv6è½¬å‘è¡¨ä¸­è¿›è¡ŒæŸ¥è¡¨è½¬å‘ L3VPNv6åœºæ™¯ End.DT4 è§£å°è£…æŠ¥æ–‡ï¼Œåœ¨æŒ‡å®šçš„IPv4è½¬å‘è¡¨ä¸­è¿›è¡ŒæŸ¥è¡¨è½¬å‘ L3VPNv4 åœºæ™¯ End.DT46 è§£å°è£…æŠ¥æ–‡ï¼Œåœ¨æŒ‡å®šçš„IPv4æˆ–IPv6è½¬å‘è¡¨ç§è¿›è¡ŒæŸ¥è¡¨è½¬å‘ L3VPNv4/L3VPNv6åœºæ™¯ End.DX2 è§£å°è£…æŠ¥æ–‡ï¼Œä»æŒ‡å®šçš„äºŒå±‚å‡ºæ¥å£è½¬å‘ EVPN VPWS (Virtual Private Wire Service, è™šæ‹Ÿä¸“ç”¨çº¿è·¯ä¸šåŠ¡)åœºæ™¯ EndDX2V è§£å°è£…æŠ¥æ–‡ï¼Œåœ¨æŒ‡å®šçš„äºŒå±‚è¡¨ä¸­ç”¨å†…å±‚VLANä¿¡æ¯è¿›è¡ŒæŸ¥è¡¨è½¬å‘ EVPN VPLS (Virtual Private LAN Service, è™šæ‹Ÿä¸“ç”¨å±€åŸŸç½‘ä¸šåŠ¡)åœºæ™¯ EndDT2U è§£å°è£…æŠ¥æ–‡ï¼Œåœ¨æŒ‡å®šçš„äºŒå±‚è¡¨ä¸­å­¦ä¹ å†…å±‚æºMACåœ°å€ï¼Œç”¨å†…å±‚ç›®çš„MACåœ°å€è¿›è¡ŒæŸ¥è¡¨è½¬å‘ EVPN VPLSçš„å•æ’­åœºæ™¯ End.DT2M è§£å°è£…æŠ¥æ–‡ï¼Œåœ¨æŒ‡å®šçš„äºŒå±‚è¡¨ä¸­å­¦ä¹ å†…å±‚æºMACåœ°å€ï¼Œæ’é™¤æŒ‡å®šçš„æ¥å£åå‘å…¶ä»–äºŒå±‚æ¥å£è½¬å‘ EVPN VPLSçš„ç»„æ’­åœºæ™¯ End.B6.Insert æ’å…¥ SRH,åº”ç”¨æŒ‡å®šçš„SRv6 Policy Insert æ¨¡å¼ä¸‹å¼•æµå…¥SRv6 Policy,éš§é“æ‹¼æ¥ã€SD-WAN é€‰è·¯ç­‰ End.B6.Insert.Red æ’å…¥ Reduced SRH,åº”ç”¨æŒ‡å®šçš„ SRv6 Poliey Insert\u0026amp;Reduce æ¨¡å¼ä¸‹å¼•æµå…¥SRv6 Policy,éš§é“æ‹¼æ¥ã€SD-WAN é€‰è·¯ç­‰ End.B6.Encaps å°è£…å¤–å±‚IPv6æŠ¥æ–‡å¤´å’ŒSRH,åº”ç”¨æŒ‡å®šçš„ç”¨æŒ‡å®šçš„SRv6 Policy Encaps æ¨¡å¼ä¸‹å¼•æµå…¥SRv6 Poliey, éš§é“éš§é“æ‹¼æ¥ã€SD-WANé€‰è·¯ç­‰ End.B6.Encaps.Red å°è£…å¤–å±‚IPv6æŠ¥æ–‡å¤´å’ŒReduced SRH,åº”ç”¨æŒ‡å®šçš„ SRv6 Policy Enaps\u0026amp;Rcuceæ¨¡å¼ä¸‹å¼•æµå…¥SRv6 Pliy,éš§é“æ‹¼æ¥ã€SD-WANé€‰è·¯ç­‰ End.BM æ’å…¥MPLSæ ‡ç­¾æ ˆï¼Œåº”ç”¨æŒ‡å®šçš„SR-MPLS Policy SRv6 ä¸SR-MPLSäº’é€šåœºæ™¯ï¼Œå¼•æµå…¥SR-MPLS Policy å¦‚å›¾æ‰€ç¤ºï¼Œå‡è®¾æœ‰æŠ¥æ–‡éœ€è¦ä»ä¸»æœº1è½¬å‘åˆ°ä¸»æœº2ï¼Œä¸»æœº1å°†æŠ¥æ–‡å‘é€ç»™èŠ‚ç‚¹Aå¤„ç†ã€‚èŠ‚ç‚¹Aã€Bã€Dã€Eå‡æ”¯æŒSRv6ï¼ŒèŠ‚ç‚¹Cä¸æ”¯æŒSRv6ï¼Œåªæ”¯æŒIPv6ã€‚æˆ‘ä»¬åœ¨æºèŠ‚ç‚¹Aä¸Šè¿›è¡Œç½‘ç»œç¼–ç¨‹ï¼Œå¸Œæœ›æŠ¥æ–‡ç»è¿‡B-Cã€C-Dé“¾è·¯ï¼Œé€è¾¾èŠ‚ç‚¹Eï¼Œç”±EèŠ‚ç‚¹é€è¾¾ä¸»æœº2ã€‚\næŠ¥æ–‡è½¬å‘æµç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š\næºèŠ‚ç‚¹Aå°†SRv6è·¯å¾„ä¿¡æ¯å°è£…åœ¨SRHä¸­ï¼ŒæŒ‡å®šB-Cï¼ŒC-Dé“¾è·¯çš„SIDï¼Œå¦å¤–å°è£…Eç‚¹å‘å¸ƒçš„SID A5::10ï¼ˆæ­¤SIDå¯¹åº”äºèŠ‚ç‚¹Eçš„ä¸€ä¸ªIPv4 VPNï¼‰ï¼Œå…±3ä¸ªSIDï¼ŒæŒ‰ç…§é€†åºå½¢å¼å‹å…¥SIDåºåˆ—ã€‚æ­¤æ—¶SLï¼ˆSegment Leftï¼‰=2ï¼Œå°†Segment List[2]å€¼å¤åˆ¶åˆ°ç›®çš„åœ°å€DAå­—æ®µï¼ŒæŒ‰ç…§æœ€é•¿åŒ¹é…åŸåˆ™æŸ¥æ‰¾IPv6è·¯ç”±è¡¨ï¼Œå°†å…¶è½¬å‘åˆ°èŠ‚ç‚¹Bã€‚ æŠ¥æ–‡åˆ°è¾¾èŠ‚ç‚¹Bï¼ŒBèŠ‚ç‚¹æŸ¥æ‰¾æœ¬åœ°SIDè¡¨ï¼ˆå­˜å‚¨æœ¬èŠ‚ç‚¹ç”Ÿæˆçš„SRv6 SIDä¿¡æ¯ï¼‰,å‘½ä¸­è‡ªèº«çš„SIDï¼ˆEnd.X SIDï¼‰ï¼Œæ‰§è¡ŒSIDå¯¹åº”çš„æŒ‡ä»¤åŠ¨ä½œã€‚SLå€¼å‡1ï¼Œå¹¶å°†Segment List[1]å€¼å¤åˆ¶åˆ°DAå­—æ®µï¼ŒåŒæ—¶å°†æŠ¥æ–‡ä»SIDç»‘å®šçš„é“¾è·¯ï¼ˆB-Cï¼‰å‘é€å‡ºå»ã€‚ æŠ¥æ–‡åˆ°è¾¾èŠ‚ç‚¹Cï¼ŒCæ— SRv6èƒ½åŠ›ï¼Œæ— æ³•è¯†åˆ«SRHï¼ŒæŒ‰ç…§æ­£å¸¸IPv6æŠ¥æ–‡å¤„ç†æµç¨‹ï¼ŒæŒ‰ç…§æœ€é•¿åŒ¹é…åŸåˆ™æŸ¥æ‰¾IPv6è·¯ç”±è¡¨ï¼Œå°†å…¶è½¬å‘åˆ°å½“å‰ç›®çš„åœ°å€æ‰€ä»£è¡¨çš„èŠ‚ç‚¹Dã€‚ èŠ‚ç‚¹Dæ”¶æŠ¥æ–‡åæ ¹æ®ç›®çš„åœ°å€A4::45æŸ¥æ‰¾æœ¬åœ°SIDè¡¨ï¼Œå‘½ä¸­è‡ªèº«çš„SIDï¼ˆEnd.X SIDï¼‰ã€‚åŒèŠ‚ç‚¹Bï¼ŒSLå€¼å‡1ï¼Œå°†A5::10ä½œä¸ºDAï¼Œå¹¶å°†æŠ¥æ–‡å‘é€å‡ºå»ã€‚ èŠ‚ç‚¹Eæ”¶åˆ°æŠ¥æ–‡åæ ¹æ®A5::10æŸ¥æ‰¾æœ¬åœ°SIDè¡¨ï¼Œå‘½ä¸­è‡ªèº«SIDï¼ˆEnd.DT4 SIDï¼‰ï¼Œæ‰§è¡Œå¯¹åº”çš„æŒ‡ä»¤åŠ¨ä½œï¼Œè§£å°è£…æŠ¥æ–‡ï¼Œå»é™¤IPv6æŠ¥æ–‡å¤´ï¼Œå¹¶å°†å†…å±‚IPv4æŠ¥æ–‡åœ¨SIDç»‘å®šçš„VPNå®ä¾‹çš„IPv4è·¯ç”±è¡¨ä¸­è¿›ç¨‹æŸ¥è¡¨è½¬å‘ï¼Œæœ€ç»ˆå°†æŠ¥æ–‡å‘é€ç»™ä¸»æœº2ã€‚ SRv6 TE å·¥ä½œæ¨¡å¼ SRv6 TE Policy åˆ©ç”¨Segment Routing çš„æºè·¯ç”±æœºåˆ¶ï¼Œé€šè¿‡åœ¨å¤´èŠ‚ç‚¹å°è£…ä¸€ä¸ªæœ‰åºçš„æŒ‡ä»¤åˆ—è¡¨æ¥æŒ‡å¯¼æŠ¥æ–‡ç©¿è¶Šç½‘ç»œã€‚\nSRv6 TE Policyçš„å·¥ä½œæµç¨‹ä¸»è¦ä¹Ÿå¯ä»¥æ¦‚æ‹¬ä¸º5ä¸ªæ­¥éª¤:\nè½¬å‘å™¨å°†ç½‘ç»œæ‹“æ‰‘ä¿¡æ¯é€šè¿‡ BGP LS. ä¸ŠæŠ¥ç»™ç½‘ç»œæ§åˆ¶å™¨ã€‚æ‹“æ‰‘ä¿¡æ¯åŒ…æ‹¬èŠ‚ç‚¹(ç±»æ¯”äº¤å‰è·¯å£)ã€é“¾è·¯ä¿¡æ¯(ç±»æ¯”é“è·¯)ï¼Œä»¥åŠé“¾è·¯çš„å¼€é”€(ç±»æ¯”æµé€Ÿ)ã€å¸¦å®½(ç±»æ¯”è½¦é“)å’Œæ—¶å»¶(ç±»æ¯”ä¿¡å·ç¯)ç­‰TEå±æ€§ã€‚ æ§åˆ¶å™¨åŸº äºæ”¶é›†åˆ°çš„æ‹“æ‰‘ä¿¡æ¯ï¼ŒæŒ‰ç…§ä¸šåŠ¡éœ€æ±‚è®¡ç®—è·¯å¾„ï¼Œç¬¦åˆä¸šåŠ¡çš„SLAã€‚ æ§åˆ¶å™¨é€šè¿‡ BGP SR-Policyæ‰©å±•å°†è·¯å¾„ä¿¡æ¯ä¸‹å‘ç»™ç½‘ç»œçš„å¤´èŠ‚ç‚¹ï¼Œå¤´èŠ‚ç‚¹ç”ŸæˆSRv6 TE Policyã€‚ ç”Ÿæˆçš„SRv6 TE Policy åŒ…æ‹¬å¤´ç«¯åœ°å€ã€ç›®çš„åœ°å€å’ŒColorç­‰å…³ é”®ä¿¡æ¯ã€‚ ç½‘ç»œçš„å¤´èŠ‚ ç‚¹ä¸ºä¸šåŠ¡é€‰æ‹©åˆé€‚çš„ SRv6TE Policy æŒ‡å¯¼è½¬å‘ã€‚ æ•°æ®è½¬å‘æ—¶ï¼Œ è½¬å‘å™¨éœ€è¦æ‰§è¡Œè‡ªå·±å‘å¸ƒçš„SIDçš„æŒ‡ä»¤ã€‚ SRv6 BE å·¥ä½œæ¨¡å¼ ä¼ ç»ŸMPLSæœ‰LDPå’ŒRSVP-TEä¸¤ç§æ§åˆ¶åè®®ï¼Œå…¶ä¸­LDPæ–¹å¼ä¸æ”¯æŒæµé‡å·¥ç¨‹èƒ½åŠ›ï¼ŒLDPåˆ©ç”¨IGPç®—è·¯ç»“æœï¼Œå»ºç«‹LDP LSPæŒ‡å¯¼è½¬å‘ã€‚åœ¨SRv6é‡Œï¼Œä¹Ÿæœ‰ç±»ä¼¼çš„æ–¹å¼ï¼Œåªä¸è¿‡SRv6ä»…ä½¿ç”¨ä¸€ä¸ªä¸šåŠ¡SIDæ¥æŒ‡å¼•æŠ¥æ–‡åœ¨IP ç½‘ç»œé‡Œè¿›è¡Œå°½åŠ›è€Œä¸º( Best Effortï¼ŒBE) çš„è½¬å‘ï¼Œè¿™ç§æ–¹å¼å°±æ˜¯SRv6 BEã€‚ä¸‹é¢ä»¥ EVPN L3VPNv4 over SRv6 BEä»‹ç»ã€‚\nåœ¨VPNæ¦‚å¿µä¸­ï¼ŒæŠŠæ•´ä¸ªç½‘ç»œä¸­çš„è·¯ç”±å™¨å¦‚ä¸‹ä¸‰ç±»ï¼š\nP(Providerï¼Œè¿è¥å•†éª¨å¹²è·¯ç”±å™¨) PE(Provider Edgeã€è¿è¥å•†è¾¹ç¼˜è·¯ç”±å™¨) CE(Customer Edgeã€å®¢æˆ·ä¾§è¾¹ç¼˜è·¯ç”±å™¨)\nåœ¨è·¯ç”±å‘å¸ƒé˜¶æ®µ:\nPE2 .ä¸Šé…ç½®Locator,ç„¶åPE2é€šè¿‡IGPåè®®å°†SRv6 SIDå¯¹åº”çš„ Locator ç½‘æ®µè·¯ç”±2001:DB8:3:/64å‘å¸ƒç»™PE1ã€‚PE1å®‰è£…è·¯ç”±åˆ°è‡ªå·±çš„IPv6è·¯ç”±è¡¨ã€‚ PE2 åœ¨LocatorèŒƒå›´å†…é…ç½®VPNå®ä¾‹çš„End.DT4 SID 2001:DB8:3::C100ï¼Œ ç”Ÿæˆæœ¬åœ°SIDè¡¨ã€‚ PE2æ”¶åˆ°CE2å‘å¸ƒçš„ç§ç½‘IPv4è·¯ç”±åï¼ŒPE2å°†ç§ç½‘IPv4è·¯ç”±è½¬æ¢æˆIP Prefix Routeå½¢å¼çš„EVPNè·¯ç”±ï¼Œé€šè¿‡BGP EVPNé‚»å±…å…³ç³»å‘å¸ƒç»™PE1 ã€‚æ­¤è·¯ç”±æºå¸¦ SRv6 VPN SIDå±æ€§ï¼Œä¹Ÿå°±æ˜¯VPNå®ä¾‹çš„End.DT4 SID 2001:DB8::C100ã€‚ PE1 æ¥æ”¶åˆ°EVPNè·¯ç”±åï¼Œå°†å…¶äº¤å‰åˆ°å¯¹åº”çš„VPNå®ä¾‹IPv4è·¯ç”±è¡¨ï¼Œç„¶åè½¬æ¢æˆæ™®é€šIPv4è·¯ç”±ï¼Œå¯¹CE1å‘å¸ƒã€‚ åœ¨æ•°æ®è½¬å‘é˜¶æ®µ:\nCE1 å‘PE1å‘é€ä¸€ä¸ªæ™®é€šIPv4æŠ¥æ–‡ã€‚ PE1 ä»ç»‘å®šäº†VPNå®ä¾‹çš„æ¥å£.ä¸Šæ”¶åˆ°ç§ç½‘æŠ¥æ–‡ä»¥åï¼ŒæŸ¥æ‰¾å¯¹åº”VPNå®ä¾‹çš„IPv4è·¯ç”±è½¬å‘è¡¨ï¼ŒåŒ¹é…ç›®çš„IPv4å‰ç¼€ï¼ŒæŸ¥æ‰¾åˆ°å…³è”çš„SRv6 VPN SID ä»¥åŠä¸‹ä¸€è·³ä¿¡æ¯ã€‚ç„¶åç›´æ¥ä½¿ç”¨SRv6 VPN SID 2001:DB8:3::C100 ä½œä¸ºç›®çš„åœ°å€å°è£…æˆIPv6æŠ¥æ–‡ã€‚ PE1ç„¶åæŒ‰ç…§æœ€é•¿åŒ¹é…åŸåˆ™ï¼ŒåŒ¹é…åˆ°è·¯ç”±2001:DB8::/64, æŒ‰æœ€çŸ­è·¯å¾„è½¬å‘åˆ°Pè®¾å¤‡ã€‚ P è®¾å¤‡æŒ‰ç…§æœ€é•¿åŒ¹é…åŸåˆ™ï¼ŒåŒ¹é…åˆ°è·¯ç”±2001:DB8:3:/64ï¼Œ æŒ‰æœ€çŸ­è·¯å¾„è½¬å‘åˆ°PE2ã€‚ PE2 ä½¿ç”¨2001:DB8::C100æŸ¥æ‰¾æœ¬åœ°SIDè¡¨ï¼ŒåŒ¹é…åˆ°End.DT4 SIDå¯¹åº”çš„è½¬å‘åŠ¨ä½œï¼Œå°†IPv6æŠ¥æ–‡å¤´å»é™¤ï¼Œç„¶åæ ¹æ®End.DT4 SIDåŒ¹é…VPNå®ä¾‹ï¼ŒæŸ¥æ‰¾VPN å®ä¾‹IPv4è·¯ç”±è¡¨è¿›è¡Œè½¬å‘ã€‚ å®è·µæ¼”ç¤º æŒ‡ä»¤ä»‹ç» ç”±äº è¯¥å®éªŒç¯å¢ƒä½¿ç”¨ iproute2 åŒ…å®ç°ï¼Œä¸åŒ…å«å…¨éƒ¨ä¸Šè¿°ç†è®ºä»‹ç»SRv6æŒ‡ä»¤ï¼Œè¿™é‡ŒæŒ‰ç…§ iproute2 åŒ…çš„å®ç°æ¥è¿›è¡Œä»‹ç»ï¼Œä½¿ç”¨ man ip route å¯ä»¥çœ‹åˆ°\nip route replace encap ENCAPTYPE ENCAPHDR attach tunnel encapsulation attributes to this route. seg6 mode inline - Directly insert Segment Routing Header after IPv6 header mode encap - Encapsulate packet in an outer IPv6 header with SRH mode l2encap - Encapsulate ingress L2 frame within an outer IPv6 header and SRH SEGMENTS - List of comma-separated IPv6 addresses KEYID - Numerical value in decimal representation. See ip-sr(8). seg6local SEG6_ACTION [ SEG6_ACTION_PARAM ] - Operation to perform on matchâ€ ing packets. The following actions are currently supported (Linux 4.14+ only). SEG6_ACTION [ SEG6_ACTION_PARAM ] - Operation to perform on matchâ€ ing packets. The following actions are currently supported (Linux 4.14+ only). End - Regular SRv6 processing as intermediate segment endpoint. This action only accepts packets with a non-zero Segments Left value. Other matching packets are dropped. End.X nh6 NEXTHOP - Regular SRv6 processing as intermediate segâ€ ment endpoint. Additionally, forward processed packets to given next-hop. This action only accepts packets with a non-zero Segâ€ ments Left value. Other matching packets are dropped. End.DX6 nh6 NEXTHOP - Decapsulate inner IPv6 packet and forward it to the specified next-hop. If the argument is set to ::, then the next-hop is selected according to the local selection rules. This action only accepts packets with either a zero Segments Left value or no SRH at all, and an inner IPv6 packet. Other matching packets are dropped. End.B6 srh segs SEGMENTS [ hmac KEYID ] - Insert the specified SRH immediately after the IPv6 header, update the DA with the first segment of the newly inserted SRH, then forward the reâ€ sulting packet. The original SRH is not modified. This action only accepts packets with a non-zero Segments Left value. Other matching packets are dropped. End.B6.Encaps srh segs SEGMENTS [ hmac KEYID ] - Regular SRv6 processing as intermediate segment endpoint. Additionally, enâ€ capsulate the matching packet within an outer IPv6 header folâ€ lowed by the specified SRH. The destination address of the outer IPv6 header is set to the first segment of the new SRH. The source address is set as described in ip-sr(8). æœ¬åœ°SIDè¡¨åœ¨ ä¸»æœºç¯å¢ƒç§å¯ä»¥ä½¿ç”¨è·¯ç”±è¡¨æŸ¥çœ‹ï¼Œå³ä¸º ip 6 route show æˆ– ip -6 route show å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ç¬¬ä¸‰æ–¹å·¥å…·ã€‚\nåœºæ™¯ç¯å¢ƒé…ç½® Ubuntu18.04 å†…æ ¸ç‰ˆæœ¬ 4.14åŠä»¥ä¸Š iproute2 ç‰ˆæœ¬4.9.0 åŠä»¥ä¸Š core ç‰ˆæœ¬7.5.1 åŠä»¥ä¸Š Quagga ç‰ˆæœ¬1.2.4 åŠä»¥ä¸Š å‚è€ƒè¿™ç¯‡åšå®¢ï¼Œè®¾è®¡äº†ä¸€ä¸ª IPv4 ä½¿ç”¨ IPv6 é€šé“çš„æµé‡å·¥ç¨‹æ‹“æ‰‘ã€‚æ¯å°è·¯ç”±å™¨éƒ½å¼€å¯ IPforword å’Œ quaggaã€‚\nsysctl -w net.ipv4.conf.all.forwarding=1 sysctl -w net.ipv4.conf.default.forwarding=1 sysctl -w net.ipv6.conf.all.forwarding=1 sysctl -w net.ipv6.conf.default.forwarding=1 ä»ä¸»æœºn1å‘å‡ºçš„IPv4æ•°æ®åŒ…ï¼Œåˆ°è¾¾æ”¯æŒSRv6çš„è·¯ç”±å™¨ n4 ï¼Œ n4 ä¼šæ ¹æ®æ‰€é…ç½®çš„æ“ä½œå¯¹æ•°æ®åŒ…è¿›è¡Œå°è£…ï¼Œåœ¨å¤–å±‚åŠ ä¸ŠIPv6ä»¥åŠSRHçš„æŠ¥å¤´ï¼Œå¹¶è¿›è¡Œæ­£å¸¸çš„IPv6è½¬å‘ã€‚åœ¨ä»…æ”¯æŒIPv6çš„è·¯ç”±å™¨ n5ï¼Œn5æ ¹æ®IPv6æŠ¥å¤´åŸºäºç›®çš„IPv6åœ°å€è¿›è¡Œè½¬å‘ã€‚åœ¨n6ï¼Œn6è·¯ç”±å™¨æ ¹æ®Segmentæ‰§è¡ŒEndæ“ä½œï¼Œå°†Segment Leftå‡1ï¼Œå¹¶æ ¹æ®Segmentåˆ—è¡¨æ›´æ–°IPv6çš„ç›®çš„åœ°å€ï¼Œå°†æ•°æ®åŒ…è½¬å‘è‡³ä¸‹ä¸€è·³n7ã€‚åœ¨æ”¯æŒSRv6çš„è·¯ç”±å™¨n7ï¼Œn7æ ¹æ®Segmentæ‰§è¡ŒEnd.DX4æ“ä½œï¼Œå‰¥æ‰å¤–å±‚çš„IPv6æŠ¥å¤´ï¼Œå°†å†…å«çš„IPv4æ•°æ®åŒ…å‘ç»™ä¸»æœºn3ï¼Œå®Œæˆè½¬å‘æµç¨‹ã€‚ ä¹‹åçš„è¿”å›åŒ…æµç¨‹å°±æ˜¯ ç›´æ¥ä»n7 æŒ‡å‘ n4ã€‚\nè¿™é‡Œä¸€å¼€å§‹åšå¯¹ SRv6 ç†è§£ä¸å¤Ÿé€å½»è®¤ä¸º SID å°±æ˜¯å•çº¯çš„IPv6åœ°å€ï¼ŒæŒ‰ç…§åŸå›¾çš„é…ç½® å¯ä»¥çœ‹åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„è·¯ç”± å±…ç„¶æ˜¯æŒ‰ç…§ fc00:4::bb ç½‘æ®µæ“ä½œï¼Œå¯æ˜¯åŸåœºæ™¯æ²¡æœ‰è¿™äº›ç½‘æ®µï¼Œè¿™è®©æˆ‘éå¸¸ç–‘æƒ‘ã€‚ä¸€åˆ‡å¦‚ä¸Šå›¾é…ç½®å®Œæ¯•åï¼Œå‘ç°ä»n4å¼€å§‹å°±æ²¡æœ‰å‘å‡º SRv6 çš„è·¯ç”±åŒ…ã€‚ä¹Ÿæ²¡æœ‰æŠ¥é”™æç¤ºï¼Œæœ€åçè¯•å‘ç°ï¼Œæ˜¯ä¸­è½¬çš„ä¾‹å¦‚ fc00:4:bb æ²¡æœ‰è¿™ä¸ªè·¯ç”±ç³»ç»Ÿå†…æ ¸ç›´æ¥å¤„ç†ä¸ºä¸å¯è¾¾ï¼Œä¹Ÿå°±æ²¡æœ‰åš SRv6 è½¬å‘æ“ä½œã€‚\nä¸€é¡¿æŠ˜è…¾åï¼Œæ¯ä¸€è·³éƒ½é…ç½®å¥½è·¯ç”±åè§‰å¾—ä¸å¤ªå¯¹ï¼Œè¿™æ¯ä¸€è·³éƒ½è¦è®¾ç½®è·¯ç”±ä¹Ÿå¤ªè ¢äº†ï¼Œä¸€å®šæ˜¯æˆ‘é…ç½®çš„é—®é¢˜ã€‚\nåæ¥åœ¨githubæ‰¾åˆ°ä¸ª onos åšSDNæ§åˆ¶å™¨ã€ mininetåšä»¿çœŸç¯å¢ƒçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œé‡Œé¢çš„ issue ä½œè€…æåˆ°å°½é‡æŠŠ sid ä¸ç‰©ç†æ¥å£éš”ç¦»å¼€ï¼Œè¿™æ—¶æˆ‘æ‰çªç„¶æ˜ç™½ï¼Œsid è®¾è®¡çš„å·§å¦™ä¹‹å¤„ï¼š\nsid é•¿åº¦ä¸º128bitï¼Œä¸IPv6åœ°å€ç›¸åŒèƒ½å¤Ÿåœ¨ä¸å…·å¤‡SRv6çš„èŠ‚ç‚¹ä¸Šä½œä¸ºæ™®é€šipåœ°å€ä½¿ç”¨ï¼Œå³å°† locatorä½œä¸ºè·¯ç”±å™¨ç½‘æ®µå†…å‰ç¼€ï¼Œfunction å­—æ®µè®¾è®¡å¹¶æ ‡è¯†ä¸ºä¸åŒçš„æµé‡ï¼Œç›¸åº”çš„èŠ‚ç‚¹å¯¹è¯¥sidåœ°å€åšä¸åŒçš„å¤„ç†ï¼Œåé¢çš„é•¿åº¦ä¹Ÿè¶³å¤Ÿé•¿å¯ä»¥è®¾è®¡åŒä¸€fuctionä¸‹çš„ä¸åŒArgumentsã€‚è¿™å°±æ˜¯ è·¯ç”± + MPLS çš„èåˆçš„è®¾è®¡æ€è·¯ï¼Œè®¾è®¡çš„SIDå‰ç¼€ä¸ä¸»æœºç½‘ç»œå‰ç¼€ç›¸åŒä½¿ç”¨åŒä¸€ä¸ª locatorï¼Œä¹‹åå†åŠ ä¸Š å®šä¹‰çš„ funtion argumentså­—æ®µï¼Œsid åˆèƒ½åšipåœ°å€åˆèƒ½ç›´æ¥å¯¹ç½‘ç»œè¿›è¡Œç¼–ç¨‹ã€‚\nè¿™é‡Œä½¿ç”¨ä¸€ä¸ªæ–°çš„åœºæ™¯ä¸¾ä¾‹è¯´æ˜ï¼Œå¯¹å‡ºå‘æµé‡ fuction è®¾å®šä¸º aï¼Œè¿”å›çš„æµé‡ fuction è®¾å®š ä¸º bï¼Œarguments éƒ½æ˜¯233 æ­¤å¤„ä¸åšå¤„ç†ã€‚å…¶é—´ç»¿è‰²è·¯ç”±å™¨ä¸ºæ™®é€š IPv6 è·¯ç”±å™¨ä»…æ”¯æŒigpåè®®ï¼Œæ­¤å¤„ä½¿ç”¨çš„æ˜¯ quagga å®ç°çš„ OSPFv3ã€‚\nç”±äºç½‘æ®µå…¨éƒ¨ä¸º 64ä½ï¼Œfuctionè®¾å®šå ç”¨16ä½ï¼Œsid è®¾è®¡ä¸º 2001:X:0:0:$fuction:0:0:0:0/80 åé¢çš„argumentsè®¾å®šä½å›ºå®šçš„ 233ã€‚\nä¸è¿‡éœ€è¦æ³¨æ„ï¼Œä½¿ç”¨SRv6è·¯ç”±å®šä¹‰æ—¶ä¸è¦ä¸åŸæœ‰å†…æ ¸ æˆ– zebra ç”Ÿæˆçš„è·¯ç”±å†²çªï¼ŒSRv6çš„ä¼˜å…ˆçº§ä¸å¤Ÿé«˜å¯èƒ½æ°¸è¿œä¹Ÿæ— æ³•è§¦å‘ç›¸åº”endæ“ä½œï¼Œå¯¼è‡´èŠ‚ç‚¹ä½¿ç”¨NDPåè®®å»å¯»æ‰¾å¯¹åº”ç‰©ç†æ„ä¹‰ä¸å­˜åœ¨çš„IPv6åœ°å€ã€‚\nå…·ä½“é…ç½®ä¿¡æ¯ï¼š\nå¼€å¯äº†IPforword æ— æ‰€è°“æŒ‡å®šçš„devï¼Œä¸å½±å“æœ€åçš„ç»“æœ\n# n1é…ç½® ip route add 10.0.6.0/24 encap seg6 mode encap segs 2001:2:0:0:a::233,2001:6:0:0:a::233 dev eth0 ip -6 route add 2001:0:0:0:b::233/80 encap seg6local action End.DX4 nh4 10.0.0.20 dev eth1 # n2é…ç½® ip -6 route add 2001:1:0:0:b::233/80 encap seg6local action End dev eth1 ip -6 route add 2001:2:0:0:a::233/80 encap seg6local action End.X nh6 2001:2::2 dev eth1# endæ“ä½œå æŒ‰ç…§æŒ‡å®šä¸‹ä¸€è·³æ¥å£è½¬å‘ip ä¸æŒ‡å®šä¼šæŒ‰ç…§è·¯ç”±æœ€çŸ­è·¯å¾„èµ° # n6é…ç½® ip -6 route add 2001:6:0:0:a::233/80 encap seg6local action End.DX4 nh4 10.0.6.20 dev eth1 ip route add 10.0.0.0/24 encap seg6 mode encap segs 2001:1:0:0:b::233,2001:0:0:0:b::233 dev eth0 æŠ“åŒ…åˆ†æ ä¸»æœºn7 ping n8 åœ¨n4 n9ä½¿ç”¨tcpdumpå¯ä»¥çœ‹åˆ°SRv6æ•°æ®åŒ…ï¼Œå‡ºå‘çš„è·¯å¾„ segment listæ˜¯é€†åºçš„ï¼ŒæŒ‡ä»¤æŒ‡å®šçš„æ˜¯æ­£åºã€‚ä¸º2001:2:0:0:a::233,2001:6:0:0:a::233\nè·¯ç”±ä¿¡æ¯èµ°åˆ°èŠ‚ç‚¹n2å‘½ä¸­æœ¬åœ°SIDè¡¨åæ‰§è¡Œ END.X ä¸ä»…å°† segment left - 1 ä¿®æ”¹ç›®çš„åœ°å€ï¼Œè¿˜è½¬å‘è‡³æŒ‡å®šä¸‹ä¸€è·³2001:2::2ã€‚ä¹‹ååˆ°è¾¾n3å ç”±äºä¸å­˜åœ¨ SRv6 å¤„ç†èƒ½åŠ›ï¼Œå•çº¯æŒ‰ç…§ç½‘æ®µæœ€é•¿å‰ç¼€åŒ¹é…è·¯ç”±ã€‚æœ€åè½¬å‘åˆ°n6åæ‰§è¡Œè§£åŒ…æ“ä½œæ‹†åˆ†å‡ºåŸå§‹çš„ IPv4 æŠ¥æ–‡ã€‚è¿”å›æ•°æ®åŒ…çš„æ“ä½œç±»ä¼¼ï¼Œä¸è¿‡æ˜¯èµ°è·¯ç”±çš„æœ€çŸ­è·¯ç»è¿‡ä¸Šé¢çš„è·¯ç”±å™¨è½¬å‘SRv6æ•°æ®ã€‚\nåœ¨æ—  SRv6 è·¯ç”±å™¨ä¸Šçš„è½¬å‘ã€‚åœ¨n2ä½¿ç”¨wiresharkå…·ä½“åˆ†æåŒ…ç»“æ„\nè¿™é‡Œç»™å‡ºæˆ‘æ­å»ºçš„åœºæ™¯é“¾æ¥ï¼Œæ–°ç‰ˆçš„coreéœ€è¦ä½¿ç”¨ legacy ui æ‰“å¼€ã€‚ä»¿çœŸä¸€å¼€å§‹å¯èƒ½pingä¸é€šï¼Œéœ€è¦ç­‰å¾…ä¸­é—´ç»¿è‰²èŠ‚ç‚¹çš„ospfè·¯ç”±ç”Ÿæˆã€‚\næ‰©å±•åœºæ™¯ è¯¥åœºæ™¯é“¾æ¥\nåœºæ™¯å¦‚ä¸Šæ‰€ç¤ºï¼Œä¸»æœºn1åˆ°ä¸»æœºn2çš„æµé‡ï¼Œåœ¨n4ä¸Šæ·»åŠ SRHè¦æ±‚ç»ç”±n6è¿›è¡Œè½¬å‘ï¼Œå› æ­¤åŸæµé‡è·¯å¾„å¦‚å›¾é»‘è‰²è·¯å¾„æ‰€ç¤ºã€‚ åœ¨n6è·¯ç”±å™¨ä¸Šï¼Œä¿®æ”¹Endæ“ä½œä¸ºEnd.B6.Encapsæ“ä½œï¼Œå°†æµé‡å…ˆå¼•å¯¼åˆ° IDS n8è¿›è¡Œå¤„ç†ï¼Œå†å›åˆ°n6è¿›è¡Œæ­£å¸¸è½¬å‘æµç¨‹ã€‚å¯¹åº”çš„æ–°çš„æµé‡è·¯å¾„å¦‚å›¾ç»¿è‰²è·¯å¾„æ‰€ç¤ºã€‚æœ€åé€šè¿‡ç»¿è‰²è·¯å¾„è¿”å›n1ã€‚\nEnd.B6.Encapså°±æ˜¯åœ¨åœ¨ç°æœ‰IPv6æ•°æ®åŒ…ä¸Šå†å°è£…ä¸€ä¸ªæ–°çš„IPv6çš„æŠ¥å¤´ï¼Œå¹¶æ·»åŠ æ–°çš„SRHæŠ¥å¤´ï¼›è€ŒEnd.B6æ“ä½œåˆ™ä¸ä¼šæ·»åŠ æ–°çš„IPv6æŠ¥å¤´ï¼Œè€Œæ˜¯ç›´æ¥æ’å…¥æ–°çš„SRHæŠ¥å¤´åˆ°ç°æœ‰çš„IPv6æŠ¥å¤´å½“ä¸­ã€‚è¿™ä¸¤ç§æ“ä½œæœ¬è´¨ä¸Šéƒ½ç›¸å½“äºæ˜¯Binding-SIDã€‚\nè¿™äº› sid è®¾è®¡å¦‚ä¸Šé¢åœºæ™¯ä¸€æ ·ã€‚ å³ä¸º2001:X:0:0:$fuction:0:0:0:0/80 ã€‚locator ä¸ºè·¯ç”±å™¨ç½‘æ®µå‰ç¼€ï¼Œfuction å¯¹åº” a, aa, b ä¸‰ç§æ“ä½œã€‚\nå…·ä½“é…ç½®å¦‚ä¸‹æ‰€ç¤ºã€‚\n# n4é…ç½® ip route add 10.0.2.0/24 encap seg6 mode encap segs 2001:8:0:0:a::233,2001:6:0:0:a::233 dev eth0 ip -6 route add 2001:0:0:0:b::233/80 encap seg6local action End.DX4 nh4 10.0.1.20 dev eth1 # n7é…ç½® ip -6 route add 2001:6:0:0:a::233/80 encap seg6local action End.DX4 nh4 10.0.2.20 dev eth1 ip route add 10.0.1.0/24 encap seg6 mode encap segs 2001:0:0:0:b::233 dev eth1 # n8é…ç½® ip route add fc:4:0:0:aa::aa via 2001:8::1 ip -6 route add fc:8:0:0:aa::aa encap seg6local action End dev eth0 # n6é…ç½® ip -6 route add fc:8:0:0:aa::aa/80 via 2001:8::2 #ç”±äºè¯¥èŠ‚ç‚¹ç›¸é‚» éœ€è¦ä½¿ç”¨ç‰¹æ®Šç½‘æ®µ é˜²æ­¢ä¼˜å…ˆåŒ¹é…äº†2001:8ç½‘æ®µå¯¼è‡´æ— æ³•è½¬å‘ ip -6 route add 2001:8:0:0:a::233/80 encap seg6local action End.B6.Encaps srh segs fc:8:0:0:aa::aa,fc:4:0:0:aa::aa dev eth1 ip -6 route add fc:4:0:0:aa::aa/80 encap seg6local action End.DX6 nh6 :: dev eth1 è¿˜å¯ä»¥ä¿®æ”¹ä¼˜å…ˆçº§ åšå¤„ç† ä½¿å¾—å…ˆè¿›è¡ŒSRv6 sid çš„å¤„ç† é¿å…é“¾è·¯è·¯ç”±å¤„ç† ä½¿ç”¨ntpå¯»æ‰¾ä¸å­˜åœ¨çš„ipã€‚n6 n8 é…ç½®çš„ä¿®æ”¹å¦‚ä¸‹æ‰€ç¤ºã€‚\n# n6é…ç½® ip -6 route add 2001:8:0:0:aa::aa via 2001:8::2 metric 255 ip -6 route add 2001:8:0:0:a::233/80 encap seg6local action End.B6.Encaps srh segs 2001:8:0:0:aa::aa,2001:4:0:0:aa::aa dev eth1 ip -6 route add 2001:4:0:0:aa::aa/80 encap seg6local action End.DX6 nh6 :: dev eth1 # n8é…ç½® ip route add 2001:4:0:0:aa::aa via 2001:8::1 metric 255 ip -6 route add 2001:8:0:0:aa::aa encap seg6local action End dev eth0 æŠ“åŒ…æ•°æ®å¤§éƒ½ç›¸åŒï¼Œè¿™é‡Œåˆ†åˆ«æŠ“å– n5 n8 n9 çš„æ•°æ®åŒ…:\n","id":4,"section":"posts","summary":"æœ€è¿‘åœ¨å­¦ä¹ SRv6ç›¸å…³çš„çŸ¥è¯†, å®è·µæ–¹é¢å‚è€ƒè¿™ç¯‡ ä½¿ç”¨ mininetçš„ åšå®¢ã€‚æˆ‘è¿™é‡Œä½¿ç”¨ core å¹³å° æ­å»ºäº†ä¸ªç®€æ˜“åœºæ™¯ ä½“ä¼š SRv6 æ•´ä¸ªæ•°æ®çš„ipåŒ…çš„åŒ…è£…è§£æã€‚äºŒ","tags":["linux","network","sdn"],"title":"SRv6å­¦ä¹ ","uri":"https://liangkang233.github.io/2022/07/srv6%E5%AD%A6%E4%B9%A0/","year":"2022"},{"content":"èƒŒæ™¯ ç°åœ¨è¦ç»§ç»­åšemaneç›¸å…³çš„å¼€å‘ï¼Œä¹‹å‰åštdmaç›¸å…³å†…å®¹å†™äº†ç¯‡ Emaneæ¨¡å‹è°ƒç ” ï¼Œç°åœ¨æƒ³æ¢³ç†ä¸‹æ•´ä¸ªä»¿çœŸå™¨çš„ä»¿çœŸæµç¨‹ï¼Œè®°å½•ä¸‹ã€‚\ndebug Emane ä¸ºäº†æ›´å¥½çš„ç†è§£å’Œå¼€å‘ emane éœ€è¦ä½¿ç”¨gdbè°ƒè¯•è¯¥ç¨‹åºï¼Œä½¿ç”¨vscodeåœ¨coreå†…å®¹å™¨èŠ‚ç‚¹æ‰§è¡Œã€‚ç”±äºè¯¥èŠ‚ç‚¹ç”¨æˆ·ä¸º root ç”¨æˆ·ï¼Œå¯ä»¥å°†ä¸‹è„šæœ¬åŠ å…¥æ‰§è¡Œç›®å½• /usr/local/bin ä¸­æ–¹ä¾¿æ‰“å¼€ root ç”¨æˆ·ä¸‹çš„ vsocdeã€‚å®¿ä¸»ä¸»æœºæ‰§è¡Œ xhost + å¦åˆ™å®¹å™¨å†…vscodeæ— æ³•é€šè¿‡ä¸‹x11è¿æ¥å¤–éƒ¨æ˜¾ç¤ºå™¨ã€‚\n#!/bin/bash code --user-data-dir=\u0026quot;/home/lk233/.vscode/root_config\u0026quot; --no-sandbox /home/lk233/emane ä¸è¿‡gdbå¯åŠ¨emaneè¿›ç¨‹è°ƒè¯•ä¼šå‡ºç°é—®é¢˜ï¼Œä»–éœ€è¦é‡å¯emaneè¿›ç¨‹ï¼Œcoreçš„link_monitorç›‘å¬çº¿ç¨‹ä¼šæŠ¥é”™ã€‚å…¶æ¬¡é‡å¯åéœ€è¦å‘é€æ‰€æœ‰èŠ‚ç‚¹çš„ä½ç½®äº‹ä»¶æ›´æ–°ä¸‹é‡å¯åçš„èŠ‚ç‚¹ä½ç½®è¡¨(å¯ä»¥ç•Œé¢æ‹–åŠ¨èŠ‚ç‚¹è§¦å‘emaneäº‹ä»¶)ï¼Œå¦åˆ™æ— æ³•å‘é€å¯¹åº”otaåŒ…ï¼Œåº”ç”¨å±‚çœ‹å°±æ˜¯æ— çº¿ç½‘å¡æ— æ³•å’Œå…¶ä»–èŠ‚ç‚¹é€šä¿¡ã€‚\nç›®å‰ç”¨çš„ä¸€ç›´æ˜¯ attach æ¨¡å¼ï¼Œä¸ä¸­æ–­åŸæœ‰çš„emaneè¿›ç¨‹ã€‚ è€Œä¸”ç”¨attachçš„å¥½å¤„åœ¨äºä¸ç”¨åœ¨å®¹å™¨å†…å¯åŠ¨vscodeå¯åŠ¨è°ƒè¯•ï¼Œå‘½åç©ºé—´å…·æœ‰å±‚çº§å…³ç³»ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹idä¼šæœ‰ä¸€ä¸ªæ˜ å°„åˆ°å®¿ä¸»ä¸»æœºä¸Šã€‚é€šè¿‡å®¹å™¨çš„è¿›ç¨‹ç›´æ¥åœ¨å®¿ä¸»æœºä¸Š attach é‚£ä¸ªemaneè¿›ç¨‹å°±èƒ½è°ƒè¯•äº†ï¼Œå¦‚æœæç¤ºéœ€è¦æƒé™è¾“å…¥yå³å¯ã€‚\næµ‹è¯•å‘ç°æœ‰äº›æ•°æ®åœ¨å®¹å™¨å¤–è°ƒè¯•çœ‹ä¸åˆ°ï¼Œè¿˜æ˜¯è€è€å®å®åœ¨å®¹å™¨å†…è°ƒå§\nå…¶è°ƒè¯•æ–‡ä»¶ /.vscode/launch.json çš„é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š\n{ // æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: https://go.microsoft.com/fwlink/?linkid=830387 \u0026quot;version\u0026quot;: \u0026quot;0.2.0\u0026quot;, \u0026quot;configurations\u0026quot;: [ { \u0026quot;name\u0026quot;: \u0026quot;(gdb) é™„åŠ \u0026quot;, \u0026quot;type\u0026quot;: \u0026quot;cppdbg\u0026quot;, \u0026quot;request\u0026quot;: \u0026quot;attach\u0026quot;, \u0026quot;program\u0026quot;: \u0026quot;/usr/bin/emane\u0026quot;, \u0026quot;processId\u0026quot;: \u0026quot;${command:pickProcess}\u0026quot;, \u0026quot;MIMode\u0026quot;: \u0026quot;gdb\u0026quot;, \u0026quot;setupCommands\u0026quot;: [ { \u0026quot;description\u0026quot;: \u0026quot;ä¸º gdb å¯ç”¨æ•´é½æ‰“å°\u0026quot;, \u0026quot;text\u0026quot;: \u0026quot;-enable-pretty-printing\u0026quot;, \u0026quot;ignoreFailures\u0026quot;: true, \u0026quot;sudo\u0026quot;: true, } ] } ] } çœ‹ä»£ç å¦‚æœé«˜äº®æœ‰é—®é¢˜ï¼Œå¯èƒ½æ˜¯Vscodeè¯­æ³•æŒ‡å‘å®‰è£…åœ¨ç³»ç»Ÿusrçš„å¤´æ–‡ä»¶å»äº†ï¼ŒVscode Ctrl Shift p å¿«æ·é”®åå¡«å…¥ C/C++:ç¼–è¾‘é…ç½®(UI) é‡Œçš„åŒ…å«è·¯å¾„æ”¹ä¸º ${workspaceFolder}/include å³å¯ã€‚\nè°ƒè¯•æ—¶å˜é‡æ˜¾ç¤º optimized out çŠ¶æ€ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦å…³é—­ç¼–è¯‘C++é¡¹ç›®æ—¶çš„ä¼˜åŒ–é€‰é¡¹ï¼Œæ‰§è¡Œconfigureå‘½ä»¤æ—¶è¿›è¡Œä¸‹è¿°è®¾ç½® ./configure CFLAGS='-g -O0' CXXFLAGS='-g -O0 -Wall -Wextra' ä¹‹åé‡æ–°ç¼–è¯‘ã€‚ï¼ˆemaneçš„configure æœ‰debugå‚æ•° ç­‰ä»·æ‰§è¡Œ ./configure --with-debug ï¼‰å¦‚æœåªæ˜¯ä¸´æ—¶æ”¹ä¸€å°éƒ¨åˆ†ï¼Œç›´æ¥ä¿®æ”¹makefileé‡Œçš„å¯¹åº”å‚æ•°æ”¹ä¼˜åŒ–ç­‰çº§ã€‚\nEmane æ‰§è¡Œæµç¨‹ æ¯ä¸€ä¸ªå®¹å™¨èŠ‚ç‚¹éƒ½å¯ä»¥éƒ¨ç½²ä¸€ä¸ªEmaneè¿›ç¨‹ï¼Œå¹¶åœ¨å®¹å™¨èŠ‚ç‚¹å†…é…ç½®å…¶Emaneæ•°æ®ä¼ è¾“ç½‘å¡ï¼ˆæ¯å®¹å™¨å”¯ä¸€ï¼‰ï¼Œ ç›‘å¬æ•°æ®ç½‘å¡ï¼ˆä¸€ä¸ªç½‘å¡å¯¹åº”ä¸€ä¸ªè‡ªç»„ç½‘æ¨¡å‹ï¼‰æ¥å°†ä»¿çœŸå†…æ‹“æ‰‘èŠ‚ç‚¹å­ªç”Ÿæ˜ å°„ä¸ºè‡ªç»„ç½‘å†…èŠ‚ç‚¹ã€‚\nä»¥ç½‘ç»œæ¨¡å‹ä¸ºä¾‹ï¼Œåº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚çš„æ¨¡å‹éƒ½æ˜¯linuxå†…æ ¸æ ˆåŸç”Ÿçš„æ•°æ®ç»“æ„ï¼Œæ‰€æœ‰æŒ‡å‘ç›‘å¬æ•°æ®ç½‘å¡ çš„æ•°æ®éƒ½ä¼šè¢«Emaneç›‘å¬å¹¶è½¬ä¸ºEmaneå†…è¿›ç¨‹æ— çº¿æ•°æ®å¹¶åœ¨Emaneä¸“ç”¨æ•°æ®ä¼ è¾“ç½‘å¡ä¸Šä¸å…¶ä»–èŠ‚ç‚¹çš„Emane è¿›ç¨‹é€šä¿¡ã€‚Emaneå°±æ˜¯å®ç°è¯¥ç›‘å¬æ•°æ®æ— çº¿ç½‘å¡çš„é“¾è·¯å±‚ã€ç‰©ç†å±‚çš„æ¨¡æ‹Ÿä»¿çœŸã€‚å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œè¿™ä¸ªç›‘å¬æ•°æ® ç½‘å¡å°±æ˜¯æ— çº¿æ¨¡å‹ç½‘å¡ï¼Œæ‰€æœ‰åº”ç”¨å¼€å‘å¯ä»¥ä¸ç”¨è€ƒè™‘æ— çº¿çš„ç»†èŠ‚ã€‚\nå½“ç„¶Emaneä¹Ÿæœ‰å…¶äº‹ä»¶è°ƒåº¦æœºåˆ¶ï¼Œå¯ä»¥åŸºäºEmaneæä¾›çš„äº‹ä»¶apiæ¥å£ï¼Œ åœ¨å®¹å™¨èŠ‚ç‚¹æˆ–Emaneå¤šæ’­é€šé“å†…ä»¥gRPCçš„æ–¹å¼å‘Emaneå‘é€æ§åˆ¶äº‹ä»¶æ¶ˆæ¯ç»„æ’­åŒ…ã€‚ åŸç†æ˜¯Emaneè¿›ç¨‹ä¼šå¼€å¯ç›‘å¬æœåŠ¡å™¨ï¼Œæ”¶é›†ç½‘å†…Emaneäº‹ä»¶å¹¶æ›´æ–°å½“å‰æ¨¡å‹ã€‚ å¸¸è§çš„äº‹ä»¶æœ‰ä½ç½®ã€è·¯å¾„æŸè€—ã€å‘å°„åŠŸç‡ç­‰ã€‚ æ— è®ºæ˜¯ç‰©ç†å±‚ã€è¿˜æ˜¯é“¾è·¯å±‚éƒ½æœ‰ç›¸åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚\nemaneçš„å¯æ‰§è¡Œæ–‡ä»¶éƒ½åœ¨ emane/src/applications ç”Ÿæˆï¼Œå…¶ä¸­emaneæ–‡ä»¶å¤¹è‡ªç„¶æ˜¯ æœ€åä½¿ç”¨çš„emaneäºŒè¿›åˆ¶æ–‡ä»¶ã€‚\nå¤§éƒ¨åˆ†éƒ½æŠ½è±¡çš„å‡½æ•° å¯¹è±¡ éƒ½å­˜åœ¨ EMANE çš„ Application å‘½åç©ºé—´ä¸‹ã€‚\nä½¿ç”¨ DECLARE_APPLICATION å®å°†å…¶mainå‡½æ•°éšè— å³ä¸ºè°ƒç”¨appçš„mainå‡½æ•°å¹¶ä¼ å‚è°ƒç”¨ (å…¶ä»–ä¾‹å¦‚ emaneeventd ç­‰appä¹Ÿæ˜¯å¦‚æ­¤å®ç°)\næŠ½è±¡è¿›ç¨‹ ä»¥ emane ä¸ºä¾‹ï¼Œsrc/libemane/main.cc Mainç±»ä¸­æœ‰æˆå‘˜å‡½æ•°mainå‡½æ•°ï¼Œåœ¨å®å®šä¹‰é¢„ç¼–è¯‘åå…¶å³ä¸ºæ•´ä¸ªè¿›ç¨‹çš„ä¸»å‡½æ•°ï¼Œå…¶æŠ½è±¡çš„æµç¨‹å°±åœ¨è¿™é‡Œå®ç°ï¼Œå¤§è‡´ä¸º\nåˆ›å»ºå’ŒEMANE loggerå¹¶è®¾ç½®æ—¥å¿—çº§åˆ« EMANE::Application::Logger logger; æ‰§è¡Œ tye catch æ•è·å¼‚å¸¸ã€‚ è¯»å–cmdé…ç½®å‚æ•° å¹¶ è§£æ doConfigure(sConfigurationXML); æ‰§è¡Œç”±æ´¾ç”Ÿç±»å®ç°å…·ä½“ç»†èŠ‚çš„çº¯è™šå‡½æ•° doStart å µå¡äº’æ–¥é”ç­‰å¾…ä¿¡å·æ•è·æµç¨‹ç»ˆæ­¢ mutex.lock(); ä¸€åˆ‡å®Œæˆå æ‰§è¡Œ ç»“æŸã€é”€æ¯å·¥ä½œ doStop(); doDestroy(); æ¨¡å—åˆ†å±‚ä»‹ç» emane è°ƒç”¨çš„æ˜¯ Emulator å¯¹è±¡ã€‚Emulator ç”± Main å…¬æœ‰ ç»§æ‰¿ã€‚\nå…¶ Emulator æ¨¡æ¿ç±»çš„ Builder Director Manager åˆ†åˆ«ä¼ å…¥ NEMBuilder NEMDirector NEMManager æ¥å¯¹ emane æ— çº¿ä»¿çœŸå™¨ä¸­çš„æœ€å°å•ä½ NEM å®šä¹‰å…¶å®ç°ã€‚\nBuilder å®šä¹‰å…¶é—´æ‰€æœ‰ layer çš„æ„å»ºåˆå§‹åŒ–è¿‡ç¨‹ï¼ŒDirector å®ç°äº†XMLçš„è§£æï¼Œç”± Builder å’Œ è¯»å–åˆ°çš„é…ç½®xmlè¿›è¡Œå®ä¾‹åŒ–åˆ›å»ºDirector å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªä»¿çœŸå™¨éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ID(uuid)ï¼Œæ ¹æ®è¯¥ Director çš„id åˆ›å»ºä¸€ä¸ªManagerå¯¹è±¡ è¿›è¡Œæ•´ä¸ªä»¿çœŸæµç¨‹çš„å¯åŠ¨ åœæ­¢ç­‰æµç¨‹çš„ç®¡ç†ã€‚\nçœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè¿™é‡Œå›é¡¾ä¸‹macå±‚çš„åŸºç¡€apiæ¸…å•ï¼š\ninitialize æ³¨å†Œæ’ä»¶é…ç½®é¡¹å’Œä¸€ä¸ªå¯é€‰çš„é…ç½®éªŒè¯å™¨ æ³¨å†Œæ— çº¿æ¨¡å‹çš„ç»Ÿè®¡ä¿¡æ¯å’Œç»Ÿè®¡è¡¨ æ³¨å†Œæ— çº¿æ¨¡å‹éœ€è¦çš„emaneäº‹ä»¶ configure å¤„ç†æ‰€æœ‰å·²åŠ è½½çš„é…ç½® start ä»¿çœŸä»è¯¥æ–¹æ³•å¼€å§‹ï¼Œå¯åŠ¨æ— çº¿æ¨¡å‹ä»¿çœŸå†…å®šæ—¶å™¨ç­‰ã€‚ postStart NEMå±‚å †æ ˆä¸­çš„æ‰€æœ‰ç»„ä»¶ç°åœ¨éƒ½å¤„äºâ€œå¯åŠ¨â€çŠ¶æ€ã€‚è·Ÿè¸ªæˆ–é…ç½®ç›¸é‚»å±‚çš„ç»„ä»¶ã€‚ stop ä¸ start ç›¸åï¼Œæ‰§è¡Œåœæ­¢è¡Œä¸º destroy ä¸ initialize ç›¸åï¼Œæ‰§è¡Œæ¸…ç†é”€æ¯æ“ä½œã€‚ æ‰§è¡Œè¿‡ç¨‹ä¸­å°±æ˜¯è¿è¡Œè¿™äº›æµç¨‹ï¼š\nå¤„ç†æ•°æ®åŒ…å’Œæ§åˆ¶æ¶ˆæ¯çš„æ–¹æ³•:\nprocessDownstreamPacket processDownstreamControl processUpstreamPacket processUpstreamControl Emaneäº‹ä»¶å¤„ç†å‡½æ•°\nprocessEvent è°ƒåº¦Emaneå®šæ—¶å™¨äº‹ä»¶å‡½æ•°\nprocessTimedEvent è¿è¡ŒçŠ¶æ€ä¸‹çš„è¿›è¡Œé…ç½®ä¿®æ”¹çš„å‡½æ•°\nprocessConfiguration ç»è¿‡ä¹‹å‰çš„åˆ†æï¼Œå¯ä»¥çŸ¥é“ emane åœ¨ç‰©ç†å±‚ä¹‹ä¸‹ å°è£…ä¸ºå¤šæ’­çš„OTA æµé‡ï¼Œå…¶ä¸Šæ˜¯ ç½‘å¡Adapter çš„ç½‘ç»œå±‚æ•°æ®åŒ…ã€‚OTAæµé‡åˆ†ä¸ºemaneäº‹ä»¶çš„æµé‡å’Œæ™®é€šæ— çº¿æ•°æ®çš„æµé‡ï¼Œä»¿çœŸå°±æ˜¯ å¯¹ phy mac å¯¹å…¶å®ç°ç‰¹å®šçš„ç®—æ³• å…¥å‡ºé˜Ÿç­‰å®ç°æ— çº¿ä¼ è¾“çš„ç‰¹æ€§ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘åªå¯¹ æ— çº¿ç½‘ç»œç›¸å…³çš„æ¨¡å—è¿›è¡Œåˆ†æï¼Œè‡³äºå…¶ä»– ç»Ÿè®¡æ•°æ® ç‰¹å®šæ¨¡å‹çš„ä¼˜å…ˆçº§ emaneäº‹ä»¶ç­‰ å°±æš‚ä¸è®¨è®ºã€‚\næ•°æ®å¤„ç†æµç¨‹ ä¸€ä¸ªè¿è¡Œäº†emaneçš„å®¹å™¨èŠ‚ç‚¹å°±æ˜¯platformï¼Œå…¶ä¸­æœ‰å¯èƒ½æ­è½½å¤šä¸ªNEMã€‚NEMä»£è¡¨å…·ä½“çš„ç½‘ç»œæ¨¡å‹ï¼Œä¼šæ˜ å°„åˆ°å®¹å™¨å†…çš„Adapterç½‘å¡ã€‚\nåœ¨ start è¿‡ç¨‹ä¸­ src/libemane/nemqueuedlayer.cc ä¼šå¼€å¯processWorkQueueçº¿ç¨‹ ä½¿ç”¨IOå¤ç”¨epoll_waitç›‘å¬ æ¥å¤„ç†platformä¸­æ‰€æœ‰nemçš„æ•°æ® äº‹ä»¶çš„è§¦å‘å¹¶è¿›è¡Œå¤„ç†ã€‚\nNEMçš„æŠ½è±¡ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š\n* NEMNetworkAdapter (connectLayers UpstreamTransport * param) * ... -- * MAC | * ... | - stack addLayer, bottom of stack pushed first. * ... | where, ... can be 0 or more shims * PHY | * ... -- * NEMOTAAdapter (connectLayers DownstreamTransport * param) nem æ ¹æ® è¯»å–çš„é…ç½®æ–‡ä»¶ ä¸€å±‚ä¸€å±‚æ„å»º layer stack æ¥ å¯¹ä»¿çœŸçš„æ•°æ®è¿›è¡Œæµç¨‹çš„å®šä¹‰ã€‚\nåœ¨ emane ä¸­ æ— è®ºæ˜¯ NEMNetworkAdapter çš„é“¾è·¯æ•°æ® è¿˜æ˜¯ NEMOTAAdapterçš„OTAæ•°æ®éƒ½æ˜¯é€šè¿‡ UpstreamTransport DownstreamTransport æ¥ä¼ è¾“çš„ï¼Œè¿™äº›æ•°æ®é˜Ÿåˆ— ä¼šæŒ‰ç…§ ç°å®ä¸–ç•Œçš„æ•°æ®ä¸€èˆ¬ ä¸€å±‚ä¸€å±‚ å°è£…ã€è§£æã€‚\nä» NEMNetworkAdapter æ¥æ”¶çš„æ•°æ® å°±æ˜¯ UpstreamTransportï¼Œ éœ€è¦ sendDownstreamPacketï¼Œåœ¨processDownä¸­å¤„ç†ã€‚ ä»£è¡¨ä¸»æœºå‘é€æ•°æ®é€šè¿‡emaneæ¥å°è£…ä¸ºOTAæ•°æ®ï¼Œç„¶åå®ƒçš„ä¸‹ä¸€å±‚å°±ä¼šæ‰§è¡ŒprocessDownã€‚ä» NEMOTAAdapter æ¥æ”¶çš„æ•°æ® å°±æ˜¯ DownstreamTransportï¼Œ éœ€è¦ sendUpstreamPacketï¼Œåœ¨processUpä¸­å¤„ç†ã€‚ ä»£è¡¨ä¸»æœºæ¥æ”¶åˆ° OTA æµé‡ éœ€è¦è§£å°è£…åˆ° Adapter ä¸­æ„å»ºä¸º ç½‘ç»œå±‚æ•°æ®åŒ…ï¼Œç„¶åå®ƒçš„ä¸Šä¸€å±‚å°±ä¼šæ‰§è¡ŒprocessUpã€‚\nåº•å±‚åºåˆ—åŒ–çš„äºŒè¿›åˆ¶æµåœ¨å¹³å°çš„ç½‘ç»œæ¥å£ é€šè¿‡å¤šæ’­é€šé“ï¼ˆover the air multicast channelï¼‰ä¼ è¾“ã€‚ç»è¿‡emaneçš„å°è£…è§£å°æ¥å®ç°ç°å®æ— çº¿æ•°æ®çš„å¤„ç†æµç¨‹ï¼Œä¹Ÿå°†æ— çº¿ä»¿çœŸæ¨¡å—åŒ–é™ä½ä¸å®¹å™¨å¹³å°çš„è€¦åˆã€‚è¿™å°±æ˜¯ä»¿çœŸå™¨ç‰©ç†å±‚åœ¨å¼‚æ„æ— çº¿ç”µæ¨¡å‹ä¸­è€ƒè™‘ä¿¡å·ä¼ æ’­ã€å¤©çº¿æ•ˆåº”å’Œå¹²æ‰°æºçš„æ–¹å¼ï¼Œéƒ½åœ¨emaneè¿›ç¨‹ä¸­å¤„ç†ã€‚\nNEMNetworkAdapter\nè¯¥ Adapter åœ¨é…ç½®xmlæ–‡ä»¶ä¸­å¯è®¾å®šä¸º raw vitualã€‚å³è™šæ‹Ÿä¸€ä¸ªä¸‰å±‚TUNè®¾å¤‡ç”¨äºä¼ è¾“æ•°æ®å¦åˆ™ä½¿ç”¨åŸç”Ÿç½‘å¡è®¾å¤‡ï¼Œé»˜è®¤ç”¨vitual å³å¯ã€‚tunçš„arpäºŒå±‚æ“ä½œç”±emaneæ¥å®ç°ï¼Œmacåœ°å€æ˜ å°„åˆ°nem idæ¥ç»´æŠ¤ä¸€ä¸ªarpè¡¨ã€‚è¿™å°±æ˜¯ä»–ä¸ä½¿ç”¨Tapè®¾å¤‡çš„åŸå› ï¼Œmacå±‚çš„æ“ä½œç”±emaneè¿›ç¨‹å¤„ç†è€Œéå†…æ ¸åè®®æ ˆã€‚ï¼ˆarpéƒ¨åˆ†src/transports/common/ethernettransport.cc 167è¡Œï¼‰\nå…¶ç›‘å¬è¯»å†™çš„å…·ä½“å·¥ä½œå†…å®¹ä¸º src/transports/virtual/virtualtransport.cc å¼€å¯ä¸€ä¸ªçº¿ç¨‹ä¸æ–­è¯»å–è¯¥è®¾å¤‡å†…æ•°æ®ã€‚\nthread_ = std::thread{\u0026amp;VirtualTransport::readDevice,this};\nMac layer\nå¤§éƒ¨åˆ†æ¨¡å‹éƒ½æ˜¯é‡‡ç”¨ ç‰©ç†å±‚è®¡ç®—å¥½çš„ä¿¡å™ªæ¯” é…åˆå®éªŒéªŒè¯çš„ä¾‹å¦‚å¸¦å®½1Mçš„åŠ æ€§é«˜æ–¯ç™½å™ªå£°ä¸‹çš„è¯¯ç ç‡ç­‰å‚æ•°è®¡ç®—å¾—åˆ°çš„åŒ…å®Œæˆåº¦æ›²çº¿ï¼ˆPacket Completion Rateï¼‰æ¥è¿›ç¨‹ä¸¢åŒ…æ“ä½œã€‚\nMacå±‚åè®®è¾ƒçµæ´»ï¼Œæ ¹æ®å®é™…éœ€æ±‚å¼€å‘ã€‚ç®€è¨€ä¹‹éœ€è¦åœ¨ä»¿çœŸå™¨å®ç°ä¸€å¥—å¯¹ä¸‹æ¸¸çš„æ•°æ®åŒ…è§£æmacå¤´ å¯¹ä¸Šæ¸¸æ•°æ®å°è£…macå¤´ ç­‰ä¸€ç³»åˆ—æ“ä½œã€‚è¯¦æƒ…ï¼šEmaneæ¨¡å‹è°ƒç ”\nPHY layer\nemane é»˜è®¤ä½¿ç”¨ src/libemane/frameworkphy.cc å®ç°çš„é€šç”¨phyå¤´ã€‚å…³äºç‰©ç†å±‚æ•°æ®ï¼Œç®€åŒ–äº†è®¸å¤šç»†èŠ‚ï¼Œå¯ä»¥è‡ªå®šä¹‰çš„æ·»åŠ ç‰©ç†å±‚çš„å¸§å¤´æ•°æ®ï¼Œå‘é€ç«¯å¸§å¤´åŒ…å« txpower æ—¶å»¶ å¸¦å®½ç­‰å‚æ•°ã€‚\né™¤æ­¤ä¹‹å¤–é€šç”¨çš„ç‰©ç†å±‚æ¨¡å‹è¿˜åŒ…å«è§’åº¦ã€ä½ç½®ã€å¤©çº¿ç­‰å‚æ•°å¢åŠ ä»¿çœŸé¢—ç²’åº¦ï¼Œä¾‹å¦‚ï¼šç›¸ä½è§’ä¿¯ä»°è§’ç­‰å‚æ•°ä»¥åŠå¤©çº¿å¢ç›Šè®¾å®šxmlæ¥æ¨¡æ‹Ÿå¤©çº¿ï¼Œä¹Ÿæ”¯æŒMIMOæ¥è¿›è¡Œå¤©çº¿çš„å¢ç›Šã€‚ä½ç½®äº‹ä»¶åŒ…å«äº†å½“å‰ç»çº¬é«˜ ä¿¯ä»°è§’ æ–¹ä½è§’å‚æ•°ï¼Œç±»ä¼¼çš„è¿™äº›äº‹ä»¶å¯ä»¥è§„å®šä¸€ä¸ªä»£ç†è¿›è¡Œåœºæ™¯çš„åŠ¨æ€æ¨¡æ‹Ÿã€‚\nå…³äºä¼ æ’­çš„è¡°è½æ¨¡å‹ è‡ªå¸¦ 2-ray nakagami freespace æ¨¡å‹ï¼Œä¹Ÿå¯åŸºäºäº‹ä»¶æ¥è§¦å‘æ›´æ–°ä¸åŒèŠ‚ç‚¹é—´å¯¹ç«‹çš„pathlossï¼Œæ¥æ”¶åŠŸç‡ã€æ¥æ”¶çµæ•åº¦å…¬å¼å¦‚ä¸‹æ‰€ç¤ºï¼Œå½“æ¥æ”¶åŠŸç‡å°äºçµæ•åº¦æ—¶å°†ä¼šä¸¢å¼ƒè¯¥otaæŠ¥æ–‡ã€‚è®¡ç®—å…¬å¼å¦‚ä¸‹æ‰€ç¤ºï¼š\nrxPower = txPower + txAntennaGain + rxAntennaGain â€“ pathloss\nrxSensitivity = âˆ’174 + noiseFigure + 10log(bandWidth)\nNEMOTAAdapter\né€šè¿‡ä¸»/è¾… æ§åˆ¶ç½‘ åœ¨ç½‘æ¡¥å†…å‘é€å¤šæ’­ç»„æ ¹æ®ç«¯å£ä¸åŒå‘é€ äº‹ä»¶ å’Œ æ™®é€šæ•°æ®ï¼Œä»¥æ¨¡æ‹Ÿè‡ªç»„ç½‘æ•°æ®ã€‚ç¡®å®šæ˜¯åŒç»„æ•°æ®åæ¥æ”¶ä¼ è¾“ç»™phyå±‚ã€‚å…·ä½“ä¹Ÿæ˜¯ä¸æ–­è¯»å–æ§åˆ¶ç½‘æ•°æ® src/libemane/otamanager.cc\nthread_ = std::thread{\u0026amp;EMANE::OTAManager::processOTAMessage,this};\nOther layer\nsrc/libemane/nembuilder.cc ä¸­ä¼šè¯»å–é…ç½®æ–‡ä»¶ ç¡®å®šå½“å‰Nemä¸­åˆå§‹åŒ–æœ‰å“ªäº› layer å¹¶æ‰§è¡Œ /src/libemane/nemlayerstack.cc çš„addLayerã€‚æ›´æ·±å±‚çš„æ•°æ®ä¼ è¾“çš„ç»†èŠ‚å°±è¦åœ¨ PHY MAC ç­‰ layer çš„ processUpstreamPacket ç­‰å‡½æ•°ä¸­æŸ¥çœ‹ã€‚\nä¹‹å åŒæ ·æ˜¯è°ƒç”¨ nemlayerstack çš„ connectLayers å°†ä¸åŒå±‚é—´çš„ä¸Šä¸‹æ¸¸å…³ç³»é€šè¿‡ setUpstreamTransport setDownstreamTransport ç¡®å®šï¼Œé€šè¿‡ sendDownstreamPacket sendUpstreamPacket å°†è¿™å±‚å¤„ç†åçš„æ•°æ® å‘é€åˆ°ä¸Šå±‚ çš„processå‡½æ•° æ„å»ºæ— çº¿æ•°æ®çš„æµé€šã€‚\nå…·ä½“å®ç°å¯ä»¥çœ‹çœ‹ NEMQueuedLayer è”åˆç»§æ‰¿ FileDescriptorServiceProvider è‡ª NEMLayerã€‚NEMLayer è”åˆç»§æ‰¿ç±» Component, UpstreamTransport, DownstreamTransport, PlatformServiceUser, Buildable, RunningStateMutableã€‚æ‰€ä»¥ä½¿ç”¨sendå‡½æ•°ä¼šæ‰¾åˆ° NEMQueuedLayer çš„ transport æ‰€å¯¹åº” ä¸Šä¸‹æ¸¸çš„ processå‡½æ•°å»åšå¤„ç†ã€‚\nåœ¨ç»†çœ‹ phy å±‚ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¥ä¸º emaneä¼šå°† location ä¿¯ä»°è§’ä¹‹ç±»çš„å‚æ•°æ”¾åˆ° phyçš„ headä¸­ï¼Œåé¢æ‰å‘ç°æ¯ä¸ªemaneç»´æŠ¤äº†æ‰€æœ‰çš„èŠ‚ç‚¹çš„è¿™äº›å‚æ•°ï¼ˆå…·ä½“çœ‹ frameworkphy.cc 1429è¡Œï¼‰ï¼Œåœ¨å‘å°„è¿™ä¸ªæ•°æ®çš„æ—¶å€™å°±å·²ç»å®Œæˆè¡°è½çš„è®¡ç®—äº†ã€‚\nå…¶ä»–ç»†èŠ‚ å¾…è¡¥å……\n","id":5,"section":"posts","summary":"èƒŒæ™¯ ç°åœ¨è¦ç»§ç»­åšemaneç›¸å…³çš„å¼€å‘ï¼Œä¹‹å‰åštdmaç›¸å…³å†…å®¹å†™äº†ç¯‡ Emaneæ¨¡å‹è°ƒç ” ï¼Œç°åœ¨æƒ³æ¢³ç†ä¸‹æ•´ä¸ªä»¿çœŸå™¨çš„ä»¿çœŸæµç¨‹ï¼Œè®°å½•ä¸‹ã€‚ debug Emane ä¸ºäº†æ›´å¥½","tags":["ä»¿çœŸ","C/C++","Emane"],"title":"Emaneæµç¨‹æ¦‚è¿°","uri":"https://liangkang233.github.io/2022/06/emane%E6%B5%81%E7%A8%8B%E6%A6%82%E8%BF%B0/","year":"2022"},{"content":"Emaneå¼€å‘æ–‡æ¡£\nEmaneç»´åŸº\nEmaneä»¿çœŸæ¶æ„ï¼š Emaneä»¿çœŸæµç¨‹ â€‹\tå½“ä»¿çœŸå™¨å®ä¾‹åŒ–æ¨¡å‹æ’ä»¶ï¼ˆå³è¯»å–æ¨¡å‹é…ç½®æ–‡ä»¶platform.xmlï¼‰ï¼Œemaneä»¿çœŸå™¨ä¼šå°†æ¯ä¸ªæ— çº¿æ¨¡å‹æ’ä»¶ä¸ä»¿çœŸå™¨ç‰©ç†å±‚çš„ä¸“ç”¨å®ä¾‹ä¸€èµ·å°è£…åœ¨ç½‘ç»œä»¿çœŸæ¨¡å— ç»„æˆç½‘ç»œä»¿çœŸä¸­çš„æœ€å°å•å…ƒNetwork Emulation Moduleï¼ˆNEMï¼‰ã€‚\nâ€‹\tä¸€ä¸ªå®¹å™¨å¯ä»¥æœ‰å¤šä¸ªNEMï¼Œä¸€ä¸ªNEMæ˜ å°„ä¸€ä¸ªæ— çº¿ç½‘å¡ï¼ˆé€šè¿‡å‘ /dev/net/tun å†™æ•°æ®å®ç°ï¼‰ã€‚è€Œç½‘ç»œæ¥å£éƒ¨ç½²åœ¨ platform (å®¹å™¨èŠ‚ç‚¹ æˆ–æ‰§è¡Œä»¿çœŸçš„ä¸»æœº)ä¸Šï¼Œåº•å±‚åŸå§‹æ•°æ®åœ¨å¹³å°çš„ç½‘ç»œæ¥å£ é€šè¿‡ç»„æ’­é€šé“ä¼ è¾“ä»¿çœŸæ•°æ®ã€‚å³æ‰€æœ‰ OTAï¼ˆover the air multicast channelï¼‰ æ¶ˆæ¯å°è£…åçš„å¤šæ’­æ•°æ®åŒ…éƒ½ç”±ä½¿ç”¨åŒä¸€ OTA å¤šæ’­é€šé“çš„æ¯ä¸ªæ¨¡æ‹Ÿå™¨å®ä¾‹platformè¿›è¡Œå¤„ç†ã€‚\nâ€‹\tè¿™äº›æ— çº¿ä»¿çœŸèŠ‚ç‚¹çš„ç‰©ç†å±‚æ•°æ®é€šè¿‡emaneè¿›ç¨‹è½¬å‘åˆ°ä¸»ã€è¾…æ§åˆ¶ç½‘ç»œçš„å¤šæ’­é€šé“äº’è¿ï¼ˆä¸¤ç§ç½‘ç»œéƒ½ä½¿ç”¨å¤šæ’­ä¼ è¾“æ•°æ®åŒ…ï¼‰ã€‚\nâ€‹\tè¿™å°±æ˜¯ä»¿çœŸå™¨ç‰©ç†å±‚åœ¨å¼‚æ„æ— çº¿ç”µæ¨¡å‹ä¸­è€ƒè™‘ä¿¡å·ä¼ æ’­ã€å¤©çº¿æ•ˆåº”å’Œå¹²æ‰°æºçš„æ–¹å¼ï¼Œéƒ½åœ¨emaneè¿›ç¨‹ä¸­å¤„ç†ã€‚\nâ€‹\tEmaneè®¡ç®—ä¿¡å™ªæ¯”åé€šè¿‡è®¾å®šè§„åˆ™çš„pcræ›²çº¿è®¡ç®—ç‰©ç†å±‚æ˜¯å¦å¯æ¥æ”¶æ•°æ®ï¼Œè·¯å¾„æŸè€—ï¼Œgpsä½ç½® å¤©çº¿è§’åº¦ é€šä¿¡æŸè€— ç­‰å¯ä»¥é€šè¿‡ emaneäº‹ä»¶è§¦å‘ã€‚\ntransport layer transport layer æ˜¯åº”ç”¨ç¨‹åº/æ¨¡æ‹Ÿä¼ è¾“è¾¹ç•Œçš„ç¨‹åºï¼Œè´Ÿè´£åœ¨æ¨¡æ‹Ÿå™¨å®ä¾‹å’Œä¸€ä¸ªæˆ–å¤šä¸ªåº”ç”¨ç¨‹åºç©ºé—´è¿›ç¨‹ä¹‹é—´ä¼ é€’æ¶ˆæ¯çš„æ¨¡æ‹Ÿç»„ä»¶ã€‚\nä¼ è¾“ç¨‹åºä¸ºæ¨¡æ‹Ÿå™¨å’Œåº”ç”¨ç¨‹åºç©ºé—´æ¶ˆæ¯æä¾›å…¥å£ç‚¹å’Œå‡ºå£ç‚¹ã€‚\nä¼ è¾“æ’ä»¶æ—¢å¯ä»¥ä½œä¸ºæ¨¡æ‹Ÿå™¨è¿›ç¨‹çš„ä¸€éƒ¨åˆ†åœ¨å†…éƒ¨å®ä¾‹åŒ–ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå…¶ä»–åº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†åœ¨å¤–éƒ¨å®ä¾‹åŒ–ã€‚Transport Daemon EMANEåº”ç”¨ç¨‹åºå¤„ç†é…ç½®XMLï¼Œä»¥ç¡®å®šè¦å®ä¾‹åŒ–çš„å¤–éƒ¨ä¼ è¾“æ’ä»¶çš„ç±»å‹ã€åº”è¯¥å¦‚ä½•é…ç½®æ’ä»¶ä»¥åŠåº”ç”¨ä»€ä¹ˆé€šç”¨çš„åº”ç”¨ç¨‹åºçº§åˆ«è®¾ç½®ã€‚\nEmane åŒ…å«ä¸¤ç§ä¼ è¾“æ¨¡å¼ï¼š\nRaw Transport\nåº”ç”¨ç¨‹åº/æ¨¡æ‹Ÿè¾¹ç•Œä¸é™äºç”±æ¨¡æ‹Ÿå™¨å†…éƒ¨åŠ è½½æˆ–ç”±Transport Daemonå¤–éƒ¨åŠ è½½çš„æ’ä»¶ã€‚åœ¨å°†è½¯ä»¶å®šä¹‰æ— çº¿ç”µ(SDR)æ³¢å½¢è¿æ¥åˆ°EMANEæ—¶ï¼Œåº”å¼€å‘è‡ªå®šä¹‰ä¼ è¾“æ¥å£ï¼Œå¹¶å°†å…¶åµŒå…¥åˆ°Modemç¡¬ä»¶æŠ½è±¡å±‚(MHAL)çš„SDRä¸­ã€‚SRSlte-emaneæ¨¡å‹å°±æ˜¯å¦‚æ­¤ï¼Œå°†sdræ›¿æ¢ä¸ºemaneç‰©ç†å±‚åµŒå…¥srslteä¸­é€šä¿¡ï¼Œä¸Šè¡Œmacå±‚æ¶æ„ä¸å˜ã€‚\nVirtual Transport\nâ€‹\té»˜è®¤ä½¿ç”¨çš„å°±æ˜¯è™šæ‹Ÿä¼ è¾“é€šé“ï¼Œå®¹å™¨èŠ‚ç‚¹ä¸­ï¼Œè™šæ‹Ÿä¼ è¾“ä½¿ç”¨ TUN/TAP æ¥å£ï¼ˆä¸€ä¸€æ˜ å°„åˆ°NEMï¼‰åˆ›å»ºè™šæ‹Ÿæ¥å£ ï¼ˆvifï¼‰ ä½œä¸ºåº”ç”¨ç¨‹åº/ä»¿çœŸè¾¹ç•Œå…¥å£/å‡ºå£ç‚¹ã€‚åœ¨ä¸‹è¡Œæ–¹å‘ï¼ˆå‘é€ç«¯å¤„ç†è¿‡ç¨‹ï¼‰ï¼Œå†…æ ¸å°†è·¯ç”±åˆ° vif çš„ä»¥å¤ªç½‘å¸§è¢«æ‰“åŒ…æˆemaneæ¶ˆæ¯è½¬å‘è‡³æ§åˆ¶ç½‘æ¥å£å³å„ä¸ªNEMå®é™…ç›¸æ¥ç½‘ç»œæ¥å£ä¸­ï¼Œå‘é€åˆ°ç›¸åº”çš„ NEM è¿›è¡Œå¤„ç†ã€‚åœ¨ä¸Šè¡Œæ–¹å‘ï¼ˆæ¥å—ç«¯å¤„ç†è¿‡ç¨‹ï¼‰ï¼Œç›´æ¥æ¥æ”¶åˆ°ä¸éœ€è¦è½¬å‘è‡³è™šæ‹Ÿvif å¤„ç†ï¼ŒNEM æ¶ˆæ¯è¢«è§£åŒ…å¹¶ä½œä¸ºä»¥å¤ªç½‘å¸§å†™å…¥ TUN/TAP æ¥å£ã€‚\nEmane NEM layer å¤„ç†æµç¨‹\nä¸Šå±‚ç»„ä»¶ç»“æ„ï¼š\nç»„ä»¶ å¤§è‡´åŠŸèƒ½ TimerServiceUser emaneå®šæ—¶å™¨åå°æœåŠ¡ EventServiceUser emaneäº‹ä»¶åå°æœåŠ¡ Component ç”¨äºé…ç½®å’Œæ§åˆ¶æ‰€æœ‰ç»„ä»¶çš„é€šç”¨æ¥å£ UpstreamTransport UpstreamTransportå…è®¸å¤„ç†ä¸Šæ¸¸æ•°æ®å’Œæ§åˆ¶æ¶ˆæ¯ã€‚ä¸Šæ¸¸æ•°æ®åŒ…å’Œæ§åˆ¶æ¶ˆæ¯è¢«æ”¾ç½®åœ¨NEMQueuedLayerå‡½æ•°é˜Ÿåˆ—ä¸­è¿›è¡Œå¤„ç†ã€‚ DownstreamTransport DownstreamTransportå…è®¸å¤„ç†ä¸‹æ¸¸æ•°æ®å’Œæ§åˆ¶æ¶ˆæ¯ PlatformServiceUser ä»¿çœŸå¹³å°æœåŠ¡çš„æ¥å£ï¼Œæä¾›å¯¹nem layeræœåŠ¡çš„è®¿é—® Buildable ä½¿ç”¨åº”ç”¨ç¨‹åºèŒƒå›´æ„å»ºå”¯ä¸€çš„Idæ ‡è®°å¯¹è±¡çš„æ¥å£ã€‚æ„å»ºå™¨æ“ä½œå¯æ„å»ºå¯¹è±¡æ¥æ³¨å†Œå®ƒä»¬ä¸å…¶ä»–åº”ç”¨ç¨‹åºå¯¹è±¡çš„å…³è”ï¼Œå¹¶æ‰§è¡Œç»„åˆè§„åˆ™ RunningStateMutable RunningStateMutableæ¥å£ç”¨äºå…è®¸åœ¨è¿è¡ŒçŠ¶æ€ä¸‹å¯¹é…ç½®è¿›è¡Œæ›´æ”¹ã€‚é…ç½®è¢«æ”¾ç½®åœ¨NEMQueuedLayerå‡½æ•°é˜Ÿåˆ—ä¸­è¿›è¡Œå¤„ç†ã€‚ NEMQueuedLayer NEMæ•°æ®å±‚å †æ ˆï¼Œæ¯å±‚ä¹‹é—´æœ‰ä¸€ä¸ªå¤„ç†é˜Ÿåˆ—ï¼Œä»¥è§£è€¦åˆ°èŠ‚ç‚¹å†…éƒ¨å¤„ç† NEMStatefulLayer ç»„ä»¶çŠ¶æ€å¼ºåˆ¶è½¬æ¢è§„åˆ™çš„å±‚å †æ ˆã€‚æœ‰çŠ¶æ€å±‚å¹¶ä¸æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„å±‚ï¼Œå®ƒå°è£…äº†åªå…è®¸æ­£ç¡®çš„è½¬æ¢å’ŒçŠ¶æ€æ“ä½œçš„NEMå±‚ã€‚ PHYLayerImplementor ç”¨äºåˆ›å»ºPHYå±‚æ’ä»¶å®ç°çš„æ¥å£ MACLayerImplementor ç”¨äºåˆ›å»ºMACå±‚æ’ä»¶å®ç°çš„æ¥å£ ShimLayerImplementor ç”¨äºåˆ›å»ºShimå±‚æ’ä»¶å®ç°çš„æ¥å£ Transport ä¼ è¾“è¾¹ç•Œç¨‹åºçš„åŸºç±» ä½¿ç”¨emaneç‰ˆæœ¬ä¸º1.2.5 ç³»ç»ŸUbuntu 18.04\n# emane ç¼–è¯‘ å®‰è£…æ•™ç¨‹ cd emane sudo apt install -y gcc g++ automake libtool libxml2-dev libprotobuf-dev libpcap-dev libpcre3-dev uuid-dev pkg-config protobuf-compiler git python3-protobuf python3-setuptools ./autogen.sh PYTHON=python3 ./configure --prefix=/usr make check # æ£€æµ‹ç¼–è¯‘ make -j$(nproc) sudo make install # å¤åˆ¶åŠ¨æ€åº“ emaneäºŒè¿›åˆ¶ç¨‹åº å¤´æ–‡ä»¶ pcræ¨¡å‹xml è§£æå™¨ åˆ°å¯¹åº”ç³»ç»Ÿç›®å½• # å®‰è£…coreå†…çš„pythonå·¥å…·ç»‘å®š cd ../core/daemon poetry run pip install ~/emane/src/python æ³¨æ„: emaneä½¿ç”¨åŠ¨æ€åº“é“¾æ¥å„æ¨¡å— å†™å¥½äº†å¯¹åº”æ¨¡å—çš„ä»£ç  ä¸å¿…æ¯æ¬¡éƒ½åœ¨æ€»ç›®å½•ä¸‹ç¼–è¯‘ç”Ÿæˆï¼Œåªè¦åœ¨å¯¹åº”ç›®å½• make å¹¶ install å³å¯ã€‚\næ¨¡å‹ä»‹ç»åŠæ¶æ„ï¼š å„æ— çº¿æ¨¡å‹å‡é‡‡ç”¨ é€šç”¨ç‰©ç†å±‚ï¼Œæ— çº¿æ¨¡å‹ä¸»è¦è®¾è®¡å…¶macå±‚ã€‚\nPHY layer ç‰©ç†å±‚å¤§éƒ¨åˆ†ç»†èŠ‚ç”± libemane includeæ–‡ä»¶å¤¹ å†…çš„otamanger commonphyheader downstreampacket ç­‰ç­‰ç»„ä»¶æ„æˆï¼Œå…¶å¤„ç†æµç¨‹ç±»ä¼¼mac layer å¤„ç†ä¸Šä¸‹æ¸¸æ•°æ®ã€‚å¯ä»¥æ„å»ºè‡ªå®šä¹‰çš„ç‰©ç†å±‚ç»„ä»¶ phylayer æˆ–è€…æ”¹é€ æ·»åŠ å…¶ç»†èŠ‚ã€‚å®˜æ–¹çš„å»ºè®®æ˜¯ä¸ºäº†å…¼å®¹æ€§æ˜¯ä¸è¦è‡ªå·±æ„å»ºæ–°çš„phyapi ç›´æ¥ä½¿ç”¨åŸç”Ÿçš„è¿›è¡Œæ”¹é€ æˆ–ä½¿ç”¨ã€‚ å…¶é—´çš„ç‰©ç†å±‚ OTAæµé‡ (åŸå§‹æ•°æ®åŒ…) æ˜¯é‡‡ç”¨ src/libemane/otaheader.proto å®šä¹‰ proto åºåˆ—åŒ–ååºåˆ—åŒ–ä¼ è¾“æ•°æ®ã€‚\nâ€‹\tæ— çº¿ç”µæ¨¡å‹å¯ä»¥ä½¿ç”¨ Spectrum Service é¢‘è°±æœåŠ¡è®¿é—®ä»¿çœŸå™¨ç‰©ç†å±‚è·Ÿè¸ªçš„æ¯ä¸ªé¢‘ç‡çš„å™ªå£°ä¿¡æ¯ã€‚\nä¼ æ’­æ¨¡å‹ï¼š2-Rayã€Freespaceã€äº‹ä»¶è§¦å‘é¢„è®¡ç®—\næ¥æ”¶åŠŸç‡è®¡ç®—\nå¤©çº¿å¢ç›Šçš„æ”¯æŒ\nå™ªå£°å¤„ç†\né¢‘ç‡åˆ†é›†\nåä½œä¼ è¾“\nâ€‹\tç‰©ç†å±‚æ¥å£ä¸»è¦ä½¿ç”¨è¿™äº› æ§åˆ¶æ¶ˆæ¯\nControlMessage åŠŸèƒ½ FrequencyControlMessage åœ¨ transport layer ä¸­ä¸Šä¸‹æ¸¸æ¶ˆæ¯ (UpstreamPacket DownstreamPacket) çš„é¢‘ç‡ TransmitterControlMessage å‘é€ ä¸‹æ¸¸ DownstreamPacket æ§åˆ¶æ¶ˆæ¯ ReceivePropertiesControlMessage æ¥æ”¶ ä¸Šæ¸¸ UpstreamPacket æ§åˆ¶æ¶ˆæ¯ TimeStampControlMessage æŒ‡å®šè¯¥æ— çº¿ä¿¡æ¯å¼€å§‹ä¼ è¾“æ—¶åˆ»çš„ä¼ è¾“æ—¶é—´æˆ³ AntennaProfileControlMessage é…ç½®æ¥æ”¶ä¸‹æ¸¸æ•°æ®æ—¶çš„å¤©çº¿å‚æ•° Radio Models (Mac layer) ç»å¤§å¤šæ¨¡å‹åº“ç”ŸæˆåŠ¨æ€åº“ç”±ä¸»ç¨‹åºåŠ è½½çš„å½¢å¼é“¾æ¥è°ƒç”¨ã€‚\nRF Pipe\nIEEE802.11abg\nTDMA\nLTE/srsRAN-emane ï¼ˆåµŒå…¥å‹ emane ä¸srsRANé…å¥—ä½¿ç”¨ï¼Œä¸æ­¤å¤„ä»‹ç»çš„å…¶ä»–æ¨¡å‹ä¸åŒï¼‰\nUtility Models ä½¿ç”¨shimç±»æ´¾ç”Ÿå®Œæˆä¸‹åˆ—åŠŸèƒ½:\nComm Effect : Comm Effect ä¸æ˜¯æ— çº¿ç”µæ¨¡å‹ã€‚å®ƒä½¿ç”¨æ¨¡æ‹Ÿå™¨æ¥å£å°†ä»¿çœŸæ•ˆæœåº”ç”¨äºæµé‡ï¼Œè€Œæ— éœ€ç›¸å…³æ— çº¿ç½‘ç»œçš„ç‰¹å®šæ¦‚å¿µ (æ„å»ºè™šæ‹Ÿshim layerå®ç°ï¼ŒçŒœæµ‹æ˜¯å¼€å‘äººå‘˜æµ‹è¯•æˆåŠŸåå°†è¿™äº›å…·ä½“å®ç°æ·»åŠ åˆ°æ— çº¿æ¨¡å‹ä¸­)\nâ€‹\tComm Effect æä¾›äº†å®šä¹‰ä»¥ä¸‹æ— çº¿ç½‘ç»œä¼ æ’­çš„æŸå¤±æ•ˆæœæ¨¡æ‹Ÿ:\nLoss: ä½¿ç”¨å‡åŒ€æŸå¤±åˆ†å¸ƒæ¨¡å‹å°†è¢«ä¸¢å¼ƒçš„åŒ…çš„ç™¾åˆ†æ¯”ã€‚ Latency: æ•°æ®åŒ…é€šè¿‡ç½‘ç»œçš„å»¶è¿Ÿç”±ä¸€ä¸ªå›ºå®šçš„å’Œå¯å˜çš„éƒ¨åˆ†ç»„æˆã€‚å›ºå®šçš„å»¶è¿Ÿé‡æ˜¯é€šè¿‡ä¸€ä¸ªå»¶è¿Ÿé…ç½®å‚æ•°å®šä¹‰çš„ï¼Œå¯å˜çš„é‡æ˜¯é€šè¿‡ä¸€ä¸ªæŠ–åŠ¨é…ç½®å‚æ•°å®šä¹‰çš„ã€‚æŠ–åŠ¨æ˜¯ä½¿ç”¨ä¸€ä¸ªå…³äº+/-æŠ–åŠ¨çš„å‡åŒ€éšæœºåˆ†å¸ƒæ¨¡å‹éšæœºç¡®å®šçš„ã€‚ç„¶åå°†éšæœºç”Ÿæˆçš„æŠ–åŠ¨å€¼æ·»åŠ åˆ°å›ºå®šçš„å»¶è¿Ÿä¸­ï¼Œä»¥ç¡®å®šæ€»å»¶è¿Ÿã€‚ Duplicates: åœ¨æ¥æ”¶ç«¯å¤åˆ¶æ¥æ”¶çš„æ•°æ®åŒ…çš„ç™¾åˆ†æ¯”ã€‚ Unicast Bitrate: å‘é€åˆ°NEMæˆ–ä»¥æ··æ‚æ¨¡å¼å¤„ç†çš„æ•°æ®åŒ…çš„æ¯”ç‰¹ç‡ã€‚ Broadcast Bitrate: å‘é€åˆ°NEMå¹¿æ’­åœ°å€çš„æŠ¥æ–‡çš„æ¯”ç‰¹ç‡ã€‚ é™¤æ­¤ä¹‹å¤–è¿˜æœ‰pathloss å¤©çº¿ TDMAç‰¹æœ‰çš„æ—¶éš™ç­‰å½±å“æ— çº¿ä¼ æ’­çš„äº‹ä»¶ã€‚è¿™äº›ç»Ÿç§°ä¸ºemaneäº‹ä»¶ äº¤ç”±å®šæ—¶å™¨ æŸ¥è¯¢æ£€ç´¢ è§¦å‘ã€‚\nPHYAPITest\næ„å»ºè™šæ‹Ÿmac ShimLayer æ¥è¿›è¡Œ phy api çš„æµ‹è¯•\nTimingAnalysis\nâ€‹\tå®šæ—¶å™¨åˆ†ææ¨¡å—ï¼Œè®¡ç®—shimlayeræ¥æ”¶æ•°æ®åˆ°å‘é€ç»™å¦ä¸€ä¸ªshimlayerçš„å»¶è¿Ÿæ—¶é—´å’Œå®šæ—¶é‡‡é›†äº‹ä»¶ä¿¡æ¯ã€‚\nShimHeaderMessage\nåŒ…å«æ¨¡å‹çš„äº‹ä»¶ åŠå®šæ—¶å™¨äº‹ä»¶çš„è§¦å‘æ¶ˆæ¯çš„åºåˆ—åŒ– ååºåˆ—åŒ–\nShimLayer\næ— çº¿æ¨¡å‹MACå¼€å‘æµç¨‹ï¼š åˆ›å»º Radio Model æ’ä»¶æ‰€éœ€çš„å®ç°çš„APIæ¸…å•ã€‚ æ´¾ç”Ÿåˆ›å»ºè‡ªå®šä¹‰çš„ macå®ç° MACLayerImplementor\nMACLayerImplementor çˆ¶ç±»çš„ å…¬å…±æˆå‘˜å‡½æ•°\nvoid setBuildId (BuildId bid) NEMId getNEMId () const BuildId getBuildId () const virtual void setUpstreamTransport (UpstreamTransport *pUpstreamTransport) virtual void setDownstreamTransport (DownstreamTransport *pDownstreamTransport) virtual ~MACLayerImplementor () virtual void initialize (Registrar \u0026amp;registrar)=0 virtual void configure (const ConfigurationUpdate \u0026amp;update)=0 virtual void start ()=0 virtual void postStart () virtual void stop ()=0 virtual void destroy ()=0 throw () void sendDownstreamControl (const ControlMessages \u0026amp;msgs) void sendUpstreamControl (const ControlMessages \u0026amp;msgs) void sendUpstreamPacket (UpstreamPacket \u0026amp;pkt, const ControlMessages \u0026amp;msgs=empty) void sendDownstreamPacket (const CommonMACHeader \u0026amp;hdr, DownstreamPacket \u0026amp;pkt, const ControlMessages \u0026amp;msgs=DownstreamTransport::empty) virtual void processUpstreamPacket (const CommonMACHeader \u0026amp;hdr, UpstreamPacket \u0026amp;pkt, const ControlMessages \u0026amp;msgs=UpstreamTransport::empty)=0 virtual void processUpstreamControl (const ControlMessages \u0026amp;msgs)=0 virtual void processDownstreamPacket (DownstreamPacket \u0026amp;pkt, const ControlMessages \u0026amp;msgs=empty)=0 virtual void processDownstreamControl (const ControlMessages \u0026amp;msgs)=0 virtual void processEvent (const EventId \u0026amp;eventId, const Serialization \u0026amp;serialization) virtual void processTimedEvent (TimerEventId eventId, const TimePoint \u0026amp;expireTime, const TimePoint \u0026amp;scheduleTime, const TimePoint \u0026amp;fireTime, const void *arg) virtual void processConfiguration (const ConfigurationUpdate \u0026amp;update) é‡å†™(è¦†ç›–)æ‰€æœ‰ç»„ä»¶çŠ¶æ€çš„è½¬æ¢æ–¹æ³•:\ninitialize æ³¨å†Œæ’ä»¶é…ç½®é¡¹å’Œä¸€ä¸ªå¯é€‰çš„é…ç½®éªŒè¯å™¨ æ³¨å†Œæ— çº¿æ¨¡å‹çš„ç»Ÿè®¡ä¿¡æ¯å’Œç»Ÿè®¡è¡¨ æ³¨å†Œæ— çº¿æ¨¡å‹éœ€è¦çš„emaneäº‹ä»¶ configure å¤„ç†æ‰€æœ‰å·²åŠ è½½çš„é…ç½® start ä»¿çœŸä»è¯¥æ–¹æ³•å¼€å§‹ï¼Œå¯åŠ¨æ— çº¿æ¨¡å‹ä»¿çœŸå†…å®šæ—¶å™¨ç­‰ã€‚ postStart NEMå±‚å †æ ˆä¸­çš„æ‰€æœ‰ç»„ä»¶ç°åœ¨éƒ½å¤„äºâ€œå¯åŠ¨â€çŠ¶æ€ã€‚è·Ÿè¸ªæˆ–é…ç½®ç›¸é‚»å±‚çš„ç»„ä»¶ã€‚ stop ä¸ start ç›¸åï¼Œæ‰§è¡Œåœæ­¢è¡Œä¸º destroy ä¸ initialize ç›¸åï¼Œæ‰§è¡Œæ¸…ç†é”€æ¯æ“ä½œã€‚ é‡å†™(è¦†ç›–)æ‰€æœ‰å¤„ç†æ•°æ®åŒ…å’Œæ§åˆ¶æ¶ˆæ¯çš„æ–¹æ³•:\nprocessDownstreamPacket processDownstreamControl processUpstreamPacket processUpstreamControl å¦‚æœä½ çš„æ’ä»¶è¦å¤„ç†Emaneäº‹ä»¶ï¼Œä¹Ÿéœ€è¦é‡å†™è¦†ç›–ä¸‹é¢å‡½æ•°:\nprocessEvent å¦‚æœä½ çš„æ’ä»¶è¦è°ƒåº¦Emaneå®šæ—¶å™¨äº‹ä»¶ï¼Œä¹Ÿéœ€è¦é‡å†™è¦†ç›–ä¸‹é¢å‡½æ•°:\nprocessTimedEvent å¦‚æœä½ çš„æ’ä»¶å…è®¸è¿è¡ŒçŠ¶æ€ä¸‹çš„è¿›è¡Œé…ç½®ä¿®æ”¹ï¼Œéœ€è¦é‡å†™è¯¥api:\nprocessConfiguration ä½¿ç”¨ DECLARE_MAC_LAYER å®å‡½æ•° æ¥å®Œæˆmacæ¨¡å‹ Implementor çš„å£°æ˜ä¸å®ä¾‹åŒ–\nå¯ä»¥çœ‹çœ‹ åŸºç¡€æ¨¡å‹ bypass çš„æ­å»ºæµç¨‹\nphylayer\nbypass æ˜¯ ç±»ä¼¼ hello world çš„æ— çº¿æ¨¡å‹æ¥ä»‹ç» emaneæ— çº¿æ¨¡å‹ çš„å¼€å‘æµç¨‹ å…¶å…·æœ‰å¤„ç†æ­¥éª¤ä¸ºç©ºçš„ æœªå¯¹æ— çº¿æ•°æ®åŒ…åšå¤„ç†çš„ phy mac åº“\nEmane æ–°æ¨¡å‹å¼€å‘ç¤ºä¾‹ï¼š Emaneæºç ä¿®æ”¹: ä»¿ç…§ rfpipe åˆ›å»ºä¸€ä¸ª æ–°çš„è‡ªå®šä¹‰æ¨¡å‹:\nå°†è¦å‘é€çš„ downstream å°è£…è‡³ä½¿ç”¨é€šç”¨ç‰©ç†å±‚çš„åŸå§‹æ•°æ®åŒ… downstreamqueue éœ€è¦è‡ªå·±è®¾è®¡å‘é€å½¢å¼æ¥è§¦å‘ sendDownstreamPacketï¼Œè€Œupstreamçš„æ•°æ® ç›´æ¥ sendUpstreamPacket ä¸éœ€è¦è®¾è®¡æ•°æ®é˜Ÿåˆ—ã€‚\néœ€è¦å®Œæˆå¦‚ä¸‹5ä¸ªç±»ï¼š\nDownstreamqueue ä¸‹æ¸¸æ•°æ®çš„å®šä¹‰\nDownstreamQueueEntry é˜Ÿåˆ—æ•°æ®å…¥é˜Ÿå®šä¹‰\nMACHeaderMessage Mac headæ•°æ®ç»“æ„åŠæˆå‘˜å®šä¹‰ï¼Œmacæ•°æ®å¯¹è±¡å¤§éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨ Google Protocol Buffers æ¥è¿›è¡Œåºåˆ—åŒ– å¦‚ä¸‹æ˜¯ rfpipemacheader.protoï¼Œå¯¹åº”ä¸Šä¸‹æ¸¸æ•°æ®æœ‰ä¸¤ç±»æ„é€ å‡½æ•°ã€‚\næ•°æ®ç±»å‹è™½ç„¶ä¸ºstring ä½†æ˜¯å†…éƒ¨æ˜¯äºŒè¿›åˆ¶çš„ éæ‰“å°æ•°æ®æµ Protobufç®€æ˜“æ•™ç¨‹\nsyntax = \u0026quot;proto2\u0026quot;; package EMANEMessage; option optimize_for = SPEED; message RFPipeMACHeader { required uint64 dataRate = 1; } Maclayer è¿›è¡Œå®ä¾‹åŒ–çš„å¯¹è±¡\npcrmanager: åŸºç¡€å°„é¢‘æ¨¡å‹ å¯¹ç‰©ç†å±‚ PCR çš„ç®¡ç†, å…¶ä¸­xmlæ•°æ®ç”±DTD (document type definition) å®šä¹‰ç»“æ„ã€‚ç®€æ˜“æ•™ç¨‹ï¼š DTDçš„ç¼–å†™ platform.xml å®šä¹‰äº†å…¨å±€çš„emane ç»„æ’­åœ°å€ äº‹ä»¶ åŠnemæ˜ å°„è®¾å¤‡ç­‰ï¼Œå…·ä½“é…ç½®ä¾èµ–nem.xmlã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œnem.xmlå®šä¹‰äº† transport phy mac å±‚çš„é…ç½®ã€‚platform çš„ dtd å¦‚ä¸‹æ‰€ç¤º\n\u0026lt;?xml encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;!ELEMENT platform ((param|paramlist)*, nem+)\u0026gt; \u0026lt;!ATTLIST platform name CDATA #IMPLIED\u0026gt; \u0026lt;!ENTITY % nemcontents SYSTEM \u0026quot;nemcontents.dtd\u0026quot;\u0026gt; %nemcontents; \u0026lt;!ELEMENT nem (%alllayers;)\u0026gt; \u0026lt;!ATTLIST nem name CDATA #IMPLIED id CDATA #REQUIRED definition NMTOKEN #REQUIRED transport (external | internal) \u0026quot;internal\u0026quot;\u0026gt; \u0026lt;!ENTITY % param SYSTEM \u0026quot;param.dtd\u0026quot;\u0026gt; %param; \u0026lt;!ELEMENT shim (param|paramlist)*\u0026gt; \u0026lt;!ATTLIST shim definition NMTOKEN #REQUIRED\u0026gt; \u0026lt;!ELEMENT mac (param|paramlist)*\u0026gt; \u0026lt;!ATTLIST mac definition NMTOKEN #REQUIRED\u0026gt; \u0026lt;!ELEMENT phy (param|paramlist)*\u0026gt; \u0026lt;!ATTLIST phy definition NMTOKEN #IMPLIED\u0026gt; \u0026lt;!ELEMENT transport (param|paramlist)*\u0026gt; \u0026lt;!ATTLIST transport definition NMTOKEN #REQUIRED group CDATA #IMPLIED æ•´ä¸ª åŸºç¡€çš„rfpipeæ¨¡å‹æ„å»ºçš„å¿…è¦æ–‡ä»¶å¤§è‡´å¦‚ä¸‹æ‰€ç¤ºï¼š\nlk233@vm-5gc:~/emane/src/models/mac/myrfpipe$ tree . â”œâ”€â”€ downstreamqueue.cc\t# å®šä¹‰äº† downstream queue çš„æ•°æ®æ ¼å¼ åŠ æ’å…¥å¼¹å‡ºæ•°æ®é˜Ÿåˆ—ç±» â”œâ”€â”€ downstreamqueue.h\t# â”œâ”€â”€ maclayer.cc\t# æ•´ä¸ªæ— çº¿æ¨¡å‹çš„å®ä¾‹åŒ– å¯åŠ¨ é”€æ¯çš„æµç¨‹å®šä¹‰ â”œâ”€â”€ maclayer.h\t# mac layer ç±»çš„ api å¿…é¡» é‡å†™ â”œâ”€â”€ Makefile.am\t# ç¼–è¯‘é…ç½®æ–‡ä»¶ é¡¹ç›®ä½¿ç”¨ autoconfig å®Œæˆç¼–è¯‘ â”œâ”€â”€ pcrmanager.cc\t# pcré…ç½®æ–‡ä»¶çš„è¯»å–ä¸è®¾å®š â”œâ”€â”€ pcrmanager.h\t# â”œâ”€â”€ rfpipemacheadermessage.cc\t# è°ƒç”¨ä¸‹é¢ probuf çš„apiè¿›è¡Œåºåˆ—åŒ– ååºåˆ—åŒ– è¿™é‡Œåªæœ‰ä¸€ä¸ªå‚æ•° daterate â”œâ”€â”€ rfpipemacheadermessage.h\t# â”œâ”€â”€ rfpipemacheader.proto\t# å®šä¹‰mac headæ¶ˆæ¯æ•°æ®ç»“æ„ã€‚ä½¿ç”¨protoc *.proto --cpp_out=./ ç”Ÿæˆ å¯¹åº”æ•°æ®åºåˆ—åŒ–ã€ååºåˆ—åŒ–çš„pb.cc pb.h â”œâ”€â”€ myrfpipemac.xml.in\t# macåº“å‚æ•° ä»¥åŠ åœ¨æºç dtd/ä¸­åŠ å…¥ DOCTYPE è§£æ ï¼ˆæ³¨æ„ library æœ€å¥½ä¸ pzLayerName å°å†™åç»Ÿä¸€ï¼‰ â”œâ”€â”€ myrfpipenem.xml.in\t# nemé…ç½®çš„å‚æ•°ç¤ºä¾‹ ä»¥åŠ åœ¨æºç dtd/ä¸­åŠ å…¥ DOCTYPE è§£æ (æ­¤å¤„nemä¸­çš„mac ä¾èµ–rfpipemac rfpipemacä¾èµ–pcr) â””â”€â”€ myrfpipepcr.xml.in\t# é»˜è®¤pcræ›²çº¿é…ç½®ç¤ºä¾‹ ä»¥åŠ åœ¨æºç dtd/ä¸­åŠ å…¥ DOCTYPE è§£æ Mac layer ä½¿ç”¨ Virtual Transport çš„æ•°æ®å¤§è‡´å¤„ç†è¿‡ç¨‹\næ­¤å¤„çš„Rfpipeæ¨¡å‹å°±æ˜¯é€šè¿‡å®šæ—¶å™¨æ§åˆ¶é˜Ÿåˆ—å…¥é˜Ÿå‡ºé˜Ÿ æ¥é™åˆ¶æ— çº¿æ•°æ®dataRate\nautomake å’Œ autoconf ä½¿ç”¨ç®€æ˜æ•™ç¨‹ï¼Œä¸‹é¢ä»‹ç» myrfpipe çš„ autoconfig é…ç½®å®ä¾‹ ï¼ˆä»¥ä¸‹ç›¸å¯¹ç›®å½•çš†æ˜¯emaneæºç è·¯å¾„çš„ç›¸å¯¹ç›®å½•ï¼‰\næ·»åŠ æ–°æ¨¡å‹ä¸€èˆ¬éœ€è¦ä¿®æ”¹ autoconfig çš„ configure.ac, åœ¨è¯¥æ–‡ä»¶çš„ AC_OUTPUT æ·»åŠ å¦‚ä¸‹è·¯å¾„ æ¥åœ¨æ„å»ºè¿‡ç¨‹æŒ‡å®šè¾“å‡ºæ–‡ä»¶\nAC_OUTPUT( *** src/models/mac/rfpipe/Makefile src/models/mac/myrfpipe/Makefile *** ) ç¼–å†™å¹¶ä¿®æ”¹ makefile.am Makefile.am ä¸­æŒ‡æ˜å½“å‰ç›®å½•å¦‚ä½•ç¼–è¯‘ã€‚\nä¿®æ”¹ Makefile.am å®‰è£… å¸è½½çš„hook (å¯é€‰)\nsrc/models/mac/Makefile.am æ·»åŠ  myrfpipe å­ç›®å½•\nåœ¨ /dtd/ ä¸­å®šä¹‰dtdçš„æ•°æ®æ ¼å¼ï¼Œå¹¶åœ¨ /dtd/Makefile.am æ·»åŠ  myrfpipepcr.dtd\nåœ¨ /scripts/emanegenmanifests.sh ä¸­æ·»åŠ  éœ€è¦ç”Ÿæˆçš„åº“å myrfpipemaclayerã€‚å…¶åŸç†æ˜¯è°ƒç”¨ emaneinfo -m å¯¼å‡ºæ’ä»¶æˆ–æ¨¡å‹çš„ç±»å†…æ³¨å†Œ é…ç½®å’Œç»Ÿè®¡ä¿¡æ¯ çš„å‚æ•°ã€‚ç”Ÿæˆçš„xmlç»™coreè§£æå°±å¯ä»¥å¾—åˆ°æ¨¡å‹çš„æ‰€æœ‰å‚æ•°ã€‚\nç¼–å†™ src/models/mac/myrfpipe/Makefile.am\nlib_LTLIBRARIES = libmyrfpipemaclayer.la # cpp ç¼–è¯‘çš„é€‰é¡¹ -IæŒ‡å®šå¤´æ–‡ä»¶ç›®å½•ç­‰ç­‰ libmyrfpipemaclayer_la_CPPFLAGS= \\ -I@top_srcdir@/include \\ $(AM_CPPFLAGS) \\ $(libemane_CFLAGS) libmyrfpipemaclayer_la_LIBADD= \\ $(libuuid_LIBS) \\ $(libxml2_LIBS) \\ $(protobuf_LIBS) \\ @top_srcdir@/src/libemane/.libs/libemane.la libmyrfpipemaclayer_la_LDFLAGS= \\ $(AM_LDFLAGS) \\ -avoid-version # æºç ç›‘å¬æ–‡ä»¶ libmyrfpipemaclayer_la_SOURCES = \\ maclayer.cc \\ downstreamqueue.cc \\ pcrmanager.cc \\ rfpipemacheadermessage.cc \\ maclayer.h \\ downstreamqueue.h \\ pcrmanager.h \\ rfpipemacheadermessage.h nodist_libmyrfpipemaclayer_la_SOURCES = \\ rfpipemacheader.pb.cc \\ rfpipemacheader.pb.h # å®šä¹‰éåŠ¨æ€åº“ç¼–è¯‘çš„å…¶ä»–æ–‡ä»¶ EXTRA_DIST= \\ myrfpipenem.xml.in \\ myrfpipemac.xml.in \\ myrfpipepcr.xml.in \\ rfpipemacheader.proto BUILT_SOURCES = \\ myrfpipenem.xml \\ myrfpipemac.xml \\ myrfpipepcr.xml \\ $(nodist_libmyrfpipemaclayer_la_SOURCES) edit = sed \\ -e 's|@datadir[@]|$(pkgdatadir)|g' # å®šä¹‰æ¨¡æ¿xmlçš„ç”Ÿæˆ sed åŠ  æ–‡æœ¬é‡å®šå‘ myrfpipenem.xml: myrfpipenem.xml.in $(edit) $\u0026lt; \u0026gt; $@ myrfpipemac.xml: myrfpipemac.xml.in $(edit) $\u0026lt; \u0026gt; $@ myrfpipepcr.xml: myrfpipepcr.xml.in $(edit) $\u0026lt; \u0026gt; $@ # å®šä¹‰proto çš„ç”Ÿæˆ rfpipemacheader.pb.cc rfpipemacheader.pb.h: rfpipemacheader.proto protoc -I=. --cpp_out=. $\u0026lt; clean-local: rm -f $(BUILT_SOURCES) # åˆ›å»º ç›¸åº”æ¨¡å‹ç›®å½•, å¹¶å®šä¹‰ make install å¤åˆ¶çš„æ¨¡æ¿xml install-exec-hook:\t$(mkinstalldirs) $(DESTDIR)$(datadir)/$(PACKAGE)/xml/models/mac/myrfpipe cp -f myrfpipenem.xml $(SCHEMAS) $(DESTDIR)$(datadir)/$(PACKAGE)/xml/models/mac/myrfpipe cp -f myrfpipemac.xml $(SCHEMAS) $(DESTDIR)$(datadir)/$(PACKAGE)/xml/models/mac/myrfpipe cp -f myrfpipepcr.xml $(SCHEMAS) $(DESTDIR)$(datadir)/$(PACKAGE)/xml/models/mac/myrfpipe uninstall-local: rm -f $(DESTDIR)$(datadir)/$(PACKAGE)/xml/models/mac/myrfpipe/myrfpipenem.xml rm -f $(DESTDIR)$(datadir)/$(PACKAGE)/xml/models/mac/myrfpipe/myrfpipemac.xml rm -f $(DESTDIR)$(datadir)/$(PACKAGE)/xml/models/mac/myrfpipe/myrfpipepcr.xml makefile ç¼–å†™å®Œæˆå\n./autogen.sh # æˆ–è€… autoreconf --install ç”Ÿæˆç›¸åº”makefile PYTHON=python3 ./configure --prefix=/usr make check # æ£€æµ‹ç¼–è¯‘ make -j$(nproc) # æŒ‰ç…§æ ¸å¿ƒæ•°å¤šçº¿ç¨‹ç¼–è¯‘ sudo make install # å¤åˆ¶åŠ¨æ€åº“ emaneäºŒè¿›åˆ¶ç¨‹åº å¤´æ–‡ä»¶ pcræ¨¡å‹xml è§£æå™¨ åˆ°å¯¹åº”ç³»ç»Ÿç›®å½• å…³äº emane çš„xmlé…ç½®è·¯å¾„:\n/usr/share/emane$ tree -L 1 . â”œâ”€â”€ dtd\t# Document Type Definitionè·¯å¾„ â”œâ”€â”€ manifest # æ‰€æœ‰æ— çº¿æ¨¡å‹ mac phy å’Œå…¶ä»–æ’ä»¶çš„å‚æ•°ç±»å‹å®šä¹‰xml â”œâ”€â”€ schema\t# tdma æ—¶éš™ä¸“ç”¨ â””â”€â”€ xml\t# æ— çº¿æ¨¡å‹æ’ä»¶pcrä¸å…¶ä»–æ’ä»¶çš„é»˜è®¤xml coreä¸­è°ƒç”¨mac library å‘½åè§„åˆ™ä¸º macå±‚ä¸»åˆå§‹åŒ–çš„æ–‡ä»¶åŠå…¶ä¸Šçº§è·¯å¾„ (å°å†™)ã€‚å…¶å…·ä½“å®šä¹‰åœ¨ makefile.am çš„ lib_LTLIBRARIES å®šä¹‰ éœ€è¦åŠ ä¸Šå‰ç¼€ lib\nmac library ç›¸å¯¹è·¯å¾„ DECLARE_MAC_LAYER bypassmaclayer src/models/mac/bypass/maclayer.cc EMANE::Models::Bypass::MACLayer ieee80211abgmaclayer src/models/mac/ieee80211abg/maclayer.cc EMANE::Models::IEEE80211ABG::MACLayer rfpipemaclayer src/models/mac/rfpipe/maclayer.cc EMANE::Models::RFPipe::MACLayer tdmaeventschedulerradiomodel src/models/mac/tdma/eventscheduler/radiomodel.cc TDMAEventSchedulerRadioModel å¦‚æœ core å®‰è£…æ—¶ä½¿ç”¨ è™šæ‹Ÿç¯å¢ƒ (é»˜è®¤)ï¼Œåˆ™emane make install ç”Ÿæˆçš„è„šæœ¬åŒ…é»˜è®¤ä½¿ç”¨çœŸå®ç¯å¢ƒçš„pythonï¼Œéœ€è¦ä¿®æ”¹æˆ–è€…è¿™äº›pyè„šæœ¬çš„è§£æå™¨è·¯å¾„ï¼Œå¦åˆ™æ— æ³•è¿è¡Œã€‚\tè¿™é‡Œåˆ†äº«ä¸€ä¸ªç®€æ˜“æŒ‡ä»¤:\npy_path=$(cat $(which core-python) | awk 'NR==2 {print $2}') py_path='#!'${py_path:1:-1} old_path='#!.*' files=(\u0026quot;emaneevent-fadingselection\u0026quot; \u0026quot;emanecommand-eel\u0026quot; \u0026quot;emaneevent-location\u0026quot; \\ \u0026quot;emaneota-publisher\u0026quot; \u0026quot;emaneevent-antennaprofile\u0026quot; \u0026quot;emaneevent-pathloss\u0026quot; \\ \u0026quot;emanesh\u0026quot; \u0026quot;emaneevent-commeffect\u0026quot; \u0026quot;emaneevent-tdmaschedule\u0026quot;\\ \u0026quot;emaneevent-dump \u0026quot;\u0026quot;emanegentransportxml\u0026quot;) for f in ${files[@]} do a=$(which $f) sudo sed -i \u0026quot;1s|$old_path|$py_path|\u0026quot; $a done æ— çº¿æ¨¡å‹ç»‘å®šè‡³core\nè®¾å®šè‡ªå®šä¹‰æ¨¡å‹è·¯å¾„\nâ€‹\tCORE é€šè¿‡åŠ¨æ€åŠ è½½ç”¨æˆ·åˆ›å»ºçš„æ¨¡å‹çš„ python æ¥æ”¯æŒè‡ªå®šä¹‰å¼€å‘çš„ EMANE æ¨¡å‹ã€‚è‡ªå®šä¹‰ EMANE æ¨¡å‹åº”æ”¾ç½®åœ¨ CORE é…ç½®æ–‡ä»¶ /etc/core/core.conf ä¸­ emane_models_dir å®šä¹‰çš„è·¯å¾„ä¸­ã€‚ä¾‹å¦‚ emane_models_dir = /home/lk233/core/mytools/myemane_modules æ­¤è·¯å¾„ä¸èƒ½ä»¥ /emane ç»“å°¾ã€‚\nè®¾å®šemaneå‚æ•° å¯¹åº”coreé…ç½®ç•Œé¢\nâ€‹\tè¯¥è·¯å¾„ä¸‹åº”å½“è®¾ç½®ä¸ºä¸€ä¸ªæ¨¡å—ï¼Œç±»ä¼¼å¦‚ä¸‹ç»“æ„\nâ”œâ”€â”€ CRradio.py â”œâ”€â”€ mybypass.py â””â”€â”€ __init__.py â€‹\tå…¶ä¸­ ä¸€ä¸ªè°ƒç”¨emaneæ¨¡å‹çš„æ¨¡æ¿ å¦‚ä¸‹æ‰€ç¤ºï¼Œå…·ä½“é€‰é¡¹ç”±è‡ªå®šä¹‰æ¨¡å‹å†³å®šï¼š\n\u0026quot;\u0026quot;\u0026quot; è‡ªå®šä¹‰ emane model ç¤ºä¾‹ \u0026quot;\u0026quot;\u0026quot; from pathlib import Path from typing import Dict, Optional, Set, List from core.config import Configuration from core.emane import emanemanifest, emanemodel class ExampleModel(emanemodel.EmaneModel): \u0026quot;\u0026quot;\u0026quot; :å‚æ•° name: å®šä¹‰å°†æ˜¾ç¤ºåœ¨GUIä¸­çš„emaneæ¨¡å‹åç§°ï¼Œå¿…é¡»åŠ ä¸Šå‰ç¼€ emane_ :å‚æ•° config_ignore: å¿½ç•¥ mac phy å‚æ•°çš„åˆ—è¡¨ï¼Œæ·»åŠ è‡³æ­¤åˆ—è¡¨çš„å‚æ•°å°†ä¸ä¼šåºåˆ—åŒ–è‡³emaneé…ç½®xmlä¸­ï¼Œè¿™äº›é…ç½®ä¸€èˆ¬æ˜¯coreçš„ç•Œé¢æˆ–å…¶ä»–é¢å¤–è®¾å®š Mac å®šä¹‰: :å‚æ•° mac_library: å®šä¹‰æ¨¡å‹å°†å¼•ç”¨çš„ emane MACåº“ :å‚æ•° mac_xml: å®šä¹‰å°†è¢«è§£æä»¥è·å¾—é»˜è®¤é…ç½®é€‰é¡¹çš„MACæ¸…å•xmlï¼Œå°†æ˜¾ç¤ºåœ¨GUIä¸­ :å‚æ•° mac_defaults: è¦†ç›–ä¸Šè¿°çš„macå±‚é»˜è®¤å€¼ :å‚æ•° mac_config: è§£æxmlå¹¶è½¬æ¢ç”Ÿæˆçš„coreæ”¯æŒçš„åˆ—è¡¨ Phy å®šä¹‰: phyä¸€èˆ¬é…ç½®ä¸ºé€šç”¨æ¨¡å‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œä¸‹é¢çš„å‚æ•°éƒ½æ˜¯å¯é€‰çš„ã€‚ :å‚æ•° phy_library: å®šä¹‰æ¨¡å‹å°†å¼•ç”¨çš„phyåº“ï¼Œä¹Ÿå¯ä½¿ç”¨è‡ªå®šä¹‰phy :å‚æ•° phy_xml: å®šä¹‰å°†è¢«è§£æä»¥è·å¾—é…ç½®é€‰é¡¹çš„phyæ¸…å•xmlï¼Œå°†æ˜¾ç¤ºåœ¨GUIä¸­ :å‚æ•° phy_defaults: è¦†ç›–ä¸Šè¿°çš„phyå±‚é»˜è®¤å€¼ :å‚æ•° phy_config: è§£æxmlå¹¶è½¬æ¢ç”Ÿæˆçš„coreæ”¯æŒçš„åˆ—è¡¨ \u0026quot;\u0026quot;\u0026quot; # ä¸€å®šä¸ºemane_å‰ç¼€ name: str = \u0026quot;emane_myrfpipe\u0026quot; # è®¾ç½®macåº“æ¨¡å‹ mac_library: str = \u0026quot;myrfpipemaclayer\u0026quot; # è§£æè·å–æ¨¡å‹æ‰€æœ‰é…ç½® mac_xml: str = \u0026quot;/usr/share/emane/manifest/myrfpipemaclayer.xml\u0026quot; # è¦†ç›–é»˜è®¤å€¼ mac_defaults: Dict[str, str] = { \u0026quot;pcrcurveuri\u0026quot;: \u0026quot;/usr/share/emane/xml/models/mac/myrfpipe/myrfpipepcr.xml\u0026quot; } mac_config: List[Configuration] = [] # phy ç±»ä¼¼macé…ç½®ï¼Œä½¿ç”¨é»˜è®¤phyæ¨¡å‹ æ— éœ€è®¾ç½®library phy_library: Optional[str] = None phy_xml: str = \u0026quot;/usr/share/emane/manifest/emanephy.xml\u0026quot; phy_defaults: Dict[str, str] = { \u0026quot;subid\u0026quot;: \u0026quot;1\u0026quot;, \u0026quot;propagationmodel\u0026quot;: \u0026quot;2ray\u0026quot;, \u0026quot;noisemode\u0026quot;: \u0026quot;none\u0026quot;, } phy_config: List[Configuration] = [] config_ignore: Set[str] = set() @classmethod def load(cls, emane_prefix: Path) -\u0026gt; None: \u0026quot;\u0026quot;\u0026quot; Called after being loaded within the EmaneManager. Provides configured emane_prefix for parsing xml files. :param emane_prefix: configured emane prefix path :return: nothing \u0026quot;\u0026quot;\u0026quot; # load mac configuration cls.mac_config = emanemanifest.parse(cls.mac_xml, cls.mac_defaults) # load phy configuration cls.phy_config = emanemanifest.parse(cls.phy_xml, cls.phy_defaults) TDMA æ¨¡å‹ æ·»åŠ æ³¨æ„é¡¹ TDMAæ— çº¿æ¨¡å‹ å®ç°äº†ä¸“é—¨çš„æ—¶éš™è°ƒåº¦å™¨å’Œæ¶ˆæ¯é˜Ÿåˆ—ç®¡ç†å™¨æ¨¡å— æ¥å¯¹çš„TDMAæ¨¡å‹å¼€å‘ã€‚\né™¤äº†å¼•ç”¨ include/emane/ ä¸‹çš„åŸºç¡€çš„è®¡ç®—é‚»å±…èŠ‚ç‚¹ç­‰å¤´æ–‡ä»¶å®šä¹‰ (ç±»ä¼¼ #include \u0026ldquo;emane/models/tdma/basemodel.h\u0026rdquo;)\nåŒ…å«äº† é€šè¿‡è§£æemaneäº‹ä»¶ç”¨äºè°ƒåº¦æ—¶éš™ çš„äº‹ä»¶æ¶ˆæ¯ç»“æ„å®šä¹‰ (ç±»ä¼¼\u0026quot;emane/events/slotstructure.h\u0026quot;)\nè¿˜åŒ…å«äº† include/emane/models/tdma/ çš„tdmaæ¨¡å‹ç‹¬æœ‰å˜ç§æ–‡ä»¶ (ç±»ä¼¼ #include \u0026ldquo;emane/maclayerimpl.h\u0026rdquo;)\nTDMA ä¸å…¶ä»–æ¨¡å‹ä¸åŒ å¹¶éåœ¨ maclayer.cc ä¸­åˆ›å»ºmacå±‚ Implementor, è€Œæ˜¯é€šè¿‡ MACLayerImplementor SchedulerUser æ´¾ç”Ÿå‡º tdma åŒ…å«æ—¶éš™é€šä¿¡çš„ã€‚TDMA æ¨¡å‹(radiomodel) ä»é€»è¾‘ä¸Šå¯ä»¥åˆ†ä¸º\nåŸºç¡€tdmaæ— çº¿æ¨¡å‹ basemodel\nåŠ¨æ€æ›´æ–°æ—¶éš™æ¨¡å— eventscheduler å’Œå…¶å¤„ç† æ—¶éš™åˆ‡å‰²æŠ¥æ–‡é˜Ÿåˆ—ç®¡ç†æ¨¡å— queuemangager\nå¤§è‡´ç»“æ„å¦‚ä¸‹æ‰€ç¤º:\næŸ¥çœ‹æ–‡ä»¶ç»“æ„\ninclude/emane/events éƒ¨åˆ†å†…å®¹ emane/include/emane/events â”œâ”€â”€ slotinfo.h â”œâ”€â”€ slotinfo.inl â”œâ”€â”€ slotstructure.h â”œâ”€â”€ slotstructure.inl â””â”€â”€ tdmascheduleevent.h # tdma æ—¶éš™äº‹ä»¶å¯ä»¥ç”¨ emane å®‰è£…åç”Ÿæˆçš„ emaneevent-tdmaschedule æ¥è§¦å‘æ–°æ—¶éš™æ›´æ–°è°ƒåº¦, å…¶ç»„ä»¶ä¸emaneè¿›ç¨‹é€šä¿¡çš„æ•°æ®ä¹Ÿæ˜¯é€šè¿‡ protobuf åºåˆ—åŒ–ç”Ÿæˆçš„ã€‚ emane/include/emane/models/tdma â”œâ”€â”€ radiomodel.h # TDMA åŠ¨æ€æ—¶éš™æ— çº¿æ¨¡å‹ çš„å¤´æ–‡ä»¶ include basemodel.h â”œâ”€â”€ basemodel.h # maclayerimpl çš„å˜ç§ åŒ…å« TDMA çš„ scheduler.h å’Œ queuemanager.h â”œâ”€â”€ basicqueuemanager.h # QueueManager çš„å˜ç§ åŒ…å« queuemanager.h â”œâ”€â”€ Makefile.am â”œâ”€â”€ messagecomponent.h # æ¶ˆæ¯ç¼“å­˜ç»„ä»¶ï¼Œå…¶å†…å®¹æ ¹æ®æ˜¯å¦å¯ç”¨äº†èšåˆ æ¥ç¡®å®š data æˆ– control message æ˜¯å¦å®Œæ•´æˆ–éƒ¨åˆ†ä¼ è¾“ æ— çº¿æ¨¡å‹æ¯æ¬¡ä¼ è¾“å°†ä¼ è¾“ä¸€ä¸ªæˆ–å¤šä¸ªç»„ä»¶ã€‚åœ¨æ—¶éš™å’Œæ¶ˆæ¯æ•°æ®å¤§å°ä¸Šçš„æ¶ˆæ¯ç»„ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªåŒ…çš„ç»„åˆã€‚ â”œâ”€â”€ messagecomponent.inl â”œâ”€â”€ packetstatuspublisher.h â”œâ”€â”€ packetstatuspublisheruser.h â”œâ”€â”€ queuemanager.h # åŒ…å«ä¸Šè¿°åŒ…å¤„ç†çš„æ¶ˆæ¯é˜Ÿåˆ—å˜ç§å¤„ç†çš„å¤´æ–‡ä»¶ â”œâ”€â”€ scheduler.h # BaseModelç”¨äºé€šä¿¡çš„è°ƒåº¦å™¨æ¥å£ä¸è°ƒåº¦å™¨(Scheduler)æ¨¡å— åŒ…å« scheduleruser.h â”œâ”€â”€ scheduleruser.h â””â”€â”€ types.h # åŒ…å«äº†macçš„åŸºç¡€æ¶ˆæ¯ç±»ä¼¼ è¿˜åŒ…å«çš„æ—¶éš™ SlotInfo TxSlotInfo RxSlotInfo ç›¸å…³çš„å®šä¹‰ ä¸€ä¸ªtdmaç¤ºä¾‹çš„å®ç° emane/src/models/mac/mytdma â”œâ”€â”€ eventscheduler â”‚ â”œâ”€â”€ radiomodel.cc # æœ€ç»ˆæ‰“åŒ…çš„åŠ¨æ€åº“å®ä¾‹ï¼Œç”ŸæˆåŠ¨æ€æ—¶éš™æ¨¡å‹ â”‚ â”œâ”€â”€ eventscheduler.cc # æ—¶éš™è°ƒåº¦å™¨å®ä¾‹ â”‚ â”œâ”€â”€ eventscheduler.h â”‚ â”œâ”€â”€ eventtablepublisher.cc # é€šè¿‡emane tdmaäº‹ä»¶ æ¥è¿›è¡Œ åŠ¨æ€è°ƒåº¦çš„å®ä¾‹ â”‚ â”œâ”€â”€ eventtablepublisher.h â”‚ â”œâ”€â”€ Makefile.am â”‚ â”œâ”€â”€ slotter.h # æ—¶éš™æˆå‘˜å£°æ˜ â”‚ â”œâ”€â”€ slotter.inl â”‚ â”œâ”€â”€ tdmanem.xml.in # åˆå§‹æ—¶éš™è¡¨ æ¨¡æ¿ç¤ºä¾‹ â”‚ â””â”€â”€ tdmaradiomodel.xml.in # åŸºç¡€æ— çº¿å‚æ•° æ¨¡æ¿ç¤ºä¾‹ â”œâ”€â”€ aggregationstatuspublisher.cc # æ¶ˆæ¯ç‰‡æ®µèšåˆçŠ¶æ€ ç»Ÿè®¡å®ä¾‹ â”œâ”€â”€ aggregationstatuspublisher.h â”œâ”€â”€ basemodel.cc # åŒ…å«äº† æ ¹æ®æ—¶éš™æ¥å¤„ç†ä¸Šä¸‹æ¸¸å…³ç³»çš„åŸºç¡€æ— çº¿tdmaæ¨¡å‹ â”œâ”€â”€ basemodelimpl.cc â”œâ”€â”€ basemodelimpl.h â”œâ”€â”€ basemodelmessage.h â”œâ”€â”€ basemodelmessage.inl â”œâ”€â”€ basicqueuemanager.cc â”œâ”€â”€ Makefile.am â”œâ”€â”€ packetstatuspublisherimpl.cc # æŠ¥æ–‡çŠ¶æ€å‘å¸ƒå®ä¾‹ â”œâ”€â”€ packetstatuspublisherimpl.h â”œâ”€â”€ pormanager.cc â”œâ”€â”€ pormanager.h â”œâ”€â”€ priority.h # ä¸‹æ¸¸æ•°æ®å…¥é˜Ÿåˆ—çš„ä¼˜å…ˆçº§å£°æ˜ â”œâ”€â”€ queue.cc â”œâ”€â”€ queue.h â”œâ”€â”€ queuestatuspublisher.cc â”œâ”€â”€ queuestatuspublisher.h â”œâ”€â”€ receivemanager.cc # å°†åˆ†ç¦»çš„æ—¶éš™çš„æ•°æ®é‡æ–°èšåˆ â”œâ”€â”€ receivemanager.h â”œâ”€â”€ slotstatustablepublisher.cc # æ—¶éš™è¡¨ç»Ÿè®¡å®ä¾‹ â”œâ”€â”€ slotstatustablepublisher.h â”œâ”€â”€ tdmabasemodelmessage.proto # æ¨¡å‹macå±‚æ¶ˆæ¯çš„æ•°æ®ç»“æ„å®šä¹‰ å¯ä»¥ä½¿ç”¨ æ–‡ä»¶å¤¹å†…make æ›´æ–°ï¼Œä¹Ÿå¯è°ƒç”¨ protoc -I=. --cpp_out=. *.proto â”œâ”€â”€ tdmabasemodelpcr.xml # é»˜è®¤æ— çº¿æ¨¡å‹çš„pcræ›²çº¿å®šä¹‰ï¼Œå…¶è§£æä¸ å…¶ä»–æ¨¡å‹äº¤ç”±emaneç»„ä»¶è§£æä¸åŒï¼Œç”±æ¨¡å‹è‡ªå·±åšè§£æå¤„ç† â”œâ”€â”€ txslotinfosformatter.cc # æ ¼å¼åŒ– å‘é€æ¶ˆæ¯æ—¶éš™çš„å¯¹è±¡ â””â”€â”€ txslotinfosformatter.h ä¿®æ”¹ configure.ac AC_OUTPUT æ·»åŠ è¿™ä¸¤è¡Œ ç”Ÿæˆ makefile é€‰é¡¹\nsrc/models/mac/mytdma/Makefile src/models/mac/mytdma/eventscheduler/Makefile å…¶ä½™ makefile.am çš„ä¿®æ”¹ç±»ä¼¼ ä¹‹å‰ myrfpipe çš„åˆ›å»ºè¿‡ç¨‹\næ³¨æ„\nxmlè§£æç”±æ¨¡å‹è‡ªå·±æ¨¡å—çš„ pormanager.cc å®ç°, æ— éœ€æ·»åŠ dtd\nä¸ºäº†åé¢å¯èƒ½éœ€è¦çš„å®šåˆ¶ä¿®æ”¹, å°† emane/models/mytdma/ å¤åˆ¶ä¸€ä»½æ”¾å…¥ header ä¸­, å¹¶å¹¶ä¿®æ”¹å…¶ä¸­çš„è°ƒç”¨è·¯å¾„\nemane/src/models/mac/mytdma/eventscheduler/Makefile.am é‡Œçš„åŠ¨æ€åº“åŒ…å«çš„ä¸Šçº§ç›®å½•çš„ libtdmabase éœ€è¦ä¿®æ”¹ libmytdmabase\n","id":6,"section":"posts","summary":"Emaneå¼€å‘æ–‡æ¡£ Emaneç»´åŸº Emaneä»¿çœŸæ¶æ„ï¼š Emaneä»¿çœŸæµç¨‹ â€‹ å½“ä»¿çœŸå™¨å®ä¾‹åŒ–æ¨¡å‹æ’ä»¶ï¼ˆå³è¯»å–æ¨¡å‹é…ç½®æ–‡ä»¶platform.xmlï¼‰","tags":["ä»¿çœŸ","C/C++","Emane"],"title":"Emaneæ¨¡å‹è°ƒç ”","uri":"https://liangkang233.github.io/2022/05/emane%E6%A8%A1%E5%9E%8B%E8%B0%83%E7%A0%94/","year":"2022"},{"content":"ä¹‹å‰å®‰è£…dockeræ—¶å€™æƒŠè®¶å…¶å±…ç„¶æœ‰windowsç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œå¿ƒæƒ³ docker ä¸æ˜¯é linuxå†…æ ¸å®ç°çš„èµ„æºæ§åˆ¶ç©ºé—´éš”ç¦»ä¹ˆï¼Œæ€ä¹ˆä¼šæœ‰windowsç‰ˆæœ¬ï¼Œçœ‹äº†ä¸‹å®‰è£…æ–¹æ³•æ‰äº†è§£åˆ° å¾®è½¯å†…ç½®äº†linuxå†…æ ¸çš„å­ç³»ç»Ÿï¼Œå³ wsl (Windows Subsystem for Linux)ã€‚\nå¯ä»¥åœ¨winç³»ç»Ÿä¸Šä¸ç”¨è™šæ‹Ÿæœºçš„æ–¹å¼åŸç”Ÿæ‰§è¡Œ linux ï¼Œæ²¡æœ‰è™šæ‹Ÿæœºé‚£äº›å…¶ä»–å¼€é”€ï¼Œè¿™ä¹Ÿå¤ªç‰›äº†ç›´æ¥å¼€æ•´ï¼Œè¯•è¯•wslå¥½ä¸å¥½ç”¨ï¼Œä¹Ÿç©ä¸‹windowsç‰ˆçš„dockerã€‚\né…ç½® wsl åœ¨ powershell ä¸‹:\nwsl --install # é…ç½®ç¯å¢ƒ wsl --list --online # åªæœ‰å†…æ ¸ è¿˜éœ€è¦åœ¨è¯¥åˆ—è¡¨ä¸­é€‰æ‹©é•œåƒå¯åŠ¨ wsl --install -d \u0026lt;DistroName\u0026gt; WSL 2 ä½¿ç”¨æœ€æ–°ã€æœ€å¼ºå¤§çš„è™šæ‹ŸåŒ–æŠ€æœ¯åœ¨è½»é‡çº§å®ç”¨å·¥å…·è™šæ‹Ÿæœº (VM) ä¸­è¿è¡Œ Linux å†…æ ¸ã€‚ æ‰€ä»¥å…ˆå‡çº§å¯¹åº”wslå†…æ ¸ç‰ˆæœ¬ï¼ˆdockeråªèƒ½è¿è¡Œåœ¨wsl2ä¸Šï¼‰é€‚ç”¨äº x64 è®¡ç®—æœºçš„ WSL2 Linux å†…æ ¸æ›´æ–°åŒ…\nwsl # å¼€å¯å¹¶è¿›å…¥é»˜è®¤ç³»ç»Ÿ ååŠ å‘½ä»¤ä¼šåœ¨åˆ†å‘ç³»ç»Ÿå†…æ‰§è¡Œè¯¥å‘½ä»¤ wsl -d Ubuntu -u root # è¿›å…¥æŒ‡å®šç‰ˆæœ¬ æŒ‡å®šç”¨æˆ· wsl --export \u0026lt;Distribution Name\u0026gt; \u0026lt;FileName\u0026gt; # ç³»ç»Ÿå¯¼å‡º wsl --import \u0026lt;Distribution Name\u0026gt; \u0026lt;InstallLocation\u0026gt; \u0026lt;FileName\u0026gt; # ç³»ç»Ÿå¯¼å…¥ wsl --unregister \u0026lt;DistributionName\u0026gt; # å¸è½½ç³»ç»Ÿ wsl -l -v # æŸ¥çœ‹å…¨éƒ¨ç³»ç»Ÿçš„wslç‰ˆæœ¬ å’ŒçŠ¶æ€ wsl --terminate, -t \u0026lt;distro name\u0026gt; # å…³é—­è¯¥ç³»ç»Ÿ --shutdown å…³é—­å…¨éƒ¨ç³»ç»Ÿ wsl --set-default-version \u0026lt;Version\u0026gt; # è®¾ç½®é»˜è®¤ WSL ç‰ˆæœ¬ wsl --distribution \u0026lt;Distribution Name\u0026gt; --user \u0026lt;User Name\u0026gt; # ä»¥ç‰¹å®šç”¨æˆ· è¿è¡Œ linuxå‘è¡Œç‰ˆ å¯¼å…¥ç³»ç»Ÿçš„å‘è¡ŒåŒ…æ²¡æ³•åƒ ubuntu2004.exe config --default-user new_user_name é…ç½®é»˜è®¤ç™»å½•ç”¨æˆ·ï¼Œè¿›å…¥å‘è¡Œç³»ç»Ÿï¼Œæ·»åŠ æˆ–ä¿®æ”¹ /etc/wsl.conf åœæ­¢wslç³»ç»Ÿé‡æ–°è¿›å…¥å³å¯ç”Ÿæ•ˆã€‚\nYourUserName=lk233 sudo echo -e \u0026quot;[user] \\ndefault = $YourUserName\u0026quot; \u0026gt; /etc/wsl.conf è‹¥æ˜¯ä¸å¯¹wslèµ„æºè¿›è¡Œé™åˆ¶ï¼Œå…¶vmmemè¿›ç¨‹ä¼šé€æ¸åƒå…‰ç‰©ç†æœºå†…å­˜ï¼Œå‚è€ƒè¯¥WSL ä¸­çš„é«˜çº§è®¾ç½®é…ç½® | Microsoft Docs è¿›è¡Œé™å®šwslç³»ç»Ÿæ€§èƒ½ã€‚ Linuxå†…æ ¸ä¸­æœ‰ä¸€ä¸ªå‚æ•°/proc/sys/vm/drop_cachesï¼Œæ˜¯å¯ä»¥ç”¨æ¥æ‰‹åŠ¨é‡Šæ”¾Linuxä¸­çš„cacheç¼“å­˜ï¼Œå¦‚æœå‘ç°wsl2çš„cacheè¿‡å¤§å½±å“åˆ°å®¿ä¸»æœºæ­£å¸¸è¿è¡Œäº†ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥é‡Šæ”¾cacheï¼š\necho 3 \u0026gt; /proc/sys/vm/drop_caches\nå¼€å‘ç¯å¢ƒ é…ç½®ç”¨æˆ·å æ‹¿æ¥è·‘æ•°æ®åº“ docker Linux guiåº”ç”¨(éœ€è¦win11) å‰ç«¯æ¡†æ¶ ç”šè‡³æœºå™¨å­¦ä¹  çš„python é¡¹ç›®éƒ½å¯ä»¥ã€‚è®¾ç½® WSL å¼€å‘ç¯å¢ƒ | Microsoft Docs\nä½¿ç”¨windowsçš„èµ„æºç®¡ç†å™¨æŸ¥çœ‹wslç³»ç»Ÿï¼Œè·¯å¾„ä¸º \\\\wsl$\\ç³»ç»Ÿå å…¶é»˜è®¤çš„çœŸå®è·¯å¾„ä¸º C:\\Users\\LAB\\AppData\\Local\\Packages\\Project$ è·¯å¾„åç¼€è‚¯å®šæ˜¯ä¸åŒæœºå™¨ä¸ä¸€æ ·çš„æˆ‘è¿™é‡ŒProject$ = CanonicalGroupLimited.Ubuntu20.04onWindows_79rhkp1fndgscã€‚åœ¨linuxå†…è¯¥è·¯å¾„ä¸º /mnt/c å¯¹åº” windowsä¸­çš„cç›˜ï¼Œä½¿ç”¨ explorer.exe . æ¥åœ¨èµ„æºç®¡ç†å™¨ä¸­æŸ¥çœ‹ã€‚åƒdockerè¿™ç±»åº”ç”¨è€ƒè™‘åˆ°ioæ€§èƒ½ï¼Œæœ€å¥½ä½¿ç”¨ linuxå†…çš„è·¯å¾„ä¾‹å¦‚ ~/my-project è€Œä¸æ˜¯ /mnt/c/users è¿™æ ·çš„æŒ‚è½½è·¯å¾„ã€‚\nåŸç”Ÿçš„ powersehll ä¸å¤ªå¥½ç”¨ï¼Œä¹Ÿæ‡’å¾—æ•´ä¸ªwindowsç»ˆç«¯ã€‚æ¥ä¸‹æ¥ä½¿ç”¨vscodeæ¥ä¼˜é›…çš„ä½“éªŒwslå§ã€‚wslåˆ†å‘ç³»ç»Ÿ é€šè¿‡è™šæ‹Ÿç½‘å¡vEthernet (WSL) ä¸ç‰©ç†ä¸»æœºè¿æ¥ï¼Œå°±åƒè¿œç¨‹ç™»å½•å…¶å®ƒlinuxä¸»æœºä¸€æ ·ï¼Œwslä½œä¸ºæœåŠ¡å™¨ä¸»æœºï¼Œvscodeä½œä¸ºå®¢æˆ·ç«¯æ˜¾ç¤ºã€‚æ‰€ä»¥å½“æœ¬åœ°vscode å‡çº§æ—¶ï¼Œè¿œç«¯ / wsl çš„ code server ä¹Ÿä¼šå‡çº§ã€‚\næŠŠ é›†æˆwsl2 çš„ docker è£…èµ·æ¥ï¼ŒWSL ä¸Šçš„ Docker å®¹å™¨å…¥é—¨ | Microsoft Docs é…ç½®å¥½åwslå°±å¯ä»¥ä½¿ç”¨ dockeräº†ã€‚\nç”±äºwinç³»ç»Ÿéƒ½æ˜¯é€šè¿‡è°ƒç”¨linuxå†…æ ¸å®ç°dockeråŠŸèƒ½ï¼Œæ•´ä¸ª docker daemon è¿˜æ˜¯ç”±docker-desktopæ§åˆ¶çš„ï¼Œæ‰€ä»¥åªåœ¨æœ¬åœ°ä¸»æœºä¸Šçš„ vscode é…ç½® docker å’Œ remote-docker æ’ä»¶è¿›è¡Œå…¨å±€ç®¡ç†å³å¯ã€‚å¯ä»¥çœ‹åˆ° wsl å¤šäº† ä¸¤ä¸ªå‘è¡Œç‰ˆ docker-desktop-data docker-desktop å¯¹åº”è·¯å¾„ä¸º C:\\Users\\user\\AppData\\Local\\Docker\\wslã€‚åé¢Cç›˜å ç”¨å¤ªé«˜å¯ä»¥å°è¯•è¿ç§»: WSL2 è¿ç§» Docker é•œåƒå­˜å‚¨ä½ç½®\né¡¹ç›®æ‰§è¡Œ ä¸€åˆ‡å°±ç»ªï¼Œè¯•è¯•è·‘è¿™ä¸ª çˆ¬è™«ç›‘è§†é¡¹ç›®ã€‚å…¶ä»– mangodb grafana influxdb ç­‰ç¯å¢ƒ è·‘ä¸ªdockerå®¹å™¨å³å¯ã€‚è¯¥é¡¹ç›®ä½¿ç”¨selenium çˆ¬å–è±†ç“£å…³é”®è¯ç›¸å…³ç”µå½±ä¿¡æ¯å­˜å…¥ mongodbä¸­ï¼Œä½¿ç”¨ æ—¶åºæ•°æ®åº“ InfluxDB æ¥è®°å½•å°†æ•°æ®æŠ“å–çš„å˜åŒ–æƒ…å†µï¼Œä½¿ç”¨ Grafana å±•ç¤ºã€‚\næ³¨æ„ redis é…ç½®æ–‡ä»¶ä¸è¦å¼€ daemonize yesï¼Œç±»ä¼¼çš„ monggoä¹Ÿä¸è¦å¼€ forkä¹‹ç±»çš„åå°æ‰§è¡Œã€‚\nä½¿ç”¨ docker-compose éƒ¨ç½²æ•°æ®åº“å®¹å™¨: docker-compose up -d ä¸ä½¿ç”¨ -f æŒ‡å®šé»˜è®¤ä½¿ç”¨å½“å‰ç›®å½•çš„docker-compose.yml\ndocker-compose # Use root/example as user/password credentials version: '3.1' services: mongo: image: mongo restart: always container_name: some-mongo ports: - 27017:27017 environment: MONGO_INITDB_ROOT_USERNAME: root MONGO_INITDB_ROOT_PASSWORD: example volumes: - ~/MyCustom/mongo/daemon_config:/etc/mongo - ~/MyCustom/mongo/mong_data_conf:/data/configdb - mong_data:/data/db command: --config /etc/mongo/mongod.conf mongo-express: image: mongo-express container_name: mongo-express depends_on: - mongo restart: always ports: - 8081:8081 environment: ME_CONFIG_MONGODB_AUTH_USERNAME: root ME_CONFIG_MONGODB_AUTH_PASSWORD: example ME_CONFIG_BASICAUTH_USERNAME: root # ç®¡ç†ç•Œé¢ express çš„è´¦å· å¯†ç  ME_CONFIG_BASICAUTH_PASSWORD: lk233pass ME_CONFIG_MONGODB_URL: mongodb://root:example@mongo:27017/ VCAP_APP_HOST: 0.0.0.0 VCAP_APP_PORT: 8081 # é…ç½®å‚æ•° https://grafana.com/docs/grafana/latest/administration/configure-docker/ é»˜è®¤è´¦æˆ·å¯†ç  admin@admin grafana: image: grafana/grafana container_name: grafana ports: - 3000:3000 environment: GF_DEFAULT_INSTANCE_NAME: my-instance GF_SECURITY_ADMIN_USER: root GF_AUTH_GOOGLE_CLIENT_SECRET: example GF_PLUGIN_GRAFANA_IMAGE_RENDERER_RENDERING_IGNORE_HTTPS_ERRORS: true # influxdb docker é…ç½® https://hub.docker.com/_/influxdb influxdb: image: influxdb container_name: influxdb ports: - 8086:8086 volumes: - influxdb_data:/var/lib/influxdb2 - ~/MyCustom/influx_db/config:/data/db environment: # DOCKER_INFLUXDB_INIT_MODE: setup upgrade DOCKER_INFLUXDB_INIT_USERNAME: root DOCKER_INFLUXDB_INIT_PASSWORD: example DOCKER_INFLUXDB_INIT_ORG: my_org DOCKER_INFLUXDB_INIT_BUCKET: my_bucket volumes: mong_data: redis_data: influxdb_data: mong_data_conf: ç”±äºwslé‡Œæ²¡æœ‰æµè§ˆå™¨ï¼Œæ‰€ä»¥è¿™ä¸ªæŠ“å–çš„è„šæœ¬æ”¹ä¸ºç”¨ edge çš„åœ¨windowsä¸Šæ‰§è¡Œã€‚ç„¶åè„šæœ¬æœ‰äº›å‡½æ•°è¢«å¼ƒç”¨äº†ï¼Œä¿®æ”¹åçš„ç‰ˆæœ¬ã€‚å¦‚æœ msedgedriver ä¸åœ¨pathç¯å¢ƒä¸‹ï¼Œéœ€è¦è®¾å®š è·¯å¾„ã€‚\nçˆ¬è™«ä»£ç  # -*- coding:utf-8 -*- import time from selenium.webdriver.common.by import By from selenium.webdriver.support.ui import WebDriverWait from selenium.webdriver.support import expected_conditions as EC import re from selenium.common.exceptions import TimeoutException from msedge.selenium_tools import Edge, EdgeOptions from lxml import etree import pymongo import datetime MONGO_URL = 'mongodb://root:example@172.18.96.216:27017/' MONGO_DB = 'douband_movices' client = pymongo.MongoClient(MONGO_URL) db = client[MONGO_DB] MONGO_TABLE = \u0026quot;movie_info\u0026quot; key_word = input(\u0026quot;è¯·è¾“å…¥éœ€è¦çˆ¬å–çš„å…³é”®è¯: \u0026quot;) edge_options = EdgeOptions() edge_options.use_chromium = True edge_options.add_argument(\u0026quot;inprivate\u0026quot;) browser = Edge(executable_path = \u0026quot;E:\\\\Github_code\\\\Tools\\\\spider_douban_selenium_mongodb\\\\msedgedriver.exe\u0026quot;, options=edge_options) wait = WebDriverWait(browser,10) browser.get('https://movie.douban.com/') def search(): try: input = wait.until( EC.presence_of_element_located((By.CSS_SELECTOR,'#inp-query')) ) submit = wait.until( EC.element_to_be_clickable((By.CSS_SELECTOR,'#db-nav-movie \u0026gt; div.nav-wrap \u0026gt; div \u0026gt; div.nav-search \u0026gt; form \u0026gt; fieldset \u0026gt; div.inp-btn \u0026gt; input[type=\u0026quot;submit\u0026quot;]')) ) input.send_keys('{}'.format(key_word)) submit.click() print('æ­£åœ¨åŠ è½½') active = wait.until( EC.presence_of_element_located((By.CSS_SELECTOR,'a.num.activate.thispage')) ) print('åŠ è½½ç¬¬ã€{}ã€‘é¡µæˆåŠŸ'.format(active.text)) get_movies() except TimeoutException: print('ç­‰å¾…è¶…æ—¶ï¼Œé‡æ–°æœç´¢...') return search() def next_page(): try: next_page_submit = wait.until( EC.element_to_be_clickable((By.CSS_SELECTOR,'a.next')) ) next_page_submit.click() wait.until( EC.presence_of_element_located((By.CSS_SELECTOR,'a.num.activate.thispage')) ) print('æˆåŠŸåŠ è½½è¯¥é¡µæ•°æ®...') get_movies() print('--------------åŠ è½½å®Œæˆï¼Œå¹¶æ‰“å°æˆåŠŸï¼Œå¼€å§‹åŠ è½½ä¸‹ä¸€é¡µ------------') time.sleep(3) next_page() except TimeoutException: print('åŠ è½½è¶…æ—¶ï¼Œé‡æ–°åŠ è½½...') return next_page() def get_movies(): try: print('æ­£åœ¨è§£æ...') page = browser.page_source.encode('utf-8') selector = etree.HTML(page) print('å¼€å§‹æ‰“å°è¾“å‡ºç”µå½±ä¿¡æ¯...') items = selector.xpath('//*[@id=\u0026quot;root\u0026quot;]/div/div[2]/div[1]/div[1]') for item in items: names = item.xpath('div/div/div/div[1]/a/text()') urls = item.xpath('div/div/div/div[1]/a/@href') ratings = item.xpath('div/div/div/div[2]/span[2]/text()') durations = re.findall(r'\\d\\d+',str(item.xpath('div/div/div/div[3]/text()'))) actors = item.xpath('div/div/div/div[4]/text()') for name,url,rating,duration,actor in zip(names,urls,ratings,durations,actors): # æ‰“åŒ…ä¸ºå…ƒç»„çš„åˆ—è¡¨ movie_info = {} movie_info['name'] = name movie_info['url'] = url if rating == '(å°šæœªä¸Šæ˜ )' or '(æš‚æ— è¯„åˆ†)': movie_info['rating'] = None else: movie_info['rating'] = float(rating) movie_info['duration'] = int(duration) movie_info['actors'] = actor movie_info['key_word'] = key_word print(movie_info) save_to_mongo(movie_info) except Exception as e: print(e) time.sleep(3) return get_movies() def save_to_mongo(result): try: # if db[MONGO_TABLE].insert_one(result): if db.get_collection(MONGO_TABLE).insert_one(result): # get å‡½æ•°æ²¡æœ‰è¯¥è¡¨ä¾¿ä¼šåˆ›å»ºä¸€ä¸ª print('æˆåŠŸå­˜å‚¨åˆ°MONGODB') except Exception as e: raise e def main(): start_time = datetime.datetime.now() # global MONGO_TABLE # å®šä¹‰å†™å…¥çš„è¡¨ä¸ºæ—¶é—´æˆ³ # MONGO_TABLE = start_time.strftime(\u0026quot;%Y-%m-%d %H:%M:%S\u0026quot;) try: db_list = client.list_database_names() # db.list_collection_names() æ˜¯è¯¥æ•°æ®åº“çš„å…¨éƒ¨æ•°æ®é›† print(f\u0026quot;å…¨éƒ¨æ•°æ®åº“ä¸º: {db_list}\u0026quot;) if MONGO_DB in db_list : print(\u0026quot;æ•°æ®åº“å­˜åœ¨\u0026quot;) search() next_page() else: print(f\u0026quot;{MONGO_DB} ä¸å­˜åœ¨, è¿æ¥ä¸å¯ç”¨\u0026quot;) except Exception as e: raise e finally: browser.close() end_time = datetime.datetime.now() print('*'*100) print('å…±è®¡ç”¨æ—¶ï¼š', end_time - start_time) total_nums = db[MONGO_TABLE].count_documents({}) print('å…±è®¡è·å–æ•°æ®ï¼š',total_nums,' æ¡') print('*'*100) if __name__ == '__main__': main() éªŒè¯ mongodb çš„æ•°æ®å¯ä»¥ä½¿ç”¨ mongo-express ç›´æ¥è®¿é—® wsl_ip:8081 ä¾‹å¦‚ 172.18.96.216:8081 å³å¯å›¾å½¢åŒ–ç•Œé¢æŸ¥çœ‹ç­›é€‰æ•°æ®åº“å†…å®¹ã€‚\ninfluxdbé‡‡é›†è„šæœ¬ InfluxDB çš„ç‰ˆæœ¬å˜åŒ–ï¼ŒåŸæ–‡ç« çš„è„šæœ¬ä¸åœ¨é€‚ç”¨ï¼Œå¯ç”¨influxå®¹å™¨å è®¿é—® 8086 ç«¯å£ï¼Œè¿›å…¥åæŸ¥çœ‹ data é¡µ çš„Client L ibraries æŸ¥çœ‹ç¼–å†™ä¾‹ç¨‹ã€‚\næ”¹å†™åï¼š\nfrom datetime import datetime from influxdb_client import InfluxDBClient, Point, WritePrecision from influxdb_client.client.write_api import SYNCHRONOUS import pymongo, time # You can generate an API token from the \u0026quot;API Tokens Tab\u0026quot; in the UI token = \u0026quot;UNX9i2BpV_VTWyccXomQ6F026rg6j_nUeXtheR4THu8WoWmky09Fgw2WBJAltHL0sQadeDaSb2OGE-J0B7-2vg==\u0026quot; org = \u0026quot;CQUPT\u0026quot; bucket = \u0026quot;douban\u0026quot; MONGO_URL = 'mongodb://root:example@172.18.96.216:27017/' MONGO_DB = 'douband_movices' mongodb = pymongo.MongoClient(MONGO_URL).get_database(MONGO_DB) # è¿æ¥ MongoDB æ•°æ®åº“ client = InfluxDBClient(url=\u0026quot;http://172.18.96.216:8086\u0026quot;, token=token, org=org) # è¿æ¥ influxDB æ•°æ®åº“ write_api = client.write_api(write_options=SYNCHRONOUS) interval = 8 def main() : last_size, last_count = {}, {} for dbname in mongodb.list_collection_names(): last_size[dbname], last_count[dbname] = 0.0, 0 while True: for dbname in mongodb.list_collection_names(): # db = mongodb.get_collection(dbname) dbstat = mongodb.command(\u0026quot;collstats\u0026quot;, dbname) now_size = round(float(dbstat[\u0026quot;size\u0026quot;] / 1024 / 1024), 2) now_count = dbstat[\u0026quot;count\u0026quot;] # å¾—åˆ°æ•°æ® å¢é•¿é‡ increase_amount = now_size - last_size[dbname] increase_collection_size = now_count - last_count[dbname] point = Point(\u0026quot;crawler\u0026quot;) \\ .tag(\u0026quot;db_name\u0026quot;, dbname) \\ .field(\u0026quot;count\u0026quot;, now_count) \\ .field(\u0026quot;increase_count\u0026quot;, increase_amount) \\ .field(\u0026quot;size\u0026quot;, now_size) \\ .field(\u0026quot;increase_size\u0026quot;, increase_collection_size) \\ .time(datetime.utcnow(), WritePrecision.NS) write_api.write(bucket, org, point) print('æˆåŠŸå†™å…¥influxdb æ•°æ®: ', point) last_size[dbname], last_count[dbname] = now_size, now_count time.sleep(interval) if __name__ == '__main__': main() å…ˆè¯•è¯• èƒ½å¤Ÿå¦ å¦‚å›¾ å°† Buckets çš„æ•°æ®äº‰å–æŠ“å‡ºæ¥ï¼Œç­›é€‰å¥½ä¿¡æ¯ submit çœ‹è§æœ‰æ•°æ®å¯¼å…¥å³å¯éªŒè¯ influx è„šæœ¬æ­£å¸¸\nGrafans é…ç½® æœ€åé…ç½® Grafansï¼Œè¿›å…¥ 3000 ç«¯å£ adminè´¦å· å¯†ç admin åˆ›å»ºåˆå§‹è´¦å·ã€‚æ–°ç‰ˆçš„ Grafans å·²ç»æœ‰ç›´æ¥æ”¯æŒ mongodb äº†ï¼Œç»äº† ç»•ä¸€å¤§åœˆğŸ˜«ã€‚è¿˜æ˜¯å…ˆåƒæ–‡ç« ä¸€æ ·é…ç½®æ•°æ®åº“å§ã€‚\nä»‹ç»ä¸‹æ€ä¹ˆè£…æ’ä»¶ï¼š\n# è¿›å…¥å®¹å™¨ç»ˆç«¯ docker exec -it grafana bash grafana-cli plugins list-remote grafana-cli plugins install grafana-mongodb-datasource # ä¹‹åé‡å¯å®¹å™¨å³å¯ç”Ÿæ•ˆ docker container restart grafana å›¾å½¢ç•Œé¢ Server Admin çš„ plugins é€‰é¡¹ä¸‹è£…æ’ä»¶æ›´æ–¹ä¾¿ï¼Œè€Œä¸”å¾ˆå¥‡æ€ªæ— æ³•åœ¨ Configuration / Data sources ä¸‹ ä½¿ç”¨ Add data source æŒ‰é’®æ·»åŠ è¯¥æ•°æ®åº“ï¼Œåªèƒ½åœ¨ Configuration çš„ plugins æˆ– Server Admin çš„ plugins ä¸‹æ·»åŠ ã€‚\né…ç½®å¥½å å¼¹çª— Enterprise License Error å‘ç°æ˜¯ éœ€è¦ä¼ä¸šç‰ˆæ‰èƒ½ç”¨ã€‚æ”¾å¼ƒï¼\nè€è€å®å®é… influx å§ï¼Œ2.0ä»¥ä¸Šç‰ˆæœ¬ Query Language ä½¿ç”¨ Fluxï¼Œè¿™é‡Œçš„ipè¦æ³¨æ„ï¼Œæˆ‘ä¹‹å‰æ­å»ºçš„ç¯å¢ƒéƒ½æ˜¯é€šè¿‡ wsl çš„ip 172.18.96.216 æ¥è¿›è¡Œé€šä¿¡çš„ï¼Œè€Œæ­¤å¤„æ˜¯ grafana å®¹å™¨è®¿é—® influx å®¹å™¨ï¼Œæ‰€ä»¥è·¨ç½‘æ®µä¼šæ‰¾ä¸åˆ°è·¯ç”±ï¼Œæ’é”™äº†åŠå¤©åœ¨ æ—¥å¿—é‡Œæ‰å‘ç°ç«¯å€ªï¼Œè¿› ifluxdb å®¹å™¨ å†…æ‰§è¡Œ ip link addr show è·å–ipä¸º 172.18.0.4ï¼Œè¿æ¥é…ç½® url è®¾ç½®ä¸ºå…¶ç½‘å…³æˆ–ç½‘å¡ipï¼ŒInfluxDB Details é‡Œçš„ token ä¸º ä¸Šè¿°ä»£ç ç”¨åˆ°çš„ api tokenã€‚\næœ€ååœ¨ dashboard æ·»åŠ ä¸€ä¸ªæ–°çš„ panelï¼Œ query é‡Œé€‰æ‹© influxDB ä½¿ç”¨ sample Query å¿«é€Ÿå¡«å…¥ä¸€äº›ç®€å•çš„æ¡ˆä¾‹ã€‚æˆ–è€…ç›´æ¥åœ¨ ifluxdbçš„ç•Œé¢ Data Explorerä¸­è¿›è¡Œå…ƒç´ ç­›é€‰ï¼Œç„¶åç‚¹å‡» Scipt Editor å¤åˆ¶å…¶æŸ¥è¯¢è¯­å¥ Grafans åˆ° panelã€‚è®¾å®šå®Œæˆå Query inspector ç”Ÿæˆå¯¹åº”å›¾åƒç¤ºä¾‹ã€‚\nç„¶å å¼€å§‹çˆ¬æ•°æ® çœ‹çœ‹æ¸²æŸ“æ•ˆæœ\nå¯ä»¥çœ‹çœ‹å…¶ä»–å†™çš„æ¯”è¾ƒå¥½çš„ Grafana æ•™ç¨‹ æ•°æ®å¯¼å‡ºçš„æ’ä»¶ä¹Ÿæœ‰å¾ˆå¤šæ–¹ä¾¿çš„å®ç°ï¼Œä¾‹å¦‚ Prometheus æ­é…å„ç±» Exporter ç»Ÿè®¡æ•°æ®ï¼ŒPrometheus çš„æ˜¾ç¤ºå¯ä»¥ä½¿ç”¨ Grafana ç°æœ‰çš„ä»ªè¡¨ç›˜å¯¼å…¥prometheusçš„æ•°æ®èƒ½åšåˆ°è®¸å¤šç›‘æ§æ•ˆæœä¾‹å¦‚mysql ä¸»æœºè¿è¡ŒçŠ¶æ€ç­‰ç›‘æ§å‚æ•°ã€‚(åœ¨Prometheusçš„æ¶æ„è®¾è®¡ä¸­ï¼ŒPrometheus Serverå¹¶ä¸ç›´æ¥æœåŠ¡ç›‘æ§ç‰¹å®šçš„ç›®æ ‡ï¼Œå…¶ä¸»è¦ä»»åŠ¡è´Ÿè´£æ•°æ®çš„æ”¶é›†ï¼Œå­˜å‚¨å¹¶ä¸”å¯¹å¤–æä¾›æ•°æ®æŸ¥è¯¢æ”¯æŒã€‚å› æ­¤ä¸ºäº†èƒ½å¤Ÿèƒ½å¤Ÿç›‘æ§åˆ°æŸäº›ä¸œè¥¿ï¼Œå¦‚ä¸»æœºçš„CPUä½¿ç”¨ç‡ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°Exporterã€‚Prometheuså‘¨æœŸæ€§çš„ä»Exporteræš´éœ²çš„HTTPæœåŠ¡åœ°å€ï¼ˆé€šå¸¸æ˜¯/metricsï¼‰æ‹‰å–ç›‘æ§æ ·æœ¬æ•°æ®ã€‚)\nGrafana åœ¨å¾ˆå¤šåœ°æ–¹éƒ½æœ‰åº”ç”¨ï¼Œä¹Ÿè®¸ä»¥åè¿˜ä¼šæœ‰ç”¨åˆ°çš„æ—¶å€™ï¼Œæœ‰æœºä¼šå†åˆ†äº«å…³äºå®ƒçš„ç”¨æ³•çš„ã€‚\nå±äºæ˜¯è·‘é¢˜è·‘åäº†ğŸ˜‚ï¼Œæœ€å¼€å§‹åªæƒ³æ•´ä¸ªwslï¼Œç»“æœæåˆ°å®¹å™¨éƒ¨ç½² æ•°æ®åº“ å’Œèµ„æºç›‘æ§äº†ã€‚\n","id":7,"section":"posts","summary":"ä¹‹å‰å®‰è£…dockeræ—¶å€™æƒŠè®¶å…¶å±…ç„¶æœ‰windowsç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œå¿ƒæƒ³ docker ä¸æ˜¯é linuxå†…æ ¸å®ç°çš„èµ„æºæ§åˆ¶ç©ºé—´éš”ç¦»ä¹ˆï¼Œæ€ä¹ˆä¼šæœ‰windowsç‰ˆ","tags":["linux","å®¹å™¨"],"title":"WSL docker åˆæ¢","uri":"https://liangkang233.github.io/2022/05/wsl%E5%88%9D%E6%8E%A2/","year":"2022"},{"content":"æ¨èä¸€äº›ä¸ªäººè§‰å¾—æ¯”è¾ƒå¥½ç”¨çš„å·¥å…·\nè¯­éŸ³è¯†åˆ«å·¥å…· ä¹‹å‰ä¹Ÿåˆ†äº«è¿‡ç™¾åº¦aiæä¾›çš„apiçš„SDkï¼Œè™½ç„¶å…è´¹ ä½†æ˜¯ä¸å¤ªå¤Ÿç”¨ã€‚æ‰€ä»¥æ‰¾äº†æ‰¾æœ‰æ²¡æœ‰ç±»ä¼¼çš„æ›¿ä»£å“ã€‚è¿™ä¸ªé¡¹ç›®ä½¿ç”¨tensorFlow.kerasåŸºäºæ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œå’Œé•¿çŸ­æ—¶è®°å¿†ç¥ç»ç½‘ç»œã€æ³¨æ„åŠ›æœºåˆ¶ä»¥åŠCTCå®ç°ã€‚ ASRT star æ•°å¾ˆå¤šï¼Œçœ‹èµ·æ¥ä¹ŸæŒºå¥½ç”¨çš„ã€‚\nè¯¥å·¥å…·åŸç†å³ è°ƒç”¨æ·±åº¦å­¦ä¹ è®­ç»ƒçš„ DCNN + CTC å£°å­¦æ¨¡å‹ å°†è¯­éŸ³æ¨¡æ‹Ÿä¿¡å·æ•°æ®ç”Ÿæˆæ‹¼éŸ³åºåˆ— å†åˆ©ç”¨ ç»Ÿè®¡è¯­è¨€æ¨¡å‹ ç”Ÿæˆæ–‡å­—ã€‚\næä¾›äº†ä¸€ä¸ª demo é¡µé¢ä»¥åŠå¯¹åº”çš„ sdk å¯¹åº”è°ƒç”¨å…¶ç½‘ç«™åç«¯çš„è¯†åˆ« api ä¾›å¼€å‘(apiæ¥å£è¯´æ˜)ã€‚åŒæ—¶ä¹Ÿå¾ˆè´´å¿ƒçš„å‡†å¤‡äº†å½•éŸ³å·¥å…· dockerfile æ¥ç”Ÿæˆé•œåƒç›´æ¥éƒ¨ç½²æ‰§è¡Œã€‚\nå¦‚æœæƒ³è‡ªå·±æ”¹è¿›ç®—æ³•æˆ–è®­ç»ƒæ¨¡å‹ï¼Œéœ€è¦æ•°æ®é›† å¼€æºçš„ä¸­æ–‡è¯­éŸ³æ•°æ®é›† å’Œæœ€ä½è¦æ±‚ 1080tiçš„æ˜¾å¡ï¼Œæˆ‘ç›´æ¥å¼€æ‘†ğŸƒâ€ğŸƒâ€ï¼Œå¥½åœ¨ Release å‹ç¼©åŒ…å†…åŒ…å«è®­ç»ƒå¥½çš„è¯­éŸ³æ¨¡å‹ï¼Œç›´æ¥æ‹¿æ¥ç”¨å§ã€‚\n# å®‰è£…ç¯å¢ƒ pip install -r requirements.txt éƒ¨åˆ†æ–‡ä»¶åŠŸèƒ½ä»‹ç» ASRT_v1.2.0\u0026gt;:. â”‚ asrserver.py # å¯ç”¨httpåå°æœåŠ¡å™¨ å¯¹åº” client.py â”‚ asrserver_http.py # å¯ç”¨flask æ¡†æ¶çš„ restful é£æ ¼ çš„ httpåå°æœåŠ¡å™¨ å¯¹åº” client_http.py â”‚ asrt_config.json # æ•°æ®é›†å¯¹åº”ä½ç½®é…ç½® â”‚ speech_model.py # å£°å­¦æ¨¡å‹åŸºç¡€åŠŸèƒ½æ¨¡æ¿å®šä¹‰ â”‚ speech_model_zoo.py # å£°å­¦æ¨¡å‹æ¨¡å‹çš„å®ç° â”‚ speech_recorder.py # ä¸€ä¸ªé…ç½®ä¸ºå¯ç”¨äºASRTè¯­éŸ³è¯†åˆ«ç³»ç»Ÿçš„å½•éŸ³ç¨‹åº | dict.txt # éŸ³æ ‡å¯¹åº”æ–‡å­— å­—å…¸ | â”œâ”€assets â”‚ default.html â”‚ â”œâ”€model_language # ç»Ÿè®¡è¯­è¨€æ¨¡å‹ â”‚ dic_pinyin.txt â”‚ language_model1.txt â”‚ language_model2.txt â”‚ â”œâ”€save_models # è¯­éŸ³è¯†åˆ«è®­ç»ƒæ¨¡å‹ h5å¯è§†åŒ– å¯ä»¥ç”¨ vitables python ç¨‹åºæµè§ˆå±‚æ¬¡åŒ–æ•°æ® â”‚ SpeechModel251bn.model.base.h5 â”‚ SpeechModel251bn.model.h5 pip install pywin pipwin install pyaudio python3 speech_recorder.py # å³å¯å½•åˆ¶å£°éŸ³ é»˜è®¤æ˜¯output.wavæ–‡ä»¶ å®‰è£… pyaudio åŒ…å¦‚æœæŠ¥é”™å¯ä»¥ä½¿ç”¨pipwinæ¥å®‰è£… ï¼ˆwindowsç¼ºå°‘å¯¹åº”ç¼–è¯‘æ‰“åŒ…ç¯å¢ƒï¼‰å‚è€ƒstackoverflowå›ç­”ï¼‰\n# å¦‚ä¸‹ä¼šè¯†åˆ«å½“å‰ç›®å½•ä¸‹çš„ filename.wav python3 predict_speech_file.py æµ‹è¯•è¯­éŸ³ï¼šäºŒæ¯›ä½ ä»Šå¤©æ²’è¯¾å˜›è¿˜å’ŒæéœèŠå¤©\næ–‡æ¡£è¯´çš„80%æ­£ç¡®ç‡çœ‹æ¥ä¸æ˜¯è°¦è™šğŸ˜‚ è½¬æ‹¼éŸ³è¯†åˆ«ç‡ä¸é”™ å°±æ˜¯è½¬è¯­å¥ä»éœ€è®­ç»ƒ\nåŸºæœ¬æµ‹è¯•å®Œæ¯•åå°±å¯ä»¥è¿›è¡Œæ”¹é€ å’Œè°ƒç”¨äº†ã€‚\nMDè½¬æ¢å·¥å…· markdown æ‹¿æ¥å†™æ‰‹å†Œåšè®°å½•è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œæ’ç‰ˆç®€æ´ è¯­æ³•ç®€å•ã€‚\næŸæ¬¡åˆ†äº«è®°å½•æ—¶ï¼Œå¯¹æ–¹æ²¡æœ‰MDé˜…è¯»è½¯ä»¶ï¼Œæƒ³ç”¨ Typora å¯¼å‡ºpdfæˆ–htmlæ ¼å¼çš„æ–‡ä»¶åˆ†äº«ç»™å…¶ä»–äººï¼Œå¯æƒœæ ¼å¼ä¸å¤ªå¥½çœ‹ã€‚\ngithubä¸Šæ‰¾äº†æ‰¾ï¼Œæ‰¾åˆ°ä¸ªè½»é‡ç®€å•çš„ MDæ–‡æ¡£è½¬htmlæ ¼å¼çš„ å°å·¥å…· MDcatï¼Œå…¶htmlæ¨¡æ¿ä¹Ÿå¯ä»¥ä¿®æ”¹ç”Ÿæˆçš„htmlå…·æœ‰é»‘æš—æ¨¡å¼ï¼Œæ”¯æŒè¯­æ³•é«˜äº®ã€‚å¯¼å‡º\nçœ‹äº†ä¸‹æºç  æ˜¯ç›´æ¥è°ƒç”¨åƒ githubçš„ https://api.github.com/markdown æ¥å£å‘é€postè¯·æ±‚ç”Ÿæˆçš„htmlã€‚ç”Ÿæˆçš„ html æ¸²æŸ“é£æ ¼å’Œ github ä¸€æ ·ã€‚\nè¿™ä¸ç›´æ¥cloneè¯•è¯•å¥½ä¸å¥½ç”¨ã€‚\næ‰§è¡Œä¸»æ–‡ä»¶ç›´æ¥ç”Ÿæˆåœ¨å½“å‰ç›®å½•\npython3 mdcat.py mdæ–‡ä»¶å # æ³¨æ„å…³é—­ç½‘ç»œä»£ç† æ•ˆæœè¿˜ä¸é”™ï¼Œæ¨èã€‚\n","id":8,"section":"posts","summary":"æ¨èä¸€äº›ä¸ªäººè§‰å¾—æ¯”è¾ƒå¥½ç”¨çš„å·¥å…· è¯­éŸ³è¯†åˆ«å·¥å…· ä¹‹å‰ä¹Ÿåˆ†äº«è¿‡ç™¾åº¦aiæä¾›çš„apiçš„SDkï¼Œè™½ç„¶å…è´¹ ä½†æ˜¯ä¸å¤ªå¤Ÿç”¨ã€‚æ‰€ä»¥æ‰¾äº†æ‰¾æœ‰æ²¡æœ‰ç±»ä¼¼çš„æ›¿ä»£å“ã€‚è¿™ä¸ª","tags":["python"],"title":"å·¥å…·æ¨èï¼šè¯­éŸ³è¯†åˆ« MDè½¬æ¢","uri":"https://liangkang233.github.io/2022/04/%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB/","year":"2022"},{"content":"åˆ·é¢˜æ—¶æ€»æ˜¯å†™äº†åˆå¿˜ï¼Œæ‰€ä»¥ä¸“é—¨æ•´ç†äº†ä¸€ä¸ªé¢˜ç›®è®°å½•æœ¬ã€‚\nåˆ·é¢˜è®°å½•æœ¬\nåšåˆ° äºŒåˆ†ç®—æ³• çš„ä¸“é¢˜æ—¶ï¼Œå¯¹äºå…¶è¾¹ç•Œçš„å¤„ç†éå¸¸æ£˜æ‰‹ã€‚æ‰€ä»¥å†™äº†è¿™ç¯‡åšå®¢å¯¹äºŒåˆ†çš„å®ç°ã€åº”ç”¨è¿›è¡Œä¸€ä¸ªå…¨é¢çš„æ€»ç»“ã€‚\næ ‡å‡†äºŒåˆ† int binarySearch(Element array[], int len, int key){ int low = 0, high = len - 1, middle; while(low \u0026lt;= high){ middle = (low + high) / 2; if(array[middle] == key){ //æ‰¾åˆ°,è¿”å›ä¸‹æ ‡ç´¢å¼•å€¼ return middle; }else if(array[middle] \u0026gt; key){ //æŸ¥æ‰¾å€¼åœ¨ä½åŠåŒº high = middle - 1; }else{ //æŸ¥æ‰¾å€¼åœ¨é«˜åŠåŒº low = middle + 1; } } return -1; //æ‰¾ä¸åˆ° } è¯´å®è¯ è¿™æ ·åšæ‰©å±•æ€§ä¸å¥½ï¼Œä¸æ¨èè¿™ä¹ˆå†™\næ‰©å±•æ€§å¼ºçš„ äºŒåˆ† æŒ‰ç…§ std upper_bound lower_bound åº“çš„æ•ˆæœè®¾è®¡çš„äºŒåˆ†å‡½æ•°\nmylower_bound å¯»æ‰¾æ•°ç»„ä¸­ ç¬¬ä¸€ä¸ªå¤§äºç­‰äº ç›®æ ‡å€¼çš„ ä¸‹æ ‡\n// last åˆå§‹å€¼ = sizeæ—¶ targetè¶…å‡ºä¸Šé™èŒƒå›´ä¼šè¿”å› endä¸‹æ ‡ int mylower_bound(int* array ,int size,int key){ int first = 0, middle ,last = size-1; while(first\u0026lt;last){ middle = (first+last) \u0026gt;\u0026gt; 1; if(array[middle] \u0026lt; key ) //å½“middleå°äºè¦æ‰¾çš„ä½ç½® ï¼Œ first +1 ä¹Ÿä¸ä¼šè¶…è¿‡keyçš„ä½ç½®ï¼Œæœ€å¤šç›¸åŒ first = middle + 1; else last = middle ; //middleæœ‰å¯èƒ½ç­‰äºè¦æ‰¾çš„ä½ç½® ï¼Œ last = middle ï¼Œ ç”¨firstä¸æ–­é€¼è¿‘ } return first; } myupper_bound å¯»æ‰¾æ•°ç»„ä¸­ ç¬¬ä¸€ä¸ªå¤§äº ç›®æ ‡å€¼çš„ ä¸‹æ ‡\n// last åˆå§‹å€¼ = size æ—¶ targetè¶…å‡ºä¸Šé™èŒƒå›´ä¼šè¿”å› endä¸‹æ ‡ int myupper_bound(int* array ,int size,int key){ int first = 0, middle ,last = size-1; while(first\u0026lt;last){ middle = (first+last) \u0026gt;\u0026gt; 1; if(array[middle] \u0026lt;= key ) //æ­¤æ—¶çš„middleä¸€å®šå¤§äºè¦æ‰¾çš„ä½ç½®ã€‚ç”¨firstä¸æ–­é€¼è¿‘ first = middle +1; //å½“middleç­‰äºè¦æ‰¾çš„ä½ç½®ï¼Œ æˆ‘ä»¬è®°å½•first = middle+1 else last = middle ; } return first; } å®é™…ä½¿ç”¨ 35.æœç´¢æ’å…¥ä½ç½®\n// è¿™ä¸ªæ ‡å‡†äºŒåˆ†çš„æ”¹ç‰ˆ ç­‰ä»·æ±‚å‡º lower_bound å†™æ³•é£æ ¼ä¸åŒï¼Œæ•ˆæœä¸€æ ·çš„ class Solution { public: int searchInsert(vector\u0026lt;int\u0026gt;\u0026amp; nums, int target) { int l = 0, r = nums.size()-1; while(l \u0026lt;= r) { int mid = (l + r) \u0026gt;\u0026gt; 1; if(nums[mid] \u0026lt; target) l = mid+1; else r = mid-1; } return l; } }; stdåº“å‡½æ•° è‡ªå®šä¹‰ å¼•å…¥å¤´æ–‡ä»¶ #include \u0026lt;algorithm\u0026gt; å³å¯ä½¿ç”¨\nä»¥ä¸‹é¢çš„å®é™…ä½¿ç”¨ä¸¾ä¾‹ è¯´æ˜ åº“å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•\næ³¨æ„è‡ªå®šä¹‰ æ¯”è¾ƒå‡½æ•° ä¸¤è€…çš„åŒºåˆ« ï¼Œä½¿ç”¨ upper_bound lower_bound\nå¯¹äºåŒä¸€å‚æ•° æ˜¯ä¸éœ€è¦ä¿®æ”¹æ¯”è¾ƒå‡½æ•°çš„ï¼Œéƒ½æ˜¯ return i \u0026lt; j;\n#include \u0026lt;iostream\u0026gt; // std::cout #include \u0026lt;algorithm\u0026gt; // std::upper_bound #include \u0026lt;vector\u0026gt; // std::vector using namespace std; //ä»¥æ™®é€šå‡½æ•°çš„æ–¹å¼å®šä¹‰æŸ¥æ‰¾è§„åˆ™ ç­‰ä»·operator bool mycomp(int i, int j) { return i \u0026gt; j; } auto mycomp1 = [](int i, int j)-\u0026gt;bool { return i \u0026gt; j; }; class mycomp2 { public: bool operator()(const int\u0026amp; i, const int\u0026amp; j) { return i\u0026lt;j; } }; int main() { int x = 1; int a[5] = {3,7,9,12,15}; // è‹¥æ˜¯è¾“å…¥æŒ‡é’ˆåˆ™ æ³¨æ„ä¸èƒ½è¶…å‡ºæ•°ç»„æœ‰æ•ˆèŒƒå›´ æ²¡æœ‰é‚£ä¸ªendå±æ€§ æŸ¥æ‰¾å¤§äºæ•°ç»„æœ€å¤§å€¼æ—¶è¿”å›çš„ä¹Ÿæ˜¯æœ€åä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ // è¿”å›å€¼æ˜¯å¯¹åº”å…ƒç´ çš„ä¸‹æ ‡æˆ–è¿­ä»£å™¨ æ‰¾ä¸åˆ°å¯¹åº”å€¼æ—¶ä¼šè¿”å› vector.end() int *p = upper_bound(a, a + 4, x); cout \u0026lt;\u0026lt; \u0026quot;*p = \u0026quot; \u0026lt;\u0026lt; *p \u0026lt;\u0026lt; endl; p = lower_bound(a, a + 4, x); cout \u0026lt;\u0026lt; \u0026quot;*p = \u0026quot; \u0026lt;\u0026lt; *p \u0026lt;\u0026lt; endl; // ä»¥å‡½æ•°å¯¹è±¡çš„å½¢å¼å®šä¹‰æŸ¥æ‰¾è§„åˆ™ jä¸ºå®¹å™¨éå†å€¼ iä¸ºè¾“å…¥çš„æŸ¥æ‰¾å€¼ // lowæ˜¯æ‰¾å‡ºå¤§äºç­‰äºæŒ‡å®šå€¼ï¼Œå³æ‰¾å‡ºi\u0026gt;=jæ‰åœ iæ˜¯éå†å€¼ å‡½æ•°å†…ä¸æˆç«‹è·³å‡ºå¾ªç¯ vector\u0026lt;int\u0026gt; myvector{ 1,2,3,4,5 }; vector\u0026lt;int\u0026gt;::iterator iter = upper_bound(myvector.begin(), myvector.end(), x, mycomp2()); if(iter==myvector.end()) cout \u0026lt;\u0026lt; \u0026quot;error\u0026quot;\u0026lt;\u0026lt;endl; else cout \u0026lt;\u0026lt; \u0026quot;*iter = \u0026quot; \u0026lt;\u0026lt; *iter; // uperæ‰¾å‡ºå¤§äºæŒ‡å®šå€¼ï¼Œå³æ‰¾å‡ºj\u0026gt;iæ‰åœ jæ˜¯éå†å€¼ å‡½æ•°å†…æˆç«‹è·³å‡ºå¾ªç¯ // ä»¥å‡½æ•°å¯¹è±¡çš„å½¢å¼å®šä¹‰æŸ¥æ‰¾è§„åˆ™ iä¸ºå®¹å™¨éå†å€¼ jä¸ºè¾“å…¥çš„æŸ¥æ‰¾å€¼ vector\u0026lt;int\u0026gt;::iterator iter1 = upper_bound(myvector.begin(), myvector.end(), x, mycomp2()); if(iter1==myvector.end()) cout \u0026lt;\u0026lt; \u0026quot;error\u0026quot;\u0026lt;\u0026lt;endl; else cout \u0026lt;\u0026lt; \u0026quot;*iter1 = \u0026quot; \u0026lt;\u0026lt; *iter1; return 0; } äºŒç»´å®¹å™¨ æ³¨æ„ç‚¹: int target = 1; vector\u0026lt;vector\u0026lt;int\u0026gt;\u0026gt; myvector{{1,3,5,7}, {10,11,16,20}, {23,30,34,60}}; //ç¬¬äºŒä¸ªå½¢å‚ä¸è®¾constä¼šæŠ¥é”™ auto row = [](const vector\u0026lt;int\u0026gt;\u0026amp; a, const vector\u0026lt;int\u0026gt;\u0026amp; b) {return a[0] \u0026lt; b[0];}; //ç›®æ ‡å€¼ä¸€å®šè¦ä¸éå†å…ƒç´ ç±»å‹ç›¸åŒï¼Œæ­¤å¤„ç›®æ ‡å€¼è½¬ä¸º ä¸€ç»´å®¹å™¨ vector\u0026lt;vector\u0026lt;int\u0026gt;\u0026gt;::iterator iter = lower_bound(myvector.begin(), myvector.end(), vector\u0026lt;int\u0026gt;{target}, row); ç»ƒä¹  74.æœç´¢äºŒç»´çŸ©é˜µ class Solution { public: // ä»¥ç¬¬ä¸€åˆ—å³è¡Œé¦–ä¸ºç›®æ ‡äºŒåˆ† åå¯¹è¯¥è¡Œè¿›è¡Œåˆ—äºŒåˆ† bool searchMatrix(vector\u0026lt;vector\u0026lt;int\u0026gt;\u0026gt;\u0026amp; matrix, int target) { auto row = [](const vector\u0026lt;int\u0026gt;\u0026amp; a, const vector\u0026lt;int\u0026gt;\u0026amp; b) {return a[0] \u0026lt; b[0];}; // æ³¨æ„ç¬¬äºŒä¸ªå½¢å‚ä¸€å®šè¦ const å»ºè®®å…¨éƒ¨å†™æˆconst, ç¬¬ä¸‰ä¸ªæ¯”è¾ƒå‚æ•°çš„ç±»å‹è¦ä¸å‰é¢å®¹å™¨å…ƒç´ ç±»å‹ä¸€è‡´ å³target è¦ä»int -\u0026gt; vector auto it = upper_bound(matrix.begin(), matrix.end(), vector\u0026lt;int\u0026gt;{target}, row); int index = distance(matrix.begin(), it); // ä»¥è¡Œé¦–äºŒåˆ† å¯»æ‰¾ç¬¬ä¸€ä¸ªå¤§äº target å€¼ æ²¡æ‰¾åˆ°è¿”å›çš„itä¸ºend index--; if(index \u0026lt; 0) return false; auto it1 = lower_bound(matrix[index].begin(), matrix[index].end(), target); // å¯¹è¯¥è¡Œè¿›è¡Œåˆ—çš„äºŒåˆ†æŸ¥æ‰¾ return it1 != matrix[index].end() \u0026amp;\u0026amp; *it1 == target; } }; 240.æœç´¢äºŒç»´çŸ©é˜µII // 74é¢˜è¿›é˜¶ï¼Œç”±é¢˜æ„ ä»»æ„åæ ‡å³ä¸‹æ–¹ å…¨éƒ¨å¤§äºç­‰äºè¯¥åæ ‡å€¼ å·¦ä¸Šæ–¹å…¨éƒ¨å°äºç­‰äºè¯¥å€¼ æ—¶é—´å¤æ‚åº¦O(logm + logn) // æ‰€ä»¥å…ˆå¯¹ç¬¬ä¸€è¡Œåˆ—äºŒåˆ†åˆ é™¤å¤šä½™å¤§äºtargetçš„åˆ— å†è¡ŒäºŒåˆ†åˆ é™¤å°äºtargetçš„è¡Œ ä¸æ–­è¿­ä»£ä¸‹å» class Solution { public: int myupper_bound(vector\u0026lt;vector\u0026lt;int\u0026gt;\u0026gt;\u0026amp; matrix, int row, int column, int target) { int L = 0, R = column + 1; while (L \u0026lt; R) { int mid = (L + R) \u0026gt;\u0026gt; 1; if(matrix[row][mid] \u0026lt;= target) L = mid+1; else R = mid; } return L; } int mylower_bound(vector\u0026lt;vector\u0026lt;int\u0026gt;\u0026gt;\u0026amp; matrix, int row, int column, int target) { int L = row, R = matrix.size(); while (L \u0026lt; R) { int mid = (L + R) \u0026gt;\u0026gt; 1; if(matrix[mid][column] \u0026lt; target) L = mid+1; else R = mid; } return L; } bool searchMatrix(vector\u0026lt;vector\u0026lt;int\u0026gt;\u0026gt;\u0026amp; matrix, int target) { // æœ‰æ•ˆèŒƒå›´ è¡Œä¸º row-\u0026gt;matrix.end()-1 åˆ—ä¸º 0-cloumn int row = 0, column = matrix[0].size()-1; while (1) { // stdåº“åšæ³• // auto it = upper_bound(matrix[row].begin(), matrix[row].begin()+column+1, target); // if(it == matrix[row].begin()) // break; // column = distance(matrix[row].begin(), it) - 1; // column å³è¾¹åˆ å» column = myupper_bound(matrix, row, column, target) - 1; // column å³è¾¹åˆ å» if(column \u0026lt; 0) //target æ¯”èŒƒå›´å†…æœ€å°å€¼è¿˜å° break; row = mylower_bound(matrix, row, column, target); if(row == matrix.size()) //target æ¯”èŒƒå›´å†…æœ€å¤§å€¼è¿˜å¤§ break; if(matrix[row][column] == target) return true; } return false; } }; 410.åˆ†å‰²æ•°ç»„çš„æœ€å¤§å€¼ class Solution { public: // äºŒåˆ†æ³• ç»äº† bool isok(vector\u0026lt;int\u0026gt;\u0026amp; nums, int mid, int m) { int count = 1, temp = 0; for(auto num : nums) { if ( temp + num \u0026lt;= mid) temp += num; else { temp = num; count ++; } } return count \u0026gt; m; } int splitArray(vector\u0026lt;int\u0026gt;\u0026amp; nums, int m) { int L = -1,R = 0, mid; // Lä¸ºæ•´ä¸ªæ•°ç»„çš„æœ€å¤§å€¼ Rä¸ºæ•´ä¸ªæ•°ç»„çš„æ€»å’Œ åˆ†å‰²çš„å­æ•°ç»„å’Œçš„æœ€å¤§å€¼ å–å€¼èŒƒå›´å³åœ¨L Rä¹‹ä¸­ // ç”±äºåˆ†å‰²æ¬¡æ•° m å’Œ åˆ†å‰²å­æ•°ç»„å’Œçš„æœ€å¤§å€¼ æˆçº¿æ€§è´Ÿç›¸å…³ å…³ç³» æ‰€ä»¥å¯ä»¥é‡‡ç”¨äºŒåˆ†çš„æ–¹æ³• é è¿‘æµ‹è¯• for (auto num : nums) { L = max(L, num); R += num; } while(L \u0026lt; R) { mid = (L + R)/2; if(isok(nums, mid, m)) L = mid+1; else R = mid; } return L; // L==R } }; ","id":9,"section":"posts","summary":"åˆ·é¢˜æ—¶æ€»æ˜¯å†™äº†åˆå¿˜ï¼Œæ‰€ä»¥ä¸“é—¨æ•´ç†äº†ä¸€ä¸ªé¢˜ç›®è®°å½•æœ¬ã€‚ åˆ·é¢˜è®°å½•æœ¬ åšåˆ° äºŒåˆ†ç®—æ³• çš„ä¸“é¢˜æ—¶ï¼Œå¯¹äºå…¶è¾¹ç•Œçš„å¤„ç†éå¸¸æ£˜æ‰‹ã€‚æ‰€ä»¥å†™äº†è¿™ç¯‡åšå®¢å¯¹äºŒåˆ†çš„å®ç°ã€åº”","tags":["C/C++","ç®—æ³•"],"title":"äºŒåˆ†å°ç»“","uri":"https://liangkang233.github.io/2022/04/%E4%BA%8C%E5%88%86%E5%B0%8F%E7%BB%93/","year":"2022"},{"content":"å‘ç°ä¸€ä¸ªç®€æ˜“çš„ä½¿ç”¨qqæ¨é€æ¶ˆæ¯çš„å·¥å…·ï¼ŒåŸæœ¬æ‰“ç®—ç”¨æ¥åšç½‘ç›˜çš„æé†’åŠ©æ‰‹ï¼Œæœ€åæ”¾å¼ƒäº†ã€‚\nä¸è¿‡æ„Ÿè§‰è¿™ä¸ªç©å…·æŒºå¥½ç©çš„ï¼Œåšä¸ªè®°å½•ã€‚\nQmsgé¦–é¡µ qqç™»å½•å³æ³¨å†Œqmsgçš„è´¦å·æ·»åŠ å¯¹åº”è´¦å·æœºå™¨äººï¼Œè·å–keyä¹‹åå°±å¯ä»¥ç”¨å®ƒåšæ¶ˆæ¯çš„æé†’ã€‚\næ–‡æ¡£å†™çš„å¾ˆç®€å• å°±åšä¸€ä¸ªget/postè¯·æ±‚å³å¯\nç”¨goæ¥å°è£… httpè¯·æ±‚ æ¨¡æ‹Ÿhttpè¯·æ±‚åœ¨çº¿æµ‹è¯•å·¥å…·\nå¤ä¹ ç›¸å…³çŸ¥è¯† ï¼ˆå¯ä»¥ç›´æ¥è·³è¿‡ï¼‰ Go çš„ HTTP æ ‡å‡†åº“-åŸºæœ¬å·¥ä½œåŸç†\nå½“ç„¶ç®€å•çš„æ“ä½œï¼Œå¯ä»¥ç›´æ¥ç”¨curl to goå°†curlå‘½ä»¤è¡Œè½¬æ¢ä¸ºå¯¹åº”goä»£ç \ngo httpåŒ… æœ‰ç®€æ˜“çš„ get postï¼Œè‹¥æ˜¯å‘é€è¾ƒé•¿çš„æ•°æ® æ¨èä½¿ç”¨postformå‘é€è¡¨å• æˆ–è€…è½¬ä¸ºjsonæ•°æ®postæŒ‡å®šjsonæ ¼å¼å‘é€\nä»¥ä¸‹æ˜¯é€šè¿‡postå‘é€è¡¨å•å’Œè§£æjsonæ•°æ®çš„ç¤ºä¾‹ä»£ç \næ³¨æ„ æ¥æ”¶çš„resp.Bodyä¸è¦å¿˜è®°å…³é—­\nå®ç° package main import ( \u0026quot;encoding/json\u0026quot; \u0026quot;log\u0026quot; \u0026quot;net/http\u0026quot; \u0026quot;net/url\u0026quot; \u0026quot;strings\u0026quot; \u0026quot;time\u0026quot; ) const key = \u0026quot;***\u0026quot; // ç”³è¯·çš„key const url1 = \u0026quot;https://qmsg.zendee.cn/send/\u0026quot; // ç§èŠæ¶ˆæ¯æ¨é€æ¥å£ï¼š // const ur2 =\u0026quot;https://qmsg.zendee.cn/group/\u0026quot; // ç¾¤æ¶ˆæ¯æ¨é€æ¥å£ï¼š type infodetail struct { Lmyidc string } type QmsgResult struct { Reason string Success bool Code int // Info interface{}\t//åµŒå¥—ç±»å‹jsonæš‚ä¸å¤„ç†ç›´æ¥ç»™æ­¤ç±»å‹ ç­‰ä»·ä¸ºmap[string] interface{} Info infodetail } func main() { log.SetFlags(log.Ldate | log.Lshortfile) myurl := url1 + key client := \u0026amp;http.Client{Timeout: time.Second * 15} params := url.Values{} params.Add(\u0026quot;msg\u0026quot;, \u0026quot;æœ‰æ²¡æœ‰è¿™ä¹ˆä¸€ç§å¯èƒ½@face=172@\u0026quot;) // params.Add(\u0026quot;msg\u0026quot;, \u0026quot;è§£æjsonæµ‹è¯•@face=177@\u0026quot;) params.Add(\u0026quot;key2\u0026quot;, `value:2`) body := strings.NewReader(params.Encode()) resp, err := client.Post(myurl, \u0026quot;application/x-www-form-urlencoded\u0026quot;, body) if err != nil { log.Println(err) } defer resp.Body.Close() DataPrint(resp) } func DataPrint(resp *http.Response) { if resp.StatusCode != http.StatusOK { log.Printf(\u0026quot;http response failed: %s\\n\u0026quot;, resp.Status) } var result QmsgResult if err := json.NewDecoder(resp.Body).Decode(\u0026amp;result); err != nil { //åº•å±‚unmarshal log.Println(err) } log.Println(result.Reason, result.Code, result.Info.Lmyidc, result.Success) } æµ‹è¯•æ— è¯¯ååªéœ€è¦å°†è¿™ä¸€å°æ®µåµŒå…¥åˆ°ä¸šåŠ¡ä»£ç å³å¯ï¼Œ\nå¾ˆå¤šäººç”¨æ³•æ˜¯å†™æˆjsæ’ä»¶åšåˆ°å‰ç«¯é¡µé¢ä¾‹å¦‚åšå®¢çš„è¯„è®ºåŒºå›å¤æé†’ç­‰ åŸºäºLeancloudæˆ–javascriptæ¨é€Valineè¯„è®º\nå…¶ä»–å¤‡å¿˜ get postç”¨æ³•\npackage main import ( \u0026quot;fmt\u0026quot; \u0026quot;io/ioutil\u0026quot; \u0026quot;log\u0026quot; \u0026quot;net/http\u0026quot; \u0026quot;os\u0026quot; ) const url = \u0026quot;https://baidu.com\u0026quot; func main() { // æ–¹å¼ä¸€ï¼Œç›´æ¥é€šè¿‡ Get å‡½æ•° resp, err := http.Get(url) ErrPrint(err) defer resp.Body.Close() // æ‹¿åˆ°æ•°æ® bytes, err := ioutil.ReadAll(resp.Body) ErrPrint(err) // è¿™é‡Œè¦æ ¼å¼åŒ–å†è¾“å‡ºï¼Œå› ä¸º ReadAll è¿”å›çš„æ˜¯å­—èŠ‚åˆ‡ç‰‡ fmt.Println(\u0026quot;------------- æ–¹æ³•ä¸€ ---------------\u0026quot;) fmt.Printf(\u0026quot;%s\u0026quot;, bytes) // æ–¹å¼äºŒï¼Œé€šè¿‡ client ç»“æ„ä½“çš„ Get æ–¹æ³• // client := new(http.Client) ç­‰ä»·ä¸‹å¼ client := \u0026amp;http.Client{} resp, err = client.Get(url) ErrPrint(err) defer resp.Body.Close() res, err := ioutil.ReadAll(resp.Body) ErrPrint(err) fmt.Println(\u0026quot;\\n\\n\\n------------- æ–¹æ³•äºŒ ---------------\u0026quot;) fmt.Printf(\u0026quot;%s\u0026quot;, res) } func ErrPrint(err error) { if err != nil { log.Fatalln(err) os.Exit(1) } } post æ™®é€šå­—ä¸² jsonç”¨æ³•\n/* post client */ package main import ( \u0026quot;encoding/json\u0026quot; \u0026quot;fmt\u0026quot; \u0026quot;io\u0026quot; \u0026quot;io/ioutil\u0026quot; \u0026quot;log\u0026quot; \u0026quot;net/http\u0026quot; \u0026quot;os\u0026quot; \u0026quot;strings\u0026quot; ) // jsonåŒ…è§£æå˜é‡åªèƒ½è§£æé¦–å­—æ¯å¤§å†™çš„ type Mytest struct { Type int Desc string Name string UserId string } const url = \u0026quot;http://localhost:8080/hello\u0026quot; func main() { // æ–¹å¼ä¸€ï¼Œç›´æ¥é€šè¿‡ Post å‡½æ•° fmt.Println(\u0026quot;------------- æ–¹æ³•ä¸€ ---------------\u0026quot;) resp, err := http.Post(url, \u0026quot;application/x-www-form-urlencoded\u0026quot;, strings.NewReader(\u0026quot;name=Bro Qiang\u0026quot;)) ErrPrint(err) defer resp.Body.Close() DataPrint(resp.Body) // æ–¹å¼äºŒï¼Œé€šè¿‡ client ç»“æ„ä½“ä¸­çš„ Post æ–¹æ³• fmt.Println(\u0026quot;------------- æ–¹æ³•äºŒ ---------------\u0026quot;) client := \u0026amp;http.Client{} resp, err = client.Post(url, \u0026quot;application/x-www-form-urlencoded\u0026quot;, strings.NewReader(\u0026quot;name=New Bro Qiang\u0026quot;)) ErrPrint(err) defer resp.Body.Close() DataPrint(resp.Body) // æ–¹å¼ä¸€å‘é€json fmt.Println(\u0026quot;------------- æ–¹æ³•ä¸€json ---------------\u0026quot;) info := Mytest{ Type: 1, UserId: \u0026quot;lsj\u0026quot;, Name: \u0026quot;lk233\u0026quot;, Desc: \u0026quot;test_UserInfo\u0026quot;, } bytes, _ := json.Marshal(info) resp, err = http.Post(url, \u0026quot;application/json\u0026quot;, strings.NewReader(string(bytes))) if err != nil { log.Println(\u0026quot;query info failed\u0026quot;, err.Error()) } defer resp.Body.Close() DataPrint(resp.Body) } func DataPrint(body io.ReadCloser) { bytes, err := ioutil.ReadAll(body) ErrPrint(err) fmt.Printf(\u0026quot;%s\u0026quot;, bytes) } func ErrPrint(err error) { if err != nil { log.Fatalln(err) os.Exit(1) } } /* get çš„serverä¸ post serverç±»ä¼¼ æ·»åŠ  ä¸‹é¢çš„ç±»ä¼¼æ¨¡å— if req.Method == \u0026quot;GET\u0026quot; { err := req.ParseForm() if err != nil { http.Error(w, http.StatusText(http.StatusInternalServerError), http.StatusInternalServerError) return } for k, v := range req.Form { } */ /* post_server */ package main import ( \u0026quot;encoding/json\u0026quot; \u0026quot;fmt\u0026quot; \u0026quot;io/ioutil\u0026quot; \u0026quot;log\u0026quot; \u0026quot;net/http\u0026quot; ) type Mytest struct { Type int Desc string UserId string Name string } func main() { http.HandleFunc(\u0026quot;/hello\u0026quot;, func(w http.ResponseWriter, req *http.Request) { if req.Method == \u0026quot;POST\u0026quot; { // if req.Context() // fmt.Fprintf(w,\u0026quot;Hello %s\\n\u0026quot;,req.FormValue(\u0026quot;name\u0026quot;)) æ­¤å‡½æ•°å¯ä»¥ç›´æ¥è·å–å¯¹åº”é”®å€¼ åº•å±‚å®é™…ä¹Ÿæ˜¯è°ƒç”¨ ParseForm err := req.ParseForm() if err != nil { http.Error(w, http.StatusText(http.StatusInternalServerError), http.StatusInternalServerError) return } // fmt.Println(req.Header[\u0026quot;Content-Type\u0026quot;][0]) if req.Header[\u0026quot;Content-Type\u0026quot;][0] == \u0026quot;application/x-www-form-urlencoded\u0026quot; { formData := req.Form fmt.Fprintf(w, \u0026quot;Hello %s\\n\u0026quot;, formData.Get(\u0026quot;name\u0026quot;)) } else { //postæ•°æ®æ˜¯jsonéœ€è¦å…¶ä»–å¤„ç† body, _ := ioutil.ReadAll(req.Body) // read reqä¹‹å reqçš„å…¶ä»–è§£æå…¨ä¸ºç©º myjson := Mytest{} if json.Unmarshal(body, \u0026amp;myjson) != nil { fmt.Fprintf(w, \u0026quot;error json\\n\u0026quot;) } else { fmt.Fprintf(w, \u0026quot;json Hello %s\\n\u0026quot;, myjson.Name) } } return } http.NotFound(w, req) }) log.Fatalf(\u0026quot;%v\u0026quot;, http.ListenAndServe(\u0026quot;localhost:8080\u0026quot;, nil)) } postformç”¨æ³•\n/* postform server */ package main import ( \u0026quot;fmt\u0026quot; \u0026quot;log\u0026quot; \u0026quot;net/http\u0026quot; ) func main() { http.HandleFunc(\u0026quot;/form\u0026quot;, MyForm) log.Fatalf(\u0026quot;%v\u0026quot;, http.ListenAndServe(\u0026quot;localhost:8080\u0026quot;, nil)) } func MyForm(w http.ResponseWriter, r *http.Request) { err := r.ParseForm() if err != nil { http.Error(w, http.StatusText(http.StatusInternalServerError), http.StatusInternalServerError) return } formData := r.Form log.Printf(\u0026quot;æ”¶åˆ°çš„æ•°æ®ï¼š %v\u0026quot;, formData) fmt.Fprintf(w, \u0026quot;æäº¤æˆåŠŸ\u0026quot;) } /* client */ package main import ( \u0026quot;fmt\u0026quot; \u0026quot;io\u0026quot; \u0026quot;io/ioutil\u0026quot; \u0026quot;log\u0026quot; \u0026quot;net/http\u0026quot; \u0026quot;os\u0026quot; ) const url = \u0026quot;http://localhost:8080/form\u0026quot; func main() { data := map[string][]string{\u0026quot;name\u0026quot;: {\u0026quot;Bro|\u0026quot;, \u0026quot;Qiang\u0026quot;}, \u0026quot;gender\u0026quot;: {\u0026quot;male\u0026quot;}} // æ–¹æ³•ä¸€ï¼šPostForm å‡½æ•° resp, err := http.PostForm(url, data) ErrPrint(err) defer resp.Body.Close() DataPrint(resp.Body) // æ–¹æ³•äºŒï¼šclient ç»“æ„ä½“çš„ PostForm æ–¹æ³• client := \u0026amp;http.Client{} resp, err = client.PostForm(url, data) ErrPrint(err) defer resp.Body.Close() DataPrint(resp.Body) } func DataPrint(body io.ReadCloser) { // æ‹¿åˆ°æ•°æ® bytes, err := ioutil.ReadAll(body) ErrPrint(err) // è¿™é‡Œè¦æ ¼å¼åŒ–å†è¾“å‡ºï¼Œå› ä¸º ReadAll è¿”å›çš„æ˜¯å­—èŠ‚åˆ‡ç‰‡ fmt.Printf(\u0026quot;%s\\n\u0026quot;, bytes) } func ErrPrint(err error) { if err != nil { log.Fatalln(err) os.Exit(1) } } ","id":10,"section":"posts","summary":"å‘ç°ä¸€ä¸ªç®€æ˜“çš„ä½¿ç”¨qqæ¨é€æ¶ˆæ¯çš„å·¥å…·ï¼ŒåŸæœ¬æ‰“ç®—ç”¨æ¥åšç½‘ç›˜çš„æé†’åŠ©æ‰‹ï¼Œæœ€åæ”¾å¼ƒäº†ã€‚ ä¸è¿‡æ„Ÿè§‰è¿™ä¸ªç©å…·æŒºå¥½ç©çš„ï¼Œåšä¸ªè®°å½•ã€‚ Qmsgé¦–é¡µ qqç™»å½•å³æ³¨","tags":["go","å¼€å‘"],"title":"Qmsgæ¶ˆæ¯æ¨é€åŠ©æ‰‹","uri":"https://liangkang233.github.io/2022/03/qmsg%E6%B6%88%E6%81%AF%E5%8A%A9%E6%89%8B/","year":"2022"},{"content":" æœ¬ç¯‡åšå®¢è½¬è½½è‡ªå¥çˆ· ğŸ‘€\nèƒŒæ™¯ Quaggaæ˜¯ä¸€ä¸ªå¼€æºçš„ã€åŸº äºZebraçš„ã€å®ç°äº†RIP, OSPF, BGPçš„åŠ¨æ€è·¯ç”±è½¯ä»¶ã€‚å®ƒæä¾›çš„CLå‘½ä»¤å’ŒCisco IOSç±»ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨quaggaå°†linuxæœºå™¨æ‰“é€ æˆä¸€å°åŠŸèƒ½å®Œå¤‡çš„è·¯ç”±å™¨ã€‚\næœ€è¿‘ç”±äºé¡¹ç›®éœ€è¦è®¡ç®—è·¯ç”±åè®®æ”¶æ•›æ—¶é—´ï¼Œå› æ­¤ä¸å¾—ä¸çœ‹Quaggaæºç å®ç°ï¼Œä½†è‹¦äºä¸çŸ¥é“å¼€å‘è€…æ˜¯å¦‚ä½•ä½¿ç”¨æ—¥å¿—å¯¹ä»£ç è¿›è¡Œè°ƒè¯•çš„ï¼Œæ‰€ä»¥æ›´æ”¹ä»£ç ã€ç¼–è¯‘åä¹Ÿä¸çŸ¥é“æ€ä¹ˆæŸ¥çœ‹ç»“æœã€‚ä¸ºäº†ä»Šåéœ€è¦çš„æ—¶å€™æœ‰ä¸ªå‚è€ƒï¼Œå› æ­¤å¯¹è¯¥è°ƒè¯•æ–¹æ³•è¿›è¡Œè®°å½•ã€‚\nvtysh debug è°ƒè¯• Quaggaæä¾›äº†ä¸€ä¸ªç±»Ciscoå‘½ä»¤è¡Œçš„åˆ†çº§å¤šç”¨æˆ·å‘½ä»¤è§£æå¼•æ“\u0026ndash;VTY(Virtual Terminal)ã€‚å®ƒæ˜¯ç±»ä¼¼äºLinux Shellçš„è™šæ‹Ÿç»ˆç«¯æ¥å£ï¼Œè´Ÿè´£å¯¹è®¿é—®çš„å®‰å…¨éªŒè¯ã€æ•°æ®ç¼“å†²ã€å‘½ä»¤è§£æã€æ¨¡å¼åˆ‡æ¢å’Œå‘½ä»¤è°ƒç”¨ã€‚\nvtysh ä½¿ç”¨ ? å¯ä»¥ç±»ä¼¼ tab è¡¥é½å‘½ä»¤\nå¯åŠ¨vtyshå‘½ä»¤è¡Œ ä¸ºQuaggaé…ç½®æ—¥å¿—æ–‡ä»¶ æ—¥å¿—åä¹Ÿå¯è®¾ç½®æ‰“å°ç­‰çº§\n$ vtysh n1# configure terminal #è¿›å…¥vtyshå…¨å±€é…ç½®æ¨¡å¼ n1(config)# log file /var/log/quagga.log #æŒ‡å®šæ—¥å¿—æ–‡ä»¶ä½ç½® æŒ‡å®šå…¶ä»–ä½ç½®ä¼šæ˜¾ç¤ºæ— æ³•æ‰“å¼€ n1(config)# exit n1# write\t#æ°¸ä¹…ä¿å­˜åˆ°é…ç½®æ–‡ä»¶ä¸­ Building Configuration... Integrated configuration saved to /usr/local/etc/quagga/Quagga.conf [OK] n1# å½“ç„¶æˆ‘è¿™é‡Œä½¿ç”¨ core æ¥åšï¼Œç›´æ¥å°†log file å†™å…¥configé…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™äº›é…ç½®æ–‡ä»¶ å’Œæ—¥å¿—æ–‡ä»¶ä¼šå•ç‹¬æŒ‚è½½ä¸ç”¨æ‹…å¿ƒå½±å“ç‰©ç†ä¸»æœºé…ç½®ã€‚ä¾‹å¦‚\nlog file /var/log/quagga.log interface eth0 ip address 10.0.0.1/24 ip ospf network point-to-point ip ospf hello-interval 2 ip ospf dead-interval 6 ip ospf retransmit-interval 5 ipv6 address 2001::1/64 ! interface eth1 ip address 10.0.1.2/24 ip ospf network point-to-point ip ospf hello-interval 2 ip ospf dead-interval 6 ip ospf retransmit-interval 5 ipv6 address 2001:1::2/64 ! router ospf router-id 10.0.0.1 network 10.0.0.1/24 area 0 network 10.0.1.2/24 area 0 ! æ‰“å¼€éœ€è¦è°ƒè¯•çš„æ¥å£\nn1# debug ospf event n1# debug ospf packet ls-update n1# show debugging bgp ospf rip ripng zebra n1# show debugging ospf OSPF debugging status: OSPF event debugging is on OSPF packet Link State Update debugging is on n1# undebug # å…³é—­debugæ¥å£ â€‹\tæŸ¥çœ‹æ—¥å¿—ä¿¡æ¯\nroot@n1:/var/log# tail -f var.log/quagga.log ä½¿ç”¨gdbè°ƒè¯•ï¼š å®¹å™¨è°ƒç”¨æ˜¾ç¤ºå™¨ åœ¨å¤–éƒ¨ç»ˆç«¯æ‰§è¡Œ xhost + ä¹‹åå°±å¯ä»¥ åœ¨å®¹å™¨å†…æ˜¾ç¤ºå›¾å½¢åŒ–ç•Œé¢ã€‚\ncoreå®¹å™¨èŠ‚ç‚¹æƒ³è¿›è¡Œå›¾å½¢åŒ–çš„è°ƒè¯• æ¨èä½¿ç”¨ vscode (æ­»å¿ ç²‰)\nrootç”¨æˆ·ä¸‹ä½¿ç”¨vscode ä½¿ç”¨ sudo code --user-data-dir=\u0026quot;/home/ling/.vscode/root_config/\u0026quot; --no-sandbox è¿›å…¥ç®¡ç†å‘˜çŠ¶æ€çš„vscode ä¿®æ”¹launchæ–‡ä»¶å°±å¯ä»¥è¿›è¡Œ é…ç½® gdbè°ƒè¯• çš„å‚æ•°ã€‚\nvtysh shell è¯»å–å½“å‰é…ç½®æ–‡ä»¶å‘ç°ä¸ç”Ÿæ•ˆ æŸ¥çœ‹ boot_quagga è„šæœ¬æ‰æ˜ç™½ éœ€è¦ä½¿ç”¨ vtysh -b å‘½ä»¤è¯»å–é…ç½®ã€‚ vtysh å‘½ä»¤ä»‹ç» ä»¥ä¸‹æ˜¯vtyshçš„ä¸€äº›å‘½ä»¤\nå‘½ä»¤ è§£é‡Š clear Reset functions configure Configuration from vty interface copy Copy from one file to another debug Enable debug messages for specific or all part. disable Turn off privileged mode command end End current mode and change to enable mode exit Exit current mode and down to previous mode list Print command list no Negate a command or set its defaults ping Send echo messages quit Exit current mode and down to previous mode show Show running system information ssh Open an ssh connection start-shell Start UNIX shell telnet Open a telnet connection terminal Set terminal line parameters traceroute Trace route to destination undebug Disable debugging functions (see also \u0026lsquo;debug\u0026rsquo;) write Write running configuration to memory, network, or terminal babel IP information bgp BGP information daemons Show list of running daemons debugging State of each debugging option interface Interface status and configuration ip IP information ipv6 IPv6 information isis IS-IS information logging Show current logging configuration memory Memory statistics mpls-te MPLS-TE information route-map route-map information running-config Current operating configuration startup-config Contentes of startup configuration table default routing table to use for all clients version Displays zebra version zebra Zebra information access-list Add an access list entry bgp BGP information debug Enable debug messages for specific or all part. dump Dump packet enable Modify enable password parameters end End current mode and change to enable mode exit Exit current mode and down to previous mode hostname Set system\u0026rsquo;s network name interface Select an interface to configure ip IP information ipv6 IPv6 information key Authentication key management line Configure a terminal line list Print command list log Logging control no Negate a command or set its defaults password Assign the terminal connection password route-map Create route-map or enter route-map command mode router Enable a routing process router-id Manually set the router-id service Set up miscellaneous service table Configure target kernel routing table ","id":11,"section":"posts","summary":"æœ¬ç¯‡åšå®¢è½¬è½½è‡ªå¥çˆ· ğŸ‘€ èƒŒæ™¯ Quaggaæ˜¯ä¸€ä¸ªå¼€æºçš„ã€åŸº äºZebraçš„ã€å®ç°äº†RIP, OSPF, BGPçš„åŠ¨æ€è·¯ç”±è½¯ä»¶ã€‚å®ƒæä¾›çš„CLå‘½ä»¤å’ŒCisco IOS","tags":["linux","è·¯ç”±"],"title":"Quagga è°ƒè¯•è®°å½•","uri":"https://liangkang233.github.io/2022/02/quagga%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/","year":"2022"},{"content":"æ ‘çš„æ¦‚å¿µ æ ‘ç”±æœ‰é™ä¸ªèŠ‚ç‚¹ï¼Œç»„æˆå…·æœ‰å±‚æ¬¡å…³ç³»çš„é›†åˆã€‚æ¯ä¸ªç»“ç‚¹æˆ–è€…æ— å­ç»“ç‚¹æˆ–è€…åªæœ‰æœ‰é™ä¸ªå­ç»“ç‚¹;\næœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç»“ç‚¹,å®ƒæ²¡æœ‰çˆ¶ç»“ç‚¹ï¼Œç§°ä¸ºæ ¹ç»“ç‚¹ã€‚æ¯ä¸€ä¸ªéæ ¹èŠ‚ç‚¹æœ‰ä¸”åªæœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ã€‚å¹¶ä¸”æ ‘é‡Œé¢æ²¡æœ‰ç¯è·¯ã€‚\nç»“ç‚¹çš„åº¦: ä¸€ä¸ªç»“ç‚¹å«æœ‰çš„å­ç»“ç‚¹ä¸ªæ•°ç§°ä¸ºè¯¥ç»“ç‚¹çš„åº¦;\næ ‘çš„åº¦: ä¸€æ£µæ ‘ä¸­ï¼Œæœ€å¤§ç»“ç‚¹çš„åº¦ç§°ä¸ºæ ‘çš„åº¦;\næŒ‰ç…§æœ‰åºæ€§ï¼Œå¯ä»¥åˆ†ä¸ºæœ‰åºæ ‘å’Œæ— åºæ ‘ï¼š\næ— åºæ ‘ï¼šæ ‘ä¸­ä»»æ„èŠ‚ç‚¹çš„å­ç»“ç‚¹ä¹‹é—´æ²¡æœ‰é¡ºåºå…³ç³» æœ‰åºæ ‘ï¼šæ ‘ä¸­ä»»æ„èŠ‚ç‚¹çš„å­ç»“ç‚¹ä¹‹é—´æœ‰é¡ºåºå…³ç³»\næŒ‰ç…§èŠ‚ç‚¹åŒ…å«å­æ ‘ä¸ªæ•°ï¼Œå¯ä»¥åˆ†ä¸ºBæ ‘å’ŒäºŒå‰æ ‘\näºŒå‰æ ‘ äºŒå‰æ ‘ï¼ˆè‹±è¯­ï¼šBinary treeï¼‰æ˜¯æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåªæœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼ˆå³ä¸å­˜åœ¨åˆ†æ”¯åº¦å¤§äº2çš„èŠ‚ç‚¹ï¼‰çš„æ ‘ç»“æ„ã€‚é€šå¸¸åˆ†æ”¯è¢«ç§°ä½œâ€œå·¦å­æ ‘â€æˆ–â€œå³å­æ ‘â€ã€‚äºŒå‰æ ‘çš„åˆ†æ”¯å…·æœ‰å·¦å³æ¬¡åºï¼Œä¸èƒ½éšæ„é¢ å€’ã€‚\näºŒå‰æ ‘å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š\n(å®Œ)æ»¡äºŒå‰æ ‘ï¼š\nå¶èŠ‚ç‚¹é™¤å¤–çš„æ‰€æœ‰èŠ‚ç‚¹å‡å«æœ‰ä¸¤ä¸ªå­æ ‘çš„æ ‘è¢«ç§°ä¸ºæ»¡äºŒå‰æ ‘;\nå®Œå…¨äºŒå‰æ ‘ï¼š\nå¦‚æœä¸€é¢—äºŒå‰æ ‘é™¤å»æœ€åä¸€å±‚èŠ‚ç‚¹ä¸ºæ»¡äºŒå‰æ ‘ï¼Œä¸”æœ€åä¸€å±‚çš„ç»“ç‚¹ä¾æ¬¡ä»å·¦åˆ°å³åˆ†å¸ƒ\néœå¤«æ›¼æ ‘ï¼š\nå¸¦æƒè·¯å¾„æœ€çŸ­çš„äºŒå‰æ ‘ï¼Œå“ˆå¤«æ›¼æ ‘åº”ç”¨äºé€šè®¯åŠæ•°æ®ä¼ é€ä¸­å¯¹ä¿¡æ¯çš„äºŒè¿›åˆ¶ç¼–ç ã€‚\nåœ¨è®¡ç®—æœºæ•°æ®å¤„ç†ä¸­ï¼Œéœå¤«æ›¼ç¼–ç ä½¿ç”¨å˜é•¿ç¼–ç è¡¨å¯¹æºç¬¦å·(å¦‚æ–‡ä»¶ä¸­çš„ä¸€ä¸ªå­—æ¯)è¿›è¡Œç¼–ç ï¼Œå…¶ä¸­å˜é•¿ç¼–ç è¡¨æ˜¯é€šè¿‡ä¸€ç§è¯„ä¼°æ¥æºç¬¦å·å‡ºç°æœºç‡çš„æ–¹æ³•å¾—åˆ°çš„ï¼Œå‡ºç°æœºç‡é«˜çš„å­—æ¯ä½¿ç”¨è¾ƒçŸ­çš„ç¼–ç ï¼Œåä¹‹å‡ºç°æœºç‡ä½çš„åˆ™ä½¿ç”¨è¾ƒé•¿çš„ç¼–ç ï¼Œè¿™ä¾¿ä½¿ç¼–ç ä¹‹åçš„å­—ç¬¦ä¸²çš„å¹³å‡é•¿åº¦ã€æœŸæœ›å€¼é™ä½ï¼Œä»è€Œè¾¾åˆ°æ— æŸå‹ç¼©æ•°æ®çš„ç›®çš„ã€‚\näºŒå‰æŸ¥æ‰¾æ ‘ï¼š\né¦–å…ˆå®ƒæ˜¯ä¸€é¢—äºŒå‰æ ‘ï¼Œè‹¥å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼;\nè‹¥å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼;å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æ’åºæ ‘;\nçº¢é»‘æ ‘ï¼š\nçº¢é»‘æ ‘æ˜¯ä¸€é¢—ç‰¹æ®Šçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²æˆ–è€…çº¢è‰²ï¼Œæ ¹èŠ‚ç‚¹ã€å¶å­èŠ‚ç‚¹æ˜¯é»‘è‰²ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²çš„ã€‚\nå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘(AVL)ï¼š\nä¸€æ£µç©ºæ ‘æˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘\nå®Œå…¨äºŒå‰æ ‘ å®Œç¾äºŒå‰æ ‘ æ€»èŠ‚ç‚¹k $2^{h-1}$ \u0026lt;= k \u0026lt;= $2^{h} - 1$ k = $2^{h} - 1$ æ ‘é«˜h h = $log_{2}k + 1$ h = $log_{2}(k+1)$ åŸºç¡€åº”ç”¨ï¼š ä»¥æ­¤æ ‘ä¸ºä¾‹ï¼š\n// äºŒå‰æ ‘èŠ‚ç‚¹ struct Node { int value; struct Node* left; struct Node* right; Node(int data) : value(data), left(nullptr), right(nullptr) {}; }; bfs å±‚æ¬¡éå† // åˆ©ç”¨é˜Ÿåˆ—æ¥åšã€‚ void LevelOrder(Node* head) { if (head) { queue\u0026lt;Node*\u0026gt; queue; queue.push(head); Node* cur; while (!queue.empty()) { cur = queue.front(); queue.pop(); cout \u0026lt;\u0026lt; cur-\u0026gt;value \u0026lt;\u0026lt; \u0026quot; \u0026quot;; if (cur-\u0026gt;left) queue.push(cur-\u0026gt;left); if (cur-\u0026gt;right) queue.push(cur-\u0026gt;right); } } } dfs å‰ä¸­å åº // å…ˆåºéå† void PreOrder(Node* head) { if (head == nullptr) return; cout \u0026lt;\u0026lt; head-\u0026gt;value \u0026lt;\u0026lt; \u0026quot; \u0026quot;; PreOrder(head-\u0026gt;left); PreOrder(head-\u0026gt;right); } // ä¸­åºéå† void InOrder(Node* head) { if (head == nullptr) return; InOrder(head-\u0026gt;left); cout \u0026lt;\u0026lt; head-\u0026gt;value \u0026lt;\u0026lt; \u0026quot; \u0026quot;; InOrder(head-\u0026gt;right); } // ååºéå† void PosOrder(Node* head) { if (head == nullptr) return; PosOrder(head-\u0026gt;left); PosOrder(head-\u0026gt;right); cout \u0026lt;\u0026lt; head-\u0026gt;value \u0026lt;\u0026lt; \u0026quot; \u0026quot;; } ä½¿ç”¨æ ˆå®ç°çš„å‰ä¸­ååºéå† vector\u0026lt;int\u0026gt; preorderTraversal(TreeNode* root) { vector\u0026lt;int\u0026gt; retvec; stack\u0026lt;TreeNode*\u0026gt; stk; while (root != NULL || !stk.empty()) { while (root != NULL) { retvec.push_back(root-\u0026gt;val); stk.push(root); root = root-\u0026gt;left; } root = stk.top(); stk.pop(); root = root-\u0026gt;right; } } // ä¸­åºéå†. vector\u0026lt;int\u0026gt; preorderTraversal(TreeNode* root) { vector\u0026lt;int\u0026gt; retvec; stack\u0026lt;TreeNode*\u0026gt; stk; while (root != NULL || !stk.empty()) { while (root != NULL) { stk.push(root); root = root-\u0026gt;left; } root = stk.top(); stk.pop(); retvec.push_back(root-\u0026gt;val); root = root-\u0026gt;right; } } /* è¡¥å……: ååºéå† å‰åºéå† =\u0026gt; æ ¹, å·¦, å³. ååºéå† =\u0026gt; å·¦, å³, æ ¹. ä»¿ç…§å‰åºéå†æ–¹æ³•æ±‚è§£å‡º =\u0026gt; æ ¹, å³, å·¦. reverse =\u0026gt; å¾—åˆ°ååºéå†. */ vector\u0026lt;int\u0026gt; postorderTraversal(TreeNode* root) { stack\u0026lt;TreeNode*\u0026gt; stk; vector\u0026lt;int\u0026gt; vec; while (root != NULL || !stk.empty()) { while (root != NULL) { vec.push_back(root-\u0026gt;val); stk.push(root); root = root-\u0026gt;right; } root = stk.top(); stk.pop(); root = root-\u0026gt;left; } reverse(vec.begin(), vec.end()); return vec; } äºŒå‰æ ‘åº”ç”¨ï¼š è“æ¡¥æ¯ï¼šæŒ‘é€‰å·¥å‚ /* é—®é¢˜æè¿° æœ€è¿‘ï¼ŒWYFæ­£å‡†å¤‡å‚è§‚ä»–çš„ç‚¹å¡å·¥å‚ã€‚WYFé›†å›¢çš„ç»ç†æ°°åƒåœ¾éœ€è¦å¸®åŠ©WYFè®¾è®¡å‚è§‚è·¯çº¿ã€‚ç°åœ¨ï¼Œæ°°åƒåœ¾çŸ¥é“ä¸€ä¸‹å‡ ä»¶äº‹æƒ…ï¼š 1.WYFçš„ç‚¹å¡å·¥å‚æ„æˆä¸€é¢—äºŒå‰æ ‘ã€‚ 2.ä¸€å…±æœ‰nåº§å·¥å‚ã€‚ 3.ä»–éœ€è¦æŠŠè¿™é¢—æ ‘ä¸Šçš„ç‚¹ä»¥ååºéå†çš„æ–¹æ³•åˆ—å‡ºæ¥ï¼Œæ‰èƒ½ç»˜åˆ¶åœ°å›¾ã€‚ è¿˜å¥½ï¼Œæœ€è¿‘ä»–çš„å±ä¸‹ç»™äº†ä»–å…ˆåºéå†å’Œä¸­åºéå†çš„æ•°æ®ã€‚å¯æ˜¯ï¼Œæ°°åƒåœ¾æœ€è¿‘è¿˜è¦å¸®ãŠæ¾¤ç©»è§£å†³ä¸€äº›é—®é¢˜ï¼Œæ²¡æœ‰æ—¶é—´ã€‚ è¯·ä½ å¸®å¸®ä»–ï¼Œæ›¿ä»–å®Œæˆè¿™é¡¹ä»»åŠ¡ã€‚ç”±äºæ°°åƒåœ¾çš„ä¸€äº›ç‰¹æ®Šçš„è¦æ±‚ï¼ŒWYFçš„å‚è§‚è·¯çº¿å°†ä¼šæ˜¯è¿™æ£µæ ‘çš„ååºéå†ã€‚ è¾“å…¥æ ¼å¼ ç¬¬ä¸€è¡Œä¸€ä¸ªæ•´æ•°nï¼Œè¡¨ç¤ºä¸€å…±åˆnåº§å·¥å‚ã€‚ ç¬¬äºŒè¡Œnä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå…ˆåºéå†ã€‚ ç¬¬ä¸‰è¡Œnä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸­åºéå†ã€‚ è¾“å‡ºæ ¼å¼ è¾“å‡ºå…±ä¸€è¡Œï¼ŒåŒ…å«nä¸ªæ•´æ•°ï¼Œä¸ºååºéå†ã€‚ æ ·ä¾‹è¾“å…¥ 8 1 2 4 5 7 3 6 8 4 2 7 5 1 8 6 3 æ ·ä¾‹è¾“å‡º 4 7 5 2 8 6 3 1 æ•°æ®è§„æ¨¡å’Œçº¦å®š 0\u0026lt;n\u0026lt;100000,ã€‚ä¿è¯å…ˆåºéå†å’Œä¸­åºéå†åˆæ³•ï¼Œä¸”å‡ä¸º1ï½nã€‚ */ /* æ­¤é¢˜å³ä¸ºç”±å…ˆã€ä¸­åºæ’åˆ—ç¡®å®š ååºæ’åº; é¦–å…ˆè¦çŸ¥é“ä¸€ä¸ªç»“è®ºï¼Œå‰åº/ååº+ä¸­åºåºåˆ—å¯ä»¥å”¯ä¸€ç¡®å®šä¸€æ£µäºŒå‰æ ‘ï¼Œæ‰€ä»¥è‡ªç„¶è€Œç„¶å¯ä»¥ç”¨æ¥å»ºæ ‘ã€‚ çœ‹ä¸€ä¸‹å‰åºå’Œä¸­åºæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Œå‰åº1,2,4,7,3,5,6,8 ï¼Œä¸­åº4,7,2,1,5,3,8,6ï¼› æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š å‰åºä¸­å·¦èµ·ç¬¬ä¸€ä½1è‚¯å®šæ˜¯æ ¹ç»“ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ®æ­¤æ‰¾åˆ°ä¸­åºä¸­æ ¹ç»“ç‚¹çš„ä½ç½®rootinï¼›ï¼ˆååºä¸­æœ€åä¸€ä½è‚¯å®šæ˜¯æ ¹èŠ‚ç‚¹ã€‚ï¼‰ ä¸­åºä¸­æ ¹ç»“ç‚¹å·¦è¾¹å°±æ˜¯å·¦å­æ ‘ç»“ç‚¹ï¼Œå³è¾¹å°±æ˜¯å³å­æ ‘ç»“ç‚¹ï¼Œå³[å·¦å­æ ‘ç»“ç‚¹ï¼Œæ ¹ç»“ç‚¹ï¼Œå³å­æ ‘ç»“ç‚¹]ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—å‡ºå·¦å­æ ‘ç»“ç‚¹ä¸ªæ•°ä¸ºint left = rootin - leftin;ï¼› å‰åºä¸­ç»“ç‚¹åˆ†å¸ƒåº”è¯¥æ˜¯ï¼š[æ ¹ç»“ç‚¹ï¼Œå·¦å­æ ‘ç»“ç‚¹ï¼Œå³å­æ ‘ç»“ç‚¹]ï¼›ï¼ˆååºä¸­åˆ†å¸ƒï¼š[å·¦å­æ ‘èŠ‚ç‚¹, å³å­æ ‘èŠ‚ç‚¹, æ ¹èŠ‚ç‚¹]ï¼‰ æ ¹æ®å‰ä¸€æ­¥ç¡®å®šçš„å·¦å­æ ‘ä¸ªæ•°ï¼Œå¯ä»¥ç¡®å®šå‰åºä¸­å·¦å­æ ‘ç»“ç‚¹å’Œå³å­æ ‘ç»“ç‚¹çš„èŒƒå›´ï¼› å¦‚æœæˆ‘ä»¬è¦å‰åºéå†ç”ŸæˆäºŒå‰æ ‘çš„è¯ï¼Œä¸‹ä¸€å±‚é€’å½’åº”è¯¥æ˜¯ï¼š å·¦å­æ ‘ï¼šroot-\u0026gt;left = pre_order; (å‰åºå·¦å­æ ‘èŒƒå›´ï¼Œä¸­åºå·¦å­æ ‘èŒƒå›´ï¼Œå‰åºåºåˆ—ï¼Œä¸­åºåºåˆ—) å³å­æ ‘ï¼šroot-\u0026gt;right = pre_order; (å‰åºå³å­æ ‘èŒƒå›´ï¼Œä¸­åºå³å­æ ‘èŒƒå›´ï¼Œå‰åºåºåˆ—ï¼Œä¸­åºåºåˆ—) æ¯ä¸€å±‚é€’å½’éƒ½è¦è¿”å›å½“å‰æ ¹ç»“ç‚¹rootï¼› */ #include\u0026lt;iostream\u0026gt; #include\u0026lt;vector\u0026gt; using namespace std; struct TreeNode { int val; TreeNode *left; TreeNode *right; TreeNode() : val(0), left(NULL), right(NULL) {} TreeNode(int x) : val(x), left(NULL), right(NULL) {} TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) {} }; TreeNode *OrderToTree(int L_Pre, int R_Pre, int L_In, int R_In, vector\u0026lt;int\u0026gt; \u0026amp;Pre, vector\u0026lt;int\u0026gt; \u0026amp;In) { if (L_Pre \u0026gt; R_Pre || L_In \u0026gt; R_In) return NULL; TreeNode *root = new TreeNode(Pre[L_Pre]); //å‰åºæ’åˆ—ä¸­ æœ€å·¦ä½ä¸ºæ ¹èŠ‚ç‚¹ int in_root = L_In; while (In[in_root] != Pre[L_Pre]) { in_root++; } int left = in_root - L_In; root-\u0026gt;left = OrderToTree(L_Pre + 1, L_Pre + left, L_In, L_In + left, Pre, In); root-\u0026gt;right = OrderToTree(L_Pre + left +1, R_Pre, L_In + left +1, R_In, Pre, In); return root; } //æ‰“å°é€†åºæ’åº void PosOrder (TreeNode* root) { if(root == NULL) return; PosOrder(root-\u0026gt;left); PosOrder(root-\u0026gt;right); cout \u0026lt;\u0026lt; root-\u0026gt;val \u0026lt;\u0026lt; ' '; } int main () { int n; // 0\u0026lt;n\u0026lt;=1000000 // int PreNumber[100000] = {0}, InNumber[100000] = {0}, PosNumber[100000] = {0}; vector\u0026lt;int\u0026gt; PreNumber, InNumber, PosNumber; cin \u0026gt;\u0026gt; n; for (int i = 0; i \u0026lt; n; i++) { int j; cin \u0026gt;\u0026gt; j; PreNumber.push_back(j); } for (int i = 0; i \u0026lt; n; i++) { int j; cin \u0026gt;\u0026gt; j; InNumber.push_back(j); } TreeNode *root = OrderToTree(0, n-1, 0, n-1, PreNumber, InNumber); PosOrder (root); return 0; } 889. æ ¹æ®å‰åºå’Œååºéå†æ„é€ äºŒå‰æ ‘ - åŠ›æ‰£ï¼ˆLeetCode) struct TreeNode { int val; TreeNode *left; TreeNode *right; TreeNode() : val(0), left(nullptr), right(nullptr) {} TreeNode(int x) : val(x), left(nullptr), right(nullptr) {} TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) {} }; // @lc code=start #include \u0026lt;iostream\u0026gt; #include \u0026lt;vector\u0026gt; using namespace std; // æ³¨æ„é¢˜ä¸­è¯´æ˜ äºŒå‰æ ‘ä¸­çš„å„ä¸ªå€¼ä¸ç›¸åŒ,ä¸éœ€è¦è€ƒè™‘ä¸æˆç«‹çš„æƒ…å†µ // å‰åº/ååº+ä¸­åºåºåˆ—å¯ä»¥å”¯ä¸€ç¡®å®šä¸€æ£µäºŒå‰æ ‘ï¼ŒåªçŸ¥é“å‰åºå’Œååºä¸å”¯ä¸€ç¡®å®š // å‰åºæ˜¯ root + å·¦æ ‘èŠ‚ç‚¹ + å³æ ‘èŠ‚ç‚¹ // ååºæ˜¯ å·¦æ ‘èŠ‚ç‚¹ + å³æ ‘èŠ‚ç‚¹ + root // æ‰€ä»¥ååºçš„å€’æ•°ç¬¬äºŒä¸ªæ˜¯å‰åºä¸­å³æ ‘çš„æ ¹èŠ‚ç‚¹ å‰åºçš„ç¬¬äºŒä¸ªæ˜¯åç»­çš„å‰æ ‘çš„æ ¹èŠ‚ç‚¹æœ€åä¸€ä½ å¦‚æ­¤é€’æ¨å°±æœ‰è§„å¾‹ class Solution { public: // l1 r1é™å®špreçš„å­æ ‘åŒºåŸŸï¼Œl2 r2é™å®špostçš„å­æ ‘åŒºåŸŸã€‚ // æ­¤æ³•é»˜è®¤ä¼˜å…ˆç”Ÿæˆå·¦å­æ ‘ï¼ˆå³åªæœ‰ä¸€è¾¹å­æ ‘æ—¶é»˜è®¤æ˜¯å·¦å­æ ‘ï¼‰ TreeNode* build_tree(vector\u0026lt;int\u0026gt;\u0026amp; pre, vector\u0026lt;int\u0026gt;\u0026amp; post, int l1, int r1, int l2, int r2) { if(l1 \u0026gt; r1) return nullptr; TreeNode *root = new TreeNode(pre[l1]); //æˆ–post[r2] for (int i = r2-1; i \u0026gt;= l2; i--) { if(pre[l1+1] == post[i]) { int len = i - l2; root-\u0026gt;left = build_tree(pre, post, l1+1, l1+len+1, l2, i); root-\u0026gt;right = build_tree(pre, post, l1+len+2, r1, i+1, r2-1); break; } } return root; } TreeNode* constructFromPrePost(vector\u0026lt;int\u0026gt;\u0026amp; preorder, vector\u0026lt;int\u0026gt;\u0026amp; postorder) { TreeNode* ans = build_tree(preorder, postorder, 0, postorder.size()-1, 0, preorder.size()-1); return ans; } }; 173. äºŒå‰æœç´¢æ ‘è¿­ä»£å™¨ - åŠ›æ‰£ï¼ˆLeetCode) class BSTIterator { private: TreeNode* cur; stack\u0026lt;TreeNode*\u0026gt; stk; public: BSTIterator(TreeNode* root): cur(root) {} int next() { while (cur != nullptr) { stk.push(cur); cur = cur-\u0026gt;left; } cur = stk.top(); stk.pop(); int ret = cur-\u0026gt;val; cur = cur-\u0026gt;right; return ret; } bool hasNext() { return cur != nullptr || !stk.empty(); } }; çº¢é»‘æ ‘ å›¾è§£çº¢é»‘æ ‘\nå¸¸ç”¨è§„åˆ™\nçº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ï¼Œå¹¶ä¸”å…¶é™„åŠ å®šä¹‰å¦‚ä¸‹ï¼š\nèŠ‚ç‚¹æœ‰ä¸”åªæœ‰ä¸¤ç§é¢œè‰²ï¼Œçº¢è‰²å’Œé»‘è‰² æ ¹èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²ï¼Œå…¶ä¸­ï¼Œå¶å­èŠ‚ç‚¹æ˜¯è™šæ‹Ÿå­˜åœ¨çš„ç©ºèŠ‚ç‚¹NULL çº¢è‰²èŠ‚ç‚¹çš„ä¸¤ä¸ªå­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰² ä»»æ„èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ä¸Šï¼Œå¿…é¡»åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ map multimap çš„åº•å±‚æ˜¯çº¢é»‘æ ‘ ä¸­åºéå†ä¼šæ˜¯æœ‰åºçš„ï¼Œä¸æ˜¯å“ˆå¸Œè¡¨ï¼Œä½†æ˜¯std::setã€std::multiset ä¾ç„¶ä½¿ç”¨å“ˆå¸Œå‡½æ•°æ¥åšæ˜ å°„ï¼Œåªä¸è¿‡åº•å±‚çš„ç¬¦å·è¡¨ä½¿ç”¨äº†çº¢é»‘æ ‘æ¥å­˜å‚¨æ•°æ®ï¼Œ\næ‰€ä»¥ä½¿ç”¨è¿™äº›æ•°æ®ç»“æ„æ¥è§£å†³æ˜ å°„é—®é¢˜çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¾ç„¶ç§°ä¹‹ä¸ºå“ˆå¸Œæ³•ã€‚ mapä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ã€‚\nunordered_map çš„åº•å±‚æ˜¯ç”¨å“ˆå¸Œè¡¨æ¥å®ç°çš„ æ— åºï¼Œé€šè¿‡keyçš„å“ˆå¸Œè·¯ç”±åˆ°æ¯ä¸€ä¸ªæ¡¶ï¼ˆå³æ•°ç»„ï¼‰ç”¨æ¥å­˜æ”¾å†…å®¹ã€‚é€šè¿‡keyæ¥è·å–valueçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯Oï¼ˆ1ï¼‰ã€‚\nå› ä¸ºkeyçš„å“ˆå¸Œå®¹æ˜“ç¢°æ’ï¼Œæ‰€ä»¥éœ€è¦å¯¹ç¢°æ’åšå¤„ç†ã€‚mapé‡Œçš„æ¯ä¸€ä¸ªæ•°ç»„ï¼ˆæ¡¶ï¼‰é‡Œé¢å­˜çš„å…¶å®æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œkeyçš„å“ˆå¸Œå†²çªä»¥åä¼šåŠ åˆ°é“¾è¡¨çš„å°¾éƒ¨ï¼Œ\nè¿™æ˜¯å†é€šè¿‡keyè·å–valueçš„æ—¶é—´å¤æ‚åº¦å°±å˜æˆO(nï¼‰ï¼Œå½“ç¢°æ’å¾ˆå¤šçš„æ—¶å€™æŸ¥è¯¢å°±ä¼šå˜æ…¢ã€‚ä¸ºäº†ä¼˜åŒ–è¿™ä¸ªæ—¶é—´å¤æ‚åº¦ï¼Œmapçš„åº•å±‚å°±æŠŠè¿™ä¸ªé“¾è¡¨è½¬æ¢æˆäº† å¹³è¡¡æ ‘ï¼Œ\nè¿™æ ·è™½ç„¶æ’å…¥å¢åŠ äº†å¤æ‚åº¦ï¼Œä½†æé«˜äº†é¢‘ç¹å“ˆå¸Œç¢°æ’æ—¶çš„æŸ¥è¯¢æ•ˆç‡ï¼Œä½¿å“ˆå¸Œç¢°æ’æ—¶æŸ¥è¯¢æ•ˆç‡å˜æˆO(log n)ã€‚\nå‰ç¼€æ ‘ trie tree æ ¹èŠ‚ç‚¹ä¸åŒ…å«å­—ç¬¦ï¼Œé™¤æ ¹èŠ‚ç‚¹å¤–æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åªåŒ…å«ä¸€ä¸ªå­—ç¬¦ã€‚ ä»æ ¹èŠ‚ç‚¹åˆ°æŸä¸€èŠ‚ç‚¹ï¼Œè·¯å¾„ä¸Šç»è¿‡çš„å­—ç¬¦è¿æ¥èµ·æ¥ï¼Œä¸ºè¯¥èŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚ æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹åŒ…å«çš„å­—ç¬¦éƒ½ä¸ç›¸åŒã€‚ åˆç§°ä¸ºå­—å…¸æ ‘ trie treeï¼Œæ˜¯ä¸€ç§æ˜¯ä¸€ç§æ ‘å½¢ç»“æ„ï¼Œæ˜¯ä¸€ç§å“ˆå¸Œæ ‘çš„å˜ç§ã€‚å…¸å‹åº”ç”¨æ˜¯ç”¨äºç»Ÿè®¡å’Œæ’åºå¤§é‡çš„å­—ç¬¦ä¸²ï¼ˆä½†ä¸ä»…é™äºå­—ç¬¦ä¸²ï¼‰ï¼Œæ‰€ä»¥ç»å¸¸è¢«æœç´¢å¼•æ“ç³»ç»Ÿç”¨äºæ–‡æœ¬è¯é¢‘ç»Ÿè®¡ã€‚\nå®ƒçš„ä¼˜ç‚¹æ˜¯ï¼šåˆ©ç”¨å­—ç¬¦ä¸²çš„å…¬å…±å‰ç¼€æ¥å‡å°‘æŸ¥è¯¢æ—¶é—´ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘æ— è°“çš„å­—ç¬¦ä¸²æ¯”è¾ƒã€‚Trieçš„æ ¸å¿ƒæ€æƒ³æ˜¯ç©ºé—´æ¢æ—¶é—´ã€‚åˆ©ç”¨å­—ç¬¦ä¸²çš„å…¬å…±å‰ç¼€æ¥é™ä½æŸ¥è¯¢æ—¶é—´çš„å¼€é”€ä»¥è¾¾åˆ°æé«˜æ•ˆç‡çš„ç›®çš„ã€‚\nä¸‹é¢ç»™å‡ºä¸€ä¸ªå°å†™å­—ç¬¦ä¸²æ˜ å°„çš„ tire tree ç®€æ˜“å®ç°:\n208. å®ç° Trie (å‰ç¼€æ ‘) - åŠ›æ‰£ï¼ˆLeetCodeï¼‰\n#include \u0026lt;iostream\u0026gt; #include \u0026lt;string\u0026gt; #include \u0026lt;vector\u0026gt; #include \u0026lt;unordered_map\u0026gt; using namespace std; struct TrieNode { bool flag; // ä¸ºtrue è¡¨ç¤ºå­˜åœ¨ä»¥è¯¥èŠ‚ç‚¹ä¸ºå°¾éƒ¨çš„å€¼ unordered_map\u0026lt;char, TrieNode*\u0026gt; son; TrieNode(): flag(false) {} }; class Trie { private: TrieNode* root = nullptr; public: Trie() { root = new TrieNode(); } void insert(string word) { TrieNode* now = root; for (const char\u0026amp; w : word) { if(now-\u0026gt;son.find(w) == now-\u0026gt;son.end()) now-\u0026gt;son[w] = new TrieNode(); now = now-\u0026gt;son[w]; } now-\u0026gt;flag = true; } bool search(string word) { TrieNode* now = root; for (const char\u0026amp; w : word) { if(now-\u0026gt;son.find(w) == now-\u0026gt;son.end()) return false; now = now-\u0026gt;son[w]; } return now-\u0026gt;flag; } bool startsWith(string prefix) { TrieNode* now = root; for (const char\u0026amp; w : prefix) { if(now-\u0026gt;son.find(w) == now-\u0026gt;son.end()) return false; now = now-\u0026gt;son[w]; } return now; } }; åŸºæ•°æ ‘ radix tree radixæ ‘ ç®€å•æ¥è¯´å°±æ˜¯ tire æ ‘çš„å‹ç¼©è·¯å¾„ç‰ˆæœ¬ï¼ŒTrieæ ‘ä¸€èˆ¬ç”¨äºå­—ç¬¦ä¸²åˆ°å¯¹è±¡çš„æ˜ å°„ï¼ˆTrieæ ‘çœ‹æˆæ˜¯ä¸€ä¸ªåŸºä¸º26çš„Radixæ ‘ï¼‰ï¼Œè€Œradixæ ‘ä¸€èˆ¬ç”¨äºé•¿æ•´æ•°åˆ°å¯¹è±¡çš„æ˜ å°„ã€‚\nå¯¹äºé•¿æ•´å‹æ•°æ®çš„æ˜ å°„ï¼Œæ€æ ·è§£å†³Hashå†²çªå’ŒHashè¡¨å¤§å°çš„è®¾è®¡æ˜¯ä¸€ä¸ªéå¸¸å¤´ç–¼çš„é—®é¢˜ã€‚radixæ ‘å°±æ˜¯é’ˆå¯¹è¿™å¯¹è¿™æ ·çš„ç¨€ç–é•¿æ•´å‹æ•°æ®æŸ¥æ‰¾ï¼Œèƒ½é«˜é€Ÿä¸”èŠ‚çœç©ºé—´åœ°å®Œæˆæ˜ å°„ã€‚å€ŸåŠ©äºRadixæ ‘ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå®ç°å¯¹äºé•¿æ•´å‹æ•°æ®ç±»å‹çš„è·¯ç”±ã€‚åˆ©ç”¨radixæ ‘èƒ½å¤Ÿä¾æ®ä¸€ä¸ªé•¿æ•´å‹ï¼ˆæ¯”å¦‚ä¸€ä¸ªé•¿IDï¼‰é«˜é€Ÿçš„æ‰¾åˆ°å…¶ç›¸åº”çš„å¯¹è±¡æŒ‡é’ˆã€‚è¿™æ¯”ç”¨hashæ˜ å°„æ¥çš„ç®€å•ï¼Œä¹Ÿæ›´èŠ‚çœç©ºé—´ï¼Œä½¿ç”¨Hashæ˜ å°„hashå‡½æ•°éš¾ä»¥è®¾è®¡ï¼Œä¸æ°å½“çš„hashå‡½æ•°å¯èƒ½å¢å¤§å†²çªï¼Œæˆ–æµªè´¹ç©ºé—´ã€‚\nradix treeæ˜¯ä¸€ç§å¤šå‰æœç´¢æ ‘ï¼Œæ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯å®é™…çš„æ•°æ®æ¡ç›®ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ªå›ºå®šçš„ã€2^næŒ‡é’ˆæŒ‡å‘å­èŠ‚ç‚¹ï¼ˆæ¯ä¸€ä¸ªæŒ‡é’ˆç§°ä¸ºslotï¼Œnä¸ºåˆ’åˆ†çš„åŸºçš„å¤§å°ï¼‰ã€‚\nredisä¹‹radix tree_happytree001çš„åšå®¢ ä»‹ç»äº†cç¼–å†™çš„ redis å¦‚ä½•å®ç° radix æ ‘\nå…¶ä¸»è¦åŒºåˆ«å®ç°åœ¨äº iscompr å­—æ®µè®°å½•è¯¥keyæ˜¯å¦ä¸ºå‹ç¼©å­—ç¬¦ä¸²\nå¹³è¡¡äºŒå‰æ ‘ å›¾è§£å¹³è¡¡äºŒå‰æ ‘\nBæ ‘ ç†è§£B+æ ‘ è§†é¢‘\nMySQLç´¢å¼•åº•å±‚ï¼šB+æ ‘è¯¦è§£ åŒ…å«å†…å®¹:\nB-æ ‘ã€B+æ ‘ç®€ä»‹ B+æ ‘æ’å…¥ B+æ ‘æŸ¥æ‰¾ B+æ ‘åˆ é™¤ B+æ ‘ç»å…¸é¢è¯•é¢˜ ","id":12,"section":"posts","summary":"æ ‘çš„æ¦‚å¿µ æ ‘ç”±æœ‰é™ä¸ªèŠ‚ç‚¹ï¼Œç»„æˆå…·æœ‰å±‚æ¬¡å…³ç³»çš„é›†åˆã€‚æ¯ä¸ªç»“ç‚¹æˆ–è€…æ— å­ç»“ç‚¹æˆ–è€…åªæœ‰æœ‰é™ä¸ªå­ç»“ç‚¹; æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç»“ç‚¹,å®ƒæ²¡æœ‰çˆ¶ç»“ç‚¹ï¼Œç§°ä¸ºæ ¹ç»“ç‚¹ã€‚æ¯ä¸€ä¸ª","tags":["C/C++","æ•°æ®ç»“æ„"],"title":"æ ‘ ç›¸å…³ç»“æ„ (TODO)","uri":"https://liangkang233.github.io/2022/01/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91%E7%9B%B8%E5%85%B3/","year":"2022"},{"content":"Docker ã€Lxcä»‹ç» dockeræ˜¯ä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿå¥½ç”¨çš„å¼€æºå…è´¹åº”ç”¨å®¹å™¨å¼•æ“ï¼Œç”¨äºåœ¨ä¸€ä¸ªé›†ä¸­çš„å¹³å°ä¸Šåˆ›å»ºã€éƒ¨ç½²å’Œå·¥ä½œåº”ç”¨ç¨‹åºã€‚è¿™ä½¿å¾—ä¸»æœºçš„æ“ä½œç³»ç»Ÿé€šè¿‡å®¹å™¨è¿è¡Œå…·æœ‰ç›¸åŒLinuxå†…æ ¸çš„åº”ç”¨ç¨‹åºï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„è™šæ‹Ÿæœºã€‚ä½¿ç”¨dockerå®¹å™¨ï¼Œä½ ä¸éœ€è¦å…³å¿ƒRamå’Œç£ç›˜ç©ºé—´çš„åˆ†é…ã€‚å®ƒèƒ½å¤Ÿè‡ªå·±å¤„ç†éœ€æ±‚ã€‚Dockerå®¹å™¨å°†åº”ç”¨å’Œå…¶ä¾èµ–ç¯å¢ƒå…¨éƒ¨æ‰“åŒ…åˆ°ä¸€ä¸ªå•ä¸€å¯¹è±¡ä¸­ï¼Œåœ¨ä¸åŒ…å«å®Œæ•´çš„æ“ä½œç³»ç»Ÿçš„æƒ…å†µä¸‹å°±èƒ½è¿è¡Œæ™®é€šåº”ç”¨ï¼Œæ›´åŠ è½»é‡çº§ï¼Œå¯ç§»æ¤æ€§æ›´å¥½ã€‚æ‰€ä»¥å®ƒæˆä¸ºäº†PaaSï¼ˆæ¯”å¦‚Kubernatesï¼‰å¹³å°çš„åŸºçŸ³ã€‚\nDockeré«˜æ•ˆä¸”å®¹æ˜“é…ç½®ã€‚ æŠ€æœ¯å¯è¡Œæ€§å’Œæé«˜ç”Ÿäº§åŠ›ã€‚ å¯ä»¥åˆ›å»ºæ›´åŠ å®‰å…¨çš„æœåŠ¡ä¾‹å¦‚é€šè¿‡ secret inspect å’Œ secret createç­‰ã€‚ æä¾›åº”ç”¨ç¨‹åºéš”ç¦»ï¼Œå¹¶ä¸”å„ä¸ªå®¹å™¨äº’ç›¸ç‹¬ç«‹æ²¡æœ‰ä¾èµ–ã€‚ åœ¨ä»‹ç»LXDä¹‹å‰å…ˆä»‹ç»LXCï¼Œå› ä¸ºLXDå¯ä»¥è§†ä½œLXCçš„å‡çº§ç‰ˆã€‚LXDçš„ç®¡ç†å‘½ä»¤å’ŒLXCçš„ç®¡ç†å‘½ä»¤å¤§å¤šç›¸åŒã€‚LXCèµ·æºäºcgroupå’Œnamespacesï¼Œä½¿å¾—è¿›ç¨‹ä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œå³è¿›ç¨‹è™šæ‹ŸåŒ–ã€‚LXCæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚æ— æ³•æœ‰æ•ˆæ”¯æŒè·¨ä¸»æœºä¹‹é—´çš„å®¹å™¨è¿ç§»ã€ç®¡ç†å¤æ‚ã€‚è€ŒLXDå¾ˆå¥½åœ°è§£å†³äº†è¿™äº›é—®é¢˜ã€‚LXC/LXDå’Œdockerä¸åŒçš„åœ°æ–¹åœ¨äºLXC/LXDä¸­åŒ…å«å®Œæ•´çš„æ“ä½œç³»ç»Ÿã€‚\nlxcæ˜¯Linux Containersçš„ç¼©å†™ï¼Œç”¨äºé€šè¿‡å•ä¸ªLinuxå†…æ ¸åœ¨å—æ§ä¸»æœºä¸Šè™šæ‹Ÿåœ°è¿è¡Œå¤šä¸ª \u0026ldquo;Linuxç³»ç»Ÿ\u0026rdquo; ã€‚å†…æ ¸çš„Cgroupsç®¡ç†ç»‘å®šçš„lscå®¹å™¨æ€§èƒ½ï¼Œä¸ºè¿›ç¨‹å’Œç½‘ç»œç©ºé—´æä¾›åŠŸèƒ½ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„è™šæ‹Ÿæœºï¼Œå¹¶ä¸ºåº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªç‹¬ç«‹çš„ç¯å¢ƒã€‚æ— è®ºæ˜¯ ip netnsã€lxdã€docker daemonç­‰è¿˜æ˜¯å…¶ä»–è‡ªåˆ¶çš„å·¥å…·æ‰€åˆ›å»ºçš„ä¾èµ–linuxå†…æ ¸namepspaceåº•å±‚æœºåˆ¶çš„å®¹å™¨éƒ½åº”è¯¥ç®—ä½œå¹¿ä¹‰ä¸Šçš„lxcå®¹å™¨ã€‚\nå®ƒæä¾›äº†å†…æ ¸åç§°ç©ºé—´ï¼Œå¦‚IPCã€mountã€PIDã€networkå’Œuserã€‚ å®ƒæä¾›å†…æ ¸åŠŸèƒ½ã€‚ æ§åˆ¶ç»„ (Control groups \u0026ndash; Cgroups) Seccompæ¦‚è¦æ–‡ä»¶ (Seccomp profiles ) Docker å’Œ LXD/LXC åŒºåˆ« LXD/LXCæ˜¯ä¸€ä¸ªç³»ç»Ÿå®¹å™¨ã€‚Dockeræ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºå®¹å™¨ï¼ŒLXCä¸èƒ½è·¨æœºå™¨ä¸Šè¿›è¡Œç§»æ¤ï¼Œè€ŒDockerå¯ä»¥è·¨æœºå™¨ç”šè‡³è·¨å¹³å°ç§»æ¤ã€‚lxc æ˜¯ Linux å†…æ ¸å®¹å™¨è™šæ‹ŸåŒ–çš„ä¸€é¡¹æŠ€æœ¯ï¼Œå¯ä»¥å®ç°èµ„æºçš„éš”ç¦»å’Œæ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯å¯¹ Cgroup å’Œ Namespace ä¸¤ä¸ªå±æ€§çš„æ§åˆ¶ã€‚å¯¹äº docker è€Œè¨€ï¼Œå®ƒå‘å±•åˆ°ç°åœ¨ä¸ä»…ä»…æ˜¯å®¹å™¨çš„ä»£åè¯äº†ï¼Œä¸è¿‡å®ƒçš„åŸºç¡€æŠ€æœ¯æ˜¯éœ€è¦ä¾èµ–å†…æ ¸çš„ Cgroup å’Œ Namespace ç‰¹æ€§ã€‚docker å‡ºç°ä¹‹åˆï¼Œä¾¿æ˜¯é‡‡ç”¨äº† lxc æŠ€æœ¯ä½œä¸º docker åº•å±‚ï¼Œå¯¹å®¹å™¨è™šæ‹ŸåŒ–çš„æ§åˆ¶ã€‚åæ¥éšç€ docker çš„å‘å±•ï¼Œå®ƒè‡ªå·±å°è£…äº† libcontainer ï¼ˆgolang çš„åº“ï¼‰æ¥å®ç° Cgroup å’Œ Namespace æ§åˆ¶ï¼Œä»è€Œæ¶ˆé™¤äº†å¯¹ lxc çš„ä¾èµ–ã€‚\nParameter LXC Docker å¼€å‘è€… LXC was created by IBM, Virtuozzo, Google and Eric Biederman. Docker was created by Solomon Hykes in 2003. æ•°æ®æ£€ç´¢ LXCä¸æ”¯æŒå¤„ç†åçš„æ•°æ®æ£€ç´¢ã€‚ Dockeræ”¯æŒæ•°æ®æ£€ç´¢ã€‚ å¯ç”¨æ€§ å®ƒæ˜¯ä¸€ä¸ªå¤šç”¨é€”çš„è™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆã€‚ å®ƒæ˜¯å•ä¸€ç›®çš„çš„è§£å†³æ–¹æ¡ˆã€‚ å¹³å° LXCä»…åœ¨Linuxå¹³å°ä¸Šæ”¯æŒã€‚ Dockerçš„å®ç°ä¾èµ–äºå¹³å°ã€‚ è™šæ‹ŸåŒ– LXCä¸ºæˆ‘ä»¬æä¾›äº†å®Œæ•´çš„ç³»ç»Ÿè™šæ‹ŸåŒ– ã€‚ Dockeræä¾›äº†åº”ç”¨è™šæ‹ŸåŒ–ã€‚ äº‘æ”¯æŒ ä¸éœ€è¦äº‘å­˜å‚¨ï¼Œå› ä¸ºæ˜¯Linuxæä¾›äº†è¿™äº›ç‰¹æ€§ã€‚ äº‘å­˜å‚¨çš„éœ€æ±‚æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„ç”Ÿæ€ç³»ç»Ÿæ‰€å¿…éœ€çš„ã€‚ æµè¡Œæ€§ ç”±äºä¸€äº›é™åˆ¶ï¼ŒLXCåœ¨å¼€å‘äººå‘˜ä¸­å¹¶ä¸æ˜¯å¾ˆæµè¡Œã€‚ Dockerå› å®¹å™¨è€Œæµè¡Œï¼Œå®ƒå°†å®¹å™¨æå‡åˆ°äº†ä¸€ä¸ªæ–°çš„å±‚æ¬¡ã€‚ cgroupï¼šCgroup æ˜¯ Control group çš„ç®€ç§°ï¼Œæ˜¯ Linux å†…æ ¸æä¾›çš„ä¸€ä¸ªç‰¹æ€§ï¼Œç”¨äºé™åˆ¶å’Œéš”ç¦»ä¸€ç»„è¿›ç¨‹å¯¹ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨ã€‚å¯¹ä¸åŒèµ„æºçš„å…·ä½“ç®¡ç†æ˜¯ç”±å„ä¸ªå­ç³»ç»Ÿåˆ†å·¥å®Œæˆçš„ã€‚\nå­ç³»ç»Ÿ ä½œç”¨ devices è®¾å¤‡æƒé™æ§åˆ¶ cpuset åˆ†é…æŒ‡å®šçš„CPUå’Œå†…å­˜èŠ‚ç‚¹ CPU æ§åˆ¶CPUä½¿ç”¨ç‡ cpuacct ç»Ÿè®¡CPUä½¿ç”¨æƒ…å†µ memory é™åˆ¶å†…å­˜çš„ä½¿ç”¨ä¸Šé™ freezer æš‚åœCgroup ä¸­çš„è¿›ç¨‹ net_cls é…åˆæµæ§é™åˆ¶ç½‘ç»œå¸¦å®½ net_prio è®¾ç½®è¿›ç¨‹çš„ç½‘ç»œæµé‡ä¼˜å…ˆçº§ perf_event å…è®¸ Perf å·¥å…·åŸºäº Cgroup åˆ†ç»„åšæ€§èƒ½æ£€æµ‹ huge_tlb é™åˆ¶ HugeTLB çš„ä½¿ç”¨ Namespaceï¼šNamespace æ˜¯å°†å†…æ ¸çš„å…¨å±€èµ„æºåšå°è£…ï¼Œä½¿å¾—æ¯ä¸ªnamespace éƒ½æœ‰ä¸€ä»½ç‹¬ç«‹çš„èµ„æºï¼Œå› æ­¤ä¸åŒçš„è¿›ç¨‹åœ¨å„è‡ªçš„namespaceå†…å¯¹åŒä¸€ç§èµ„æºçš„ä½¿ç”¨äº’ä¸å¹²æ‰°ã€‚\nNamespace ä½œç”¨ IPC éš”ç¦» System V IPC å’Œ POSIX æ¶ˆæ¯é˜Ÿåˆ— Network éš”ç¦»ç½‘ç»œèµ„æº Mount éš”ç¦»æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹ PID éš”ç¦»è¿›ç¨‹ID UTS éš”ç¦»ä¸»æœºåå’ŒåŸŸå User éš”ç¦»ç”¨æˆ·å’Œç”¨æˆ·ç»„ å¸¸è§é—®é¢˜ Containerå†…ä¸éœ€è¦OSï¼Œä¸ºä½•éœ€è¦OSçš„åŸºç¡€é•œåƒï¼Ÿ\nVscode æ’ä»¶æ— æ³•æŸ¥çœ‹é•œåƒ\né»˜è®¤æƒ…å†µä¸‹ï¼Œdocker å‘½ä»¤ä¼šä½¿ç”¨ Unix socket (opens new window)ä¸ Docker å¼•æ“é€šè®¯ã€‚ è€Œåªæœ‰ root ç”¨æˆ·å’Œ docker ç»„çš„ç”¨æˆ·æ‰å¯ä»¥è®¿é—® Docker å¼•æ“çš„ Unix socketã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œ ä¸€èˆ¬ Linux ç³»ç»Ÿä¸Šä¸ä¼šç›´æ¥ä½¿ç”¨ root ç”¨æˆ·ã€‚å› æ­¤ï¼Œæ›´å¥½åœ°åšæ³•æ˜¯å°†éœ€è¦ä½¿ç”¨ docker çš„ç”¨æˆ·åŠ å…¥ docker ç”¨æˆ·ç»„ã€‚\n# å»ºç«‹ docker ç»„ï¼š sudo groupadd docker # å°†å½“å‰ç”¨æˆ·åŠ å…¥ docker ç»„ï¼š sudo usermod -aG docker $USER Dockerç½‘ç»œç®¡ç† ï¼ˆå¯¼å‡ºç«¯å£ï¼Œå¤šå®¹å™¨é—´é€šä¿¡ ç­‰é—®é¢˜åˆ†æï¼‰\né…ç½®ä»£ç†\nå›½å†…ç‰¹æ®Šç¯å¢ƒï¼Œpull é•œåƒå¯èƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œæ¢é•œåƒæºã€‚\nnano /etc/docker/daemon.json # å†™å…¥ä»¥ä¸‹å†…å®¹ { \u0026quot;registry-mirrors\u0026quot;: [ \u0026quot;https://hub-mirror.c.163.com\u0026quot;, \u0026quot;https://mirror.baidubce.com\u0026quot; ] } # ä¹‹åé‡å¯docker sudo service docker restart è‡ªå®šä¹‰ç½‘æ¡¥\nå¯ä»¥ç”¨ docker port å®¹å™¨id æŸ¥çœ‹å®¹å™¨å¯¼å‡ºæ¥å£ç«¯å£portï¼Œæˆ–è€…ç›´æ¥ docker ps ç”±äºä¹‹å‰æ‰‹è´±ï¼Œip link del docker0 ç½‘æ¡¥å¯¼è‡´åé¢çš„å®¹å™¨æ— æ³•å¯¼å‡ºç«¯å£ï¼Œä½¿ç”¨æ­¤æ³•åŠ å›æ¥\nip link add docker0(åå­—ä¸ä¸‹é¢ *daemon.json* ä½¿ç”¨ç›¸åŒçš„åå­—) sudo ip addr add 192.168.5.1/24 dev docker0 sudo ip link set dev docker0 up nano /etc/docker/daemon.json # æ·»åŠ ä»¥ä¸‹å†…å®¹ { \u0026quot;bridge\u0026quot;: \u0026quot;docker0\u0026quot;, } # ä¹‹åé‡å¯docker sudo service docker restart å¸¸ç”¨å‘½ä»¤ Docker build options\nDocker run options\nå‘½ä»¤ åŠŸèƒ½ docker pull [é€‰é¡¹] [Docker Registry åœ°å€[:ç«¯å£å·]/]ä»“åº“å[:æ ‡ç­¾] é»˜è®¤åœ°å€æ˜¯ Docker Hub(docker.io)ã€‚ è¿™é‡Œçš„ä»“åº“åæ˜¯ä¸¤æ®µå¼åç§°ï¼Œå³ \u0026lt;ç”¨æˆ·å\u0026gt;/\u0026lt;è½¯ä»¶å\u0026gt;ã€‚ å¯¹äº Docker Hubï¼Œå¦‚æœä¸ç»™å‡ºç”¨æˆ·åï¼Œåˆ™é»˜è®¤ä¸º libraryï¼Œä¹Ÿå°±æ˜¯å®˜æ–¹é•œåƒã€‚ docker container ls -a æŸ¥çœ‹å…¨éƒ¨å®¹å™¨ åˆ é™¤rm docker docker image ls -a æŸ¥çœ‹å…¨éƒ¨é•œåƒ åˆ é™¤é•œåƒç”¨rm docker build -t nginx:v1 . ç¼–è¯‘é•œåƒ -t è®¾å®šå®¹å™¨ååŠtag åé¢çš„ . è®¾å®šçš„æ˜¯ä¸Šä¸‹æ–‡çš„è·¯å¾„ docker build -t koa-demo:0.1 . -f ./koa-docker/Dockerfile å¯ä»¥ä½¿ç”¨ dockerfile å–æ¶ˆè·Ÿè¸ªæ‹·è´æ–‡ä»¶ æ³¨æ„é»˜è®¤dockfileæ˜¯åœ¨è®¾å®šä¸Šä¸‹æ–‡ç›®å½•ä¸­å¯»æ‰¾ï¼Œcopyçš„æ–‡ä»¶åªèƒ½æ˜¯ä¸Šä¸‹æ–‡ç›®å½•åŠå…¶å­ç›®å½• -f å¯ä»¥æŒ‡å®šdockefile ï¼š docker image prune åˆ é™¤æ‚¬æµ®é•œåƒ docker system df/ prune / events æ˜¾ç¤ºå„é¡¹æ•°æ®ç£ç›˜å ç”¨ æ¸…é™¤æ— ç”¨æ•°æ® æŸ¥çœ‹docker serverå®æ—¶äº‹ä»¶ docker history imageå æŸ¥çœ‹é•œåƒæ“ä½œå†å²è®°å½• docker run \u0026ndash;name webserver -d -p 1080:80 nginx:v1 ä½¿ç”¨é•œåƒç”Ÿæˆæ–°å®¹å™¨å¹¶ç›´æ¥è¿è¡Œï¼ˆå‘½åä¸ºwebserver -p ç‰©ç†æœº1080ä»£ç†å®¹å™¨80ç«¯å£ -d deatch ï¼‰ docker run \u0026ndash;rm -it \\ -v /var/sflowtrend-pro:/var/local/sflowtrend-pro \\ koa-demo:0.2 bash -iç»‘å®šç»ˆç«¯è¾“å…¥ -tç”Ÿæˆè™šæ‹Ÿç»ˆç«¯tty -i -t ç­‰ä»·-it \u0026ndash;rmï¼šè¿™ä¸ªå‚æ•°æ˜¯è¯´å®¹å™¨é€€å‡ºåéšä¹‹å°†å…¶åˆ é™¤ -d åå°è¿è¡Œ -v å°†ä¸»æœºçš„/var/sflowtrend-proç›®å½•æŒ‚è½½åˆ°/var/local/sflowtrend-proä¸­ docker container start/stop laughing_jennings/æˆ–è€…å®¹å™¨id å¯åŠ¨/ä¸­æ­¢ å®¹å™¨ laughing_jennings docker container logs å®¹å™¨åæˆ–id æŸ¥çœ‹å®¹å™¨è¿è¡Œè¾“å‡º docker diff å®¹å™¨åæˆ–id æŸ¥çœ‹å®¹å™¨ä¿®æ”¹æ–‡ä»¶ docker attach 243c è¿›å…¥å®¹å™¨æ‰§è¡Œæ“ä½œ ä½¿ç”¨ attach è¿›å…¥å®¹å™¨ å½“è¿™ä¸ªç»ˆç«¯åœæ­¢æˆ–exitæ—¶å®¹å™¨ä¹Ÿä¼šåœæ­¢ docker exec -i 69d1 bash ä½¿ç”¨execåˆ™æ— å½±å“ï¼Œä»…ä»…æ˜¯æ‰§è¡Œbashå¹¶å®šå‘åˆ°å½“å‰stdin å…¶ä»–å‚æ•°ä½¿ç”¨docker exec -h æŸ¥çœ‹ docker commit \\ \u0026ndash;author \u0026ldquo;Tao Wang twang2218@gmail.com\u0026rdquo; \\ \u0026ndash;message \u0026ldquo;ä¿®æ”¹äº†é»˜è®¤ç½‘é¡µ\u0026rdquo; \\ webserver \\ nginx:v2 æäº¤å®¹å™¨å†…æ”¹å˜ç¼–è¯‘ç”Ÿæˆé•œåƒ commitç”Ÿæˆçš„é•œåƒä¸ºé»‘ç®±é•œåƒè¿˜æ˜¯æ¨èç”¨dockerfileåšæ˜¯ç»´æŠ¤ç”¨çš„é•œåƒ dockerfileä½¿ç”¨ docker export 7691a814370e \u0026gt; ubuntu.tar å¯¼å‡ºå®¹å™¨çš„å¿«ç…§åˆ°æœ¬åœ°å½’æ¡£æ–‡ä»¶ cat ubuntu.tar | docker import - test/ubuntu:v1.0 æˆ–è€…æŒ‡å®šurlä¸‹è½½å¹¶å¯¼å…¥ docker import http://example.com/exampleimage.tgz example/imagerepo å°†å®¹å™¨å½’æ¡£æ–‡ä»¶å¯¼å…¥ä¸ºé•œåƒ ç”¨æˆ·æ—¢å¯ä»¥ä½¿ç”¨ docker load æ¥å¯¼å…¥é•œåƒå­˜å‚¨æ–‡ä»¶åˆ°æœ¬åœ°é•œåƒåº“ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ docker import æ¥å¯¼å…¥ä¸€ä¸ªå®¹å™¨å¿«ç…§åˆ°æœ¬åœ°é•œåƒåº“ã€‚è¿™ä¸¤è€…çš„åŒºåˆ«åœ¨äºå®¹å™¨å¿«ç…§æ–‡ä»¶å°†ä¸¢å¼ƒæ‰€æœ‰çš„å†å²è®°å½•å’Œå…ƒæ•°æ®ä¿¡æ¯ï¼ˆå³ä»…ä¿å­˜å®¹å™¨å½“æ—¶çš„å¿«ç…§çŠ¶æ€ï¼‰ï¼Œè€Œé•œåƒå­˜å‚¨æ–‡ä»¶å°†ä¿å­˜å®Œæ•´è®°å½•ï¼Œä½“ç§¯ä¹Ÿè¦å¤§ã€‚æ­¤å¤–ï¼Œä»å®¹å™¨å¿«ç…§æ–‡ä»¶å¯¼å…¥æ—¶å¯ä»¥é‡æ–°æŒ‡å®šæ ‡ç­¾ç­‰å…ƒæ•°æ®ä¿¡æ¯ã€‚ docker save alpine -o filename docker save alpine | gzip \u0026gt; alpine-latest.tar.gz docker load -i alpine-latest.tar.gz save loadä¸ºé•œåƒçš„ä¿å­˜ä¸å¯¼å…¥ï¼Œç°åœ¨å·²ç»ä¸æ¨èï¼Œé•œåƒè¿ç§»åº”è¯¥ç›´æ¥ä½¿ç”¨ Docker Registryï¼Œæ— è®ºæ˜¯ç›´æ¥ä½¿ç”¨ Docker Hub è¿˜æ˜¯ä½¿ç”¨å†…ç½‘ç§æœ‰ Registry éƒ½å¯ä»¥ï¼‰ docker ps -aq æ˜¾ç¤ºdockeræ‰€æœ‰å®¹å™¨ ï¼ˆ-a ä¸ºå…¨éƒ¨å¦åˆ™é»˜è®¤åªæœ‰è¿è¡Œå®¹å™¨ -qåªæ˜¾ç¤ºå®¹å™¨idï¼‰ docker top å®¹å™¨id æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹ docker inspect \u0026ndash;format \u0026lsquo;{{ .NetworkSettings.IPAddress }}\u0026rsquo; å®¹å™¨id æŸ¥çœ‹å®¹å™¨ip docker inspect \u0026ndash;format=\u0026rsquo;{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}\u0026rsquo; $(docker ps -aq) æŸ¥çœ‹å…¨éƒ¨å®¹å™¨ip å¦‚æœæˆ‘ä»¬ç»“åˆè¿™ä¸¤ä¸ªå‘½ä»¤ä»¥åŠ ssh ç”šè‡³ pv çš„è¯ï¼Œåˆ©ç”¨ Linux å¼ºå¤§çš„ç®¡é“ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªå‘½ä»¤å®Œæˆä»ä¸€ä¸ªæœºå™¨å°†é•œåƒè¿ç§»åˆ°å¦ä¸€ä¸ªæœºå™¨ï¼Œå¹¶ä¸”å¸¦è¿›åº¦æ¡çš„åŠŸèƒ½:\ndocker save \u0026lt;é•œåƒå\u0026gt; |bzip2 |pv |ssh \u0026lt;ç”¨æˆ·å\u0026gt;@\u0026lt;ä¸»æœºå\u0026gt; 'cat |docker load'\nå…¶å®æœ‰å¾ˆå¤šæ’ä»¶å¯ä»¥æ–¹ä¾¿å¿«æ·æ“ä½œï¼Œä¾‹å¦‚vscodeä¸­çš„dockeræ’ä»¶ï¼Œè¿™é‡Œæ¨èä¸€ä¸‹ã€‚\n","id":13,"section":"posts","summary":"Docker ã€Lxcä»‹ç» dockeræ˜¯ä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿå¥½ç”¨çš„å¼€æºå…è´¹åº”ç”¨å®¹å™¨å¼•æ“ï¼Œç”¨äºåœ¨ä¸€ä¸ªé›†ä¸­çš„å¹³å°ä¸Šåˆ›å»ºã€éƒ¨ç½²å’Œå·¥ä½œåº”ç”¨ç¨‹åºã€‚è¿™ä½¿å¾—ä¸»æœºçš„æ“ä½œç³»ç»Ÿé€šè¿‡","tags":["å®¹å™¨"],"title":"Dockerå®¹å™¨ç›¸å…³","uri":"https://liangkang233.github.io/2021/12/%E5%AE%B9%E5%99%A8%E7%9B%B8%E5%85%B3/","year":"2021"},{"content":"OVS ä»‹ç» Open virtual Switch æ˜¯ä¸€ä¸ªåœ¨ Apache2è®¸å¯æˆæƒçš„ å¼€æºå¤šå±‚è½¯ä»¶äº¤æ¢æœºã€‚ç›®æ ‡æ˜¯å®ç°ä¸€ä¸ªäº§å“è´¨é‡çš„äº¤æ¢æœºå¹³å°ï¼Œæ”¯æŒæ ‡å‡†çš„ç®¡ç†æ¥å£ï¼Œå¹¶å¼€æ”¾è½¬å‘åŠŸèƒ½ï¼Œä»¥ä¾›ç¼–ç¨‹æ‰©å±•å’Œæ§åˆ¶ã€‚\novsç®€è¨€ä¹‹å°±æ˜¯ä½¿ç”¨openflowè¡¨åšdatapathï¼Œå°†åº•å±‚æ•°æ®ç«¯å£çš„æ•°æ®æµçš„æ§åˆ¶é¢å¯¼å…¥ä¸Šå±‚openflowäº¤æ¢æœºåšè·¯ç”±è½¬å‘ï¼Œæ•°æ®ä¼ è¾“çš„è½¯ä»¶å±‚é¢è™šæ‹Ÿäº¤æ¢æœºã€‚\nOVSå®ç° å…¶ä¸­ï¼Œ ovs-vswitchd å’Œ datapath å…±åŒæ„æˆäº† OVS çš„æ•°æ®é¢ï¼Œæ§åˆ¶é¢ç”± controller æ¨¡å—æ¥å®Œæˆï¼Œcontroller ä¸€èˆ¬è¡¨ç¤ºçš„æ˜¯ OpenFlow æ§åˆ¶å™¨ï¼Œåœ¨ OVS ä¸­ï¼Œå®ƒå¯ä»¥å€Ÿç”±ç¬¬ä¸‰æ–¹æ¥å®Œæˆï¼Œåªè¦æ”¯æŒ OpenFlow åè®®å³å¯ã€‚\novs-vswitchd\novs-vswitchedä¸å®ƒçš„å†…æ ¸æ¨¡å—datapthå…±åŒæ„æˆäº†OVSçš„æ•°æ®é¢ã€‚å®ƒä½¿ç”¨OpenFlowåè®®ä¸OpenFlowæ§åˆ¶å™¨é€šä¿¡ï¼Œä½¿ç”¨ OVSDB åè®®ä¸ ovsdb-server é€šä¿¡ï¼Œä½¿ç”¨ netlink å’Œ datapath å†…æ ¸æ¨¡å—é€šä¿¡ã€‚\novsdb-server\novsdb-server æ˜¯ OVS è½»é‡çº§çš„æ•°æ®åº“æœåŠ¡ï¼Œç”¨äºæ•´ä¸ª OVS çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥å£ã€äº¤æ¢å†…å®¹ã€VLAN ç­‰ï¼Œovs-vswitchd æ ¹æ®è¿™äº›é…ç½®ä¿¡æ¯å·¥ä½œã€‚\nOpenFlow æ§åˆ¶å™¨\nOpenFlow æ§åˆ¶å™¨å¯ä»¥é€šè¿‡ OpenFlow åè®®è¿æ¥åˆ°ä»»ä½•æ”¯æŒ OpenFlow çš„äº¤æ¢æœºï¼Œæ¯”å¦‚ ovs-ofctl ã€‚æ§åˆ¶å™¨é€šè¿‡å‘äº¤æ¢æœºä¸‹å‘æµè¡¨è§„åˆ™æ¥æ§åˆ¶æ•°æ®æµå‘ã€‚\nKernel Datapath\ndatapath å†…æ ¸æ¨¡å—å’Œ ovs-vswitchd æ˜¯ç›¸äº’åä½œå·¥ä½œçš„ï¼Œdatapath è´Ÿè´£å…·ä½“çš„æ”¶å‘åŒ…ï¼Œè€Œ ovs-vswitchd é€šè¿‡ controller ä¸‹å‘çš„æµè¡¨è§„åˆ™æŒ‡å¯¼ datapath å¦‚ä½•è½¬å‘åŒ…ã€‚\næ•°æ®é¢å°±æ˜¯ä»¥ç”¨æˆ·æ€çš„ ovs-vswitchd å’Œå†…æ ¸æ€çš„ datapath ä¸ºä¸»çš„è½¬å‘æ¨¡å—ï¼Œä»¥åŠä¸ä¹‹ç›¸å…³è”çš„æ•°æ®åº“æ¨¡å— ovsdb-serverï¼Œæ§åˆ¶é¢ä¸»è¦æ˜¯ç”± ovs-ofctl æ¨¡å—è´Ÿè´£ï¼ŒåŸºäº OpenFlow åè®®ä¸æ•°æ®é¢è¿›è¡Œäº¤äº’ã€‚è€Œç®¡ç†é¢åˆ™æ˜¯ç”± OVS æä¾›çš„å„ç§å·¥å…·æ¥è´Ÿè´£\nOVSæ¶æ„ OVSçš„ä¸»è¦ç»„ä»¶æ˜¯ï¼š\novs-vswitchdï¼Œä¸€ä¸ªå®ç°äº¤æ¢æœºçš„å®ˆæŠ¤ç¨‹åºï¼Œä»¥åŠä¸€ä¸ªç”¨äºåŸºäºæµçš„åˆ‡æ¢çš„é…å¥— Linux å†…æ ¸æ¨¡å—ã€‚ ovsdb-serverï¼Œä¸€ä¸ªè½»é‡çº§çš„æ•°æ®åº“æœåŠ¡å™¨ï¼Œå®ƒé€šè¿‡ ovs-vswitchd æŸ¥è¯¢æ¥è·å–å…¶é…ç½®ã€‚ ovs-dpctlï¼Œä¸€ä¸ªç”¨äºé…ç½®äº¤æ¢æœºå†…æ ¸æ¨¡å—çš„å·¥å…·ï¼Œå¯ä»¥æ§åˆ¶è½¬å‘è§„åˆ™ã€‚ ovs-vsctlï¼Œä¸€ä¸ªç”¨äºæŸ¥è¯¢å’Œæ›´æ–° ovs-vswitchd é…ç½®çš„å®ç”¨ç¨‹åºã€‚ ovs-appctlï¼Œä¸€ä¸ªå‘è¿è¡Œ Open vSwitch å®ˆæŠ¤ç¨‹åºå‘é€å‘½ä»¤çš„å®ç”¨ç¨‹åºã€‚ ä¸º Citrix XenServer å’Œ Red Hat Enterprise Linux æ„å»º RPM çš„è„šæœ¬å’Œè§„èŒƒã€‚XenServer RPM å…è®¸å°† Open vSwitch å®‰è£…åœ¨ Citrix XenServer ä¸»æœºä¸Šï¼Œä½œä¸ºå…¶äº¤æ¢æœºçš„ç›´æ¥æ›¿ä»£å“ï¼Œå¹¶å…·æœ‰å…¶ä»–åŠŸèƒ½ã€‚ Open vSwitch è¿˜æä¾›äº†ä¸€äº›å·¥å…·ï¼š\novs-ofctlï¼Œä¸€ä¸ªç”¨äºæŸ¥è¯¢å’Œæ§åˆ¶ OpenFlow äº¤æ¢æœºå’Œæ§åˆ¶å™¨çš„å®ç”¨ç¨‹åºã€‚ ovs-pkiï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç† OpenFlow äº¤æ¢æœºå…¬é’¥åŸºç¡€ç»“æ„çš„å®ç”¨ç¨‹åºã€‚ ovs-testcontrollerï¼Œä¸€ä¸ªç®€å•çš„OpenFlowæ§åˆ¶å™¨ï¼Œå¯èƒ½å¯¹æµ‹è¯•æœ‰ç”¨ï¼ˆå°½ç®¡ä¸é€‚ç”¨äºç”Ÿäº§ï¼‰ã€‚ tcpdump çš„æ‰©å±•ç¨‹åºï¼Œä½¿å…¶èƒ½å¤Ÿè§£æ OpenFlow æ¶ˆæ¯ã€‚ æ‰€æœ‰å·¥å…·çš„æ‰‹å†Œ,å†…å®¹ä¸ linux ä¸­çš„manualä¸€è‡´ã€‚\nä¸€äº›åŸºç¡€æ¦‚å¿µ Bridge: Bridgeï¼Œlinux ç½‘æ¡¥æ˜¯ Linux ä¸Šç”¨æ¥åš TCP/IP äºŒå±‚åè®®äº¤æ¢çš„è®¾å¤‡ï¼Œä¸€ä¸ªä¸»æœºä¸­å¯ä»¥åˆ›å»ºä¸€ä¸ªæˆ–è€…å¤šä¸ª Bridge è®¾å¤‡ã€‚ Port: ç«¯å£ä¸ç‰©ç†äº¤æ¢æœºçš„ç«¯å£æ¦‚å¿µç±»ä¼¼ï¼Œæ¯ä¸ª Port éƒ½éš¶å±äºä¸€ä¸ª Bridgeã€‚ Interface: è¿æ¥åˆ° Port çš„ç½‘ç»œæ¥å£è®¾å¤‡ã€‚åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼ŒPort å’Œ Interface æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³», åªæœ‰åœ¨é…ç½® Port ä¸º bond æ¨¡å¼åï¼ŒPort å’Œ Interface æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚ Controller: OpenFlow æ§åˆ¶å™¨ã€‚OVS å¯ä»¥åŒæ—¶æ¥å—ä¸€ä¸ªæˆ–è€…å¤šä¸ª OpenFlow æ§åˆ¶å™¨çš„ç®¡ç†ã€‚ datapath: åœ¨ OVS ä¸­ï¼Œdatapath è´Ÿè´£æ‰§è¡Œæ•°æ®äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯æŠŠä»æ¥æ”¶ç«¯å£æ”¶åˆ°çš„æ•°æ®åŒ…åœ¨æµè¡¨ä¸­è¿›è¡ŒåŒ¹é…ï¼Œå¹¶æ‰§è¡ŒåŒ¹é…åˆ°çš„åŠ¨ä½œã€‚ Flow table: æ¯ä¸ª datapath éƒ½å’Œä¸€ä¸ªâ€œflow tableâ€å…³è”ï¼Œå½“ datapath æ¥æ”¶åˆ°æ•°æ®ä¹‹åï¼Œ OVS ä¼šåœ¨ flow table ä¸­æŸ¥æ‰¾å¯ä»¥åŒ¹é…çš„ flowï¼Œæ‰§è¡Œå¯¹åº”çš„æ“ä½œ, ä¾‹å¦‚è½¬å‘æ•°æ®åˆ°å¦å¤–çš„ç«¯å£ã€‚æ”¯æŒ OpenFlow åè®®çš„äº¤æ¢æœºåº”è¯¥åŒ…æ‹¬ä¸€ä¸ªæˆ–è€…å¤šä¸ªæµè¡¨ï¼Œæµè¡¨ä¸­çš„æ¡ç›®åŒ…å«ï¼šæ•°æ®åŒ…å¤´çš„ä¿¡æ¯ã€åŒ¹é…æˆåŠŸåè¦æ‰§è¡Œçš„æŒ‡ä»¤å’Œç»Ÿè®¡ä¿¡æ¯ Flow ï¼š åœ¨ OpenFlow çš„ç™½çš®ä¹¦ä¸­ï¼ŒFlow è¢«å®šä¹‰ä¸ºæŸä¸ªç‰¹å®šçš„ç½‘ç»œæµé‡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª TCP è¿æ¥å°±æ˜¯ä¸€ä¸ª Flowï¼Œæˆ–è€…ä»æŸä¸ª IP åœ°å€å‘å‡ºæ¥çš„æ•°æ®åŒ…ï¼Œéƒ½å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ª Flowã€‚ OpenFlowä»‹ç» OpenFlowæ˜¯ä¸€ç§æ§åˆ¶é¢å’Œæ•°æ®é¢é€šä¿¡çš„ç½‘ç»œé€šä¿¡åè®®ï¼Œåº”ç”¨äºSDNæ¶æ„ä¸­æ§åˆ¶å™¨å’Œè½¬å‘å™¨ä¹‹é—´çš„é€šä¿¡ã€‚\nè½¯ä»¶å®šä¹‰ç½‘ç»œSDNçš„ä¸€ä¸ªæ ¸å¿ƒæ€æƒ³å°±æ˜¯â€œè½¬å‘ã€æ§åˆ¶åˆ†ç¦»â€ï¼Œè¦å®ç°è½¬ã€æ§åˆ†ç¦»ï¼Œå°±éœ€è¦åœ¨æ§åˆ¶å™¨ä¸è½¬å‘å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªé€šä¿¡æ¥å£æ ‡å‡†ï¼Œ å…è®¸æ§åˆ¶å™¨ç›´æ¥è®¿é—®å’Œæ§åˆ¶è½¬å‘å™¨çš„è½¬å‘å¹³é¢ã€‚OpenFlowå¼•å…¥äº†â€œæµè¡¨â€çš„æ¦‚å¿µï¼Œè½¬å‘å™¨é€šè¿‡æµè¡¨æ¥æŒ‡å¯¼æ•°æ®åŒ…çš„è½¬å‘ã€‚ æ§åˆ¶å™¨æ­£æ˜¯é€šè¿‡OpenFlowæä¾›çš„æ¥å£åœ¨è½¬å‘å™¨ä¸Šéƒ¨ç½²ç›¸åº”çš„æµè¡¨ï¼Œä»è€Œå®ç°å¯¹è½¬å‘å¹³é¢çš„æ§åˆ¶ã€‚\né“¾è·¯åŠäº¤æ¢æœº ciscoç½‘ç»œä¸­ï¼Œäº¤æ¢æœºåœ¨å±€åŸŸç½‘ä¸­æœ€ç»ˆç¨³å®šçŠ¶æ€çš„æ¥å£ç±»å‹ä¸»è¦æœ‰å››ç§ï¼šaccess/trunk/ multi/ dot1q-tunnelã€‚\naccess: ä¸»è¦ç”¨æ¥æ¥å…¥ç»ˆç«¯è®¾å¤‡ï¼Œå¦‚PCæœºã€æœåŠ¡å™¨ã€æ‰“å°æœåŠ¡å™¨ç­‰ã€‚ trunk: ä¸»è¦ç”¨åœ¨è¿æ¥å…¶å®ƒäº¤æ¢æœºï¼Œä»¥ä¾¿åœ¨çº¿è·¯ä¸Šæ‰¿è½½å¤šä¸ªvlanã€‚ multi: åœ¨ä¸€ä¸ªçº¿è·¯ä¸­æ‰¿è½½å¤šä¸ªvlanï¼Œä½†ä¸åƒtrunk,å®ƒä¸å¯¹æ‰¿è½½çš„æ•°æ®æ‰“æ ‡ç­¾ã€‚ä¸»è¦ç”¨äºæ¥å…¥æ”¯æŒå¤švlançš„æœåŠ¡å™¨æˆ–è€…ä¸€äº›ç½‘ç»œåˆ†æè®¾å¤‡ã€‚ç°åœ¨åŸºæœ¬ä¸ä½¿ç”¨æ­¤ç±»æ¥å£ï¼Œåœ¨ciscoçš„ç½‘ç»œè®¾å¤‡ä¸­ï¼Œä¹ŸåŸºæœ¬ä¸æ”¯æŒæ­¤ç±»æ¥å£äº†ã€‚ dot1q-tunnel: ç”¨åœ¨Q-in-Qéš§é“é…ç½®ä¸­ã€‚ vlançš„é“¾è·¯ç±»å‹å¯ä»¥åˆ†ä¸ºæ¥å…¥é“¾è·¯å’Œå¹²é“é“¾è·¯ã€‚\næ¥å…¥é“¾è·¯ï¼ˆaccess linkï¼‰æŒ‡çš„äº¤æ¢æœºåˆ°ç”¨æˆ·è®¾å¤‡çš„é“¾è·¯ï¼Œå³æ˜¯æ¥å…¥åˆ°æˆ·ï¼Œå¯ä»¥ç†è§£ä¸ºç”±äº¤æ¢æœºå‘ç”¨æˆ·çš„é“¾è·¯ã€‚ç”±äºå¤§å¤šæ•°ç”µè„‘ä¸èƒ½å‘é€å¸¦vlan tagçš„å¸§ï¼Œæ‰€ä»¥è¿™æ®µé“¾è·¯å¯ä»¥ç†è§£ä¸ºä¸å¸¦vlan tagçš„é“¾è·¯ã€‚ å¹²é“é“¾è·¯ï¼ˆtrunk linkï¼‰æŒ‡çš„äº¤æ¢æœºåˆ°ä¸Šå±‚è®¾å¤‡å¦‚è·¯ç”±å™¨çš„é“¾è·¯ï¼Œå¯ä»¥ç†è§£ä¸ºå‘å¹¿åŸŸç½‘èµ°çš„é“¾è·¯ã€‚è¿™æ®µé“¾è·¯ç”±äºè¦é vlanæ¥åŒºåˆ†ç”¨æˆ·æˆ–è€…æœåŠ¡ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½å¸¦æœ‰vlan tagã€‚ éš§é“ä»‹ç» éš§é“æŠ€æœ¯ä»‹ç»ï¼š\næ˜¯åœ¨ç°æœ‰çš„ç‰©ç†ç½‘ç»œä¹‹ä¸Šæ„å»ºä¸€å±‚è™šæ‹Ÿç½‘ç»œï¼Œä¸Šå±‚åº”ç”¨åªä¸è™šæ‹Ÿç½‘ç»œç›¸å…³ï¼Œä»¥æ­¤å®ç°çš„è™šæ‹Ÿç½‘ç»œæ¯”ç‰©ç†ç½‘ç»œé…ç½®æ›´åŠ çµæ´»ï¼Œ å¹¶èƒ½å¤Ÿå®ç°è·¨ä¸»æœºçš„L2é€šä¿¡ä»¥åŠå¿…è¦çš„ç§Ÿæˆ·éš”ç¦»ã€‚ä¸åŒéš§é“æŠ€æœ¯å…¶å¤§ä½“æ€è·¯å‡æ˜¯å°†ä»¥å¤ªç½‘æŠ¥æ–‡ä½¿ç”¨éš§é“åè®®å°è£…ï¼Œ ç„¶åä½¿ç”¨åº•å±‚IPç½‘ç»œè½¬å‘å°è£…åçš„æ•°æ®åŒ…ï¼Œå…¶å·®å¼‚æ€§åœ¨äºé€‰æ‹©å’Œæ„é€ éš§é“çš„åè®®ä¸åŒã€‚ å¸¸è§éš§é“æŠ€æœ¯æœ‰ä¸¤ç§greæˆ–vxlan\nGeneral Router Encapsulation åœ¨GREä¸­ï¼Œéœ€è¦è¢«ä¼ è¾“å’Œå°è£…çš„æŠ¥æ–‡ç§°ä¹‹ä¸ºpayload packetï¼Œè€Œç”¨äºå°è£…å’Œä¼ è¾“çš„åè®®åˆ™æˆä¸ºdelivery protocolã€‚ GREåœ¨å°è£…çš„æ—¶å€™ï¼Œé™¤äº†payloadå’Œdeliveryåè®®çš„headerå¤–ï¼Œä¼šç”Ÿæˆä¸€ä¸ªGRE headerã€‚GRE header + payloadä¸€èµ·è¢«deliveryåè®®å°è£…ç”¨äºä¼ è¾“ï¼ŒGRE headerä¼šåŒ…å«payloadçš„ä¸€äº›ä¿¡æ¯ï¼ŒåŒ…æ‹¬checksumã€versionã€payloadçš„åè®®ç±»å‹ç­‰ã€‚å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡è¿™ä¸ªGRE headerçš„åè®®ç±»å‹å­—æ®µï¼Œå½“è„±å–è¿™ä¸€å±‚deliveryå±‚åï¼Œå°±å¯ä»¥è§£æä¸ºåŸæ•°æ®åŒ…æ ¼å¼ï¼Œé€šè¿‡GRE headerä¸­çš„åè®®ç±»å‹æˆ‘ä»¬å°±èƒ½çŸ¥é“åè®®ç±»å‹äº†ï¼Œæ—¢ç„¶çŸ¥é“äº†åè®®ç±»å‹ï¼Œé‚£ä¹ˆå°±æœ‰èƒ½åŠ›è§£æäº†ã€‚\nç”±äºGREæ˜¯ä¸€ç§é€šç”¨çš„æ ¼å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨GREè¿›è¡Œå¾ˆå¤šä¸åŒç§ç±»çš„å°è£…ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨PPTPåè®®æ¥è¿›è¡ŒVPNï¼Œå¯ä»¥ä½¿ç”¨IPv4æ¥åŒ…è£¹IPv6ã€‚æ¯”è¾ƒå¸¸è§çš„deliveryåè®®ä¸€èˆ¬æ˜¯IPåè®®ã€‚ ä¸è¿‡GREåœ¨è®¾è®¡çš„æ—¶å€™æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æ²¡æœ‰è€ƒè™‘åŠ å¯†ã€‚å› æ­¤ç°åœ¨å¸¸è§çš„éœ€è¦åŠ å¯†çš„å°è£…ä¸€èˆ¬æ˜¯ç”¨çš„IPsecåè®®ã€‚\nVirtual eXtensible Local Area Network ç®€å•çš„è¯´å°±æ˜¯æ‰©å……äº†çš„VLANï¼Œç›¸æ¯”äºGREçš„é€šç”¨æ€§ï¼ŒVXLANä¸»è¦ç”¨äºå°è£…ã€è½¬å‘2å±‚æŠ¥æ–‡ã€‚ å…¶ä½¿å¾—å¤šä¸ªé€šè¿‡ä¸‰å±‚è¿æ¥çš„ç½‘ç»œå¯ä»¥è¡¨ç°çš„å’Œç›´æ¥é€šè¿‡ä¸€å°ä¸€å°ç‰©ç†äº¤æ¢æœºè¿æ¥é…ç½®è€Œæˆçš„ç½‘ç»œä¸€æ ·å¤„åœ¨ä¸€ä¸ªLANä¸­ã€‚ å…¶å°†äºŒå±‚æŠ¥æ–‡åŠ ä¸Šä¸ªvxlan headerï¼Œå°è£…åœ¨ä¸€ä¸ªUDPåŒ…ä¸­è¿›è¡Œä¼ è¾“ã€‚vxlan headerä¼šåŒ…æ‹¬ä¸€ä¸ª24ä½çš„IDï¼ˆç§°ä¸ºVNIï¼‰ï¼Œ å«ä¹‰ç±»ä¼¼äºVLAN idæˆ–è€…ä¸Šé¢æåˆ°çš„GREçš„tunnel idã€‚\nåœ¨ä¸Šé¢GREçš„ä¾‹å­ä¸­ï¼Œæ˜¯é€šè¿‡è·¯ç”±å™¨æ¥è¿›è¡ŒGREåè®®çš„å°è£…å’Œè§£å°çš„ï¼Œ åœ¨VXLANä¸­è¿™ç±»å°è£…å’Œè§£å°çš„ç»„ä»¶æœ‰ä¸ªä¸“æœ‰çš„åå­—å«åšVTEPã€‚ç›¸æ¯”èµ·VLANæ¥è¯´ï¼Œå¥½å¤„åœ¨äºå…¶çªç ´äº†VLANåªæœ‰4094å­ç½‘çš„é™åˆ¶ï¼Œ åŒæ—¶æ¶è®¾åœ¨UDPåè®®ä¸Šåå…¶æ‰©å±•æ€§æé«˜äº†ä¸å°‘ï¼ˆå› ä¸ºUDPæ˜¯é«˜å±‚åè®®ï¼Œå±è”½äº†åº•å±‚çš„å·®å¼‚ï¼Œæ¢å¥è¯è¯´å±è”½äº†äºŒå±‚çš„å·®å¼‚ï¼‰ã€‚\nOVS å®‰è£…ä¸ä½¿ç”¨ linuxå¯ä»¥ç›´æ¥å®‰è£…sudo apt-get install openvswitch-switch,ä½†æ˜¯æ‰§è¡Œovs-tcpdumpæŠ¥é”™ï¼š\nlk233@vm-5gc:~$ sudo ovs-tcpdump Traceback (most recent call last): File \u0026quot;/usr/bin/ovs-tcpdump\u0026quot;, line 27, in \u0026lt;module\u0026gt; import netifaces ImportError: No module named netifaces å¯æ˜¯æˆ‘python3ä½¿ç”¨pip3 -læŸ¥çœ‹çš„åŒ…é‡Œæœ‰netifaces\næ£€æŸ¥å‘ç°ç³»ç»Ÿé»˜è®¤pipæ˜¯python3ï¼Œå¯æ˜¯æ‰§è¡Œpythoné»˜è®¤æ˜¯python2 ğŸ˜…\n# å¦‚ä¸‹æ£€æŸ¥ç‰ˆæœ¬å’Œ ä½¿ç”¨alternativesé€‰æ‹©é»˜è®¤ç‰ˆæœ¬ pip -V python -V sudo update-alternatives --install /usr/bin/python python /usr/bin/python2.7 1 sudo update-alternatives --install /usr/bin/python python /usr/bin/python3.6 2 sudo update-alternatives --config python ovs-tcpdump -h ERROR: Please install the correct Open vSwitch python support libraries (version 2.9.0). Alternatively, check that your PYTHONPATH is pointing to the correct location. # å¦‚æœä¹‹åæŠ¥å¦‚ä¸Šçš„é”™è¯¯å®‰è£…ovs python æ”¯æŒåŒ… pip3 install ovs # æˆ–è€…è¿™é‡Œä¸‹æºç åŒ…æ‰§è¡Œå®‰è£… https://pypi.org/project/ovs/#modal-close sudo python3 ./setup.py install ä¸€åˆ‡å®‰è£…å®Œæ¯•åï¼Œå¯ä»¥æ£€æµ‹åˆ°åå°æœåŠ¡ä¸æ§åˆ¶ç‰ˆæœ¬ä¿¡æ¯ OVS åŸºç¡€æ•™ç¨‹: dockerå®¹å™¨ä½¿ç”¨OVSæ•™ç¨‹\nOVS OpenFlow æ•™ç¨‹ OVS IPsecéš§é“ æ•™ç¨‹ OVS é«˜çº§åŠŸèƒ½ (åŒ…å«gdbè°ƒè¯• vlanå…¥å£å¤„ç† è¾“å‡ºå¤„ç†ç»†èŠ‚ç­‰) OVS Conntrack æ•™ç¨‹ (Conntrackæ˜¯ä¸€ä¸ªç”¨äºæ£€æŸ¥æŠ¥æ–‡çŠ¶æ€çš„è¿æ¥è·Ÿè¸ªæ¨¡å—) å½“ç„¶OVSçš„åŠŸèƒ½ä¸å±€é™äºè¿™äº›ï¼Œæ²¡æœ‰å¿…è¦èŠ±è´¹å¤§é‡äº‹ä»¶å­¦ä¹ å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå·¥å…·ï¼ŒçŸ¥é“å¤§è‡´çš„æ€è·¯å’Œè¿è¡Œé€»è¾‘ï¼Œå°±éœ€è¦æ€è€ƒæ€ä¹ˆå°†ovsè¿ç”¨åˆ°å®é™…ä¸­ã€‚ ä¸‹é¢æ˜¯ä¸€äº›åŸºç¡€åº”ç”¨:\nOpen vSwitch with KVM Encrypt Open vSwitch Tunnels with IPsec Open vSwitch with SELinux Open vSwitch with Libvirt Open vSwitch with SSL Using LISP tunneling Connecting VMs Using Tunnels Connecting VMs Using Tunnels (Userspace) Isolating VM Traffic Using VLANs Quality of Service (QoS) Rate Limiting How to Use the VTEP Emulator Monitoring VM Traffic Using sFlow Using Open vSwitch with DPDK å®é™…åº”ç”¨-å¤šä¸»æœºé—´å®¹å™¨é€šä¿¡ æ–¹æ¡ˆé€‰å‹ æˆ‘æœ€è¿‘éœ€è¦åšåˆ†å¸ƒå¼å®¹å™¨é—´çš„é€šä¿¡ç›¸å…³å·¥ä½œï¼Œå¦‚æœæŒ‰ç…§ä¼ ç»Ÿçš„æ–¹æ¡ˆå»ºç«‹éš§é“ç»´æŠ¤ç›¸å½“éº»çƒ¦ï¼Œäºæ˜¯æƒ³åˆ°é‡‡ç”¨ovsçš„æ–¹æ¡ˆæ¥åšã€‚\nä¸‹é¢æ˜¯ç‰©ç†åœºæ™¯çš„å¤§æ¦‚çš„ç¤ºæ„å›¾ï¼š\næ–¹æ¡ˆ1ï¼šgreéš§é“ ovsçš„greä¸å‘½ä»¤è¡Œçš„ç›´æ¥æ­å»ºgreéš§é“åšç‚¹å¯¹ç‚¹é“¾è·¯æ— å¼‚ï¼Œè¯¥æ–¹æ¡ˆå³ä¸º Connecting VMs Using Tunnelsï¼Œåœ¨å®é™…æµ‹è¯•ä¸­æˆ‘æ·»åŠ å¤šä¸ªç›¸åŒä¸»æœºé—´éš§é“ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥æ²¡æ³•ç”¨å¤šä¸ªç½‘æ¡¥é…å¤šä¸ªgreéš§é“é—´éš”ä¸»æœºå¯¹é—´çš„æµé‡ã€‚\næ–¹æ¡ˆ2: vlan ä½¿ç”¨vlanï¼ˆIsolating VM Traffic Using VLANsï¼‰å¯ä»¥åšåˆ°å…¨éƒ¨ä¸»æœºattachåˆ°ä¸€ä¸ªç½‘æ¡¥ä¸Šä»è€Œå¤šä¸»æœºé€šä¿¡ï¼Œä½†æ˜¯ä¸»æœºé—´çš„æ¥å…¥ç½‘å¡ç”±äºå·¥ä½œåœ¨äºŒå±‚è®¾å¤‡ä¸‹ipåœ°å€åŠç»‘å®šå…¶ipç¨‹åºéƒ½ä¼šå¤±æ•ˆï¼Œä¸æ˜¯å¾ˆæ¨èä½¿ç”¨è¿™ä¸ªã€‚\næ–¹æ¡ˆ3: vxlanéš§é“ æ‰€ä»¥åº”è¯¥ç”¨ ovs ç®¡ç†ä¸€ä¸ªvxlanéš§é“å±€åŸŸç½‘, OVSåœ¨è®¡ç®—å’Œç½‘ç»œèŠ‚ç‚¹ä¸Šå»ºç«‹éš§é“Portæ¥è¿æ¥å„èŠ‚ç‚¹ä¸Šçš„ç½‘æ¡¥br-intï¼ˆbr-intæ˜¯ä¸¾ä¾‹çš„ç½‘æ¡¥åï¼‰ï¼Œè¿™æ ·æ‰€æœ‰ç½‘ç»œå’Œè®¡ç®—èŠ‚ç‚¹ä¸Šçš„br-intäº’è”å½¢æˆäº†ä¸€ä¸ªå¤§çš„è™šæ‹Ÿçš„è·¨æ‰€æœ‰èŠ‚ç‚¹çš„é€»è¾‘ç½‘æ¡¥(å†…éƒ¨é tunnel idæˆ–VNIéš”ç¦»ä¸åŒå­ç½‘)ï¼Œè¿™ä¸ªé€»è¾‘ç½‘æ¡¥å¯¹è™šæ‹Ÿæœºå’Œqrouteræ˜¯é€æ˜çš„ï¼Œå†…éƒ¨æ•°æ®ä¸å˜è½¬å‘å‡ºæœºå™¨çš„æ•°æ®å°±åƒäº¤æ¢æœºæ ¹æ®tagè¿›è¡Œè½¬å‘ä¼ é€’æ•°æ®ã€‚\näºæ˜¯å‚è€ƒäº†è¿™ä¸ª Connecting VMs Using Tunnels (Userspace) æ–¹æ¡ˆ\nå¤šä¸ªä¸»æœºä¸Šæ¡¥æ¥åˆ°br-vxlançš„è™šæ‹Ÿæœºå°±åƒè¿æ¥åˆ°åŒä¸€ä¸ªäº¤æ¢æœºä¸€æ ·ï¼Œå¯ä»¥å®ç°è·¨ä¸»æœºçš„L2è¿æ¥ï¼ŒåŒæ—¶åˆå®Œå…¨ä¸ç‰©ç†ç½‘ç»œéš”ç¦»ã€‚ æ‰€æœ‰æ•°æ®éƒ½åˆ°è¾¾ä¸­é—´ä¸»æœºè½¬å‘å¯»è·¯ ä¸greéš§é“ç±»ä¼¼ï¼Œç›¸åŒä¸»æœºé—´æ·»åŠ å¤šä¸ªvxlanéš§é“ä¼šæŠ¥é”™ã€‚\nç–‘æƒ‘ï¼š vxlané—®é¢˜åœ¨äºä¸»æ§ä¸»æœºä½œä¸º OVSäº¤æ¢æœºï¼Œè‹¥æ˜¯host2å†…å®¹å™¨2å‘host3ä¸»æœºå®¹å™¨3å‘é€æ•°æ®ï¼Œhost1ä¾æ—§ä¼šæ¥æ”¶å¹¶è½¬å‘æ•°æ®åŒ…ï¼Œä½†å®é™…ä¸Šhost1å‘host3çš„æ•°æ®å®Œå…¨èµ°ç‰©ç†äº¤æ¢æœºä¸€è·³å³å¯ï¼Œä¸çŸ¥é“æ•°æ®é‡å¤§äº†åæ‰€æœ‰æ•°æ®éƒ½æ±‡æ€»åœ¨host1è¿›è¡Œå¤„ç†è½¬å‘æ˜¯å¦ä¼šè¾¾åˆ°æ€§èƒ½ç“¶é¢ˆã€‚\nå…·ä½“å®æ–½ # æŸ¥çœ‹OVSç½‘æ¡¥åŠå…¶ç«¯å£ sudo ovs-vsctl show # è®¾å®šä¸»ç½‘æ¡¥ br-vxlan # ä¸»æœº 192.168.163.134 ä¸Š sudo ovs-vsctl add-br br-vxlan # ä¸»æœº 192.168.163.140 ä¸Š sudo ovs-vsctl add-br br-vxlan # ä¸»æœº 192.168.163.141 ä¸Š sudo ovs-vsctl add-br br-vxlan # ç½‘å¡æ·»åŠ è‡³å¯¹åº”ç½‘æ¡¥ sudo ovs-vsctl add-port br-vxlan veth1.0.df sudo ovs-vsctl add-port br-vxlan veth2.0.2e sudo ovs-vsctl add-port br-vxlan veth3.0.ec æ·»åŠ é€šä¿¡éš§é“ï¼ˆåŒå‘æ·»åŠ ï¼‰ # ä¸»æœº 192.168.163.140ä¸Š æ·»åŠ è¿æ¥åˆ° 192.168.163.134 141 çš„Tunnel Port sudo ovs-vsctl add-port br-vxlan tun0 -- set Interface tun0 type=vxlan options:remote_ip=192.168.163.134 sudo ovs-vsctl add-port br-vxlan tun1 -- set Interface tun1 type=vxlan options:remote_ip=192.168.163.141 # ä¸»æœº 192.168.163.134ä¸Š æ·»åŠ è¿æ¥åˆ° 192.168.163.140 çš„Tunnel Port sudo ovs-vsctl add-port br-vxlan tun0 -- set Interface tun0 type=vxlan options:remote_ip=192.168.163.140 # ä¸»æœº 192.168.163.141ä¸Š æ·»åŠ è¿æ¥åˆ° 192.168.163.140 çš„Tunnel Port sudo ovs-vsctl add-port br-vxlan tun0 -- set Interface tun0 type=vxlan options:remote_ip=192.168.163.140 å½“åœ¨ç”¨æˆ·ç©ºé—´è¿è¡ŒOpen vSwitchè€Œä¸æ˜¯åŸºäºå†…æ ¸çš„Open vSwitchæ—¶ï¼Œéœ€è¦è¿™ä¸ªé¢å¤–çš„ç½‘æ¡¥br-phyã€‚è¿™ä¸ªç½‘æ¡¥çš„ç›®çš„æ˜¯å…è®¸ä½¿ç”¨å†…æ ¸ç½‘ç»œå †æ ˆè¿›è¡Œè·¯ç”±å’ŒARPè§£æã€‚æ•°æ®è·¯å¾„éœ€è¦æŸ¥æ‰¾è·¯ç”±è¡¨å’ŒARPè¡¨ï¼Œå‡†å¤‡éš§é“å¤´å¹¶å°†æ•°æ®å‘é€åˆ°è¾“å‡ºç«¯å£ã€‚\næ·»åŠ phyç½‘æ¡¥ååŸæœ‰å®¹å™¨å†…æ•°æ®æ— æ³•pingé€šï¼Œå¯èƒ½æ˜¯ç”±äºè·¯ç”±æ²¡é…å¥½ï¼Ÿ ä½†æ˜¯æŒ‰ç…§æ‰‹å†ŒåŠ ä¸ä¸Šè·¯ç”± æ‰€ä»¥æœ€åæˆ‘æ˜¯è·³è¿‡phyå’Œens33attachæ­¥éª¤ï¼Œç»“æœä¹Ÿæ­£å¸¸ã€‚\n# è®¾å®šphyç½‘æ¡¥ï¼ˆï¼‰ sudo ovs-vsctl --may-exist add-br br-phy \\ -- set Bridge br-phy datapath_type=netdev \\ -- br-set-external-id br-phy bridge-id br-phy \\ -- set bridge br-phy fail-mode=standalone \\ other_config:hwaddr=\u0026lt;mac address of eth33 interface\u0026gt; sudo ovs-vsctl add-br br-phy \\ -- set bridge br-phy fail-mode=standalone \\ other_config:hwaddr=00:0c:29:ef:1b:c5 # å°†ç‰©ç†ç½‘å¡ens33 attach ä¸Š br-phyç½‘æ¡¥ sudo ovs-vsctl --timeout 10 add-port br-phy ens33 sudo ip addr add 192.168.163.140/24 dev br-phy sudo ip link set br-phy up sudo ip addr flush dev eth1 2\u0026gt;/dev/null sudo ip link set ens33 up sudo iptables -F # æ·»åŠ  VXLAN è·¯ç”± # æŒ‰ç…§æ‰‹å†Œ ovs-appctl ovs/route/add æ·»åŠ è·¯ç”±å¤±è´¥ï¼Œæš‚æ—¶æœªè§£å†³ã€‚ # æ˜¾ç¤º VXLAN è·¯ç”± ovs-appctl ovs/route/show æ£€éªŒç°è±¡ï¼šå¯ä»¥åœ¨å®¹å™¨å†…äº’ç›¸pingé€š172ç½‘æ®µipå³å¯\ngreéš§é“çš„åšæ³•ä¸vxlanä¸­ä¸åŠ br-phyçš„åšæ³•åŸºæœ¬ä¸€æ ·ï¼Œå°±ä¸å¤è¿°äº†ï¼Œvlançš„æ–¹æ¡ˆä¸Šé¢çš„æ•™ç¨‹å†™çš„å¾ˆè¯¦ç»†ã€‚\næŠ“åŒ…æµ‹è¯• è‹¥ä¸æ˜¯ä½¿ç”¨å®¹å™¨æˆ–è€…å…¶ä»–ç½‘ç»œç©ºé—´ï¼ˆnetns ï¼‰çš„è®¾å¤‡æ˜¯æŠ“ä¸åˆ°ä¸‹é¢çš„portçš„åŒ…ï¼Œè€Œä¸”ä¼ è¾“çš„æ•°æ®å¯èƒ½æ˜¯å°è£…è¿‡åçš„ï¼Œä¸å¤ªå¥½åˆ†æã€‚æ‰€ä»¥è¯•è¯•æ‰‹å†Œé‡Œæåˆ°çš„ovs-tcpdumpã€‚å®ƒæ˜¯ç”¨pythonå®ç°çš„æ•è·ovsçš„æ•°æ®åŒ…çš„tcpdumpè¡¥ä¸ã€‚ï¼ˆovsâˆ’tcpundumpç¨‹åºä»stdinè¯»å–tcpdumpâˆ’xxè¾“å‡ºï¼ŒæŸ¥æ‰¾åå…­è¿›åˆ¶æ•°æ®åŒ…æ•°æ®ï¼Œå¹¶åœ¨stdoutä¸Šå°†æ¯ä¸ªä»¥å¤ªç½‘è½¬å‚¨ä¸ºä¸€ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼‰\næ„Ÿè§‰è¿™ä¸ªç¨‹åºå¾ˆä¹…ä¸ç»´æŠ¤äº†ï¼Œä½¿ç”¨python3æ‰§è¡Œæœ‰å¾ˆå¤šé—®é¢˜ã€‚\n# é¦–å…ˆä½¿ç”¨ç®¡ç†å‘˜æ¨¡å¼, å¦åˆ™ä¸‹è¿°æŠ¥é”™ Exception: Unable to connect to /var/run/openvswitch/db.sock # ä¹‹åçš„æŠ¥é”™æ˜¯å› ä¸ºrwä¸æ”¯æŒï¼Œæ¨èå°† rw æ”¹ä¸º r+b File \u0026quot;/usr/bin/ovs-tcpdump\u0026quot;, line 65, in _install_tap_linux tapdev_fd = open('/dev/net/tun', 'rw') ValueError: must have exactly one of create/read/write/append mode # åé¢åˆæŠ¥é”™ï¼ŒæŸ¥è¯¢èµ„æ–™è¯´æ˜¯python3ä¸å…¼å®¹çš„é—®é¢˜ï¼ŒæŠŠç¼“å†²æ”¹ä¸º0 å³openå‡½æ•° ä¼ å‚ buffering = 0 io.UnsupportedOperation: File or stream is not seekable #æœ€åä¾æ—§æ˜¯æœ‰é—®é¢˜æ— æ³•æŠ“åŒ… æŠ“åŒ…å¤±è´¥å¹¶ä¸”æç¤ºå…³é—­ç›‘å¬ç«¯å£ Please use ovs-vsctl to remove the ports and mirrors created. ex: ovs-vsctl --db=unix:/var/run/openvswitch/db.sock del-port mib.4.db ä¿®æ”¹åçš„ä»£ç ï¼š\nä¹‹åçš„æŠ“åŒ…ä¾æ—§æœ‰é—®é¢˜ï¼Œä¸”æ²¡æœ‰æŠ¥é”™æé†’ æš‚æ—¶æ— æ³•è§£å†³\nå®åœ¨æ˜¯å¤ªæŠ˜è…¾äº†ï¼Œä¸€ä¸ªå·¥å…·ç”¨çš„è¿™ä¹ˆéº»çƒ¦ ğŸ˜’æˆ‘ç”¨çš„æ˜¯lxcå®¹å™¨å„é“¾è·¯ä½¿ç”¨ovsé“¾æ¥ï¼Œå®Œå…¨å¯ä»¥æ‰§è¡Œå®¹å™¨å†…çš„tcpdumpã€‚\nçœ‹åˆ°è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼šä½¿ç”¨ç«¯å£é•œåƒæ¥æŠ“åŒ…ï¼Œ ovs-tcpdumpåº”è¯¥ä¹Ÿæ˜¯è¿™ä¹ˆç›‘å¬çš„æ‰€ä»¥ç›´æ¥æŒ‰ç…§è¿™ç¯‡åšå®¢è¯•äº†è¯•,å®è·µåç¡®å®šå¯ä»¥æŠ“æ²¡æœ‰tagæµçš„åŸå§‹åŒ…\næ³¨æ„: tcpdump æŠ“åŒ…æ—¶åŠ -lå¯ä»¥ä¸ç¼“å­˜å®æ—¶åˆ·æ–°\næœ€å Vxlanæ–¹æ¡ˆ çš„host1çš„å®¹å™¨1å†…çš„æŠ“åŒ…ç»“æœéªŒè¯äº†æˆ‘ä¹‹å‰çš„é—®é¢˜\næ•°æ®åŒ…åŒ…å«vlan tagä¸”ä¸­é—´çš„ä¸»æ§ä¸»æœºå‚ä¸äº†æ•°æ®çš„å¤„ç†è½¬å‘ï¼Œhost2ä¸host3é—´çš„å®¹å™¨äº’ç›¸pingï¼Œéƒ½ä¼šæ˜¯host1è½¬å‘äº†è¯¥icmpåŒ…ã€‚requestå’Œreplyéƒ½ä¼ é€äº†ä¸¤æ¬¡å³host1-host2ã€host1-host3ä¸¤æ¡éš§é“éƒ½èµ°äº†ã€‚åœ¨host2ã€host3é—´åŠ ç›´è¾¾éš§é“ä¹Ÿæ— æ•ˆï¼Œä¾æ—§host1å‚ä¸å¤„ç†è½¬å‘ã€‚\nä¹Ÿè®¸ç›´è¾¾é“¾è·¯æœ€å¥½çš„è¿˜æ˜¯æ·»åŠ éš§é“åšç›´è¾¾å¤„ç†ï¼Œå¦‚æœå¤šä¸ªä¸»æœºæ¥å…¥ä¸€ä¸ªè™šæ‹Ÿäº¤æ¢æœºå¤„ç†ï¼Œè¯¥è™šæ‹Ÿäº¤æ¢æœºæ˜¯éœ€è¦å¤„ç†æ‰€æœ‰æµç»çš„æ•°æ®åŒ…çš„ã€‚\nå…³äºä¸‹å±å­èŠ‚ç‚¹é—´çš„æ•°æ®åŒºåˆ†ï¼Œå¯ä»¥åƒvlanä¸€æ ·ç›´æ¥åŠ ä¸ªtag vxlanæ·»åŠ tagï¼Œæ€»ä¹‹ åšovsäº¤æ¢æœºçš„ä¸»æœºå¿…ç„¶æ˜¯éœ€è¦æ¥æ”¶æ‰€æœ‰æ•°æ® ç”±å®ƒåšæ•°æ®åŒºåˆ† è½¬å‘ã€‚\næµè¡¨ç›‘å¬ ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„ç›‘å¬å‘½ä»¤:\næŸ¥çœ‹æµè¡¨: ovs-ofctl dump-flows br-tun æŸ¥çœ‹portæ”¶å‘åŒ…æƒ…å†µ: ovs-ofctl dump-ports br-tun å½“ç„¶å‚è€ƒäº†è¿™ç¯‡æ–‡ç« åMonitoring VM Traffic Using sFlowç›‘å¬æ•°æ®æ›´æ–¹ä¾¿äº†ã€‚\nä¸ºäº†é˜²æ­¢Javaç¯å¢ƒè®¾ç½®ã€å®‰è£…è½¯ä»¶ç­‰ä¸€ç³»åˆ—é…ç½®ç¯å¢ƒçš„é—®é¢˜ï¼Œåé¢çš„ sFlow ç›‘å¬æˆ‘ä½¿ç”¨ sflowtrend dockerï¼Œç¡®ä¿å…·å¤‡dockerç¯å¢ƒã€‚ä¹‹åæˆ‘ä¼šå†™ä¸€ç¯‡å…³äºdockerã€lxcå®¹å™¨çš„æ–‡ç« ã€‚\né…ç½®å®Œdockerå¿…è¦ç¯å¢ƒåï¼Œç›´æ¥pullé•œåƒå¹¶è¿è¡Œå³å¯ã€‚\ndocker pull sflow/sflowtrend docker run -v \u0026lt;ä½ çš„æ˜ å°„è·¯å¾„\u0026gt;:/var/local/sflowtrend-pro \\ -p 6343:6343/udp -p 8087:8087 -p 8443:8443 \\ -h sflowtrend-pro -e TZ=Asia/Chungking\u0026lt;ä½¿ç”¨åŒ—äº¬æ—¶é—´æ—¶åŒºæ”¹ä¸ºAsia/Shanghai\u0026gt; -d \\ --restart unless-stopped sflow/sflowtrend ä»¥å¦‚ä¸‹ç½‘ç»œåšç¤ºä¾‹ç›‘å¬ï¼š åé¢ä»¥ç¬¬ä¸€ç§æƒ…å†µåšç¤ºä¾‹\næŸ¥è¯¢dockerç½‘å¡ip:\ndocker ps #æŸ¥çœ‹è¿è¡Œå®¹å™¨ docker inspect --format '{{ .NetworkSettings.IPAddress }}' å®¹å™¨id #æŸ¥çœ‹å®¹å™¨ip å¼€å§‹è®¾å®šç›‘å¬sFlow\n# æ”¶é›†ç›‘å¬æ•°æ®çš„å®¹å™¨æˆ–åº”ç”¨è¿›ç¨‹ä¸»æœºçš„ip åŠç«¯å£ï¼ˆé»˜è®¤6343ï¼‰ COLLECTOR_IP=192.168.254.2 # COLLECTOR_IPæ³¨æ„è¦è·ŸsFlowç³»ç»Ÿé…ç½®çš„COLLECTOR_IPç›¸åŒ COLLECTOR_PORT=6343 # å‘é€ç›‘å¬æ•°æ®çš„ç½‘æ¡¥çš„ä¸»æœºä¸æ”¶é›†æ•°æ®çš„ç›‘å¬ä¸»æœºé€šä¿¡ä½¿ç”¨çš„æ¥å£ # ç”±äºæ˜¯åŒä¸»æœºä½¿ç”¨çš„dockerï¼Œæ‰€ä»¥æ‰€æœ‰å®¹å™¨éƒ½attachåœ¨docker0ç½‘æ¡¥ä¸Šï¼Œä¸€èˆ¬æ­¤å¤„ä¸ºens33 AGENT_IP=docker0 HEADER_BYTES=128 # å¸§å¤´é•¿åº¦ SAMPLING_N=64 # é‡‡æ ·ç‡ POLLING_SECS=10 # è½®è¯¢æ—¶é—´ # ç›‘å¬ovsç½‘æ¡¥ m_bridge=b.5.35 sudo ovs-vsctl -- --id=@sflow create sflow agent=${AGENT_IP} \\ target=\u0026quot;\\\u0026quot;${COLLECTOR_IP}:${COLLECTOR_PORT}\\\u0026quot;\u0026quot; header=${HEADER_BYTES} \\ sampling=${SAMPLING_N} polling=${POLLING_SECS} \\ -- set bridge ${m_bridge} sflow=@sflow # æ‰§è¡ŒæˆåŠŸåè¿”å› sFlow UUID # åˆ é™¤sFlowç›‘å¬é¡¹ç›® sudo ovs-vsctl remove bridge ${m_bridge} sflow \u0026lt;sFlow UUID\u0026gt; # æŸ¥çœ‹å…¨éƒ¨ç›‘å¬ sudo ovs-vsctl list sflow æµè§ˆå™¨æ‰“å¼€ http://localhost:8087 æˆ– https://localhost:8443, å¦‚æœæ˜¯è¿œç¨‹ä¸»æœºè®¿é—®å°†localhostæ”¹ä¸ºè¿è¡Œè¿™ä¸ªå®¹å™¨/appçš„ä¸»æœºIP\nè¿™é‡Œæœ‰ä¸€äº›åŸºæœ¬çš„ä½¿ç”¨è¯´æ˜\næœ€åç»“æœé‡‡é›†çš„å¾ˆè¯¦ç»†ï¼Œä½†æ˜¯ä¸»æœºè´Ÿè½½ä¹‹ç±»çš„æ•°æ®æ²¡æœ‰é‡‡é›†ï¼Œåº”è¯¥æ˜¯éœ€è¦snmpåè®®ç›‘å¬æ‰æœ‰ã€‚\nsFlowã€NetFlowã€SNMPä¸‰è€…ä¹‹é—´æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ\nç½‘ç»œæ‹“æ‰‘: ç­›é€‰æµé‡: ","id":14,"section":"posts","summary":"OVS ä»‹ç» Open virtual Switch æ˜¯ä¸€ä¸ªåœ¨ Apache2è®¸å¯æˆæƒçš„ å¼€æºå¤šå±‚è½¯ä»¶äº¤æ¢æœºã€‚ç›®æ ‡æ˜¯å®ç°ä¸€ä¸ªäº§å“è´¨é‡çš„äº¤æ¢æœºå¹³å°ï¼Œæ”¯æŒæ ‡å‡†çš„ç®¡ç†æ¥å£ï¼Œå¹¶å¼€æ”¾è½¬å‘åŠŸèƒ½ï¼Œä»¥ä¾›","tags":["linux","network"],"title":"OVS å­¦ä¹ ç¬”è®°","uri":"https://liangkang233.github.io/2021/12/ovs%E5%AD%A6%E4%B9%A0/","year":"2021"},{"content":"æœ€è¿‘åœ¨åšä¸€ä¸ªå…³äºåº”ç”¨ä¸Šäº‘çš„æµ‹è¯•ï¼Œäºæ˜¯çœ‹åˆ°æœ‰åä¸ºäº‘çš„å…è´¹æœåŠ¡å™¨è¯•ç”¨å°±æ³¨å†Œäº†ä¸€ä¸ªï¼Œè®°å½•ä¸‹æ“ä½œå¤‡å¿˜ã€‚\nä¸ªäººç”¨æˆ·å®åæ³¨å†Œå³å¯é¢†å–ä¸€ä¸ªä½æ€§èƒ½çš„2æ ¸4gçš„æœåŠ¡å™¨ï¼Œè¯•ç”¨15å¤©ã€‚é¢†å–é“¾æ¥\nåˆå§‹åŒ–æ“ä½œ é¢†å–æˆåŠŸåï¼ŒæŒ‰ç…§åˆ›å»ºæ­¥éª¤å³å¯ã€‚å¦‚æœæ²¡æœ‰è®¾å®šç™»å½•å¯†ç çš„ï¼Œåœ¨æ§åˆ¶å°è®¾ç½®å³å¯ã€‚å¼¹æ€§å…¬ç½‘å³ä¸ºæœåŠ¡å™¨çš„å…¬ç½‘IPï¼Œä¸å…¶é“¾æ¥é€šä¿¡è¯•ç”¨è¿™ä¸ªipã€‚ è¿œç¨‹ç™»å½•å¯ä»¥è¯•ç”¨ CloudShell VNC Xshell shell ç­‰ç™»å½•ï¼Œå…ˆä½¿ç”¨VNCè®¾ç½®åˆå§‹å¯†ç ï¼Œç½‘ç»œå®‰å…¨ç»„çš„å…¥ç«™ç­‰è§„åˆ™ã€‚ æ­¤é¡µé¢ä¹Ÿå¯æŸ¥è¯¢æœåŠ¡å™¨è¯¦ç»†ä¸€æ®µæ—¶é—´å†…è¿è¡ŒçŠ¶æ€ éœ€è¦çš„åˆæ­¥æ“ä½œï¼š æ·»åŠ æ™®é€šç”¨æˆ·\nroot ç”¨æˆ·æƒé™å¤ªå¤§ï¼Œä¸ºäº†ä»¥é˜²è¯¯æ“ä½œå’Œå¼€å‘éœ€è¦ï¼Œéœ€è¦æ–°å»ºä¸€ä¸ªæœ‰rootæƒé™çš„æ™®é€šç”¨æˆ·ã€‚\n# åˆ›å»ºç”¨æˆ· sudo adduser username ## å‘½ä»¤å°†å‘ä½ è¯¢é—®ä¸€ç³»åˆ—çš„é—®é¢˜ã€‚å¯†ç æ˜¯å¿…éœ€çš„ï¼Œå…¶ä»–å­—æ®µéƒ½æ˜¯å¯é€‰çš„ã€‚ Enter new UNIX password: Retype new UNIX password: passwd: password updated successfully Changing the user information for username Enter the new value, or press ENTER for the default Full Name []: Room Number []: Work Phone []: Home Phone []: Other []: Is the information correct? [Y/n] # æœ€åï¼Œè¾“å…¥Yç¡®è®¤ä¿¡æ¯æ˜¯å¦æ­£ç¡®ã€‚ # å¦‚æœæ‚¨å¸Œæœ›æ–°åˆ›å»ºçš„ç”¨æˆ·å…·æœ‰ç®¡ç†æƒé™ï¼Œè¯·å°†ç”¨æˆ·æ·»åŠ åˆ°sudoç»„ï¼š sudo usermod -aG sudo username # æ‚¨å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªå‘½ä»¤è¡Œå·¥å…·æ¥åˆ é™¤ç”¨æˆ·å¸æˆ·ï¼šuserdelå’Œdeluserã€‚åœ¨Ubuntuä¸Šï¼Œå»ºè®®æ‚¨ä½¿ç”¨deluserå‘½ä»¤ï¼Œå› ä¸ºå®ƒæ¯”userdel æ›´å‹å¥½ã€‚ # è¦åˆ é™¤ç”¨æˆ·è€Œä¸åˆ é™¤ç”¨æˆ·æ–‡ä»¶ï¼Œè¯·è¿è¡Œï¼š sudo deluser username # å¦‚æœè¦åˆ é™¤å¹¶ä¸”ç”¨æˆ·çš„å®¶ç›®å½•å’Œé‚®ä»¶ä½¿ç”¨--remove-homeé€‰é¡¹ï¼š sudo deluser --remove-home username sshå…¬é’¥å…å¯†ç™»å½•\næˆ‘æ›´ä¹ æƒ¯ç›´æ¥ä½¿ç”¨sshç™»å½•è¿œç¨‹æœåŠ¡å™¨ï¼Œæ‰€ä»¥è®¾ç½®å…å¯†ç™»å½•å¾ˆæœ‰å¿…è¦\napt-get install openssh-server openssh-client # å¦‚æœæ²¡æœ‰æˆ–è€…éœ€è¦ä¸€ä¸ªæ–°å…¬ç§é’¥çš„åˆ›å»ºå‘½ä»¤ ssh-keygen -t rsa -f ~/.ssh/cloud # å¤åˆ¶å…¬é’¥ï¼Œéœ€è¦ç™»å½•é‚£ä¸ªç”¨æˆ·å°±å¤åˆ¶åˆ°å“ª ssh-copy-id -i ~/.ssh/cloud.pub root@å¼¹æ€§å…¬ç½‘IP X11å›¾å½¢ç•Œé¢å…è®¸\nå¦‚æœéœ€è¦ç¬¦åˆä¼ è¾“X11åè®®çš„å›¾å½¢ç•Œé¢éœ€è¦ç¡®ä¿sshç™»å½•åï¼š\nç¯å¢ƒè¯´æ˜ï¼š Aä¸»æœºsshè¿æ¥Bä¸»æœºï¼ŒAä½¿ç”¨X11æœåŠ¡æ˜¾ç¤ºä½¿ç”¨Bä¸»æœºçš„codeç­‰ç•Œé¢ a. é¦–å…ˆç¡®ä¿Aå¯ä»¥è¿æ¥ä¸ŠBä¸»æœº b. è®¾ç½®ä¸»æœºAè¿è¡Œå…¶ä»–æœåŠ¡å™¨çš„ X11 ç•Œé¢ï¼š xhost + c. è®¾ç½®ä¸»æœºA sudo vim /etc/ssh/ssh_config ForwardAgent yes ForwardX11 yes ForwardX11Trusted yes d. è®¾ç½®ä¸»æœºBçš„ daemon é…ç½®X11è½¬å‘ sudo vim /etc/ssh/sshd_config #è¡¥å……ä¸‹é¢è¿™è¡Œ,æˆ‘è¿™å°æœåŠ¡å™¨æ˜¯å·²ç»é…ç½®å¥½çš„ã€‚ X11Forwarding yes #ç¡®ä¿æ­£ç¡®åé‡å¯ssh daemon sudo systemctl restart sshd æœ€åè¿æ¥Bä¸»æœºå³å¯ ssh -X username@Bä¸»æœº(IP) æ›´æ”¹ä¸»æœºå\nå¦‚æœä½ åœ¨ä¸€ä¸ªäº‘å®ä¾‹ä¸Šè¿è¡Œ Ubuntuï¼Œå¹¶ä¸”å®‰è£…äº†cloud-initè½¯ä»¶åŒ…ï¼Œä½ ä¹Ÿå¯ä»¥ç¼–è¾‘/etc/cloud/cloud.cfgæ–‡ä»¶ã€‚è¿™ä¸ªè½¯ä»¶åŒ…ç”±äº‘æœåŠ¡å™¨å‚å•†æä¾›ï¼Œé€šå¸¸é»˜è®¤è¢«å®‰è£…ï¼Œå¹¶ä¸”å®ƒå¯ä»¥è¢«ç”¨æ¥å¤„ç†äº‘æœåŠ¡å™¨å®ä¾‹çš„åˆå§‹åŒ–ã€‚å¦‚æœæ–‡ä»¶å­˜åœ¨äºä½ çš„ç³»ç»Ÿä¸Šï¼Œæ‰“å¼€å®ƒï¼šsudo nano /etc/cloud/cloud.cfgæœç´¢\u0026quot;preserve_hostnameâ€,å¹¶ä¸”å°†å€¼ä»falseä¿®æ”¹åˆ°trueã€‚\n#This will cause the set+update hostname module to not operate (if true) preserve_hostname: true # ä¿å­˜æ–‡ä»¶ï¼Œå¹¶ä¸”å…³é—­ç¼–è¾‘å™¨è¿è¡Œå‘½ä»¤ hostnamectl sethostname YOUR_define_name è¿œç¨‹Vscode è™½ç„¶æœåŠ¡å™¨è‡ªå¸¦vimç­‰ç¼–è¾‘å™¨ï¼Œä½†æ˜¯è¿˜æ˜¯vscodeç”¨çš„é¡ºæ‰‹ï¼Œä¸‹é¢æ˜¯é…ç½®è¿œç«¯ç™»å½•vscodeçš„è®°å½•ã€‚ï¼ˆç”¨x11æ‰“å¼€çš„vscodeå¤ªå¡ï¼Œä¸æ¨èå¦‚æ­¤ä½¿ç”¨ï¼‰\næ‰“å¼€æœ¬åœ°ä¸»æœºçš„vscodeæ‰©å±•å•†åº—ï¼Œæœç´¢å®‰è£… Remote - SSH: Editing Configuration Files ms-vscode-remote.remote-ssh-edit ä¹‹åæ‰“å¼€æ­¤æ‰©å±•è®¾å®šè¿œç¨‹ç™»å½•çš„IPå’Œç”¨æˆ· å¯æ˜¯å¯åŠ¨è¿œç¨‹ç™»å½•æ—¶ssh Serverå¡åœ¨Setting up SSH Host XX: Downloading VS Code Server\né‡æ–°è¿æ¥åæœ‰detailé€‰é¡¹ï¼Œæ‰“å¼€æ˜¾ç¤ºçš„éƒ¨åˆ†æ—¥å¿—å¦‚ä¸‹ï¼š\n[14:30:07.314] Log Level: 2 [14:30:07.317] remote-ssh@0.66.0 [14:30:07.318] linux x64 [14:30:07.321] SSH Resolver called for \u0026quot;ssh-remote+cloud-huawei-root\u0026quot;, attempt 1 [14:30:07.322] \u0026quot;remote.SSH.useLocalServer\u0026quot;: true [14:30:07.322] \u0026quot;remote.SSH.path\u0026quot;: undefined [14:30:07.322] \u0026quot;remote.SSH.configFile\u0026quot;: undefined [14:30:07.322] \u0026quot;remote.SSH.useFlock\u0026quot;: true [14:30:07.323] \u0026quot;remote.SSH.lockfilesInTmp\u0026quot;: false [14:30:07.323] \u0026quot;remote.SSH.localServerDownload\u0026quot;: auto [14:30:07.323] \u0026quot;remote.SSH.remoteServerListenOnSocket\u0026quot;: false [14:30:07.323] \u0026quot;remote.SSH.showLoginTerminal\u0026quot;: false [14:30:07.324] \u0026quot;remote.SSH.defaultExtensions\u0026quot;: [] [14:30:07.324] \u0026quot;remote.SSH.loglevel\u0026quot;: 2 [14:30:07.325] SSH Resolver called for host: cloud-huawei-root [14:30:07.325] Setting up SSH remote \u0026quot;cloud-huawei-root\u0026quot; [14:30:07.331] Acquiring local install lock: /tmp/vscode-remote-ssh-fd33cb2f-install.lock [14:30:07.352] Looking for existing server data file at /home/lk233/.config/Code/User/globalStorage/ms-vscode-remote.remote-ssh/vscode-ssh-host-fd33cb2f-b4c1bd0a9b03c749ea011b06c6d2676c8091a70c-0.66.0/data.json [14:30:07.356] Using commit id \u0026quot;b4c1bd0a9b03c749ea011b06c6d2676c8091a70c\u0026quot; and quality \u0026quot;stable\u0026quot; for server [14:30:07.368] Install and start server if needed [14:30:07.379] PATH: /home/lk233/.local/bin:/home/lk233/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/home/lk233/.local/bin:/home/lk233/go/bin:/usr/local/go/bin:/home/lk233/.local/bin:/home/lk233/.local/bin [14:30:07.380] Checking ssh with \u0026quot;ssh -V\u0026quot; [14:30:07.418] \u0026gt; OpenSSH_7.6p1 Ubuntu-4ubuntu0.3, OpenSSL 1.0.2n 7 Dec 2017 [14:30:07.429] askpass server listening on /run/user/1000/vscode-ssh-askpass-40f6502d1f6ea56e214539b4c7f7cd72b715cc8b.sock [14:30:07.430] Spawning local server with {\u0026quot;serverId\u0026quot;:1,\u0026quot;ipcHandlePath\u0026quot;:\u0026quot;/run/user/1000/vscode-ssh-askpass-2918dcdc514eef86200f16b5db8a75360fbea57c.sock\u0026quot;,\u0026quot;sshCommand\u0026quot;:\u0026quot;ssh\u0026quot;,\u0026quot;sshArgs\u0026quot;:[\u0026quot;-v\u0026quot;,\u0026quot;-T\u0026quot;,\u0026quot;-D\u0026quot;,\u0026quot;45283\u0026quot;,\u0026quot;-o\u0026quot;,\u0026quot;ConnectTimeout=15\u0026quot;,\u0026quot;cloud-huawei-root\u0026quot;],\u0026quot;dataFilePath\u0026quot;:\u0026quot;/home/lk233/.config/Code/User/globalStorage/ms-vscode-remote.remote-ssh/vscode-ssh-host-fd33cb2f-b4c1bd0a9b03c749ea011b06c6d2676c8091a70c-0.66.0/data.json\u0026quot;} [14:30:07.430] Local server env: {\u0026quot;DISPLAY\u0026quot;:\u0026quot;:0\u0026quot;,\u0026quot;ELECTRON_RUN_AS_NODE\u0026quot;:\u0026quot;1\u0026quot;,\u0026quot;SSH_ASKPASS\u0026quot;:\u0026quot;/home/lk233/.vscode/extensions/ms-vscode-remote.remote-ssh-0.66.0/out/local-server/askpass.sh\u0026quot;,\u0026quot;VSCODE_SSH_ASKPASS_NODE\u0026quot;:\u0026quot;/usr/share/code/code\u0026quot;,\u0026quot;VSCODE_SSH_ASKPASS_MAIN\u0026quot;:\u0026quot;/home/lk233/.vscode/extensions/ms-vscode-remote.remote-ssh-0.66.0/out/askpass-main.js\u0026quot;,\u0026quot;VSCODE_SSH_ASKPASS_HANDLE\u0026quot;:\u0026quot;/run/user/1000/vscode-ssh-askpass-40f6502d1f6ea56e214539b4c7f7cd72b715cc8b.sock\u0026quot;} [14:30:07.447] Spawned 11142 [14:30:07.653] \u0026gt; local-server-1\u0026gt; Spawned ssh, pid=11150 [14:30:07.659] stderr\u0026gt; OpenSSH_7.6p1 Ubuntu-4ubuntu0.3, OpenSSL 1.0.2n 7 Dec 2017 [14:30:07.914] stderr\u0026gt; debug1: Server host key: ecdsa-sha2-nistp256 SHA256:TeikcLf0gyEyeAnlAgObhrs6PKRrfQQeW6zLEFgFiA4 [14:30:08.172] stderr\u0026gt; Authenticated to 123.60.23.165 ([123.60.23.165]:22). [14:30:08.977] \u0026gt; Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-70-generic aarch64) \u0026gt; \u0026gt; * Documentation: https://help.ubuntu.com \u0026gt; * Management: https://landscape.canonical.com \u0026gt; * Support: https://ubuntu.com/advantage \u0026gt; \u0026gt; System information as of Sun Nov 14 14:30:08 CST 2021 \u0026gt; \u0026gt; System load: 0.05 Processes: 99 \u0026gt; Usage of /: 10.2% of 38.63GB Users logged in: 0 \u0026gt; Memory usage: 6% IP address for eth0: 192.168.0.20 \u0026gt; Swap usage: 0% \u0026gt; ***** æŸ¥äº†ä¸‹æœç„¶æ˜¯è¿™ä¸ªvscode-serveråŒ…éœ€è¦ç§‘å­¦ä¸Šç½‘ï¼Œæ‰€ä»¥äº‘æœåŠ¡å™¨æ— æ³•è¿æ¥ä¸Šã€‚ åªèƒ½æŒ‰ç…§How can I install vscode-server in linux offlineç±»ä¼¼çš„å®‰è£…äº†ã€‚ä¸è¿‡é‡Œé¢é—®é¢˜æé—®çš„äººçš„æ˜¯x86æ¶æ„çš„åŒ…ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ARMçš„åŒ…ã€‚\nä¸Šé¢æ—¥å¿—å¯ä»¥çœ‹åˆ°æœ‰ä¸€å¥Using commit id \u0026ldquo;b4c1bd0a9b03c749ea011b06c6d2676c8091a70c\u0026rdquo; and quality \u0026ldquo;stable\u0026rdquo; for serverï¼Œè¿™ä¸ªç­‰ä»·æ›¿æ¢ä¸Šé¢é—®é¢˜çš„è§£å†³æ–¹æ¡ˆçš„commitidå³å¯ã€‚å…¶å®ç›´æ¥æŸ¥çœ‹ä¸»æœºè¿è¡Œçš„code ç›¸å…³è¿›ç¨‹å³å¯çœ‹åˆ°ï¼š\nroot@cloud:~# ps aux | grep code root 507 0.0 0.1 11488 5940 ? S 14:27 0:00 wget --tries=1 --connect-timeout=7 --dns-timeout=7 -nv -O vscode-server.tar.gz https://update.code.visualstudio.com/commit:b4c1bd0a9b03c749ea011b06c6d2676c8091a70c/server-linux-arm64/stable root 5321 0.0 0.0 5672 664 pts/0 S+ 14:31 0:00 grep --color=auto code æ€»ç»“ä¸‹è§£å†³æ–¹æ¡ˆï¼š\næœ¬åœ°ä¸‹å¥½å¯¹åº”åŒ… æˆ‘çš„ç‰ˆæœ¬çš„ commit id = b4c1bd0a9b03c749ea011b06c6d2676c8091a70cï¼Œä½¿ç”¨stableç‰ˆæœ¬ï¼ˆinsideé¢„è§ˆä¸æ¨èï¼‰ æµè§ˆå™¨æˆ–wgetä¸‹è½½https://update.code.visualstudio.com/commit:b4c1bd0a9b03c749ea011b06c6d2676c8091a70c/server-linux-arm64/stable scpå¤åˆ¶è¯¥å‹ç¼©åŒ…ä¸Šä¼ äº‘æœåŠ¡å™¨ $ scp /home/localuser/vscode-server-linux-arm64.tar.gz user@123.60.23.165:/home/user/ è§£å‹å¹¶è®¾å®šçŠ¶æ€ å¦‚æœä¹‹å‰ä¸‹è½½å¤±è´¥äº†è®°å¾—æŠŠcommitå¯¹åº”æ–‡ä»¶å¤¹æ¸…ç©ºï¼Œæˆ–è€…æ–°å»ºä¸€ä¸ªã€‚userå¯¹åº”äº‘æœåŠ¡å™¨ç”¨æˆ·åä¸€èˆ¬ä¸º /root/.vscode-server-insiders/bin/${commit_id} æˆ–è€… /home/user/.vscode-server-insiders/bin/${commit_id} tar zxvf ./vscode-server-linux-x64.tar.gz -C /home/user/.vscode-server-insiders/bin/${commit_id} --strip 1 touch /home/user/.vscode-server-insiders/bin/${commit_id}/0 æœ€åï¼Œå®‰è£…å®Œæ¯•ï¼Œç™»å½•æˆåŠŸå¦‚ä¸‹æ‰€ç¤º å½“ç„¶ï¼Œè¦è®°å¾—å…³é—­åå°æ›´æ–°ã€‚\n","id":15,"section":"posts","summary":"æœ€è¿‘åœ¨åšä¸€ä¸ªå…³äºåº”ç”¨ä¸Šäº‘çš„æµ‹è¯•ï¼Œäºæ˜¯çœ‹åˆ°æœ‰åä¸ºäº‘çš„å…è´¹æœåŠ¡å™¨è¯•ç”¨å°±æ³¨å†Œäº†ä¸€ä¸ªï¼Œè®°å½•ä¸‹æ“ä½œå¤‡å¿˜ã€‚ ä¸ªäººç”¨æˆ·å®åæ³¨å†Œå³å¯é¢†å–ä¸€ä¸ªä½æ€§èƒ½çš„2æ ¸4gçš„","tags":["linux"],"title":"åä¸ºäº‘æœåŠ¡å™¨æŠ˜è…¾è®°å½•","uri":"https://liangkang233.github.io/2021/11/%E5%8D%8E%E4%B8%BA%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/","year":"2021"},{"content":"å…ˆç®€å•ä»‹ç»å‡ ä¸ªåŸºç¡€æ¦‚å¿µï¼š é€’å½’ é€’å½’æ˜¯é‡å¤è°ƒç”¨å‡½æ•°è‡ªèº«å®ç°å¾ªç¯ã€‚è¿­ä»£æ˜¯å‡½æ•°å†…æŸæ®µä»£ç å®ç°å¾ªç¯ã€‚ å…¶ä¸­ï¼Œè¿­ä»£ä¸æ™®é€šå¾ªç¯çš„åŒºåˆ«æ˜¯ï¼šè¿­ä»£æ—¶ï¼Œå¾ªç¯ä»£ç ä¸­å‚ä¸è¿ç®—çš„å˜é‡åŒæ—¶æ˜¯ä¿å­˜ç»“æœçš„å˜é‡ï¼Œå½“å‰ä¿å­˜çš„ç»“æœä½œä¸ºä¸‹ä¸€æ¬¡å¾ªç¯è®¡ç®—çš„åˆå§‹å€¼ã€‚å…¸å‹çš„åº”ç”¨æœ‰æ·±åº¦æœç´¢dfs\nè¿­ä»£ é€’å½’å¾ªç¯ä¸­ï¼Œé‡åˆ°æ»¡è¶³ç»ˆæ­¢æ¡ä»¶çš„æƒ…å†µæ—¶é€å±‚è¿”å›æ¥ç»“æŸã€‚è¿­ä»£åˆ™ä½¿ç”¨è®¡æ•°å™¨ç»“æŸå¾ªç¯ã€‚ å½“ç„¶å¾ˆå¤šæƒ…å†µéƒ½æ˜¯å¤šç§å¾ªç¯æ··åˆé‡‡ç”¨ï¼Œè¿™è¦æ ¹æ®å…·ä½“éœ€æ±‚.åœ¨å¾ªç¯çš„æ¬¡æ•°è¾ƒå¤§çš„æ—¶å€™ï¼Œè¿­ä»£çš„æ•ˆç‡æ˜æ˜¾é«˜äºé€’å½’,ä½†æ˜¯ä¸æ˜“äºç†è§£ã€‚å…¸å‹åº”ç”¨æœ‰bfsä¸­éå†é˜Ÿåˆ—ã€‚\nå¯¹äºæ–æ³¢é‚£å¥‘æ•°åˆ—\n// é€’å½’æ–¹æ³• int fibonacci_sequence_recursion(int n) { return (n \u0026amp;lt; 2) ? n : fibonacci_sequence_recursion(n - 1) + fibonacci_sequence_recursion(n - 2); } // è¿­ä»£æ–¹æ³• int fibonacci_sequence_loop(int n) { if (n \u0026amp;lt; 2) return n; int before = 0; int last = 1; while (1 \u0026amp;lt; n--) { last = before + last; before = last - before; } return last; } äº”å¤§åŸºæœ¬ç®—æ³•ï¼š ç©·ä¸¾ enumerate æšä¸¾çš„æ€æƒ³æ˜¯ä¸æ–­åœ°çŒœæµ‹ï¼Œä»å¯èƒ½çš„é›†åˆä¸­ä¸€ä¸€å°è¯•ï¼Œç„¶åå†åˆ¤æ–­é¢˜ç›®çš„æ¡ä»¶æ˜¯å¦æˆç«‹ã€‚ æšä¸¾çš„æ—¶å€™è¦æƒ³æ¸…æ¥šï¼šå¯èƒ½çš„æƒ…å†µæ˜¯ä»€ä¹ˆï¼Ÿè¦æšä¸¾å“ªäº›è¦ç´ ï¼Ÿ æšä¸¾çš„èŒƒå›´æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯æ‰€æœ‰çš„å†…å®¹éƒ½éœ€è¦æšä¸¾å—ï¼Ÿ\nåœ¨ç”¨æšä¸¾æ³•è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œä¸€å®šè¦æƒ³æ¸…æ¥šè¿™ä¸¤ä»¶äº‹ï¼Œå¦åˆ™ä¼šå¸¦æ¥ä¸å¿…è¦çš„æ—¶é—´å¼€é”€ã€‚\nè´ªå¿ƒ greedy åœ¨æ¯ä¸€æ­¥é€‰æ‹©ä¸­éƒ½é‡‡å–åœ¨å½“å‰çŠ¶æ€ä¸‹æœ€å¥½æˆ–æœ€ä¼˜ï¼ˆå³æœ€æœ‰åˆ©ï¼‰çš„é€‰æ‹©ï¼Œä»è€Œå¸Œæœ›å¯¼è‡´ç»“æœæ˜¯æœ€å¥½æˆ–æœ€ä¼˜çš„ç®—æ³•ã€‚æ¯”å¦‚åœ¨æ—…è¡Œæ¨é”€å‘˜é—®é¢˜ä¸­ï¼Œå¦‚æœæ—…è¡Œå‘˜æ¯æ¬¡éƒ½é€‰æ‹©æœ€è¿‘çš„åŸå¸‚ï¼Œé‚£è¿™å°±æ˜¯ä¸€ç§è´ªå¿ƒç®—æ³•ã€‚\nè´ªå¿ƒç®—æ³•ä¸åŠ¨æ€è§„åˆ’çš„ä¸åŒåœ¨äºå®ƒå¯¹æ¯ä¸ªå­é—®é¢˜çš„è§£å†³æ–¹æ¡ˆéƒ½åšå‡ºé€‰æ‹©ï¼Œä¸èƒ½å›é€€ã€‚åŠ¨æ€è§„åˆ’åˆ™ä¼šä¿å­˜ä»¥å‰çš„è¿ç®—ç»“æœï¼Œå¹¶æ ¹æ®ä»¥å‰çš„ç»“æœå¯¹å½“å‰è¿›è¡Œé€‰æ‹©ï¼Œæœ‰å›é€€åŠŸèƒ½ã€‚\nåˆ†æ²» divide-and-conquer æŠŠé—®é¢˜åˆ†è§£æˆè§„æ¨¡å°çš„é—®é¢˜ï¼Œå†å»é€’å½’(æˆ–è¿­ä»£)è§£å†³ã€‚\næ³¨æ„äºŒåˆ†æœç´¢(binary-search)æ¯æ¬¡éƒ½è¦èˆå¼ƒä¸€åŠï¼Œä»ç•™ä¸‹çš„ä¸€åŠä¸­å¯»æ‰¾ç›®æ ‡ï¼›è€Œåˆ†æ²»æ³•æŠŠä¸€ä¸ªå¤§é—®é¢˜åˆ†æˆä¸¤ä¸ªæˆ–å¤šä¸ªå°é—®é¢˜\nå½’å¹¶æ’åº void merge_sort_recursive(int arr[], int reg[], int start, int end) { if (start \u0026gt;= end) return; int len = end - start, mid = (len \u0026gt;\u0026gt; 1) + start; int start1 = start, end1 = mid; int start2 = mid + 1, end2 = end; merge_sort_recursive(arr, reg, start1, end1); merge_sort_recursive(arr, reg, start2, end2); int k = start; while (start1 \u0026lt;= end1 \u0026amp;\u0026amp; start2 \u0026lt;= end2) reg[k++] = arr[start1] \u0026lt; arr[start2] ? arr[start1++] : arr[start2++]; while (start1 \u0026lt;= end1) reg[k++] = arr[start1++]; while (start2 \u0026lt;= end2) reg[k++] = arr[start2++]; for (k = start; k \u0026lt;= end; k++) arr[k] = reg[k]; } void merge_sort(int arr[], const int len) { int reg[len]; merge_sort_recursive(arr, reg, 0, len - 1); } æ±‰è¯ºå¡”é—®é¢˜ #!/usr/bin/env python3 # -*- coding: utf-8 -*- def move(n, a, b, c): if n == 1: print(a, '--\u0026gt;', c) return move(n-1, a, c, b) print(a, '--\u0026gt;', c) move(n-1, b, a, c) a = input(\u0026quot;è¯·è¾“å…¥æ±‰å°¼å¡”Açš„ä¸ªæ•°: \u0026quot;) move(int(a), 'A', 'B', 'C') \u0026quot;\u0026quot;\u0026quot; æ€»æ¬¡æ•°ä¸€å®šä¸º 2^n - 1 å¯ä»¥æŠŠç›˜å­çœ‹æˆä¸¤éƒ¨åˆ†ï¼Œæœ€ä¸‹é¢çš„ç¬¬nä¸ªå’Œä¸Šé¢çš„n-1ä¸ªï¼Œå®Œæˆæ‰€æœ‰ç›˜å­çš„ä»aåˆ°cå¯ä»¥åˆ†è§£ä¸º3æ­¥: 1.æŠŠä¸Šé¢n-1ä¸ªç›˜å­ä»aç§»åŠ¨åˆ°b 2.æŠŠæœ€ä¸‹é¢çš„ç¬¬nä¸ªç›˜å­ä»aç§»åŠ¨åˆ°c 3.æŠŠåœ¨bä¸Šçš„n-1ä¸ªç›˜å­ç§»åŠ¨åˆ°c è¿™æ ·ä»æœ€åä¸€æ­¥å¾€å‰n-1ä¸ªåˆ†è§£ï¼Œåªä¸è¿‡æ­¥éª¤1å’Œ3ä¸­çš„ç§»åŠ¨å‰n-1ä¸ªä¸æ˜¯å€ŸåŠ©bä»aç§»åŠ¨åˆ°cï¼Œè€Œåˆ†åˆ«æ˜¯ï¼Œå€ŸåŠ©cä»aåˆ°bå’Œå€ŸåŠ©aä»båˆ°cã€‚ è¿™æ ·å°±åˆ†è§£æˆäº†n-1ä¸ªç›˜å­çš„æ±‰è¯ºå¡”é—®é¢˜ï¼Œä¸€ç›´ç”¨è¿™ä¸‰æ­¥è¿­ä»£åˆ†è§£ä¸€ç›´åˆ°nç­‰äº1ã€‚ \u0026quot;\u0026quot;\u0026quot; å›æº¯ backtracking å›æº¯æ³•ç®€å•æ¥è¯´å°±æ˜¯æŒ‰ç…§æ·±åº¦ä¼˜å…ˆçš„é¡ºåºï¼Œç©·ä¸¾æ‰€æœ‰å¯èƒ½æ€§çš„ç®—æ³•ï¼Œä½†æ˜¯å›æº¯ç®—æ³•æ¯”æš´åŠ›ç©·ä¸¾æ³•æ›´é«˜æ˜çš„åœ°æ–¹å°±æ˜¯å›æº¯ç®—æ³•å¯ä»¥éšæ—¶åˆ¤æ–­å½“å‰çŠ¶æ€æ˜¯å¦ç¬¦åˆé—®é¢˜çš„æ¡ä»¶ã€‚ä¸€æ—¦ä¸ç¬¦åˆæ¡ä»¶ï¼Œé‚£ä¹ˆå°±é€€å›åˆ°ä¸Šä¸€ä¸ªçŠ¶æ€ï¼Œçœå»äº†ç»§ç»­å¾€ä¸‹æ¢ç´¢çš„æ—¶é—´ã€‚æ‰€ä»¥æ ¹æ®è¿™ç±»é—®é¢˜ï¼Œä¸€èˆ¬ä¼šæœ‰ä¼˜åŒ–å‰ªæç­–ç•¥ä»¥åŠå¯å‘å¼æœç´¢ç­–ç•¥ã€‚\nå¤šè¯´æ— ç›Šï¼Œç»™å‡ºå‡ ä¸ªå…·ä½“ä¾‹å­ï¼š\nç»å…¸å…«çš‡åé—®é¢˜\nå…«çš‡åé—®é¢˜æ˜¯ä¸€ä¸ªä»¥å›½é™…è±¡æ£‹ä¸ºèƒŒæ™¯çš„é—®é¢˜ï¼šå¦‚ä½•èƒ½å¤Ÿåœ¨8Ã—8çš„å›½é™…è±¡æ£‹æ£‹ç›˜ä¸Šæ”¾ç½®å…«ä¸ªçš‡åï¼Œ ä½¿å¾—ä»»ä½•ä¸€ä¸ªçš‡åéƒ½æ— æ³•ç›´æ¥åƒæ‰å…¶ä»–çš„çš‡åï¼Ÿä¸ºäº†è¾¾åˆ°æ­¤ç›®çš„ï¼Œä»»ä¸¤ä¸ªçš‡åéƒ½ä¸èƒ½å¤„äºåŒä¸€æ¡æ¨ªè¡Œã€çºµè¡Œæˆ–æ–œçº¿ä¸Šã€‚å…«çš‡åé—®é¢˜å¯ä»¥æ¨å¹¿ä¸ºæ›´ä¸€èˆ¬çš„nçš‡åæ‘†æ”¾é—®é¢˜ï¼šè¿™æ—¶æ£‹ç›˜çš„å¤§å°å˜ä¸ºnÃ—nï¼Œè€Œçš‡åä¸ªæ•°ä¹Ÿå˜æˆnã€‚å½“ä¸”ä»…å½“n = 1æˆ–n â‰¥ 4æ—¶é—®é¢˜æœ‰è§£[1]ã€‚*/\n#include \u0026lt;iostream\u0026gt; using namespace std; const int N = 8; int arr[10], total_cnt; // arrè®°å½•æ¯ä¸€è¡Œ(X)çš‡åçš„Yåæ ‡ bool isPlaceOK(int *a, int n, int c) { for (int i = 1; i \u0026lt;= n - 1; ++i) { if (a[i] == c || a[i] - i == c - n || a[i] + i == c + n) return false; //æ£€æŸ¥ä½ç½®æ˜¯å¦å¯ä»¥æ”¾ (nè¡Œcåˆ—)æ˜¯å°†è¦æ”¾ç½®çš„ä½ç½® //a[i] == cå¦‚æœæ”¾åœ¨åŒä¸€åˆ—ï¼Œfalse //a[i] -+ i = c -+ n å¦‚æœåœ¨å¯¹è§’çº¿ä¸Šï¼Œï¼ˆå¤„åœ¨åŒä¸€å·¦(å³)å¯¹è§’,è¡Œåˆ—å€¼åªå·®(å’Œ)ç›¸åŒï¼‰ false } return true; } void printSol(int *a) { for (int i = 1; i \u0026lt;= N; ++i) { //éå†æ¯ä¸€è¡Œ for (int j = 1; j \u0026lt;= N; ++j) { //éå†æ¯ä¸€åˆ— cout \u0026lt;\u0026lt; (a[i] == j ? \u0026quot;X\u0026quot; : \u0026quot;-\u0026quot;) \u0026lt;\u0026lt; \u0026quot; \u0026quot;;; } //å¦‚æœæ ‡è®°æ•°ç»„ä¸­è¿™ä¸€è¡Œçš„çš‡åæ”¾åœ¨jä½ç½®ï¼Œåˆ™è¾“å‡ºXï¼Œå¦åˆ™è¾“å‡º-ï¼Œ //ç”¨ç©ºæ ¼åˆ†éš” cout \u0026lt;\u0026lt; endl; //æ¯ä¸€è¡Œè¾“å‡ºä¸€ä¸ªæ¢è¡Œ } cout \u0026lt;\u0026lt; endl; //æ¯ä¸€ç»„æ•°æ®ä¸€ä¸ªæ¢è¡Œåˆ†éš” } void addQueen(int *a, int n) { if (n \u0026gt; N) { //nä»£è¡¨ä»ç¬¬ä¸€è¡Œå¼€å§‹æ”¾ç½® printSol(a); total_cnt++; return ; } for (int i = 1; i \u0026lt;= N; ++i) { //iä»ç¬¬1åˆ—åˆ°ç¬¬Nåˆ—éå† if (isPlaceOK(a, n, i)) { a[n] = i; //å¦‚æœå¯ä»¥æ”¾ç½®ï¼Œå°±æŠŠçš‡åæ”¾åœ¨ç¬¬nè¡Œç¬¬iåˆ— addQueen(a, n + 1); } } } int main() { addQueen(arr, 1); cout \u0026lt;\u0026lt; \u0026quot;total: \u0026quot; \u0026lt;\u0026lt; total_cnt \u0026lt;\u0026lt; \u0026quot; solutions.\\n\u0026quot;; return 0; } åˆ†å‰²å›æ–‡ä¸² class Solution { public: vector\u0026lt;vector\u0026lt;string\u0026gt;\u0026gt; ans; bool isHui(string a) { int size = a.size(); for (int i = 0; i \u0026lt; size / 2; i++) { if (a[i] != a[size - i - 1]) return false; } return true; } void find(string s, int index, vector\u0026lt;string\u0026gt; temp) { if (index == s.size()) ans.push_back(temp); for (int i = 1; index + i \u0026lt;= s.size(); i++) { if (isHui(s.substr(index, i))) { vector\u0026lt;string\u0026gt; temp1(temp); temp1.push_back(s.substr(index, i)); find(s, index + i, temp1); } } } vector\u0026lt;vector\u0026lt;string\u0026gt;\u0026gt; partition(string s) { vector\u0026lt;string\u0026gt; temp; find(s, 0, temp); return ans; } }; åŠ¨æ€è§„åˆ’ dynamic-programming åŠ¨æ€è§„åˆ’åœ¨åˆ·é¢˜ä¸­ç»å¸¸é‡åˆ°ï¼Œæœ‰å¾ˆå¤šç§å˜å½¢é¢˜ä½†æ˜¯åŸºæœ¬éƒ½æ˜¯è¿™ä¹ˆä¸ªæ€è·¯ï¼Œè‡ªé¡¶å‘ä¸‹ æ‹†åˆ†é—®é¢˜ æ‰¾å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚ åŠ¨æ€è§„åˆ’å°±æ˜¯ä¸€ç§èªæ˜çš„ç©·ä¸¾ï¼Œè®°å½•å…¶ä¸­éƒ¨åˆ†è¿‡ç¨‹çš„çŠ¶æ€ã€‚éå¸¸é‡è¦ï¼Œå¤šåšå¤šæ€è€ƒã€‚\nç»å…¸èƒŒåŒ…é—®é¢˜ #include\u0026lt;stdio.h\u0026gt; int V[200][200];//å‰iä¸ªç‰©å“è£…å…¥å®¹é‡ä¸ºjçš„èƒŒåŒ…ä¸­è·å¾—çš„æœ€å¤§ä»·å€¼ int max(int a,int b) { if(a\u0026gt;=b) return a; else return b; } int KnapSack(int n,int w[],int v[],int x[],int C) { int i,j; //å¡«è¡¨,å…¶ä¸­ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—å…¨ä¸º0 for(i=0;i\u0026lt;=n;i++) V[i][0]=0; for(j=0;j\u0026lt;=C;j++) V[0][j]=0; for(i=1;i\u0026lt;=n;i++) { printf(\u0026quot;ç‰©å“ç¼–å·%d é‡é‡%d ä»·å€¼%d \u0026quot;,i,w[i-1],v[i-1]); for(j=1;j\u0026lt;=C;j++) { if(j\u0026lt;w[i-1]) //å½“å‰ç¼–å·ç‰©å“æ¯”æ•´ä¸ªèƒŒåŒ…å®¹é‡è¿˜å¤§ { V[i][j]=V[i-1][j]; printf(\u0026quot;[%d][%d]=%2d \u0026quot;,i,j,V[i][j]); } else // ç”¨maxæ¯”è¾ƒè¦ä¸è¦æ”¾ä¸‹å½“å‰ç‰©å“ { V[i][j]=max(V[i-1][j],V[i-1][j-w[i-1]]+v[i-1]); printf(\u0026quot;[%d][%d]=%2d \u0026quot;,i,j,V[i][j]); } } printf(\u0026quot;\\n\u0026quot;); } //åˆ¤æ–­å“ªäº›ç‰©å“è¢«é€‰ä¸­ j=C; for(i=n;i\u0026gt;=1;i--) { if(V[i][j]\u0026gt;V[i-1][j]) { x[i]=1; j=j-w[i-1]; } else x[i]=0; } printf(\u0026quot;é€‰ä¸­çš„ç‰©å“æ˜¯:\\n\u0026quot;); for(i=1;i\u0026lt;=n;i++) printf(\u0026quot;%d \u0026quot;,x[i]); printf(\u0026quot;\\n\u0026quot;); return V[n][C]; } void main() { int s;//è·å¾—çš„æœ€å¤§ä»·å€¼ int w[15];//ç‰©å“çš„é‡é‡ int v[15];//ç‰©å“çš„ä»·å€¼ int x[15];//ç‰©å“çš„é€‰å–çŠ¶æ€ int n,i; int C;//èƒŒåŒ…æœ€å¤§å®¹é‡ n=5; printf(\u0026quot;è¯·è¾“å…¥èƒŒåŒ…çš„æœ€å¤§å®¹é‡:\\n\u0026quot;); scanf(\u0026quot;%d\u0026quot;,\u0026amp;C); printf(\u0026quot;è¾“å…¥ç‰©å“æ•°:\\n\u0026quot;); scanf(\u0026quot;%d\u0026quot;,\u0026amp;n); printf(\u0026quot;è¯·åˆ†åˆ«è¾“å…¥ç‰©å“çš„é‡é‡:\\n\u0026quot;); for(i=0;i\u0026lt;n;i++) scanf(\u0026quot;%d\u0026quot;,\u0026amp;w[i]); printf(\u0026quot;è¯·åˆ†åˆ«è¾“å…¥ç‰©å“çš„ä»·å€¼:\\n\u0026quot;); for(i=0;i\u0026lt;n;i++) scanf(\u0026quot;%d\u0026quot;,\u0026amp;v[i]); s=KnapSack(n,w,v,x,C); printf(\u0026quot;æœ€å¤§ç‰©å“ä»·å€¼ä¸º:\\n\u0026quot;); printf(\u0026quot;%d\\n\u0026quot;,s); } KMPç®—æ³• åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒKnuth-Morris-Prattå­—ç¬¦ä¸²æŸ¥æ‰¾ç®—æ³•ï¼ˆç®€ç§°ä¸ºKMPç®—æ³•ï¼‰å¯åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²Så†…æŸ¥æ‰¾ä¸€ä¸ªè¯Wçš„å‡ºç°ä½ç½®ã€‚ ä¸€ä¸ªè¯åœ¨ä¸åŒ¹é…æ—¶æœ¬èº«å°±åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯æ¥ç¡®å®šä¸‹ä¸€ä¸ªåŒ¹é…å¯èƒ½çš„å¼€å§‹ä½ç½®ï¼Œæ­¤ç®—æ³•åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ä»¥é¿å…é‡æ–°æ£€æŸ¥å…ˆå‰é…å¯¹çš„å­—ç¬¦ã€‚\né˜®ä¸€å³°çš„åšå®¢åˆ†æçš„å¾ˆå¥½ï¼Œè¿™é‡Œå°†å…·ä½“å®ç°åˆ†äº«ä¸‹ã€‚\næ³¨æ„size() è¿”å›çš„æ˜¯æ— ç¬¦å·æ•°ï¼Œå…¶ä¸è´Ÿæ•°æ¯”è¾ƒå¤§å°æ—¶ä¸€å®šè¦è½¬ä¸ºæœ‰ç¬¦å·çš„ï¼Œå¦åˆ™è´Ÿæ•°ä¼šå…ˆè½¬å˜ä¸ºæ— ç¬¦å·æ•°ä¹‹åæ¯”è¾ƒå¤§å°ç»“æœé”™è¯¯ã€‚\n#include \u0026lt;iostream\u0026gt; #include \u0026lt;string\u0026gt; using namespace std; const int Maxn = 1024; class Solution { public: int next[Maxn] = { 0 }; //ç»´æŠ¤pç­‰ä»·å‰ç¼€é•¿åº¦çš„è®°å½•æ•°ç»„,påŒ¹é…å¤±è´¥å°±è·³è½¬åˆ°è¯¥ä½ç½® å³åŒ¹é…äº†pçš„ä¸ªæ•°-1 // å…³é”®åœ¨äºè®¡ç®—nextæ•°ç»„ è¿™é‡ŒåŸºäºæœ€å¤§é•¿åº¦è¡¨(å­—ç¬¦ä¸²çš„å‰ç¼€åç¼€çš„å…¬å…±å…ƒç´ çš„æœ€å¤§é•¿åº¦)æ¥åš // nextæ•°ç»„æ˜¯ é™¤å½“å‰å­—ç¬¦å¤– çš„æœ€é•¿ç›¸åŒå‰ç¼€åç¼€ã€‚æ‰€ä»¥ä¸ºæœ€å¤§é•¿åº¦è¡¨å‘å³ç§»ä¸€ä½ï¼Œåˆå€¼èµ‹ä¸º-1çš„æ•°ç»„ void GetNextval(string p) { next[0] = -1; int i = -1, j = 0; // iè¡¨ç¤ºå‰ç¼€ jéå†indexåç¼€ æ±‚å‡ºéœ€è¦åŒ¹é…çš„å­—ç¬¦ä¸²Pçš„nextæ•°ç»„ while (j \u0026lt; int(p.size()) - 1) { if (i == -1 || p[i] == p[j]) { ++i; ++j; // next[j] = i; //ä¼˜åŒ–å¦‚ä¸‹æ‰€ç¤º, å½“p[i] == p[j] æ—¶ï¼ŒKmpSearché‡Œä¸åŒ¹é…è°ƒç”¨nextä¼šé‡å¤è°ƒç”¨ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥å¤„ç† if(p[i] != p[j]) next[j] = i; else next[j] = next[i]; } else i = next[i]; } } int KmpSearch(string s, string p) { int i = 0, j = 0; GetNextval(p); // æ³¨æ„ï¼ size() è¿”å›çš„æ˜¯æ— ç¬¦å·æ•°ï¼Œä¸€å®šè¦è½¬ä¸ºæœ‰ç¬¦å·çš„ å¦åˆ™jä¸º-1æ—¶ä¼šå…ˆè½¬å˜ä¸ºæ— ç¬¦å·æ•°æ¯”è¾ƒå¤§å°ä¼šé”™è¯¯ while ( i \u0026lt; int(s.size()) \u0026amp;\u0026amp; j \u0026lt; int(p.size()) ) { // jä¸º-1 æˆ– åŒ¹é…æˆåŠŸ sã€pçš„ä¸‹æ ‡éƒ½å‘åèµ° if (j == -1 || s[i] == p[j]) { i++; j++; } // å¦åˆ™å­—ç¬¦åŒ¹é…å¤±è´¥ï¼Œiä¸å˜ jè½¬ä¸ºnextè®°å½•å€¼ï¼Œå†ç”¨åŸæ¥çš„s[i] ä¸ æ–°çš„p[j]åŒ¹é… // å½“j==-1å³è¯¥å­—ç¬¦å‰ä¸å¯èƒ½æœ‰ç›¸åŒå‰åç¼€æ—¶ è¿˜ä¸åŒ¹é… è¯´æ˜ i éœ€è¦+1 è€Œj=0 else j = next[j]; } if (j == p.size()) return i - j; return -1; } }; int main() { Solution sol; string s1, s2; while (1) { cin \u0026gt;\u0026gt; s1 \u0026gt;\u0026gt; s2; cout \u0026lt;\u0026lt; sol.KmpSearch(s1, s2) \u0026lt;\u0026lt; endl; } } å…³äºå­—ç¬¦åŒ¹é…çš„åŠ¨æ€è§„åˆ’é¢˜ 10.æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…\nclass Solution { public: bool isMatch(string s, string p) { int sl = s.size(), pl = p.size(); vector\u0026lt;vector\u0026lt;int\u0026gt;\u0026gt; f_map; f_map.assign(sl + 1, vector\u0026lt;int\u0026gt;(pl + 1, 0)); f_map[0][0] = 1; // pä¸ºæ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸² // åŒ¿åå‡½æ•°ç”¨æ³• è¿™æ ·åšå¯å‡å°‘å†…å­˜çš„æ‹·è´ auto matches = [\u0026amp;](int i, int j) -\u0026gt; bool{ if(i == 0) return false; else if(p[j - 1] == '.') return true; else return s[i - 1] == p[j - 1]; }; for (int i = 0; i \u0026lt;= sl; i++) { // i jä»£è¡¨ç¬¬å‡ ä¸ªå­—ç¬¦ï¼Œè‹¥ä¸º0 è¡¨ç¤ºå­—ç¬¦ä¸ºç©º for (int j = 1; j \u0026lt;= pl; j++) { // jä¸º0æ—¶é™¤éi=0å¦åˆ™å¿…å®šåŒ¹é…å¤±è´¥,åˆå§‹åŒ–æ—¶å·²ç»ç»™æ‰€æœ‰é™¤f_map[0][0]å¤–èµ‹0 if(p[j-1] == '*') { if( matches(i, j-1) ) // f_map[i][j] = f_map[i-1][j]; i-1è¡¨ç¤º*å¤åˆ¶ä¸€ä»½å‰å­—ç¬¦ï¼Œj-2è¡¨ç¤º*å’Œä¹‹å‰å­—ç¬¦ä»£è¡¨ç©º f_map[i][j] = f_map[i-1][j] || f_map[i][j-2]; //åŠ ä¸Šæˆ–ï¼Œé˜²æ­¢å½“å‰så¤´ä¸èƒ½å‡å°‘çš„æƒ…å†µ else f_map[i][j] = f_map[i][j-2]; // } else{ if( matches(i, j) ) f_map[i][j] = f_map[i-1][j-1]; } } } return f_map[sl][pl]; } }; 44.é€šé…ç¬¦åŒ¹é…\nclass Solution { public: // sä¸ºè¾“å…¥æµ‹è¯•å€¼,æµ‹è¯•æ˜¯å¦ä¸påŒ¹é… p,åŒ…å«a-z ? * // æ­¤é¢˜ä¸ 10.æ­£åˆ™è¡¨è¾¾å¼åŒ¹é….cpp ç±»ä¼¼ã€‚ä¸è¿‡æ­¤å¤„é€šé…ç¬¦æ˜¯åŒ¹é…ä»»æ„ä¸€æ®µå­—ç¬¦ä¸²ï¼Œä¸”*å‰å¯æ— å­—ç¬¦ // æ­£åˆ™è¡¨è¾¾å¼æ˜¯ *åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦Næ¬¡ bool isMatch(string s, string p) { int sl = s.size(), pl = p.size(); // dp[i][j] è¡¨ç¤º sçš„ié•¿åº¦ ä¸ pçš„jé•¿åº¦ æ˜¯å¦åŒ¹é… iã€jä¸º0è¡¨ç¤ºé•¿åº¦ä¸º0çš„ç©ºçš„å­—ç¬¦ä¸² auto match = [\u0026amp;](int i, int j) -\u0026gt; bool { if (i == 0) return false; //è¿›å…¥matchåˆ¤æ–­æ—¶å¿…å®šä¸ä¸º* æ‰€ä»¥å¯ä»¥ç›´æ¥return false else if (p[j-1] == '?') return true; return s[i-1] == p[j-1]; }; vector\u0026lt;vector\u0026lt;bool\u0026gt;\u0026gt; dp(sl + 1, vector\u0026lt;bool\u0026gt;(pl + 1, false)); dp[0][0] = true; for (int i = 0; i \u0026lt;= sl; i++) { for (int j = 1; j \u0026lt;= pl; j++) { if (p[j-1] == '*') dp[i][j] = dp[i][j-1] || (i\u0026gt;0 \u0026amp;\u0026amp; dp[i-1][j]); //ç­‰ä»· *ä¸å­˜åœ¨ æˆ–è€… *å‰é¢åŒ¹é…æˆåŠŸ else dp[i][j] = match(i, j) \u0026amp;\u0026amp; dp[i-1][j-1]; } } return dp[sl][pl]; } }; ","id":16,"section":"posts","summary":"å…ˆç®€å•ä»‹ç»å‡ ä¸ªåŸºç¡€æ¦‚å¿µï¼š é€’å½’ é€’å½’æ˜¯é‡å¤è°ƒç”¨å‡½æ•°è‡ªèº«å®ç°å¾ªç¯ã€‚è¿­ä»£æ˜¯å‡½æ•°å†…æŸæ®µä»£ç å®ç°å¾ªç¯ã€‚ å…¶ä¸­ï¼Œè¿­ä»£ä¸æ™®é€šå¾ªç¯çš„åŒºåˆ«æ˜¯ï¼šè¿­ä»£æ—¶ï¼Œå¾ªç¯ä»£ç ä¸­å‚","tags":["C/C++","ç®—æ³•"],"title":"äº”å¤§åŸºæœ¬ç®—æ³•","uri":"https://liangkang233.github.io/2021/11/%E4%BA%94%E5%A4%A7%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/","year":"2021"},{"content":"å†…å­˜æ¨¡å‹ å¯¹äºC/C++ ç­‰è¯­è¨€æ¥è¯´ï¼Œå†…å­˜ç©ºé—´å¤§è‡´ä½¿ç”¨åœ¨\næ ˆåŒºï¼ˆstackï¼‰ï¼šåˆç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…é‡Šæ”¾ï¼Œå­˜æ”¾å‡½æ•°çš„å‚æ•°å€¼ï¼Œå±€éƒ¨å˜é‡çš„å€¼ç­‰ï¼Œå…¶æ“ä½œæ–¹å¼ç±»ä¼¼äºæ•°æ®ç»“æ„çš„æ ˆã€‚\nå †åŒºï¼ˆheapï¼‰ï¼šä¸€èˆ¬æ˜¯ç”±ç¨‹åºå‘˜åˆ†é…é‡Šæ”¾ï¼Œè‹¥ç¨‹åºå‘˜ä¸é‡Šæ”¾çš„è¯ï¼Œç¨‹åºç»“æŸæ—¶å¯èƒ½ç”±OSå›æ”¶ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ä»–ä¸æ•°æ®ç»“æ„çš„å †æ˜¯ä¸¤å›äº‹.\nå…¨å±€åŒºï¼ˆstaticï¼‰ï¼šä¹Ÿå«é™æ€æ•°æ®å†…å­˜ç©ºé—´ï¼Œå­˜å‚¨å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œå…¨å±€å˜é‡å’Œé™æ€å˜é‡çš„å­˜å‚¨æ˜¯æ”¾ä¸€å—çš„ï¼Œåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡æ”¾ä¸€å—åŒºåŸŸï¼Œæ²¡æœ‰åˆå§‹åŒ–çš„åœ¨ç›¸é‚»çš„å¦ä¸€å—åŒºåŸŸï¼Œç¨‹åºç»“æŸåç”±ç³»ç»Ÿé‡Šæ”¾ã€‚\næ–‡å­—å¸¸é‡åŒº(const)ï¼šå¸¸é‡å­—ç¬¦ä¸²å°±æ˜¯æ”¾åœ¨è¿™é‡Œï¼Œç¨‹åºç»“æŸåç”±ç³»ç»Ÿé‡Šæ”¾ã€‚\nç¨‹åºä»£ç åŒºï¼šå­˜æ”¾å‡½æ•°ä½“çš„äºŒè¿›åˆ¶ä»£ç ã€‚\nå †ä¸­çš„å¯¹è±¡å¯¹äºGo ä»¥åŠ Java ç­‰ç¼–ç¨‹è¯­è¨€æ¥è¯´ç”±å·¥ç¨‹å¸ˆå’Œç¼–è¯‘å™¨å…±åŒç®¡ç†ï¼Œå †å†…å­˜å¯¹è±¡ç”±å†…å­˜åˆ†é…å™¨åˆ†é…å¹¶ç”±åƒåœ¾æ”¶é›†å™¨ gc (garbage collection) å›æ”¶ã€‚\nåœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸‹ï¼Œè¿½æ±‚æ›´é«˜å†…å­˜ç®¡ç†æ•ˆç‡ï¼šæ›´å¿«çš„åˆ†é…æ˜¯ä¸»è¦ç›®çš„ã€‚\nå¼•å…¥è™šæ‹Ÿå†…å­˜åï¼Œè®©å†…å­˜çš„å¹¶å‘è®¿é—®é—®é¢˜çš„ç²’åº¦ä»å¤šè¿›ç¨‹çº§åˆ«ï¼Œé™ä½åˆ°å¤šçº¿ç¨‹çº§åˆ«ã€‚ ä¸ºçº¿ç¨‹é¢„åˆ†é…ç¼“å­˜éœ€è¦è¿›è¡Œ1æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œåç»­çº¿ç¨‹ç”³è¯·å°å†…å­˜æ—¶ï¼Œä»ç¼“å­˜åˆ†é…ï¼Œéƒ½æ˜¯åœ¨ç”¨æˆ·æ€æ‰§è¡Œï¼Œæ²¡æœ‰ç³»ç»Ÿè°ƒç”¨ï¼Œç¼©çŸ­äº†å†…å­˜æ€»ä½“çš„åˆ†é…å’Œé‡Šæ”¾æ—¶é—´ï¼Œ å¤šä¸ªçº¿ç¨‹åŒæ—¶ç”³è¯·å°å†…å­˜æ—¶ï¼Œä»å„è‡ªçš„ç¼“å­˜åˆ†é…ï¼Œè®¿é—®çš„æ˜¯ä¸åŒçš„åœ°å€ç©ºé—´ï¼Œæ— éœ€åŠ é”ï¼ŒæŠŠå†…å­˜å¹¶å‘è®¿é—®çš„ç²’åº¦è¿›ä¸€æ­¥é™ä½ æ¥ä¸‹æ¥ä»‹ç»goçš„å…·ä½“å†…å­˜æ¨¡å‹ï¼š\nå†…å­˜åˆ†é…æ–¹æ³• çº¿æ€§åˆ†é…å™¨ï¼ˆSequential Allocatorï¼ŒBump Allocatorï¼‰\nå®ç°ç®€å•ï¼Œç›´æ¥åœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘å¯ç”¨åœ°å€çš„æŒ‡é’ˆã€‚å…¶GCéœ€è¦ä¸å…·æœ‰æ‹·è´ç‰¹æ€§çš„å›æ”¶æ–¹æ³•:æ ‡è®°å‹ç¼©ï¼ˆMark-Compactï¼‰ã€å¤åˆ¶å›æ”¶ï¼ˆCopying GCï¼‰å’Œåˆ†ä»£å›æ”¶ï¼ˆGenerational GCï¼‰ç­‰ç®—æ³•,æ‰€ä»¥åƒCã€C++è¿™æ ·æš´æ¼å†…å­˜åœ°å€æŒ‡é’ˆçš„æ— æ³•ä½¿ç”¨ã€‚\nç©ºé—²é“¾è¡¨åˆ†é…å™¨ï¼ˆFree-List Allocatorï¼‰\nå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å››ç§ç­–ç•¥ï¼šgoä½¿ç”¨çš„æ˜¯ç¬¬å››ç§\né¦–æ¬¡é€‚åº”ï¼ˆFirst-Fitï¼‰â€” ä»é“¾è¡¨å¤´å¼€å§‹éå†ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªå¤§å°å¤§äºç”³è¯·å†…å­˜çš„å†…å­˜å—ï¼› å¾ªç¯é¦–æ¬¡é€‚åº”ï¼ˆNext-Fitï¼‰â€” ä»ä¸Šæ¬¡éå†çš„ç»“æŸä½ç½®å¼€å§‹éå†ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªå¤§å°å¤§äºç”³è¯·å†…å­˜çš„å†…å­˜å—ï¼› æœ€ä¼˜é€‚åº”ï¼ˆBest-Fitï¼‰â€” ä»é“¾è¡¨å¤´éå†æ•´ä¸ªé“¾è¡¨ï¼Œé€‰æ‹©æœ€åˆé€‚çš„å†…å­˜å—ï¼› éš”ç¦»é€‚åº”ï¼ˆSegregated-Fitï¼‰â€” å°†å†…å­˜åˆ†å‰²æˆå¤šä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªé“¾è¡¨ä¸­çš„å†…å­˜å—å¤§å°ç›¸åŒï¼Œç”³è¯·å†…å­˜æ—¶å…ˆæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„é“¾è¡¨ï¼Œå†ä»é“¾è¡¨ä¸­é€‰æ‹©åˆé€‚çš„å†…å­˜å—ï¼›ä¸¾ä¾‹ï¼šå°†å†…å­˜åˆ†å‰²æˆç”± 4ã€8ã€16ã€32 å­—èŠ‚çš„å†…å­˜å—ç»„æˆçš„é“¾è¡¨ï¼Œå½“æˆ‘ä»¬å‘å†…å­˜åˆ†é…å™¨ç”³è¯· 8 å­—èŠ‚çš„å†…å­˜æ—¶ï¼Œå®ƒä¼šåœ¨8å­—èŠ‚é“¾è¡¨ä¸­æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ç©ºé—²å†…å­˜å—å¹¶è¿”å›ã€‚éš”ç¦»é€‚åº”çš„åˆ†é…ç­–ç•¥å‡å°‘äº†éœ€è¦éå†çš„å†…å­˜å—æ•°é‡ï¼Œæé«˜äº†å†…å­˜åˆ†é…çš„æ•ˆç‡ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œgoçš„å†…å­˜åˆ†é…å™¨è¿˜å€Ÿé‰´äº†TCMalloc(æ¯•ç«Ÿéƒ½æ˜¯googleåšçš„)çš„è®¾è®¡ç†å¿µâ€”â€”ä½¿ç”¨å¤šçº§ç¼“å­˜å°†å¯¹è±¡æ ¹æ®å¤§å°åˆ†ç±»ï¼Œå¹¶æŒ‰ç…§ç±»åˆ«å®æ–½ä¸åŒçš„åˆ†é…ç­–ç•¥\nç±»åˆ« å¤§å° å¾®å¯¹è±¡ (0, 16B) å°å¯¹è±¡ [16B, 32KB] å¤§å¯¹è±¡ (32KB, +âˆ) Pageï¼šæ“ä½œç³»ç»Ÿå¯¹å†…å­˜ç®¡ç†ä»¥é¡µä¸ºå•ä½ï¼ŒTCMallocä¹Ÿæ˜¯è¿™æ ·ï¼Œåªä¸è¿‡TCMallocé‡Œçš„Pageå¤§å°ä¸æ“ä½œç³»ç»Ÿé‡Œçš„å¤§å°å¹¶ä¸ä¸€å®šç›¸ç­‰ï¼Œè€Œæ˜¯å€æ•°å…³ç³»ã€‚ã€ŠTCMallocè§£å¯†ã€‹é‡Œç§°x64ä¸‹Pageå¤§å°æ˜¯8KBã€‚ Spanï¼šä¸€ç»„è¿ç»­çš„Pageè¢«ç§°ä¸ºSpanï¼Œæ¯”å¦‚å¯ä»¥æœ‰2ä¸ªé¡µå¤§å°çš„Spanï¼Œä¹Ÿå¯ä»¥æœ‰16é¡µå¤§å°çš„Spanï¼ŒSpanæ¯”Pageé«˜ä¸€ä¸ªå±‚çº§ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†ä¸€å®šå¤§å°çš„å†…å­˜åŒºåŸŸï¼ŒSpanæ˜¯TCMallocä¸­å†…å­˜ç®¡ç†çš„åŸºæœ¬å•ä½ã€‚ ThreadCacheï¼šæ¯ä¸ªçº¿ç¨‹å„è‡ªçš„Cacheï¼Œä¸€ä¸ªCacheåŒ…å«å¤šä¸ªç©ºé—²å†…å­˜å—é“¾è¡¨ï¼Œæ¯ä¸ªé“¾è¡¨è¿æ¥çš„éƒ½æ˜¯å†…å­˜å—ï¼ŒåŒä¸€ä¸ªé“¾è¡¨ä¸Šå†…å­˜å—çš„å¤§å°æ˜¯ç›¸åŒçš„ï¼Œä¹Ÿå¯ä»¥è¯´æŒ‰å†…å­˜å—å¤§å°ï¼Œç»™å†…å­˜å—åˆ†äº†ä¸ªç±»ï¼Œè¿™æ ·å¯ä»¥æ ¹æ®ç”³è¯·çš„å†…å­˜å¤§å°ï¼Œå¿«é€Ÿä»åˆé€‚çš„é“¾è¡¨é€‰æ‹©ç©ºé—²å†…å­˜å—ã€‚ç”±äºæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ThreadCacheï¼Œæ‰€ä»¥ThreadCacheè®¿é—®æ˜¯æ— é”çš„ã€‚ CentralCacheï¼šæ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ç¼“å­˜ï¼Œä¹Ÿæ˜¯ä¿å­˜çš„ç©ºé—²å†…å­˜å—é“¾è¡¨ï¼Œé“¾è¡¨çš„æ•°é‡ä¸ThreadCacheä¸­é“¾è¡¨æ•°é‡ç›¸åŒï¼Œå½“ThreadCacheå†…å­˜å—ä¸è¶³æ—¶ï¼Œå¯ä»¥ä»CentralCacheå–ï¼Œå½“ThreadCacheå†…å­˜å—å¤šæ—¶ï¼Œå¯ä»¥æ”¾å›CentralCacheã€‚ç”±äºCentralCacheæ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥å®ƒçš„è®¿é—®æ˜¯è¦åŠ é”çš„ã€‚ PageHeapï¼šPageHeapæ˜¯å †å†…å­˜çš„æŠ½è±¡ï¼ŒPageHeapå­˜çš„ä¹Ÿæ˜¯è‹¥å¹²é“¾è¡¨ï¼Œé“¾è¡¨ä¿å­˜çš„æ˜¯Spanï¼Œå½“CentralCacheæ²¡æœ‰å†…å­˜çš„æ—¶ï¼Œä¼šä»PageHeapå–ï¼ŒæŠŠ1ä¸ªSpanæ‹†æˆè‹¥å¹²å†…å­˜å—ï¼Œæ·»åŠ åˆ°å¯¹åº”å¤§å°çš„é“¾è¡¨ä¸­ï¼Œå½“CentralCacheå†…å­˜å¤šçš„æ—¶å€™ï¼Œä¼šæ”¾å›PageHeapã€‚å¦‚ä¸Šå›¾ï¼Œåˆ†åˆ«æ˜¯1é¡µPageçš„Spané“¾è¡¨ï¼Œ2é¡µPageçš„Spané“¾è¡¨ç­‰ï¼Œæœ€åæ˜¯large span setï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥ä¿å­˜ä¸­å¤§å¯¹è±¡çš„ã€‚æ¯«æ— ç–‘é—®ï¼ŒPageHeapä¹Ÿæ˜¯è¦åŠ é”çš„ã€‚ åƒåœ¾å›æ”¶ gc(garbage collection)åœ¨å‡ ä¹æ‰€æœ‰çš„ç°ä»£ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œåƒåœ¾æ”¶é›†å™¨éƒ½æ˜¯ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿï¼Œä¸ºäº†åœ¨ä¸å½±å“ç”¨æˆ·ç¨‹åºçš„æƒ…å†µä¸‹å›æ”¶åºŸå¼ƒçš„å†…å­˜éœ€è¦ä»˜å‡ºéå¸¸å¤šçš„åŠªåŠ›ï¼ŒJava çš„åƒåœ¾æ”¶é›†æœºåˆ¶æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼ŒJava 8 ä¸­åŒ…å«çº¿æ€§ã€å¹¶å‘ã€å¹¶è¡Œæ ‡è®°æ¸…é™¤å’Œ G1 å››ä¸ªåƒåœ¾æ”¶é›†å™¨ï¼Œæƒ³è¦ç†è§£å®ƒä»¬çš„å·¥ä½œåŸç†å’Œå®ç°ç»†èŠ‚éœ€è¦èŠ±è´¹å¾ˆå¤šçš„ç²¾åŠ›ã€‚\nåƒåœ¾æ”¶é›†å™¨å°†å­˜å‚¨å™¨è§†ä¸ºä¸€å¼ æœ‰å‘å¯è¾¾å›¾ã€‚å›¾ä¸­çš„èŠ‚ç‚¹å¯ä»¥åˆ†ä¸ºä¸¤ç»„ï¼šä¸€ç»„ç§°ä¸ºæ ¹èŠ‚ç‚¹ï¼Œå¯¹åº”äºä¸åœ¨å †ä¸­çš„ä½ç½®ï¼Œè¿™äº›ä½ç½®å¯ä»¥æ˜¯å¯„å­˜å™¨ã€æ ˆä¸­çš„å˜é‡ï¼Œæˆ–è€…æ˜¯è™šæ‹Ÿå­˜å‚¨å™¨ä¸­è¯»å†™æ•°æ®åŒºåŸŸçš„å…¨å±€å˜é‡ï¼›å¦å¤–ä¸€ç»„ç§°ä¸ºå †èŠ‚ç‚¹ï¼Œå¯¹åº”äºå †ä¸­ä¸€ä¸ªåˆ†é…å—ï¼Œå¦‚ä¸‹å›¾ï¼š\nå½“å †èŠ‚ç‚¹ä¸å¯è¾¾æ—¶å³å¯è§†ä¸ºåƒåœ¾ï¼Œå› ä¸ºå·²ç»è®¿é—®ä¸åˆ°äº†ã€‚\nä»‹ç»å‡ ç§åŸºç¡€çš„GCç®—æ³•ï¼š\nå¼•ç”¨è®¡æ•°ï¼š\nObjective-C é€‰æ‹©äº†è‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼ˆæ™ºèƒ½æŒ‡é’ˆï¼‰ï¼Œå³åˆ›å»ºçš„å †ç©ºé—´ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¯å½“æœ‰æ–°çš„å¼•ç”¨æŒ‡å‘å®ƒå°±è®¡æ•°å™¨åŠ ä¸€ã€‚åä¹‹æŒ‡å‘å…¶çš„å¼•ç”¨ç½®ç©ºæˆ–æŒ‡å‘å…¶ä»–å¯¹è±¡è®¡æ•°å™¨å‡ä¸€ï¼Œå‡å°‘è‡³0åˆ™é‡Šæ”¾ï¼Œå®ç°åŠ¨æ€å›æ”¶å†…å­˜ç©ºé—´ã€‚\nè€Œå…¶ç¼ºç‚¹æ˜¯è‹¥å­˜åœ¨å¯¹è±¡çš„å¾ªç¯å¼•ç”¨ï¼Œæ— æ³•é‡Šæ”¾è¿™äº›å¯¹è±¡ã€‚å¹¶ä¸”å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹å¼•ç”¨è®¡æ•°è¿›è¡Œå¢å‡æ—¶ï¼Œå¼•ç”¨è®¡æ•°çš„å€¼å¯èƒ½ä¼šäº§ç”Ÿä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå¿…é¡»ä½¿ç”¨å¹¶å‘æ§åˆ¶æœºåˆ¶è§£å†³è¿™ä¸€é—®é¢˜ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¸å°çš„å¼€é”€ã€‚\næ ‡è®°æ¸…é™¤\nè¿™ä¸ªç®—æ³•ä¹Ÿç§°ä¸ºMark \u0026amp; Sweepç®—æ³•ï¼Œä¸ºMcCarthyç‹¬åˆ›ã€‚å®ƒä¹Ÿæ˜¯ç›®å‰å…¬è®¤çš„æœ€æœ‰æ•ˆçš„GCæ–¹æ¡ˆã€‚Mark\u0026amp;Sweepåƒåœ¾æ”¶é›†å™¨ç”±æ ‡è®°é˜¶æ®µå’Œå›æ”¶é˜¶æ®µç»„æˆï¼Œæ ‡è®°é˜¶æ®µæ ‡è®°å‡ºæ ¹èŠ‚ç‚¹æ‰€æœ‰å¯è¾¾çš„å¯¹èŠ‚ç‚¹ï¼Œæ¸…é™¤é˜¶æ®µé‡Šæ”¾æ¯ä¸ªæœªè¢«æ ‡è®°çš„å·²åˆ†é…å—ï¼Œå…¶æ‰§è¡Œè¿‡ç¨‹å¯ä»¥åˆ†æˆæ ‡è®°ï¼ˆMarkï¼‰å’Œæ¸…é™¤ï¼ˆSweepï¼‰ä¸¤ä¸ªé˜¶æ®µï¼š\næ ‡è®°é˜¶æ®µ â€” ä»æ ¹å¯¹è±¡å‡ºå‘æŸ¥æ‰¾å¹¶æ ‡è®°å †ä¸­æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼› æ¸…é™¤é˜¶æ®µ â€” éå†å †ä¸­çš„å…¨éƒ¨å¯¹è±¡ï¼Œå›æ”¶æœªè¢«æ ‡è®°çš„åƒåœ¾å¯¹è±¡å¹¶å°†å›æ”¶çš„å†…å­˜åŠ å…¥ç©ºé—²é“¾è¡¨ï¼› ä¸€èˆ¬çš„åœ°ï¼Œå—å¤´éƒ¨ä¸­ç©ºé—²çš„ä½ä½ä¸­çš„ä¸€ä½ç”¨æ¥è¡¨ç¤ºè¿™ä¸ªå—æ˜¯å¦å·²ç»è¢«æ ‡è®°äº†ã€‚é€šè¿‡Mark\u0026amp;Sweepç®—æ³•åŠ¨æ€ç”³è¯·å†…å­˜æ—¶ï¼Œå…ˆæŒ‰éœ€åˆ†é…å†…å­˜ï¼Œå½“å†…å­˜ä¸è¶³ä»¥åˆ†é…æ—¶ï¼Œä»å¯„å­˜å™¨æˆ–è€…ç¨‹åºæ ˆä¸Šçš„å¼•ç”¨å‡ºå‘ï¼Œéå†ä¸Šè¿°çš„æœ‰å‘å¯è¾¾å›¾å¹¶ä½œæ ‡è®°ï¼ˆæ ‡è®°é˜¶æ®µï¼‰ï¼Œç„¶åå†éå†ä¸€æ¬¡å†…å­˜ç©ºé—´ï¼ŒæŠŠæ‰€æœ‰æ²¡æœ‰æ ‡è®°çš„å¯¹è±¡é‡Šæ”¾ï¼ˆæ¸…é™¤é˜¶æ®µï¼‰ã€‚å› æ­¤åœ¨æ”¶é›†åƒåœ¾æ—¶éœ€è¦ ä¸­æ–­æ­£å¸¸ç¨‹åºSTW (Stop the world) ï¼Œåœ¨ç¨‹åºæ¶‰åŠå†…å­˜å¤§ã€å¯¹è±¡å¤šçš„æ—¶å€™ä¸­æ–­è¿‡ç¨‹å¯èƒ½æœ‰ç‚¹é•¿ã€‚å½“ç„¶ï¼Œæ”¶é›†å™¨ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹ä¸æ–­åœ°å®šæ—¶æ›´æ–°å¯è¾¾å›¾å’Œå›æ”¶åƒåœ¾ã€‚\nè¯¥ç®—æ³•ä¸åƒå¼•ç”¨è®¡æ•°å¯å¯¹å†…å­˜è¿›è¡Œå³æ—¶å›æ”¶ï¼Œä½†æ˜¯å®ƒè§£å†³äº†å¼•ç”¨è®¡æ•°çš„å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œå› æ­¤æœ‰çš„è¯­è¨€æŠŠå¼•ç”¨è®¡æ•°ç®—æ³•æ­é…Mark \u0026amp; Sweep ç®—æ³•æ„æˆGCæœºåˆ¶ã€‚\nèŠ‚ç‚¹å¤åˆ¶\nMark \u0026amp; Sweepç®—æ³•çš„ç¼ºç‚¹æ˜¯åœ¨åˆ†é…å¤§é‡å¯¹è±¡æ—¶ï¼Œä¸”å¯¹è±¡å¤§éƒ½éœ€è¦å›æ”¶æ—¶ï¼Œå›æ”¶ä¸­æ–­è¿‡ç¨‹å¯èƒ½æ¶ˆè€—å¾ˆå¤§ã€‚è€ŒèŠ‚ç‚¹å¤åˆ¶ç®—æ³•åˆ™åˆšå¥½ç›¸åï¼Œå½“éœ€è¦å›æ”¶çš„å¯¹è±¡è¶Šå¤šæ—¶ï¼Œå®ƒçš„å¼€é”€å¾ˆå°ï¼Œè€Œå½“å¤§éƒ¨åˆ†å¯¹è±¡éƒ½ä¸éœ€è¦å›æ”¶æ—¶ï¼Œå…¶å¼€é”€åè€Œå¾ˆå¤§ã€‚ç®—æ³•çš„åŸºæœ¬æ€è·¯æ˜¯è¿™æ ·çš„ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œè¢«å¼•ç”¨çš„å¯¹è±¡éƒ½ä¼šè¢«å¤åˆ¶åˆ°ä¸€ä¸ªæ–°çš„å­˜å‚¨åŒºåŸŸä¸­ï¼Œè€Œå‰©ä¸‹çš„å¯¹è±¡åˆ™æ˜¯ä¸å†è¢«å¼•ç”¨çš„ï¼Œå³ä¸ºåƒåœ¾ï¼Œç•™åœ¨åŸæ¥çš„å­˜å‚¨åŒºåŸŸã€‚é‡Šæ”¾å†…å­˜æ—¶ï¼Œç›´æ¥æŠŠåŸæ¥çš„å­˜å‚¨åŒºåŸŸé‡Šæ”¾æ‰ï¼Œç»§ç»­ç»´æŠ¤æ–°çš„å­˜å‚¨åŒºåŸŸå³å¯ã€‚\nåˆ†ä»£å›æ”¶\nä»¥ä¸Šä¸‰ç§åŸºæœ¬ç®—æ³•å„æœ‰å„çš„ä¼˜ç¼ºç‚¹ï¼Œä¹Ÿå„è‡ªæœ‰è®¸å¤šæ”¹è¿›çš„æ–¹æ¡ˆã€‚é€šè¿‡å¯¹è¿™ä¸‰ç§æ–¹å¼çš„èåˆï¼Œå‡ºç°äº†ä¸€äº›æ›´åŠ é«˜çº§çš„æ–¹å¼ã€‚è€Œé«˜çº§GCæŠ€æœ¯ä¸­æœ€é‡è¦çš„ä¸€ç§ä¸ºåˆ†ä»£å›æ”¶ã€‚å®ƒçš„åŸºæœ¬æ€è·¯æ˜¯è¿™æ ·çš„ï¼šç¨‹åºä¸­å­˜åœ¨å¤§é‡çš„è¿™æ ·çš„å¯¹è±¡ï¼Œå®ƒä»¬è¢«åˆ†é…å‡ºæ¥ä¹‹åå¾ˆå¿«å°±ä¼šè¢«é‡Šæ”¾ï¼Œä½†å¦‚æœä¸€ä¸ªå¯¹è±¡åˆ†é…åç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´å†…éƒ½æ²¡æœ‰è¢«å›æ”¶ï¼Œé‚£ä¹ˆææœ‰å¯èƒ½å®ƒçš„ç”Ÿå‘½å‘¨æœŸå¾ˆé•¿ï¼Œå°è¯•æ”¶é›†å®ƒæ˜¯æ— ç”¨åŠŸã€‚ä¸ºäº†è®©GCå˜å¾—æ›´é«˜æ•ˆï¼Œæˆ‘ä»¬åº”è¯¥å¯¹åˆšè¯ç”Ÿä¸ä¹…çš„å¯¹è±¡è¿›è¡Œé‡ç‚¹æ‰«æï¼Œè¿™æ ·å°±å¯ä»¥å›æ”¶å¤§éƒ¨åˆ†çš„åƒåœ¾ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦ä¾æ®å¯¹è±¡çš„â€å¹´é¾„â€œè¿›è¡Œåˆ†ä»£ï¼Œåˆšåˆšç”Ÿæˆä¸ä¹…çš„å¯¹è±¡åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£ï¼Œè€Œå­˜åœ¨æ—¶é—´é•¿çš„å¯¹è±¡åˆ’åˆ†ä¸ºè€ç”Ÿä»£ï¼Œæ ¹æ®å®ç°æ–¹å¼çš„ä¸åŒï¼Œå¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ªä»£ã€‚\nä¸€ç§å›æ”¶çš„å®ç°ç­–ç•¥å¯ä»¥æ˜¯ï¼šé¦–å…ˆä»æ ¹å¼€å§‹è¿›è¡Œä¸€æ¬¡å¸¸è§„æ‰«æï¼Œæ‰«æè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°è€ç”Ÿä»£å¯¹è±¡åˆ™ä¸è¿›è¡Œé€’å½’æ‰«æï¼Œè¿™æ ·å¯å¤§å¤§å‡å°‘æ‰«ææ¬¡æ•°ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä½¿ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•æˆ–è€…å¤åˆ¶æ”¶é›†ç®—æ³•ã€‚ç„¶åï¼ŒæŠŠæ‰«æåæ®‹ç•™ä¸‹æ¥çš„å¯¹è±¡åˆ’åˆ†åˆ°è€ç”Ÿä»£ï¼Œè‹¥æ˜¯é‡‡ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œåˆ™åº”è¯¥åœ¨å¯¹è±¡ä¸Šè®¾ç½®æŸä¸ªæ ‡å¿—ä½æ ‡å¿—å…¶å¹´é¾„ï¼›è‹¥æ˜¯é‡‡ç”¨å¤åˆ¶æ”¶é›†ï¼Œåˆ™åªéœ€è¦æŠŠæ–°çš„å­˜å‚¨åŒºåŸŸå†…å¯¹è±¡è®¾ç½®ä¸ºè€ç”Ÿä»£å°±å¯ä»¥äº†ã€‚è€Œå®é™…çš„å®ç°ä¸Šï¼Œåˆ†ä»£å›æ”¶ç®—æ³•çš„æ–¹æ¡ˆäº”èŠ±å…«é—¨ï¼Œå¸¸å¸¸ä¼šèåˆå‡ ç§åŸºæœ¬ç®—æ³•ã€‚\ngoçš„åƒåœ¾å›æ”¶ ä¸ºäº†é«˜æ•ˆçš„æ ‡è®°å¯¹è±¡ç¼©çŸ­stwæ—¶é—´ï¼Œgoä½¿ç”¨ä¸‰è‰²æ ‡è®°æ³•ï¼ˆæ ‡è®°æ¸…é™¤çš„ä¸€ç§æ”¹è‰¯ï¼‰æ¥åšï¼›\nä¸‰è‰²å¯¹è±¡å®šä¹‰ï¼š\nç™½è‰²å¯¹è±¡ â€” æ½œåœ¨çš„åƒåœ¾ï¼Œå…¶å†…å­˜å¯èƒ½ä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ï¼›\né»‘è‰²å¯¹è±¡ â€” æ´»è·ƒçš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ä¸å­˜åœ¨ä»»ä½•å¼•ç”¨å¤–éƒ¨æŒ‡é’ˆçš„å¯¹è±¡ä»¥åŠä»æ ¹å¯¹è±¡å¯è¾¾çš„å¯¹è±¡ï¼›\nç°è‰²å¯¹è±¡ â€” æ´»è·ƒçš„å¯¹è±¡ï¼Œå› ä¸ºå­˜åœ¨æŒ‡å‘ç™½è‰²å¯¹è±¡çš„å¤–éƒ¨æŒ‡é’ˆï¼Œåƒåœ¾æ”¶é›†å™¨ä¼šæ‰«æè¿™äº›å¯¹è±¡çš„å­å¯¹è±¡ï¼›\nåœ¨åƒåœ¾æ”¶é›†å™¨å¼€å§‹å·¥ä½œæ—¶ï¼Œåƒåœ¾æ”¶é›†çš„æ ¹å¯¹è±¡ä¼šè¢«æ ‡è®°æˆç°è‰²ï¼Œå…¶ä»–å¯¹è±¡æ ‡è®°ä¸ºç™½è‰²ï¼Œåƒåœ¾æ”¶é›†å™¨åªä¼šä»ç°è‰²å¯¹è±¡é›†åˆä¸­å–å‡ºå¯¹è±¡å¼€å§‹æ‰«æï¼Œå½“ç°è‰²é›†åˆä¸­ä¸å­˜åœ¨ä»»ä½•å¯¹è±¡æ—¶ï¼Œæ ‡è®°é˜¶æ®µå°±ä¼šç»“æŸã€‚\nä¸‰è‰²æ ‡è®°åƒåœ¾æ”¶é›†å™¨çš„å·¥ä½œåŸç†å¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å½’çº³æˆä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\nä»ç°è‰²å¯¹è±¡çš„é›†åˆé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªç°è‰²å¯¹è±¡å¹¶å°†å…¶æ ‡è®°æˆé»‘è‰²å¹¶è¿›è¡Œæ­¥éª¤2ï¼› å°†é»‘è‰²å¯¹è±¡æŒ‡å‘çš„æ‰€æœ‰å¯¹è±¡éƒ½æ ‡è®°æˆç°è‰²ï¼Œä¿è¯è¯¥å¯¹è±¡å’Œè¢«è¯¥å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«å›æ”¶ï¼› é‡å¤ä¸Šè¿°ä¸¤ä¸ªæ­¥éª¤ç›´åˆ°å¯¹è±¡å›¾ä¸­ä¸å­˜åœ¨ç°è‰²å¯¹è±¡ï¼› åƒåœ¾æ”¶é›†å™¨ä¸€æ—¦å¼€å§‹æ‰§è¡Œå°±ä¼šæµªè´¹å¤§é‡çš„è®¡ç®—èµ„æºï¼Œä¸ºäº†å‡å°‘åº”ç”¨ç¨‹åºæš‚åœçš„æœ€é•¿æ—¶é—´å’Œåƒåœ¾æ”¶é›†çš„æ€»æš‚åœæ—¶é—´ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸‹é¢çš„ç­–ç•¥ä¼˜åŒ–ç°ä»£çš„åƒåœ¾æ”¶é›†å™¨ï¼š\nå¢é‡åƒåœ¾æ”¶é›† â€” å¢é‡åœ°æ ‡è®°å’Œæ¸…é™¤åƒåœ¾ï¼Œé™ä½åº”ç”¨ç¨‹åºæš‚åœçš„æœ€é•¿æ—¶é—´ï¼›\nå¢é‡å¼ï¼ˆIncrementalï¼‰çš„åƒåœ¾æ”¶é›†æ˜¯å‡å°‘ç¨‹åºæœ€é•¿æš‚åœæ—¶é—´çš„ä¸€ç§æ–¹æ¡ˆï¼Œå®ƒå¯ä»¥å°†åŸæœ¬æ—¶é—´è¾ƒé•¿çš„æš‚åœæ—¶é—´åˆ‡åˆ†æˆå¤šä¸ªæ›´å°çš„ GC æ—¶é—´ç‰‡ï¼Œè™½ç„¶ä»åƒåœ¾æ”¶é›†å¼€å§‹åˆ°ç»“æŸçš„æ—¶é—´æ›´é•¿äº†ï¼Œä½†æ˜¯è¿™ä¹Ÿå‡å°‘äº†åº”ç”¨ç¨‹åºæš‚åœçš„æœ€å¤§æ—¶é—´ï¼š\nå¹¶å‘åƒåœ¾æ”¶é›† â€” åˆ©ç”¨å¤šæ ¸çš„è®¡ç®—èµ„æºï¼Œåœ¨ç”¨æˆ·ç¨‹åºæ‰§è¡Œæ—¶å¹¶å‘æ ‡è®°å’Œæ¸…é™¤åƒåœ¾ï¼›\nå¹¶å‘ï¼ˆConcurrentï¼‰çš„åƒåœ¾æ”¶é›†ä¸ä»…èƒ½å¤Ÿå‡å°‘ç¨‹åºçš„æœ€é•¿æš‚åœæ—¶é—´ï¼Œè¿˜èƒ½å‡å°‘æ•´ä¸ªåƒåœ¾æ”¶é›†é˜¶æ®µçš„æ—¶é—´ï¼Œé€šè¿‡å¼€å¯è¯»å†™å±éšœã€åˆ©ç”¨å¤šæ ¸ä¼˜åŠ¿ä¸ç”¨æˆ·ç¨‹åºå¹¶è¡Œæ‰§è¡Œï¼Œå¹¶å‘åƒåœ¾æ”¶é›†å™¨ç¡®å®èƒ½å¤Ÿå‡å°‘åƒåœ¾æ”¶é›†å¯¹åº”ç”¨ç¨‹åºçš„å½±å“ï¼š\nå› ä¸ºå¢é‡å’Œå¹¶å‘ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ä¸ç”¨æˆ·ç¨‹åºäº¤æ›¿è¿è¡Œï¼Œä½¿ç”¨å¹¶å‘æˆ–å¢é‡æ‰§è¡Œï¼Œæœ‰å¯èƒ½ä¼šç”Ÿæˆæ‚¬æŒ‚æŒ‡é’ˆâ€”â€”å³ä¸è¯¥è¢«å›æ”¶çš„å¯¹è±¡è¢«å›æ”¶äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨å±éšœæŠ€æœ¯ä¿è¯åƒåœ¾æ”¶é›†çš„æ­£ç¡®æ€§ï¼›ä¸æ­¤åŒæ—¶ï¼Œåº”ç”¨ç¨‹åºä¹Ÿä¸èƒ½ç­‰åˆ°å†…å­˜æº¢å‡ºæ—¶è§¦å‘åƒåœ¾æ”¶é›†ï¼Œå› ä¸ºå½“å†…å­˜ä¸è¶³æ—¶ï¼Œåº”ç”¨ç¨‹åºå·²ç»æ— æ³•åˆ†é…å†…å­˜ï¼Œè¿™ä¸ç›´æ¥æš‚åœç¨‹åºæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå¢é‡å’Œå¹¶å‘çš„åƒåœ¾æ”¶é›†éœ€è¦æå‰è§¦å‘å¹¶åœ¨å†…å­˜ä¸è¶³å‰å®Œæˆæ•´ä¸ªå¾ªç¯ï¼Œé¿å…ç¨‹åºçš„é•¿æ—¶é—´æš‚åœã€‚\nå†…å­˜å±éšœæŠ€æœ¯æ˜¯ä¸€ç§å±éšœæŒ‡ä»¤ï¼Œå®ƒå¯ä»¥è®© CPU æˆ–è€…ç¼–è¯‘å™¨åœ¨æ‰§è¡Œå†…å­˜ç›¸å…³æ“ä½œæ—¶éµå¾ªç‰¹å®šçš„çº¦æŸï¼Œç›®å‰å¤šæ•°çš„ç°ä»£å¤„ç†å™¨éƒ½ä¼šä¹±åºæ‰§è¡ŒæŒ‡ä»¤ä»¥æœ€å¤§åŒ–æ€§èƒ½ï¼Œä½†æ˜¯è¯¥æŠ€æœ¯èƒ½å¤Ÿä¿è¯å†…å­˜æ“ä½œçš„é¡ºåºæ€§ï¼Œåœ¨å†…å­˜å±éšœå‰æ‰§è¡Œçš„æ“ä½œä¸€å®šä¼šå…ˆäºå†…å­˜å±éšœåæ‰§è¡Œçš„æ“ä½œã€‚\næƒ³è¦åœ¨å¹¶å‘æˆ–è€…å¢é‡çš„æ ‡è®°ç®—æ³•ä¸­ä¿è¯æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬éœ€è¦è¾¾æˆä»¥ä¸‹ä¸¤ç§ä¸‰è‰²ä¸å˜æ€§ï¼ˆTri-color invariantï¼‰ä¸­çš„ä¸€ç§ï¼š\nå¼ºä¸‰è‰²ä¸å˜æ€§ â€” é»‘è‰²å¯¹è±¡ä¸ä¼šæŒ‡å‘ç™½è‰²å¯¹è±¡ï¼Œåªä¼šæŒ‡å‘ç°è‰²å¯¹è±¡æˆ–è€…é»‘è‰²å¯¹è±¡ï¼› å¼±ä¸‰è‰²ä¸å˜æ€§ â€” é»‘è‰²å¯¹è±¡æŒ‡å‘çš„ç™½è‰²å¯¹è±¡å¿…é¡»åŒ…å«ä¸€æ¡ä»ç°è‰²å¯¹è±¡ç»ç”±å¤šä¸ªç™½è‰²å¯¹è±¡çš„å¯è¾¾è·¯å¾„ åƒåœ¾æ”¶é›†ä¸­çš„å±éšœæŠ€æœ¯æ›´åƒæ˜¯ä¸€ä¸ªé’©å­æ–¹æ³•ï¼Œå®ƒæ˜¯åœ¨ç”¨æˆ·ç¨‹åºè¯»å–å¯¹è±¡ã€åˆ›å»ºæ–°å¯¹è±¡ä»¥åŠæ›´æ–°å¯¹è±¡æŒ‡é’ˆæ—¶æ‰§è¡Œçš„ä¸€æ®µä»£ç ï¼Œæ ¹æ®æ“ä½œç±»å‹çš„ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬åˆ†æˆè¯»å±éšœï¼ˆRead barrierï¼‰å’Œå†™å±éšœï¼ˆWrite barrierï¼‰ä¸¤ç§ï¼Œå› ä¸ºè¯»å±éšœéœ€è¦åœ¨è¯»æ“ä½œä¸­åŠ å…¥ä»£ç ç‰‡æ®µï¼Œå¯¹ç”¨æˆ·ç¨‹åºçš„æ€§èƒ½å½±å“å¾ˆå¤§ï¼Œæ‰€ä»¥ç¼–ç¨‹è¯­è¨€å¾€å¾€éƒ½ä¼šé‡‡ç”¨å†™å±éšœä¿è¯ä¸‰è‰²ä¸å˜æ€§ã€‚\n","id":17,"section":"posts","summary":"å†…å­˜æ¨¡å‹ å¯¹äºC/C++ ç­‰è¯­è¨€æ¥è¯´ï¼Œå†…å­˜ç©ºé—´å¤§è‡´ä½¿ç”¨åœ¨ æ ˆåŒºï¼ˆstackï¼‰ï¼šåˆç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…é‡Šæ”¾ï¼Œå­˜æ”¾å‡½æ•°çš„å‚æ•°å€¼ï¼Œå±€éƒ¨å˜é‡çš„å€¼ç­‰ï¼Œå…¶æ“ä½œæ–¹å¼ç±»","tags":["go"],"title":"Goå†…å­˜æ¨¡å‹","uri":"https://liangkang233.github.io/2021/10/go%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/","year":"2021"},{"content":"å¦‚æœéœ€è¦å¿«é€Ÿçš„æ±‚å¤šæ¬¡ ä¸€ä¸ªæ•°ç»„Aå†…çš„ æŸäº›åŒºé—´å’Œï¼Œæœ€å¿«çš„æ–¹æ³•æ˜¯ç”¨å‰ç¼€å’Œæ¥è®°å½•ä¸ºæ•°ç»„B\nå·®åˆ†æ•°ç»„çš„ä¸»è¦é€‚ç”¨åœºæ™¯æ˜¯é¢‘ç¹å¯¹åŸå§‹æ•°ç»„çš„æŸä¸ªåŒºé—´çš„å…ƒç´ è¿›â¾å¢å‡ã€‚\nå‰ç¼€å’Œæ•°ç»„ å·®åˆ†æ•°ç»„\nä½†æ˜¯ å¦‚æœæ•°ç»„Aæ˜¯ä¼šå˜åŒ–çš„ï¼Œæ¯æ¬¡ä¿®æ”¹æŸä¸ªå…ƒç´ ï¼ŒåŒºé—´å’ŒB(å‡è®¾æœ‰nä¸ªå…ƒç´ )æ¯ä¸ªå…ƒç´ éƒ½è¦ä¿®æ”¹ï¼Œæ—¶é—´å¤æ‚åº¦O(n)\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨æ ‘çŠ¶æ•°ç»„ï¼Œå…¶æŸ¥è¯¢ AåŒºé—´ å’Œ ä¿®æ”¹åŒºé—´å…ƒç´  çš„æ—¶é—´å¤æ‚åº¦çš†ä¸º O(log n)\næ ‘çŠ¶æ•°ç»„ æ ‘çŠ¶æ•°ç»„ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªç»´æŠ¤äº†ä¸€æ®µæ•°æ®å’Œçš„æ•°ç»„ï¼Œå…¶è®°å½•å€¼è§„å¾‹å¦‚ä¸‹æ‰€ç¤ºã€‚\nå…³é”®åœ¨äºlowbitå‡½æ•° a \u0026amp; -aï¼Œå³ï¼šå–å‡ºaçš„äºŒè¿›åˆ¶è¡¨è¾¾ä¸­çš„æœ€åä¸€ä½1çš„å€¼ï¼ˆè´Ÿæ•°åœ¨è®¡ç®—æœºä¸­ä»¥è¡¥ç è¡¨ç¤ºï¼‰\nåŸæ•°ç»„ä¸ºa[i]ï¼Œc[i]æ ‘çŠ¶æ•°ç»„ã€‚\næ‰€ä»¥ï¼Œå¯¹äºä¸€ä¸ªæ ‘çŠ¶æ•°ç»„ï¼Œæ·»åŠ æ–°å…ƒç´ ã€è®¡ç®—å‰né¡¹å’Œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(log n)ã€‚\nå…¶è¿›é˜¶æ“ä½œä¸ºçº¿æ®µæ ‘ï¼Œä»¥åé‡åˆ°åˆé€‚æ¡ˆä¾‹å†è¡¥å……è®°å½•ã€‚\nå®ç° æ·»åŠ å€¼å°±æ˜¯é€’å½’çš„åŠ lowbitæ·»åŠ ï¼Œç›¸åæŸ¥è¯¢çš„è¯å°±æ˜¯é€’å½’çš„å‡lowbitç´¯åŠ å’Œå³ä¸ºåŒºé—´å’Œã€‚\nå®é™…ä½¿ç”¨æ—¶ä¸ç”¨æ¨å¯¼ï¼Œç›´æ¥æ‹¿æ¥ç”¨ã€‚\nè§†é¢‘æºç ï¼š\nint t[maxn]; // tæ•°ç»„ä¸ºç»´æŠ¤çš„æ ‘çŠ¶æ•°ç»„ void add(int x, int k) { for(; x \u0026lt;= n; x += (x\u0026amp;-x) ) { t[x] += k; } } int ask(int x) { int ans; for (; i \u0026gt; 0; x -= (x\u0026amp;-x)) { ans += t[x]; } return ans; } // å•ç‚¹ä¿®æ”¹ã€å•ç‚¹æŸ¥è¯¢ add(x, k); ask(x) - ask(x-1); // å•ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢ add(x, k); ask(r) - ask(l-1); // åŒºé—´[l,r]å†… // åŒºé—´æŸ¥è¯¢ä¿®æ”¹ éœ€è¦ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„ç»´æŠ¤ // t1[]ç»´æŠ¤b[i]å‰ç¼€å’Œ,t2[]ç»´æŠ¤i*b[i]å‰ç¼€å’Œ int t1[maxn], t2[maxn]]; void add1(int x, int k) { for(; x \u0026lt;= n; x += (x\u0026amp;-x) ) { t1[x] += k; } } int ask1(int x) { int ans; for (; i \u0026gt; 0; x -= (x\u0026amp;-x)) { ans += t1[x]; } return ans; } void add2(int x, int k) { for(; x \u0026lt;= n; x += (x\u0026amp;-x) ) { t2[x] += k; } } int ask2(int x) { int ans; for (; i \u0026gt; 0; x -= (x\u0026amp;-x)) { ans += t2[x]; } return ans; } // åŒºé—´ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢ // åœ¨åŒºé—´[l, r]ä¿®æ”¹ add1(l, d); add1(r+1, -d); add2(l, l*d); add2(r+1, -(r+1)*d); sum[r] - sum[l-1]; //å³ä¸ºä¸‹å¼ (r+1)*ask1[r] - ask2[r] + (l-1+1)*ask1[l-1] - ask2[l-1]; åº”ç”¨ è“æ¡¥æ¯é¢˜ç›®ï¼šè“æ¡¥æ¯-å†å±Šè¯•é¢˜ å°æœ‹å‹æ’é˜Ÿ ï¼ˆæ ‘çŠ¶æ•°ç»„ï¼‰ (lagou.com)\n/* é—®é¢˜æè¿° n ä¸ªå°æœ‹å‹ç«™æˆä¸€æ’ã€‚ç°åœ¨è¦æŠŠä»–ä»¬æŒ‰èº«é«˜ä»ä½åˆ°é«˜çš„é¡ºåºæ’åˆ—ï¼Œä½†æ˜¯æ¯æ¬¡åªèƒ½äº¤æ¢ä½ç½®ç›¸é‚»çš„ä¸¤ä¸ªå°æœ‹å‹ã€‚ æ¯ä¸ªå°æœ‹å‹éƒ½æœ‰ä¸€ä¸ªä¸é«˜å…´çš„ç¨‹åº¦ã€‚å¼€å§‹çš„æ—¶å€™ï¼Œæ‰€æœ‰å°æœ‹å‹çš„ä¸é«˜å…´ç¨‹åº¦éƒ½æ˜¯0ã€‚ å¦‚æœæŸä¸ªå°æœ‹å‹ç¬¬ä¸€æ¬¡è¢«è¦æ±‚äº¤æ¢ï¼Œåˆ™ä»–çš„ä¸é«˜å…´ç¨‹åº¦å¢åŠ 1ï¼Œå¦‚æœç¬¬äºŒæ¬¡è¦æ±‚ä»–äº¤æ¢ï¼Œåˆ™ä»–çš„ä¸é«˜å…´ç¨‹åº¦å¢åŠ 2ï¼ˆå³ä¸é«˜å…´ç¨‹åº¦ä¸º3ï¼‰ï¼Œ ä¾æ¬¡ç±»æ¨ã€‚å½“è¦æ±‚æŸä¸ªå°æœ‹å‹ç¬¬kæ¬¡äº¤æ¢æ—¶ï¼Œä»–çš„ä¸é«˜å…´ç¨‹åº¦å¢åŠ kã€‚ è¯·é—®ï¼Œè¦è®©æ‰€æœ‰å°æœ‹å‹æŒ‰ä»ä½åˆ°é«˜æ’é˜Ÿï¼Œä»–ä»¬çš„ä¸é«˜å…´ç¨‹åº¦ä¹‹å’Œæœ€å°æ˜¯å¤šå°‘ã€‚ å¦‚æœæœ‰ä¸¤ä¸ªå°æœ‹å‹èº«é«˜ä¸€æ ·ï¼Œåˆ™ä»–ä»¬è°ç«™åœ¨è°å‰é¢æ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚ è¾“å…¥æ ¼å¼ è¾“å…¥çš„ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•°nï¼Œè¡¨ç¤ºå°æœ‹å‹çš„ä¸ªæ•°ã€‚ ç¬¬äºŒè¡ŒåŒ…å« n ä¸ªæ•´æ•° H1 H2 â€¦ Hnï¼Œåˆ†åˆ«è¡¨ç¤ºæ¯ä¸ªå°æœ‹å‹çš„èº«é«˜ã€‚ è¾“å‡ºæ ¼å¼ è¾“å‡ºä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå°æœ‹å‹çš„ä¸é«˜å…´ç¨‹åº¦å’Œçš„æœ€å°å€¼ã€‚ æ ·ä¾‹è¾“å…¥ 3 3 2 1 æ ·ä¾‹è¾“å‡º 9 æ ·ä¾‹è¯´æ˜ é¦–å…ˆäº¤æ¢èº«é«˜ä¸º3å’Œ2çš„å°æœ‹å‹ï¼Œå†äº¤æ¢èº«é«˜ä¸º3å’Œ1çš„å°æœ‹å‹ï¼Œå†äº¤æ¢èº«é«˜ä¸º2å’Œ1çš„å°æœ‹å‹ï¼Œæ¯ä¸ªå°æœ‹å‹çš„ä¸é«˜å…´ç¨‹åº¦éƒ½æ˜¯3ï¼Œæ€»å’Œä¸º9ã€‚ æ•°æ®è§„æ¨¡å’Œçº¦å®š å¯¹äº10%çš„æ•°æ®ï¼Œ 1\u0026lt;=n\u0026lt;=10ï¼› å¯¹äº30%çš„æ•°æ®ï¼Œ 1\u0026lt;=n\u0026lt;=1000ï¼› å¯¹äº50%çš„æ•°æ®ï¼Œ 1\u0026lt;=n\u0026lt;=10000ï¼› å¯¹äº100%çš„æ•°æ®ï¼Œ1\u0026lt;=n\u0026lt;=100000ï¼Œ0\u0026lt;=Hi\u0026lt;=1000000ã€‚ */ // ç”¨æ±‚é€†åºæ•°çš„æ€æƒ³å»åšï¼Œå®šä¹‰å‰é¢çš„æ•°å¤§äºå½“å‰æ•°çš„ä¸ªæ•°ä¸ºé€†åºæ•°ï¼Œ // åé¢çš„æ•°å°äºå½“å‰æ•°çš„ä¸ªæ•°ä¸ºé€†åºæ•°2å·ï¼Œ // å°æœ‹å‹çš„ä¸é«˜å…´å€¼ = é€†åºæ•°1 ç­‰å·®å’Œ + é€†åºæ•°2 ç­‰å·®å’Œ // é€†åºæ•°å®šä¹‰å¯çŸ¥ï¼Œä¸€ä¸ªæ•°çš„é€†åºæ•°æ˜¯å¾€å‰æŒªå‡ æ¬¡ï¼Œç›¸åº”çš„é€†åºæ•°2å·å°±æ˜¯è¢«åé¢çš„æ•°æŒªåŠ¨çš„æ¬¡æ•°ï¼Œ // å¦‚æœæ˜¯æ±‚äº¤æ¢æ¬¡æ•°ï¼Œåªéœ€è¦æ±‚é€†åºæ•°1 æˆ– 2 çš„ç´¯åŠ å³å¯ // å…¶å® å·¦å³éå† é€†åºæ•°å’Œ ä¸€å®šæ˜¯ç›¸åŒçš„ï¼Œ // åªä¸è¿‡è¿™é‡Œè¦ç´¯è®¡çš„æ˜¯ä¸é«˜å…´å€¼ æ˜¯ä¸€ä¸ªç­‰å·®æ•°åˆ—çš„né¡¹å’Œ æ‰€ä»¥åªèƒ½é€†åºæ•°çš„ä¸¤ä¸ªæ–¹å‘åˆ†å¼€æ¥æ±‚ // ä½¿ç”¨æ ‘çŠ¶æ•°ç»„æ¥åš ä»¥ èº«é«˜+1 ä¸ºæ ‘çŠ¶æ•°ç»„ä¸‹æ ‡ è¿™æ ·éå†ä¸‹å»å°±åªä¼šç»Ÿè®¡åˆ°èº«é«˜æ¯”å®ƒå°çš„å€¼ // https://www.lagou.com/lgeduarticle/508.html #include \u0026lt;iostream\u0026gt; #include \u0026lt;cstring\u0026gt; using namespace std; // å°æœ‹å‹èº«é«˜å±…ç„¶å¯ä»¥ä¸º0 // ç”±äºæ ‘çŠ¶æ•°ç»„ç»“æ„è®¾è®¡æ— æ³•å‘tree[0]å­˜å‚¨å€¼æ‰€ä»¥å­˜æ ‘çŠ¶å€¼ä¸‹æ ‡ä¸ºèº«é«˜å€¼åŠ 1 // å †ç©ºé—´ç”³è¯·è¿”å›çš„æ˜¯å•ä¸ªå…ƒç´ çš„æŒ‡é’ˆï¼Œåˆ‡ä¸å¯ä½¿ç”¨memset(tree, 0, sizeof(tree)); // è€Œæ˜¯ memset(tree, 0, maxn * sizeof(int)); åŒç†ä¼ å‚ä¹Ÿæ˜¯å¦‚æ­¤ #define maxn 1000002 void add(int i, int k, int* tree) { for (; i \u0026lt; maxn; i += (i \u0026amp; -i)) { tree[i] += k; } } int sum (int i, int *tree) { int sum = 0; for (; i \u0026gt; 0; i -= (i \u0026amp; -i)) { sum += tree[i]; } return sum; } int main() { int N; long long count = 0; int* tree = new int[maxn]; int* temp = new int[maxn]; long long* num = new long long[maxn]; memset(temp, 0, maxn * sizeof(int)); memset(num, 0, maxn * sizeof(long long)); cin \u0026gt;\u0026gt; N; for (int i = 0; i \u0026lt; N; i++) cin \u0026gt;\u0026gt; temp[i]; // ä»å·¦å¾€å³ è®°å½•å·¦è¾¹æ¯”å®ƒé«˜çš„ memset(tree, 0, maxn * sizeof(int)); for (int j = 0; j \u0026lt; N; j++) { add(temp[j]+1 , 1, tree); num[j] = j+1 - sum(temp[j]+1, tree); } // ä»å³å¾€å·¦ è®°å½•å³è¾¹æ¯”ä»–çŸ®çš„ memset(tree, 0, maxn * sizeof(int)); for (int j = N-1; j \u0026gt;= 0; j--) { add(temp[j]+1, 1, tree); num[j] += sum(temp[j], tree); } for (int i = 0; i \u0026lt; N; i++) { count += num[i] * (num[i]+1) / 2; } delete[] tree; delete[] temp; delete[] num; return 0; } ","id":18,"section":"posts","summary":"å¦‚æœéœ€è¦å¿«é€Ÿçš„æ±‚å¤šæ¬¡ ä¸€ä¸ªæ•°ç»„Aå†…çš„ æŸäº›åŒºé—´å’Œï¼Œæœ€å¿«çš„æ–¹æ³•æ˜¯ç”¨å‰ç¼€å’Œæ¥è®°å½•ä¸ºæ•°ç»„B å·®åˆ†æ•°ç»„çš„ä¸»è¦é€‚ç”¨åœºæ™¯æ˜¯é¢‘ç¹å¯¹åŸå§‹æ•°ç»„çš„æŸä¸ªåŒºé—´çš„å…ƒç´ è¿›â¾å¢","tags":["C/C++","æ•°æ®ç»“æ„"],"title":"æ•°æ®ç»“æ„-æ ‘çŠ¶æ•°ç»„","uri":"https://liangkang233.github.io/2021/10/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/","year":"2021"},{"content":"å¹¶æŸ¥é›† å¹¶æŸ¥é›†æ˜¯ä¸€ç§æ ‘å½¢çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå¤„ç†ä¸äº¤é›†ï¼ˆDisjoint setsï¼‰çš„åˆå¹¶å’ŒæŸ¥è¯¢é—®é¢˜ã€‚\næ¡ˆä¾‹ï¼šåˆå§‹çŠ¶æ€nä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ ä½äºç‹¬ç«‹çš„é›†åˆï¼Œä¹‹åè¿›è¡Œåˆå¹¶æ“ä½œå°†é›†åˆåˆå¹¶ã€‚åˆå¹¶è¿‡ç¨‹ä¸­åˆ¤æ–­é›†åˆä¸­æ˜¯å¦æœ‰é‡å¤å…ƒç´ ã€‚\næ‰€ä»¥å¹¶æŸ¥é›†ä¸»è¦çš„ä¸¤ä¸ªæ“ä½œï¼š\næŸ¥è¯¢: find ç¡®å®šæŸä¸ªå…ƒç´ å¤„äºå“ªä¸ªå­é›† åˆå¹¶: union å°†ä¸¤ä¸ªå­é›†åˆåˆå¹¶æˆä¸€ä¸ªé›†åˆ å¹¶æŸ¥é›†çš„å®ç° æ€è·¯:ä½¿ç”¨æ•°ç»„ç­‰ç»“æ„è®°å½•æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢æ“ä½œå°±æ˜¯é€’å½’çš„æŸ¥è¯¢è¯¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ‰¾å¯»å…¶rootï¼Œåˆå¹¶æ“ä½œå°±æ˜¯æŠŠä¸¤ä¸ªèŠ‚ç‚¹çš„ä¸­ä¸€ä¸ªä½œä¸ºå¦ä¸€ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹è¿™æ ·å°±å®Œæˆäº†åˆå¹¶ã€‚\nä¸€å¼€å§‹æ¯ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªé›†åˆï¼Œéšç€æ‰€æœ‰èŠ‚ç‚¹è¿­ä»£ä¸‹å»çš„åˆå¹¶ï¼Œåˆå¹¶ä¸¤ä¸ªèŠ‚ç‚¹å°±ç›¸å½“äºåˆå¹¶åŒ…å«è¯¥èŠ‚ç‚¹çš„ä¸¤ä¸ªé›†åˆã€‚æ¯ä¸¤ä¸ªèŠ‚ç‚¹åˆå¹¶æ—¶æŸ¥è¯¢ä¸¤ä¸ªèŠ‚ç‚¹çš„çš„rootèŠ‚ç‚¹ã€‚å¦‚æœç›¸åŒè¯´æ˜ä¸¤ä¸ªè¿™ä¸¤ä¸ªé›†åˆæœ‰ç›¸åŒçš„å­èŠ‚ç‚¹ï¼Œåˆå¹¶åå¿…å®šä¼šäº§ç”Ÿç¯ã€‚\nä¼˜åŒ–ï¼š\nè·¯å¾„å‹ç¼©ï¼šæŸ¥æ‰¾rootèŠ‚ç‚¹çš„æ—¶å€™å°±ç›´æ¥æŠŠä»–çš„çˆ¶èŠ‚ç‚¹æ”¹ä¸ºrootï¼Œçœçš„ä¸‹æ¬¡é‡å¤æŸ¥æ‰¾ æŒ‰ç§©åˆå¹¶ï¼šç»´æŠ¤ä¸€ä¸ªç§©æ•°ç»„ï¼Œè®°å½•è¯¥èŠ‚ç‚¹ä¸‹çš„å­æ ‘æ·±åº¦ã€‚è¿™æ ·åˆå¹¶ä¸¤ä¸ªèŠ‚ç‚¹æ—¶ï¼Œè®©ç§©å¤§çš„åšçˆ¶èŠ‚ç‚¹é¿å…å­æ ‘è¿‡é•¿ã€‚ è§†é¢‘çš„è§£æå¾ˆæ¸…æ¥šï¼Œåšä¸ªæçº²é˜²æ­¢å¿˜è®°\nè§†é¢‘çš„æºç ï¼š\n#include\u0026lt;stdio.h\u0026gt; #include\u0026lt;stdlib.h\u0026gt; #include\u0026lt;string.h\u0026gt; #define VERTICES 6 #define _CRT_SECURE_NO_WARNINGS int find_root(int x, int parent[]) // æ‰¾åˆ°æ ¹èŠ‚ç‚¹ { if (parent[x] != x) { //å½“çˆ¶èŠ‚ç‚¹æ˜¯è‡ªå·±è¯´æ˜å·²ç»æ˜¯æ ¹èŠ‚ç‚¹ parent[x] = find_root(parent[x], parent); //è·¯å¾„å‹ç¼©,æ‰¾çˆ¶èŠ‚ç‚¹çš„åŒæ—¶æ›´æ–°è‡ªå·±çš„çˆ¶èŠ‚ç‚¹ä¸ºrootèŠ‚ç‚¹ } return parent[x]; } int union_vertices(int x, int y, int parent[],int rank[]) // è®©ä¸¤ä¸ªé›†åˆåˆå¹¶ { int x_root = find_root(x, parent); int y_root = find_root(y, parent); if (x_root == y_root) return 0; else { if (rank[x_root] \u0026gt; rank[y_root]) // è®© å°‘çš„æŒ‡å‘å¤š çš„ parent[y_root] = x_root; else if (rank[x_root] \u0026lt; rank[y_root]) parent[x_root] = y_root; else { parent[x_root] = y_root; // è¿™ä¸ªéšä¾¿å¯ä»¥ rank[y_root]++; } return 1; } } int main(void) { int parent[VERTICES] = { 0 }; int rank[VERTICES] = { 0 }; memset(rank, 0, sizeof(rank)); // memset(parent, -1, sizeof(parent)); for (int i = 0; i \u0026lt; VERTICES; i++) //åˆå§‹çˆ¶èŠ‚ç‚¹å°±æ˜¯è‡ªå·± parent[i] = i; int edges[6][2] = { {0,1},{1,2},{1,3},{2,4},{3,4},{2,5} }; for (int i = 0; i \u0026lt; 6; i++) { int x = edges[i][0]; int y = edges[i][1]; if (union_vertices(x, y, parent,rank) == 0) { printf(\u0026quot;Cycle detected!\\n\u0026quot;); system(\u0026quot;pause\u0026quot;); exit(0); } } printf(\u0026quot;No cycle found.\\n\u0026quot;); system(\u0026quot;pause\u0026quot;); return 0; } å¹¶æŸ¥é›†çš„åº”ç”¨ leetcode 547é¢˜ç›®\nclass Solution { public: int find(int i) { if (parent[i] != i) //é€’å½’å¯»æ‰¾rootèŠ‚ç‚¹å¹¶æŠŠrootèµ‹å€¼ parent[i] = find(parent[i]); return parent[i]; } void merge(int i, int j) { int root1 = find(i), root2 = find(j); if(root1 == root2) // è‹¥ç›¸ç­‰åˆ™ä¸¤ä¸ªé›†åˆæœ‰äº¤é›†ï¼Œç›¸å½“äºåœ¨åŒä¸€ä¸ªçœä»½å†…çš„ä¸¤ä¸ªåŸå¸‚ç›¸è¿ï¼ˆæˆç¯ï¼‰ return; // è¿™é‡Œä¸åšä»»ä½•å¤„ç† ansçœä»½æ ‘ä¸ä¼šå‡å°‘ ans--; // æ¥ä¸‹æ¥è¿›è¡Œåˆå¹¶ if(rank[root1] \u0026gt;= rank[root2]) parent[root2] = root1; else parent[root1] = root2; if (rank[root1] == rank[root2]) rank[root1]++; } int ans; vector\u0026lt;int\u0026gt; parent, rank; int findCircleNum(vector\u0026lt;vector\u0026lt;int\u0026gt;\u0026gt;\u0026amp; isConnected) { ans = isConnected.size(); //åˆå§‹è§†ä½œæ¯ä¸ªåŸå¸‚éƒ½æ˜¯ä¸€ä¸ªçœä»½ rank.resize(ans, 0); for (int i = 0; i \u0026lt; isConnected.size(); i++) parent.push_back(i); for (int i = 0; i \u0026lt; isConnected.size(); i++) { for (int j = 0; j \u0026lt; isConnected.size(); j++) { if (isConnected[i][j] == 0 || i == j) continue; merge(i, j); } } return ans; } }; é¢˜å¤–è¯ï¼šåŒæŒ‡é’ˆåˆ¤æ–­é“¾è¡¨æ˜¯å¦æœ‰ç¯ï¼Œçœ‹èµ·æ¥ç±»ä¼¼ä¹Ÿæ˜¯æ‰¾ç¯ï¼Œä½†æ˜¯ç”¨çš„åŒæŒ‡é’ˆæ‰¾çš„ã€‚141. ç¯å½¢é“¾è¡¨\nå † è¿™é‡Œè¯´çš„å †æŒ‡çš„æ—¶æ•°æ®ç»“æ„å †ï¼Œä¸æ˜¯ç¨‹åºç”³è¯·çš„å †ç©ºé—´ã€‚\nå †ï¼ˆheapï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­ä¸€ç±»ç‰¹æ®Šçš„æ•°æ®ç»“æ„çš„ç»Ÿç§°ã€‚å †é€šå¸¸æ˜¯ä¸€ä¸ªå¯ä»¥è¢«çœ‹åšä¸€æ£µæ ‘çš„æ•°ç»„å¯¹è±¡ã€‚\nå †æ€»æ˜¯æ»¡è¶³ä¸‹åˆ—æ€§è´¨ï¼š\nå°æ ¹å †Min-heap: çˆ¶èŠ‚ç‚¹çš„å€¼å°äºæˆ–ç­‰äºå­èŠ‚ç‚¹çš„å€¼ï¼› å¤§æ ¹å †Max-heap: çˆ¶èŠ‚ç‚¹çš„å€¼å¤§äºæˆ–ç­‰äºå­èŠ‚ç‚¹çš„å€¼ï¼›\nå †ä¸­æŸä¸ªç»“ç‚¹çš„å€¼æ€»æ˜¯ä¸å¤§äºæˆ–ä¸å°äºå…¶çˆ¶ç»“ç‚¹çš„å€¼ï¼›\nå †æ€»æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘1\nå…¶æ’å…¥æ·»åŠ å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸ºO(log n)ã€‚æŸ¥è¯¢æœ€å¤§ã€å°å€¼çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)\nå †çš„å®ç° ç”±äºå †æ˜¯ä¸€é¢—å®Œå…¨äºŒå‰æ ‘ï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥ç”¨ä¸€ä¸ªæ•°ç»„å‡†ç¡®å¹¶å”¯ä¸€çš„è¡¨ç¤ºè¯¥äºŒå‰æ ‘ã€‚\nç”¨æ•°ç»„è¡¨ç¤ºè¯¥å®Œå…¨äºŒå‰æ ‘ç”±ä¸Šåˆ°ä¸‹ã€ç”±åšåˆ°å³çš„è®°å½•æ—¶ï¼Œæœ‰ä»¥ä¸‹æ€§è´¨ï¼š\nçˆ¶èŠ‚ç‚¹ = (i - 1) / 2 å·¦å­èŠ‚ç‚¹ = 2 * i + 1 å³å­èŠ‚ç‚¹ = 2 * i + 2 C++ STLåº“ä¼˜å…ˆé˜Ÿåˆ—çš„ä½¿ç”¨æ–¹å¼ å¤´æ–‡ä»¶: #include \u0026lt;queue\u0026gt;\npriority_queue\u0026lt;point, vector\u0026lt;point\u0026gt;, greater\u0026lt;point\u0026gt;\u0026gt; que; // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­˜å‚¨å¯¹è±¡çš„ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å­˜å‚¨å…ƒç´ çš„åº•å±‚å®¹å™¨ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å‡½æ•°å¯¹è±¡ï¼Œç¬¬äºŒç¬¬ä¸‰å‚æ•°å¯ä»¥ä¸å¡«å…¥ // ä¸sortåˆšå¥½ç›¸ä¼˜å…ˆé˜Ÿåˆ—åé˜Ÿåˆ—é»˜è®¤é‡‡ç”¨çš„æ˜¯lessç”Ÿæˆçš„æ˜¯å¤§æ ¹å †ï¼Œsort é»˜è®¤æ˜¯ less ä»å°åˆ°å¤§å‡åºæ’åº å †çš„åº”ç”¨ ç”¨äºå †æ’åº æ—¶é—´å¤æ‚åº¦O(nlog n)ï¼Œé¢å¤–ç©ºé—´å¤æ‚åº¦O(1)\n// å¯¹ä¸€ä¸ªèŠ‚ç‚¹åšheapifyçš„æ—¶å€™ï¼Œå¿…é¡»ä¿è¯å®ƒçš„æ‰€æœ‰å­æ ‘éƒ½å·²ç»æ˜¯å †ã€‚ void swap(int *a, int *b) { int temp = *b; *b = *a; *a = temp; } void max_heapify(int arr[], int start, int end) { int dad = start; int son = dad * 2 + 1; while (son \u0026lt;= end) { if (son + 1 \u0026lt;= end \u0026amp;\u0026amp; arr[son] \u0026lt; arr[son + 1]) // åˆ¤æ–­å³å­èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œå¹¶æ¯”è¾ƒå¤§å° son++; if (arr[dad] \u0026gt; arr[son]) //å¦‚æœçˆ¶èŠ‚ç‚¹å¤§äºå­èŠ‚ç‚¹ä»£è¡¨è°ƒæ•´å®Œæ¯•ï¼Œç›´æ¥è·³å‡ºå‡½æ•¸ return; else { // å¦åˆ™äº¤æ¢çˆ¶å­èŠ‚ç‚¹ swap(\u0026amp;arr[dad], \u0026amp;arr[son]); dad = son; son = dad * 2 + 1; } } } void heap_sort(int arr[], int len) { int i; // åˆå§‹åŒ–ï¼Œä»æœ€åä¸€ä¸ªçˆ¶èŠ‚ç‚¹å¼€å§‹è°ƒæ•´ for (i = (len-2) / 2; i \u0026gt;= 0; i--) max_heapify(arr, i, len - 1); // å–å‡ºæœ€å¤§å€¼(å †å¤´)ï¼Œç„¶åé‡æ–°heapify è¿™é‡Œä¼˜åŒ–ä¸ºå°†å †å¤´æ¢åˆ°æœ€åä¸€ä½ï¼Œç„¶åæœ€åä¸€ä¸ªèŠ‚ç‚¹ä¸å‚åŠ heapify // è¿­ä»£å…¨éƒ¨å †å¤´åï¼Œå°±æ˜¯æ’åºåçš„åˆ—è¡¨ for (i = len - 1; i \u0026gt; 0; i--) { swap(\u0026amp;arr[0], \u0026amp;arr[i]); max_heapify(arr, 0, i - 1); } } ç”¨ä¼˜å…ˆé˜Ÿåˆ—è§£å†³çš„æ¡ˆä¾‹ï¼š23. åˆå¹¶Kä¸ªå‡åºé“¾è¡¨ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰ (leetcode-cn.com)\nclass Solution { public: //é¢˜ç›®23 \u0026quot;é‡è½½ç»“æ„ä½“çš„\u0026lt;\u0026quot;ï¼Œç”¨é»˜è®¤çš„lessï¼ˆæ‰€ä»¥çœç•¥äº†è¯¥å‚æ•°ï¼‰ struct Status { int val; ListNode *ptr; bool operator \u0026lt; (const Status \u0026amp;rhs) const { return val \u0026gt; rhs.val; } }; priority_queue \u0026lt;Status\u0026gt; q; ListNode* mergeKLists(vector\u0026lt;ListNode*\u0026gt;\u0026amp; lists) { for (auto node: lists) { if (node) q.push({node-\u0026gt;val, node}); } ListNode head, *tail = \u0026amp;head; while (!q.empty()) { auto f = q.top(); q.pop(); tail-\u0026gt;next = f.ptr; tail = tail-\u0026gt;next; if (f.ptr-\u0026gt;next) q.push({f.ptr-\u0026gt;next-\u0026gt;val, f.ptr-\u0026gt;next}); } return head.next; } }; // \u0026quot;ä¹Ÿå¯ä»¥é‡è½½()\u0026quot; å…¶å® greater å’Œ less å°±æ˜¯ä¸€ä¸ªæ¨¡æ¿è°ƒç”¨çš„æ¨¡æ¿ç±»ï¼Œé‡Œé¢é‡è½½äº†å…ƒç´ çš„() è¿”å›\u0026gt; æˆ–\u0026lt;çš„bool // STRUCT TEMPLATE greater template \u0026lt;class _Ty = void\u0026gt; struct greater { _CXX17_DEPRECATE_ADAPTOR_TYPEDEFS typedef _Ty _FIRST_ARGUMENT_TYPE_NAME; _CXX17_DEPRECATE_ADAPTOR_TYPEDEFS typedef _Ty _SECOND_ARGUMENT_TYPE_NAME; _CXX17_DEPRECATE_ADAPTOR_TYPEDEFS typedef bool _RESULT_TYPE_NAME; _NODISCARD constexpr bool operator()(const _Ty\u0026amp; _Left, const _Ty\u0026amp; _Right) const { return _Left \u0026gt; _Right; } }; // é‡è½½()å¦‚ä¸‹æ‰€ç¤º struct com{ bool operator()(pair\u0026lt;int,int\u0026gt;\u0026amp;a,pair\u0026lt;int,int\u0026gt;\u0026amp;b){ return a.second\u0026gt;b.second; } }; priority_queue\u0026lt;pair\u0026lt;int,int\u0026gt;,vector\u0026lt;pair\u0026lt;int,int\u0026gt;\u0026gt;,com\u0026gt; q; ä¸€æ£µæ·±åº¦ä¸ºkçš„æœ‰nä¸ªç»“ç‚¹çš„äºŒå‰æ ‘ï¼Œå¯¹æ ‘ä¸­çš„ç»“ç‚¹æŒ‰ä»ä¸Šè‡³ä¸‹ã€ä»å·¦åˆ°å³çš„é¡ºåºè¿›è¡Œç¼–å·ï¼Œå¦‚æœç¼–å·ä¸ºiï¼ˆ1â‰¤iâ‰¤nï¼‰çš„ç»“ç‚¹ä¸æ»¡äºŒå‰æ ‘ä¸­ç¼–å·ä¸ºiçš„ç»“ç‚¹åœ¨äºŒå‰æ ‘ä¸­çš„ä½ç½®ç›¸åŒï¼Œåˆ™è¿™æ£µäºŒå‰æ ‘ç§°ä¸ºå®Œå…¨äºŒå‰æ ‘ã€‚\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","id":19,"section":"posts","summary":"å¹¶æŸ¥é›† å¹¶æŸ¥é›†æ˜¯ä¸€ç§æ ‘å½¢çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå¤„ç†ä¸äº¤é›†ï¼ˆDisjoint setsï¼‰çš„åˆå¹¶å’ŒæŸ¥è¯¢é—®é¢˜ã€‚ æ¡ˆä¾‹ï¼šåˆå§‹çŠ¶æ€nä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ ä½äºç‹¬ç«‹çš„é›†åˆ","tags":["C/C++","æ•°æ®ç»“æ„"],"title":"å¹¶æŸ¥é›†ã€å †(ä¼˜å…ˆé˜Ÿåˆ—)","uri":"https://liangkang233.github.io/2021/10/%E5%B9%B6%E6%9F%A5%E9%9B%86%E5%A0%86%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/","year":"2021"},{"content":"ä»‹ç» æœ€è¿‘åœ¨åšä¸€ä¸ªå…³äºæ— çº¿ç§»åŠ¨è‡ªç»„ç»‡ç½‘ç»œç›¸å…³çš„å†…å®¹ï¼Œç§»åŠ¨è‡ªç»„ç»‡ç½‘ç»œæ˜¯ç”±å½¼æ­¤å·²ç»å‘ç°å’Œäº’ç›¸æ¥è¿‘çš„ä¸”æœ‰é€šä¿¡éœ€æ±‚çš„ç§»åŠ¨è®¾å¤‡æ„æˆçš„ã€‚ç”±äºç½‘å†…èŠ‚ç‚¹çš„ç§»åŠ¨æ‹“æ‰‘æ˜¯ä¸å¯çŸ¥çš„ï¼Œæ‰€ä»¥å„è‡ªç»„ç½‘ç»“æ„æ˜¯åŠ¨æ€å˜åŒ–çš„ã€‚è¦æ ¹æ®å…¶å„ä¸ªå®æ—¶åŠ¨æ€å½¢æˆçš„è‡ªç»„ç½‘å¼€å‘æ–°çš„å†…å®¹ï¼Œè¿™å°±éœ€è¦ä¸€ä¸ªå¯ä»¥æ¢æµ‹ç½‘å†…èŠ‚ç‚¹æ•°é‡çš„å·¥å…·æ¥è®¾å®šå½“å‰è‡ªç»„ç½‘å†…çŠ¶æ€ã€‚åœ¨ç½‘ä¸Šæ‰¾å¯»ç›¸å…³å·¥å…·èµ„æ–™çš„æ—¶å€™æƒ³åˆ°OSPFçš„helloç»„æ’­åŒ…ï¼Œè§‰å¾—è¿™ä¸ªå®ç°å¾ˆä¸é”™ï¼Œäºæ˜¯å°è¯•ç”¨goå†™äº†ä¸ªudpç»„æ’­å®ç°çš„æ¢æµ‹ç½‘å†…èŠ‚ç‚¹çš„å·¥å…·ï¼Œåˆ†äº«ä¸‹ã€‚\nå…¶å®ç°åŸç†å°±æ˜¯ä½¿ç”¨å®šæ—¶å™¨å®šæ—¶è§¦å‘hellloç»„æ’­åŒ…ç»™ç»„æ’­åŸŸï¼Œå¦‚æœèŠ‚ç‚¹æ¥æ”¶åˆ°å…¶ä»–èŠ‚ç‚¹å‘é€çš„ç»„æ’­åŒ…å°±è®°å½•ä¸‹ã€‚æ¯ä¸€ä¸ªæ€»æ£€æµ‹å‘¨æœŸå†…æŸ¥è¯¢æ¥æ”¶çš„èŠ‚ç‚¹ï¼Œæ ¹æ®æ¥æ”¶åˆ°çš„èŠ‚ç‚¹åå°±å¯ä»¥çŸ¥é“è¯¥èŠ‚ç‚¹çš„è‡ªç»„ç½‘ä¸‹èŠ‚ç‚¹æœ‰å“ªäº›ã€‚ä¾‹å¦‚åœºæ™¯ä¸­æœ‰1-10ä¸ªèŠ‚ç‚¹ï¼Œ1èŠ‚ç‚¹èƒ½å¤Ÿæ”¶åˆ°2-7èŠ‚ç‚¹çš„ç»„æ’­åŒ…è¯´æ˜1-7èŠ‚ç‚¹åœ¨åŒä¸€è‡ªç»„ç½‘å†…å±äºè¯¥è‡ªç»„ç½‘çš„å­˜æ´»èŠ‚ç‚¹ã€‚ï¼ˆéå­˜æ´»èŠ‚ç‚¹å¹¶ä¸æ˜¯è¡¨ç¤ºè¯¥èŠ‚ç‚¹downï¼Œä»…ä»…æ˜¯ä»£è¡¨è¯¥èŠ‚ç‚¹ä¾‹å¦‚èŠ‚ç‚¹8ä¸åœ¨è¿™ä¸ªè‡ªç»„ç½‘å†…ï¼‰\nå®ç°è¿‡ç¨‹ goä¸­å¯¹udpç­‰å¥—æ¥å­—çš„å®˜æ–¹åŒ…å®ç°ç±»ä¼¼unixï¼ŒåŸºæœ¬çš„å¥—æ¥å­—çŸ¥è¯†å°±ä¸åœ¨è¿™å›é¡¾äº†ï¼Œæ€»ä¹‹è¦äº†è§£ä¸‹udpä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨connectå‡½æ•°åšæœ‰è¿æ¥çš„è¯·æ±‚ï¼Œå¹¶ä¸æ˜¯è¯´å¦‚tcpé‚£èˆ¬æ¡æ‰‹æä¾›å¯é è¿æ¥ï¼Œä»…ä»…æ˜¯å•æ–¹é¢çš„ç¡®å®šæºç›®æ ‡åœ°å€çš„è¿æ¥ã€‚\nç»„æ’­å®šä¹‰ï¼šç»„æ’­æ˜¯æŒ‡åœ¨IPç½‘ç»œä¸­å°†æ•°æ®åŒ…ä»¥å°½åŠ›ä¼ é€çš„å½¢å¼å‘é€åˆ°æŸä¸ªç¡®å®šçš„èŠ‚ç‚¹é›†åˆï¼ˆå³ç»„æ’­ç»„ï¼‰ï¼Œå…¶åŸºæœ¬æ€æƒ³æ˜¯ï¼šæºä¸»æœºï¼ˆå³ç»„æ’­æºï¼‰åªå‘é€ä¸€ä»½æ•°æ®ï¼Œå…¶ç›®çš„åœ°å€ä¸ºç»„æ’­ç»„åœ°å€ï¼›ç»„æ’­ç»„ä¸­çš„æ‰€æœ‰æ¥æ”¶è€…éƒ½å¯æ”¶åˆ°åŒæ ·çš„æ•°æ®æ‹·è´ï¼Œå¹¶ä¸”åªæœ‰ç»„æ’­ç»„å†…çš„ä¸»æœºå¯ä»¥æ¥æ”¶è¯¥æ•°æ®ï¼Œè€Œå…¶å®ƒä¸»æœºåˆ™ä¸èƒ½æ”¶åˆ°ã€‚\nåŸºç¡€çš„ç”¨goçš„å¥—æ¥å­—ç¤ºä¾‹å®ç°çœ‹çœ‹æ·±å…¥Go UDPç¼–ç¨‹è¿™ç¯‡åšå®¢å³å¯ï¼Œç®€å•æ˜“ç”¨ã€‚ç»„æ’­éƒ¨åˆ†ä»£ç ä¹Ÿæ˜¯ä½¿ç”¨åœ¨è¿™ç¯‡æ–‡ç« çš„é€šç”¨å¤šæ’­ç¼–ç¨‹ä»£ç 1æ”¹å†™çš„\n// ç»„æ’­æœåŠ¡å™¨ä»£ç  func main() { //å¦‚æœç¬¬äºŒå‚æ•°ä¸ºnil,å®ƒä¼šä½¿ç”¨ç³»ç»ŸæŒ‡å®šå¤šæ’­æ¥å£ï¼Œä½†æ˜¯ä¸æ¨èè¿™æ ·ä½¿ç”¨ addr, err := net.ResolveUDPAddr(\u0026quot;udp\u0026quot;, \u0026quot;224.0.0.250:9981\u0026quot;) if err != nil { fmt.Println(err) } listener, err := net.ListenMulticastUDP(\u0026quot;udp\u0026quot;, nil, addr) if err != nil { fmt.Println(err) return } fmt.Printf(\u0026quot;Local: \u0026lt;%s\u0026gt; \\n\u0026quot;, listener.LocalAddr().String()) data := make([]byte, 1024) for { n, remoteAddr, err := listener.ReadFromUDP(data) if err != nil { fmt.Printf(\u0026quot;error during read: %s\u0026quot;, err) } fmt.Printf(\u0026quot;\u0026lt;%s\u0026gt; %s\\n\u0026quot;, remoteAddr, data[:n]) } } // ç»„æ’­å®¢æˆ·ç«¯ä»£ç  func main() { ip := net.ParseIP(\u0026quot;224.0.0.250\u0026quot;) srcAddr := \u0026amp;net.UDPAddr{IP: net.IPv4zero, Port: 0} dstAddr := \u0026amp;net.UDPAddr{IP: ip, Port: 9981} conn, err := net.DialUDP(\u0026quot;udp\u0026quot;, srcAddr, dstAddr) if err != nil { fmt.Println(err) } defer conn.Close() conn.Write([]byte(\u0026quot;hello\u0026quot;)) fmt.Printf(\u0026quot;\u0026lt;%s\u0026gt;\\n\u0026quot;, conn.RemoteAddr())} buildä»£ç åè¿è¡Œå‘ç°å®¢æˆ·ç«¯è¿è¡ŒæŠ¥é”™:dial udp 0.0.0.0:0-\u0026gt;224.0.0.250:9981: connect: network is unreachable.\nå®¢æˆ·ç«¯çš„é”™è¯¯åº”è¯¥è·¯ç”±ä¸å¯è¾¾æ²¡é…è·¯ç”±æ‰€ä»¥æ— æ³•åˆ°è¾¾224ç½‘æ®µã€‚å¯ä»¥è®¾ç½®è·¯ç”±è§£å†³é—®é¢˜ï¼Œä¾‹å¦‚ip route add 224.0.0.0/8 dev ens33ä½†è¿™åœ¨ç”¨æˆ·å±‚é¢æ“ä½œå¤ªè ¢äº†ï¼Œè€Œä¸”ä¼šå¹²æ‰°åŸæœ‰çš„è·¯ç”±è¡¨ã€‚åº”è¯¥åœ¨ä»£ç å¤„æŒ‡å®šå‘é€æ–¹ç½‘å¡ç”¨è¯¥ç½‘å¡ipå‘é€ç»„æ’­åŒ…ã€‚æ‰€ä»¥ä¿®æ”¹äº†ä¸‹å®¢æˆ·ç«¯çš„ä»£ç ï¼Œå…¶ä¸­å®¢æˆ·ç«¯ä¼ å‚éœ€è¦å‘é€ç»„æ’­ipçš„ç½‘å¡ã€‚\nå…¶ä¸­è·å–ç½‘å¡ipçš„å‡½æ•°gain_ipæ˜¯å‚è€ƒè¿™ç¯‡æ–‡ç« 2æ”¹çš„ã€‚æˆ‘è¿™é‡Œçš„åŠŸèƒ½ä¿®æ”¹ä¸ºè¯»å‡ºè¾“å…¥ç½‘å¡çš„ä»»æ„ä¸€ä¸ªæœ‰æ•ˆçš„ipv4åœ°å€ã€‚\n//DialUDPçš„srcAddrè®¾ç½®0.0.0.0:0 æˆ–nilä¼šè‡ªå·±æ‰¾åŒ¹é…è·¯ç”± ç«¯å£å·ä¸º0è¡¨ç¤ºç³»ç»Ÿåˆ†é…ç«¯å£ func main() { //é€‰æ‹©ä½¿ç”¨é‚£å¼ ç½‘å¡å‘é€ç»„æ’­åŒ…(å–å‡ºå…¶ipä½œæºåœ°å€), ä¸è¾“å…¥å‚æ•°ç½‘å¡è®¾å®šä¸ºç©º eg. eth0 var ethAddr net.IP = nil if len(os.Args) \u0026gt; 1 { ethAddr = gain_ip(os.Args[1]) } if ethAddr == nil { fmt.Printf(\u0026quot;Failed to retrieve valid ipv4 address as source address,\\nsearch for matching route to send\\n\u0026quot;) ethAddr = net.IPv4zero } srcAddr := \u0026amp;net.UDPAddr{IP: ethAddr, Port: 0} dstAddr, _ := net.ResolveUDPAddr(\u0026quot;udp\u0026quot;, \u0026quot;224.0.0.250:9981\u0026quot;) conn, err := net.DialUDP(\u0026quot;udp\u0026quot;, srcAddr, dstAddr) if err != nil { fmt.Println(err) return } defer conn.Close() conn.Write([]byte(\u0026quot;hello\u0026quot;)) fmt.Printf(\u0026quot;\u0026lt;%s\u0026gt;\\n\u0026quot;, conn.RemoteAddr()) } // å–å¾—ç½‘å¡çš„ä»»æ„ä¸€ä¸ªæœ‰æ•ˆipv4åœ°å€ func gain_ip(ethname string) net.IP { eth, _ := net.InterfaceByName(ethname) Addrs, err := eth.Addrs() if err != nil { // fmt.Println(err) //ç½‘å¡æ— æ•ˆ return nil } for _, Addr := range Addrs { if ipnet, ok := Addr.(*net.IPNet); ok \u0026amp;\u0026amp; !ipnet.IP.IsLoopback() { //æ¥å£è½¬ä¸ºç»“æ„ä½“ if ipnet.IP.To4() != nil { return ipnet.IP.To4() } } } return nil //æ‰¾ä¸åˆ°æœ‰æ•ˆç½‘å¡åœ°å€ } è¿è¡ŒæœåŠ¡å™¨ç«¯å‘ç°ä¹Ÿæœ‰æŠ¥é”™ï¼šsetsockopt:no such device ï¼ŒæŸ¥çœ‹äº†ListenMulticastUDPå‡½æ•°çš„æºç ï¼Œå‘ç°ä¸Šé¢çš„ä¾‹ç¨‹ListenMulticastUDPæ²¡æœ‰ä¼ å…¥ç¬¬äºŒä¸ªæ¥å£å‚æ•°ï¼Œä¼šä½¿å¾—ç¨‹åºæ‰¾å¯»é»˜è®¤åˆ°è¯¥ç»„æ’­åŸŸçš„è·¯ç”±æ‰€ä»¥é…è·¯ç”±ä¹Ÿèƒ½è§£å†³è¯¥é—®é¢˜ã€‚æˆ‘è¿™é‡Œè¿˜æ˜¯ä¼ å‚ä¸€ä¸ªç½‘å¡åç§°è§£å†³ã€‚\nfunc main() { var ethname string = \u0026quot;\u0026quot; if len(os.Args) \u0026gt; 1 { ethname = os.Args[1] } /* listener, err := net.ListenMulticastUDP(\u0026quot;udp\u0026quot;, nil, Multicast_addr) ListenMulticastUDPç›‘å¬æœ¬åœ°ç³»ç»Ÿçš„æ‰€æœ‰å¯ç”¨IPåœ°å€ï¼ŒåŒ…æ‹¬ç»„æ’­ç»„IPåœ°å€ã€‚ å¦‚æœifi(ç¬¬äºŒä¸ªå‚æ•°)ä¸ºé›¶ï¼ŒListenMulticastUDPä½¿ç”¨ç³»ç»Ÿåˆ†é…çš„å¤šæ’­æ¥å£ï¼Œä½†ä¸å»ºè®®è¿™æ ·åšï¼Œ å› ä¸ºåˆ†é…å–å†³äºå¹³å°ï¼Œæœ‰æ—¶å¯èƒ½éœ€è¦è·¯ç”±é…ç½®ã€‚å¦‚æœgaddrçš„ç«¯å£å­—æ®µä¸º0ï¼Œåˆ™ä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªç«¯å£å·ã€‚ */ eth, _ := net.InterfaceByName(ethname) //é€‰æ‹©ä½¿ç”¨é‚£å¼ ç½‘å¡åŠ å…¥ç»„æ’­åŸŸ Multicast_addr, _ := net.ResolveUDPAddr(\u0026quot;udp\u0026quot;, \u0026quot;224.0.0.250:9981\u0026quot;) listener, err := net.ListenMulticastUDP(\u0026quot;udp\u0026quot;, eth, Multicast_addr) if err != nil { fmt.Println(err) return } defer listener.Close() fmt.Printf(\u0026quot;Listener Multicast addr: \u0026lt;%s\u0026gt; \\n\u0026quot;, Multicast_addr.String()) data := make([]byte, 1024) for { n, remoteAddr, err := listener.ReadFromUDP(data) if err != nil { fmt.Printf(\u0026quot;error during read: %s\u0026quot;, err) } fmt.Printf(\u0026quot;\u0026lt;src ip: %s\u0026gt; %s\\n\u0026quot;, remoteAddr, data[:n]) } } ç¤ºä¾‹ä»£ç  å‡†ç¡®çš„ç›¸å¯¹æ—¶é—´è§¦å‘å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿå°¤ä¸ºé‡è¦ï¼Œè™½ç„¶åªæ˜¯ç®€å•çš„è°ƒç”¨å®šæ—¶å™¨ï¼Œä½†æ˜¯è¿™ä½å¤§ä½¬çš„åšå®¢3å¯¹goä¸­å®šæ—¶å™¨çš„æœ‰æ¯”è¾ƒå¥½çš„åˆ†æï¼Œæ‰“æ—¥å¿—çš„å‚è€ƒæ–‡ç« 4ä¹Ÿæ ‡æ³¨å‡ºæ¥ã€‚\næœ€åæ•´åˆäº†ä¸‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ¥æ”¶ï¼Œæ¯ä¸ªç§»åŠ¨è®¾å¤‡è¿è¡Œè¯¥ç¨‹åºï¼ˆå®šæ—¶å‘åŠ¨ç»„æ’­åŒ…ï¼Œåå°åç¨‹ç›‘å¬æ¥è‡ªç»„æ’­åŸŸå…¶ä»–èŠ‚ç‚¹åŒ…æ¶ˆæ¯ï¼‰å°±èƒ½æ¢æµ‹å„ç½‘å†…å­˜æ´»/åœ¨çº¿è®¾å¤‡ã€‚å…³äºæ¥æ”¶æ•°æ®çš„å¤„ç†æˆ‘è¿™é‡Œæ•…æ„åªæ‰“æ—¥å¿—ä¸åšå…¶ä»–å¤„ç†ï¼Œå…³äºæ¥æ”¶çš„æ•°æ®å¦‚ä½•å¤„ç†ï¼Œå¤„ç†æ•°æ®å…·ä½“å¹²å•¥å°±çœ‹ä½ è‡ªå·±çš„ç”¨é€”äº†ã€‚å°±åƒæˆ‘å‚è€ƒçš„è¿™äº›æ–‡ç« ä¸€æ ·ï¼Œå¸Œæœ›èƒ½å¯¹è¯»è€…æœ‰æ‰€å¸®åŠ©ã€‚\npackage main import ( \u0026quot;fmt\u0026quot; \u0026quot;io\u0026quot; \u0026quot;log\u0026quot; \u0026quot;net\u0026quot; \u0026quot;os\u0026quot; \u0026quot;time\u0026quot; ) type myconn struct { send *net.UDPConn recv chan int } var ( Info *log.Logger Warning *log.Logger Error *log.Logger ) func init() { logfile, err := os.OpenFile(\u0026quot;Nodes_multicast.log\u0026quot;, os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0666) if err != nil { log.Fatalln(\u0026quot;æ‰“å¼€æ—¥å¿—æ–‡ä»¶å¤±è´¥ï¼š\u0026quot;, err) } Info = log.New(logfile, \u0026quot;Info: \u0026quot;, log.Lmicroseconds|log.Lshortfile) Warning = log.New(io.MultiWriter(os.Stdout, logfile), \u0026quot;Warning: \u0026quot;, log.Lmicroseconds|log.Lshortfile) Error = log.New(io.MultiWriter(os.Stderr, logfile), \u0026quot;Error: \u0026quot;, log.Lmicroseconds|log.Lshortfile) } func main() { // ä½¿ç”¨å‚æ•°1çš„ç½‘å¡å‘é€å’Œç›‘å¬ç»„æ’­åŒ…(å–å‡ºå…¶ipä½œæºåœ°å€), ä¸è¾“å…¥å‚æ•°ä½¿ç”¨é»˜è®¤è·¯ç”± // å‚æ•°2ä»£è¡¨è¿è¡Œå®¢æˆ·ç«¯nemèŠ‚ç‚¹å·ï¼Œé»˜è®¤ä¸º1 var ethname, nemid string = \u0026quot;\u0026quot;, \u0026quot;1\u0026quot; if len(os.Args) \u0026gt; 2 { ethname = os.Args[1] nemid = os.Args[2] } else { Warning.Println(\u0026quot;No parameter is entered,now using default route and nemid:\u0026quot;, nemid) } conn, err := multicast_init(ethname) if err != nil { Error.Println(\u0026quot;multicast init error:\u0026quot;, err) return } defer conn.send.Close() Info.Println(\u0026quot;Nodes start multicast :\u0026quot;) send_interval := time.Tick(time.Second * 3) check_interval := time.Tick(time.Second * 15) for { select { case \u0026lt;-send_interval: Info.Println(\u0026quot;\\\u0026quot;send msg\\\u0026quot;\u0026quot;) // s := []byte(fmt.Sprintf(\u0026quot;Hello,I'm %s\u0026quot;, nemid)) s := []byte(\u0026quot;Hello,I'm \u0026quot; + nemid) conn.send.Write(s) case \u0026lt;-check_interval: Info.Println(\u0026quot;\\\u0026quot;check schedul\\\u0026quot;\u0026quot;) case num := \u0026lt;-conn.recv: Info.Println(\u0026quot;\\\u0026quot;recv msg\\\u0026quot; \u0026quot;, num) } } } // å–å¾—ç½‘å¡çš„ä»»æ„ä¸€ä¸ªæœ‰æ•ˆipv4åœ°å€ func gain_ip(ethname string) net.IP { eth, _ := net.InterfaceByName(ethname) Addrs, err := eth.Addrs() if err != nil { // Warning.Println(err) //ç½‘å¡æ— æ•ˆ return nil } for _, Addr := range Addrs { if ipnet, ok := Addr.(*net.IPNet); ok \u0026amp;\u0026amp; !ipnet.IP.IsLoopback() { //æ¥å£å¼ºè½¬ä¸ºç»“æ„ä½“ if ipnet.IP.To4() != nil { return ipnet.IP.To4() } } } return nil } // udpç»„æ’­çš„å‘é€åˆå§‹åŒ–ï¼Œå¹¶å¼€å§‹ç›‘å¬ç»„æ’­åŸŸ func multicast_init(ethname string) (myconn, error) { ethAddr := gain_ip(ethname) if ethAddr == nil { Warning.Printf(\u0026quot;Failed to retrieve valid ipv4 address as source address,\\nsearch for matching route to send\\n\u0026quot;) ethAddr = net.IPv4zero } srcAddr := \u0026amp;net.UDPAddr{IP: ethAddr, Port: 0} Multicast_addr, _ := net.ResolveUDPAddr(\u0026quot;udp\u0026quot;, \u0026quot;224.0.0.250:9981\u0026quot;) Info.Println(\u0026quot;send addr is\u0026quot;, srcAddr, \u0026quot;ListenMulticast is\u0026quot;, Multicast_addr) send, err := net.DialUDP(\u0026quot;udp\u0026quot;, srcAddr, Multicast_addr) if err != nil { return myconn{}, err } eth, _ := net.InterfaceByName(ethname) listener, err := net.ListenMulticastUDP(\u0026quot;udp\u0026quot;, eth, Multicast_addr) if err != nil { send.Close() return myconn{}, err } data := make([]byte, 1024) datach := make(chan int, 0) go func() { // goçš„åŒ¿åå‡½æ•°é»˜è®¤æ•è·ä¸Šä¸‹æ–‡å˜é‡ defer listener.Close() for { n, remoteAddr, err := listener.ReadFromUDP(data) if err != nil { Warning.Printf(\u0026quot;error during read: %s\u0026quot;, err) continue } s := string(data[:n]) if remoteAddr.IP.Equal(ethAddr) { continue // æ’é™¤è‡ªèº«å‘å‡ºçš„ç»„æ’­åŒ… } // Info.Printf(\u0026quot;receive %s %d bytes: %s\\n\u0026quot;, remoteAddr, n, s) _, err = fmt.Sscanf(s, \u0026quot;Hello,I'm %d\u0026quot;, \u0026amp;n) if err != nil { Warning.Printf(\u0026quot;error during Sscanf: %s\u0026quot;, err) continue } datach \u0026lt;- n } }() return myconn{send: send, recv: datach}, nil } åç»­å†…å®¹ å…¶å®æˆ‘ä½¿ç”¨è¿™ä¸ªå·¥å…·åªæ˜¯åšçš„TDMAåŠ¨æ€æ—¶éš™çš„ç»Ÿè®¡ï¼Œå¤§è‡´åšæ³•æ˜¯å°†å„ä¸ªèŠ‚ç‚¹çš„æ¥æ”¶æ•°æ®åšè®°å½•å­˜å…¥mapä¸­ã€‚æ²¡åˆ°æ£€æµ‹æ—¶é—´çš„ç®¡é“è®¡æ—¶åˆ°è¾¾åå¼€å§‹å¤„ç†mapæ•°æ®ç”Ÿæˆæ—¶éš™è¡¨ã€‚æ³¨æ„goä¸­çš„mapå¹¶ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œéœ€è¦åŠ sync.Mutexäº’æ–¥é”æˆ–sync.RWMutexè¯»å†™é”æ¥é¿å…ç«äº‰å†’é™©ã€‚ä¸è¿‡å¥½åœ¨æˆ‘æ˜¯åˆ†å¼€åœ¨selectä¸­å¤„ç†ä¸ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜ï¼Œgoä¸­ä¹Ÿæœ‰äººåšäº†å¹¶å‘å®‰å…¨çš„set5ã€‚\nå…³äºgoçš„æ–‡ä»¶è¯»å†™è¿˜æ˜¯è¦æä¸‹ï¼Œ*bufio.Writer *os.Fileè¿™ä¸¤ä¸ªæ¥å£éƒ½å®ç°å¯writestringå‡½æ•°ï¼Œä¸‹é¢çš„å†™æ–‡ä»¶ä»£ç ä¸ºäº†æå‡æ•ˆç‡æ–°å»ºäº†bufio,bufio åœ¨ä¸€å®šåœºæ™¯ä¸‹è¿˜æ˜¯å¾ˆèƒ½æå‡æ•ˆç‡çš„ï¼Œä¸è¿‡è¿˜æ˜¯éœ€è¦æ³¨æ„ä¸ç›´æ¥å†™å…¥æ–‡ä»¶çš„å¼‚åŒï¼Œé˜²æ­¢ç¼“å­˜æ•°æ®æœªåŒæ­¥çš„çŠ¶å†µå‘ç”Ÿã€‚å¦‚ä¸‹ï¼Œå†™å®Œæ–‡ä»¶åéœ€è¦è°ƒç”¨Flushåˆ·æ–°ã€‚\nfunc write_schedule(filepath string, newdata []string) error { file, err := os.Create(filepath) if err != nil { return err } defer file.Close() writer := bufio.NewWriter(file) for _, str := range newdata { _, err = writer.WriteString(str + \u0026quot;\\n\u0026quot;) } //æ³¨æ„ï¼Œbufio é€šè¿‡flushæ“ä½œå°†ç¼“å†²å†™å…¥çœŸå®çš„æ–‡ä»¶çš„ï¼Œåœ¨å…³é—­æ–‡ä»¶ä¹‹å‰å…ˆflushï¼Œå¦åˆ™ä¼šé€ æˆæ•°æ®ä¸¢å¤±çš„æƒ…å†µã€‚ writer.Flush() return err } ä¹‹åæœ‰å¯èƒ½ä¼šåˆ†äº«ä¸‹åç»­å…·ä½“åŠ¨æ€æ—¶éš™å†…å®¹ã€‚\nç»„æ’­æ¢æµ‹ç¨‹åºï¼š\nç»„æ’­éƒ¨åˆ†ï¼š æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šé€šè¿‡æŒ‡å®šç½‘å¡å‘ç»„æ’­åŸŸä¸­å‘é€helloåŒ…ï¼Œå®šæ—¶é—´éš”ä¸º 'send_interval_time' é€šè¿‡åŠ å…¥è¯¥ç»„æ’­åŸŸç›‘å¬è¯¥ç»„æ’­åŸŸå†…æ¶ˆæ¯ï¼Œåšåˆ°ç±»ä¼¼æ¢æµ‹ç½‘å†…å­˜æ´»èŠ‚ç‚¹æ•°é‡ç›®çš„ å®šæ—¶æ£€æµ‹æ—¶éš™(ç»„æ’­åŸŸä¸­æˆå‘˜æ˜¯å¦æœ‰å˜åŒ–),æ£€æµ‹æ—¶é—´ä¸º 'check_interval_time' å³ä¸€æ¬¡æ£€æµ‹æ—¶éš™å‘¨æœŸå†…æ¥æ”¶åˆ°å¯¹åº”nemidç»„æ’­åŒ…å³è®¤ä¸ºè¯¥èŠ‚ç‚¹å­˜æ´» æ”¶å‘åŒ…æ ¼å¼ä¸º \u0026quot;Hello,I'm $nemid\u0026quot; å‘é€æ§åˆ¶ç½‘æ—¶éš™æ¶ˆæ¯ï¼š ç¡®å®šä¸»æ§åˆ¶ç½‘ç½‘æ¡¥IPï¼Œä¾‹å¦‚172.16.0.254 æ¥æ”¶çš„ç»„æ’­è®°å½•å­˜å‚¨è‡³ å¹¶å‘å®‰å…¨setä¸­ï¼Œæˆ‘è¿™é‡Œçš„å®ç°é‡‡ç”¨map(å¹¶å‘ä¸å®‰å…¨) è¿™æ˜¯å› ä¸ºæˆ‘ä½¿ç”¨selectç®¡é“ä¼ è¾“æ•°æ®å†è¿›è¡Œä¿®æ”¹mapå°±ä¸ä¼šå‡ºç°ç«äº‰å†’é™©ï¼Œé€ æˆå¹¶å‘çš„è¯»å†™ å„ä¸ªèŠ‚ç‚¹ä¿¡æ¯ç»¼åˆæ ¼å¼ä¸º I'm 1,recv 2 3 4 5 æ—¶éš™ç»Ÿè®¡ç¨‹åºï¼š\né¦–å…ˆæ‰“å¼€å½“å‰åœºæ™¯çš„æ—¶éš™åˆ†é…xmlæ–‡ä»¶ï¼Œè·å–åŸºæœ¬å‚æ•°ä¿¡æ¯ ç„¶åå®šæ—¶æ£€æµ‹å„ä¸ªèŠ‚ç‚¹å‘é€çš„èŠ‚ç‚¹ç›‘æµ‹æ¶ˆæ¯ï¼Œæ ¹æ®ä¼˜å…ˆçº§å›ºå®šçš„é¡ºåºåˆ†é…æ—¶éš™ ä¸€å®šæ˜¯å…ˆæ’åˆ—å®Œå…¨éƒ¨èŠ‚ç‚¹åå†ç»§ç»­æŒ‰ç…§èŠ‚ç‚¹ä¼˜å…ˆçº§é¡ºåºæ’åˆ—æ—¶éš™ï¼Œ æ‰€ä»¥ä¼˜å…ˆçº§é«˜çš„èŠ‚ç‚¹å…¶åˆ†é…åˆ°æ—¶éš™çš„å¯èƒ½æ€§è¶Šå¤§ å½“å‰ä¼˜å…ˆçº§ ç®€å•çš„å¤„ç†ä¸º nemidï¼Œidè¶Šå° ä¼˜å…ˆçº§è¶Šé«˜,å…·ä½“å‚è€ƒmyschedule_createçš„å®ç° æ£€æµ‹æ—¶é—´é—´éš”ä¸å¤šæ’­ç¨‹åºçš„æ—¶é—´é—´éš”ç›¸åŒ 'check_interval' æ³¨æ„ï¼šè¿™é‡Œä»…ä»…æ˜¯ä¸ºäº†å¤„ç†æ–¹ä¾¿å°†æ‰€æœ‰èŠ‚ç‚¹æ—¶éš™æ•°æ®æ•´åˆåœ¨ä¸€èµ· å…¶å®å®é™…å„ä¸ªèŠ‚ç‚¹çš„æ—¶éš™æ˜¯å•ç‹¬åˆ†æ´¾çš„ï¼Œä¾‹å¦‚è‹¥ä¸¤èŠ‚ç‚¹n1 n15åˆ†åˆ«åœ¨ä¸¤ä¸ªç½‘å†…ï¼ˆç»„æ’­åŸŸä¸­æœªäº’ç›¸æ¢æµ‹åˆ°ï¼‰ æ‰€ä»¥ä»–ä»¬çš„æ—¶éš™å¾ˆå¯èƒ½æ˜¯ä¼šæœ‰é‡åˆå†²çªçš„éƒ¨åˆ†ï¼Œä½†ç”±äºç»„æ’­æ— æ³•äº’ç›¸æ¢æµ‹åˆ°å¯è®¤ä¸ºæ˜¯æ— å½±å“çš„ã€‚ // æ ¹æ®æ—¶éš™è¡¨è§„åˆ™ï¼Œè®¾å®šä»¥èŠ‚ç‚¹idä¸ºä¼˜å…ˆçº§ å›ºå®šé¡ºåºçš„æ’åˆ—æ—¶éš™è¡¨ï¼Œä¸¾ä¾‹ æ—¶éš™ä¸º10 // 1æ”¶åˆ° 2 3ï¼š\té¡ºåºï¼š1 2 3 1 2 3 1 2 3 1\t1çš„æ—¶éš™ï¼š0,3,6,9 // 7æ”¶åˆ° 8 9 4ï¼š\té¡ºåºï¼š4 7 8 9 4 7 8 9 4 7\t7çš„æ—¶éš™ï¼š1,5,9 // è¦æ¨ç®—èŠ‚ç‚¹ datas.id çš„æ—¶éš™åˆ†å¸ƒï¼Œåªè¦çŸ¥é“æ—¶éš™ä¸ªæ•°ï¼Œä¼˜å…ˆçº§æ’å(idè¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜)å³å¯æ¨ç®— é¸Ÿçª. æ·±å…¥Go UDPç¼–ç¨‹ (colobu.com) é€šç”¨å¤šæ’­ç¼–ç¨‹\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nä¸äºŒæ˜Ÿç©º. GOå®ç°è·å–æœ¬åœ°IPåœ°å€(csdn.net) è·å–ç½‘å¡ip\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nDraveness. Go è¯­è¨€è®¾è®¡ä¸å®ç°(draveness.me) å¹¶å‘ç¼–ç¨‹ä¸è®¡æ—¶å™¨\u0026#160;\u0026#x21a9;\u0026#xfe0e;\né£é›ªæ— æƒ…. Goè¯­è¨€å®æˆ˜ç¬”è®°(flysnow.org) å®šåˆ¶goæ—¥å¿—\u0026#160;\u0026#x21a9;\u0026#xfe0e;\næ³¢ç½—å­¦. Go ä¸­å¦‚ä½•ä½¿ç”¨ set - æ˜é‡‘ (juejin.cn)\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","id":20,"section":"posts","summary":"ä»‹ç» æœ€è¿‘åœ¨åšä¸€ä¸ªå…³äºæ— çº¿ç§»åŠ¨è‡ªç»„ç»‡ç½‘ç»œç›¸å…³çš„å†…å®¹ï¼Œç§»åŠ¨è‡ªç»„ç»‡ç½‘ç»œæ˜¯ç”±å½¼æ­¤å·²ç»å‘ç°å’Œäº’ç›¸æ¥è¿‘çš„ä¸”æœ‰é€šä¿¡éœ€æ±‚çš„ç§»åŠ¨è®¾å¤‡æ„æˆçš„ã€‚ç”±äºç½‘å†…èŠ‚ç‚¹çš„ç§»åŠ¨","tags":["go","network","å¼€å‘"],"title":"ç½‘å†…å­˜æ´»èŠ‚ç‚¹æµ‹è¯•å·¥å…·","uri":"https://liangkang233.github.io/2021/09/%E7%BD%91%E5%86%85%E5%AD%98%E6%B4%BB%E8%8A%82%E7%82%B9%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/","year":"2021"},{"content":" å…¶å®ç½‘ä¸Šæœ‰å¾ˆå¤šå…³äºæ‰©å®¹çš„æ–‡ç« ï¼Œä½†æ˜¯æ²¡æœ‰è§£å†³æˆ‘çš„é—®é¢˜æ‰€ä»¥å½“æ‰©å®¹åæˆåŠŸåè¿˜æ˜¯å†³å®šåšä¸ªè®°å½•æ–¹ä¾¿è§£å†³ç±»ä¼¼é—®é¢˜ã€‚ä¸è®ºæ˜¯è™šæ‹Ÿæœºè¿˜æ˜¯ç‰©ç†æœºçš„æ‰©å®¹éƒ½å¯ä»¥è¯•è¯•ä¸‹é¢çš„æ–¹æ³•ã€‚\né—®é¢˜åˆ†æ Ubuntuçš„å›¾å½¢ç•Œé¢éå¸¸ç›´è§‚ï¼Œä¸Šæ‰‹éš¾åº¦ä¹Ÿä¸å¤§ï¼Œæ‰€ä»¥ä½¿ç”¨VMè™šæ‹Ÿæœºè£…äº†ä¸ªUbuntuç³»ç»Ÿï¼Œæ­å»ºä¸“é—¨è·‘å®éªŒå®¤çš„ä¸€äº›linuxè½¯ä»¶ç¯å¢ƒï¼Œç”¨åˆ°åé¢ / æŒ‚è½½çš„ç£ç›˜ä»…å‰©500Mä¸åˆ°ï¼Œæ ¹æœ¬ä¸å¤Ÿç”¨å°±å¾ˆéš¾å—ã€‚ä½†æ˜¯é‡é…ç¯å¢ƒåˆå¾ˆéº»çƒ¦æ‰€ä»¥è¿˜æ˜¯å†³å®šæ‰©å®¹åˆ†åŒºã€‚\næ‰©å®¹é¦–å…ˆå¾—æœ‰ç©ºé—´ï¼Œè™šæ‹Ÿæœºå°±ç›´æ¥å¦‚ä¸‹å›¾èˆ¬æ·»åŠ ç©ºé—´å³å¯ï¼ˆéœ€è¦åˆ é™¤æ‰€æœ‰å¿«ç…§ï¼‰ï¼Œå¦‚æœæœ‰æœªåˆ†é…çš„ç©ºé—´ç›´æ¥æ‹¿æ¥ç”¨ä¸ç”¨æ­¤æ­¥ã€‚\nç‰©ç†æœºçš„è¯å°±å‡†å¤‡æ–°çš„ç¡¬ç›˜æŒ‚è½½åˆ†åŒºã€‚å®åœ¨ä¸è¡Œä¹Ÿå¯ä»¥ä»å…¶ä»–åˆ†åŒºæŒ¤å‡ºäº›ç©ºé—´ã€‚\næ³¨æ„é™¤éæ˜¯windowsçš„åŠ¨æ€ç£ç›˜ï¼Œå¦åˆ™åˆ†åŒºç‰©ç†åˆ†é…é€»è¾‘æ˜¯ä»å·¦åˆ°å³çš„é¡ºåºï¼Œä¸å¯ä»¥è·¨åˆ†åŒºåˆ†é…ç»™å…¶ä»–ç©ºé—´ã€‚\nUbuntuæœ‰å›¾å½¢åˆ†åŒºå·¥å…· gparted ,æˆ‘è¿™é‡Œæ·»åŠ äº†20gçš„ç©ºé—´ï¼ˆå›ºæ€ç©ºé—´å‰©çš„ä¸å¤šäº†ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æ‰©å¤šå°‘ï¼‰\næ‰€ä»¥æè¿‡windowsåˆ†åŒºçš„è¯çœ‹èµ·æ¥å¾ˆå¿«å°±èƒ½æå®šï¼Œå›¾å½¢ç•Œé¢ç‚¹ä¸¤ä¸‹å°±å®Œäº‹äº†ã€‚\nä¸Šé”çš„åˆ†åŒºéœ€è¦å¸è½½åæ“ä½œå®Œæ¯•å†æŒ‚è½½ã€‚\n# æŸ¥çœ‹æŒ‚è½½åˆ†åŒºç©ºé—´å‘½ä»¤ df -Th # å®‰è£… åˆ†åŒºå·¥å…· sudo apt-get install gparted æ–‡ä»¶ç³»ç»Ÿ ç±»å‹ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹ udev devtmpfs 1.9G 0 1.9G 0% /dev tmpfs tmpfs 391M 2.2M 389M 1% /run /dev/sda6 ext4 9.4G 8.4G 475M 95% / tmpfs tmpfs 2.0G 111M 1.9G 6% /dev/shm tmpfs tmpfs 5.0M 4.0K 5.0M 1% /run/lock tmpfs tmpfs 2.0G 0 2.0G 0% /sys/fs/cgroup /dev/loop1 squashfs 2.5M 2.5M 0 100% /snap/gnome-system-monitor/163 /dev/loop2 squashfs 219M 219M 0 100% /snap/gnome-3-34-1804/66 /dev/loop3 squashfs 219M 219M 0 100% /snap/gnome-3-34-1804/72 /dev/loop4 squashfs 640K 640K 0 100% /snap/gnome-logs/103 /dev/loop5 squashfs 2.5M 2.5M 0 100% /snap/gnome-calculator/884 /dev/loop6 squashfs 242M 242M 0 100% /snap/gnome-3-38-2004/70 /dev/loop7 squashfs 2.5M 2.5M 0 100% /snap/gnome-system-monitor/160 /dev/loop0 squashfs 640K 640K 0 100% /snap/gnome-logs/106 /dev/loop10 squashfs 66M 66M 0 100% /snap/gtk-common-themes/1515 /dev/loop9 squashfs 56M 56M 0 100% /snap/core18/2128 /dev/loop11 squashfs 768K 768K 0 100% /snap/gnome-characters/726 /dev/loop12 squashfs 768K 768K 0 100% /snap/gnome-characters/723 /dev/loop13 squashfs 62M 62M 0 100% /snap/core20/1081 /dev/loop14 squashfs 56M 56M 0 100% /snap/core18/2074 /dev/loop15 squashfs 33M 33M 0 100% /snap/snapd/12883 /dev/sda1 ext4 268M 118M 132M 48% /boot /dev/loop16 squashfs 33M 33M 0 100% /snap/snapd/12704 /dev/sda3 ext4 15G 5.2G 8.2G 39% /home /dev/loop17 squashfs 62M 62M 0 100% /snap/core20/1026 /dev/loop18 squashfs 65M 65M 0 100% /snap/gtk-common-themes/1514 /dev/sda4 ext4 3.9G 63M 3.6G 2% /tmp /dev/loop19 squashfs 2.5M 2.5M 0 100% /snap/gnome-calculator/748 tmpfs tmpfs 391M 40K 391M 1% /run/user/1000 /dev/loop20 squashfs 243M 243M 0 100% /snap/gnome-3-38-2004/76 ä¸€å¼€å§‹æˆ‘æ˜¯æƒ³ç›´æ¥æŠŠhomeåˆ†åŒºï¼ˆçœ‹ä¸Šé¢çš„è®°å½• homeåˆ†åŒºåŸºæœ¬æ²¡ç”¨å¤šå°‘ï¼‰å¤åˆ¶æŒ‚è½½åˆ°æ‰©å®¹ç¡¬ç›˜æ–°å»ºç«‹åˆ†åŒºã€‚ç„¶åæŠŠhomeåˆ†åŒºåˆ é™¤åˆ†ç»™ /ã€‚ ä½†æ˜¯ä¹Ÿä¸çŸ¥é“å½“æ—¶ä¸ºå•¥è¿™ä¹ˆæ†¨ğŸ˜“ è£…ç³»ç»Ÿæ—¶ home äº¤æ¢ç©ºé—´ tmp bootéƒ½æ‹¿æ¥åšä¸»åˆ†åŒºï¼Œæ‹¿ä¸€ä¸ª10gçš„é€»è¾‘åˆ†åŒºæŒ‚è½½ / ã€‚è€Œä¸”ç³»ç»Ÿåˆ†åŒºè¡¨é€‰çš„æ˜¯mbrå¯¼è‡´ä¸€ä¸ªç£ç›˜ç½®å¤šå››ä¸ªä¸»åˆ†åŒºã€‚æ‰€ä»¥è¿™ä¸ªè®¡åˆ’æ ¹æœ¬ä¸å¯è¡Œï¼Œä¸èƒ½åœ¨å½“å‰ç³»ç»Ÿä¸‹æ“ä½œåŠ æ–°ä¸»åˆ†åŒºã€‚ï¼ˆæˆ‘åœ¨å½“å‰ç³»ç»Ÿä¸‹è‚¯å®šæ˜¯ä¸å¤ªå¥½æ“ä½œå½“å‰ç³»ç»Ÿçš„ç£ç›˜çš„ï¼‰\nå›æƒ³èµ·windowsæœ‰peå·¥å…·ï¼Œè¯´ä¸å®šUbuntuä¹Ÿæœ‰ç±»ä¼¼çš„å·¥å…·ã€‚ç½‘ä¸Šä¸€æŸ¥ubuntuå¯åŠ¨ç›˜è‡ªèº«å°±æ˜¯ä¸€ä¸ªlinuxç³»ç»Ÿï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›linuxè½¯ä»¶åŒ…ï¼Œè¯´å¹²å°±å¹²å‡†å¤‡å¯åŠ¨ç›˜ã€‚\nè§£å†³æ­¥éª¤ å¦‚æœæ˜¯è™šæ‹Ÿæœºï¼š\næ‰¾åˆ°å®‰è£…è¯¥ç³»ç»Ÿå¯¹åº”çš„isoé•œåƒï¼Œå¹¶åœ¨è™šæ‹Ÿæœºç¡¬ä»¶è®¾ç½®ä¸­é€‰é¡¹cd/dvdä¸­é€‰ä¸­è¯¥é•œåƒå¹¶å‹¾é€‰å¯åŠ¨æ—¶è¿æ¥æ—¶ã€‚ç„¶åå¦‚ä¸‹å›¾ç›´æ¥è¿›biosè®¾ç½®å¯åŠ¨é¡¹å³å¯ã€‚\nå¦‚æœæ˜¯ç‰©ç†æœºï¼Œå°±è·Ÿè£…ç³»ç»Ÿä¸€æ ·åšä¸€ä¸ªä½ å½“å‰ä¸»æ¿biosèƒ½è¯†åˆ«çš„å¯åŠ¨ç›˜å³å¯ï¼Œé•œåƒè¦ä¸å½“å‰ç³»ç»Ÿä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°å¯åŠ¨ç›˜çš„åˆ¶ä½œäº†ã€‚ä¹‹åè¿›å…¥biosè®¾ç½®å¯åŠ¨ç›˜ã€‚\næˆåŠŸè¿›å…¥å¯åŠ¨ç›˜åï¼Œé€‰æ‹©è¯•ç”¨Ubuntuå°±è¿›å…¥åˆ°å¯åŠ¨ç›˜ä¸­çš„linuxç³»ç»Ÿäº†ï¼Œç”±äºä¸ä¸»ç¡¬ç›˜åˆ†ç¦»æ‰€ä»¥å¯ä»¥æ“ä½œæŒ‚è½½çš„è·¯å¾„åˆ†åŒºç­‰ã€‚\nåŒæ ·çš„è¿›å…¥ gpartedä¸­ï¼Œæ²¡æœ‰å°±è”ç½‘å®‰è£…ä¸€ä¸ªã€‚\næ¥ä¸‹æ¥å°±å¯ä»¥éšå¿ƒæ”¹å˜åˆ†åŒºäº†ä¸è¿‡æœ‰å‡ ä¸ªæ³¨æ„ç‚¹ï¼Œé‡è¦æ•°æ®ä¸€å®šè¦å…ˆå¤‡ä»½ï¼Œæ•°æ®æ— ä»·ã€‚ï¼ˆè™šæ‹Ÿæœºçš„è¯ç›´æ¥åŠ ä¸ªå¿«ç…§ï¼Œæœ‰é—®é¢˜å°±è¿˜åŸå›æ¥ï¼‰\næœ‰äº›ä»æŒ‚è½½çš„åˆ†åŒºä¸Šé”çŠ¶æ€è¦å…ˆç¦ç”¨æˆ–å¸è½½ï¼Œä¹‹åå†å¯ç”¨æˆ–æ˜¯æŒ‚è½½ ä¾‹å¦‚æˆ‘çš„swapäº¤æ¢ç©ºé—´ã€‚\né€»è¾‘åˆ†åŒºçš„å¤§å°æ‰©å®¹è¦å…ˆæ‰©å®¹å…¶ä¸»åˆ†åŒºå¤§å°ï¼Œå†æ“ä½œé€»è¾‘åˆ†åŒº ä¾‹å¦‚æˆ‘è¿™æŒ‚è½½ / çš„sda6æ‰‡åŒºå°±æ˜¯é€»è¾‘åˆ†åŒºã€‚\nç§»åŠ¨åˆ†åŒºæ—¶ï¼Œå¦‚æœæ”¹å˜äº†æ‰‡åŒºå¤´è¦æ³¨æ„è¯¥æ‰‡åŒºå†…æ˜¯å¦æŒ‚è½½äº† boot uefiç­‰å¯åŠ¨åˆ†åŒºå¯èƒ½å›é€ æˆå¯åŠ¨é¡¹æ— æ³•è¯†åˆ«ã€‚\nâ€‹\tæ‚¨å¯ä»¥åœ¨GParted FAQä¸­å­¦ä¹ å¦‚ä½•ä¿®å¤å¯åŠ¨é…ç½®ã€‚http://gparted.org/faq.phpã€‚æˆ‘ä½¿ç”¨çš„mbråˆ†åŒºè¡¨æ²¡æœ‰uefiå¯åŠ¨åˆ†åŒºï¼Œbiosæ˜¯å•ç‹¬çš„æ‰‡åŒºæŒ‚è½½ä¸Šå»çš„æ‰€ä»¥å¯ä»¥æ”¾å¿ƒæ“ä½œã€‚\næœ€åæ‰©å®¹å°±å®Œæˆäº†ï¼Œå›¾å½¢ç•Œé¢çš„æ“ä½œæ²¡å•¥è¯´çš„ã€‚åªèƒ½æ„Ÿå¹linuxçš„å¼ºå¤§ï¼Œwindows to goè¦æ˜¯ä¹Ÿèƒ½å¦‚æ­¤åŠŸèƒ½å¼ºå¤§ã€é…ç½®æ–¹ä¾¿å°±å¥½äº†ã€‚\n","id":21,"section":"posts","summary":"å…¶å®ç½‘ä¸Šæœ‰å¾ˆå¤šå…³äºæ‰©å®¹çš„æ–‡ç« ï¼Œä½†æ˜¯æ²¡æœ‰è§£å†³æˆ‘çš„é—®é¢˜æ‰€ä»¥å½“æ‰©å®¹åæˆåŠŸåè¿˜æ˜¯å†³å®šåšä¸ªè®°å½•æ–¹ä¾¿è§£å†³ç±»ä¼¼é—®é¢˜ã€‚ä¸è®ºæ˜¯è™šæ‹Ÿæœºè¿˜æ˜¯ç‰©ç†æœºçš„æ‰©å®¹éƒ½å¯ä»¥è¯•è¯•","tags":["linux"],"title":"Ubuntuåˆ†åŒºæ‰©å®¹","uri":"https://liangkang233.github.io/2021/09/ubuntu%E5%88%86%E5%8C%BA%E6%89%A9%E5%AE%B9/","year":"2021"},{"content":"å¯¹goçš„åŸºç¡€å­¦ä¹ ä¸­ï¼Œä¹Ÿäº†è§£äº†äº›ç›¸å…³çƒ­ç‚¹é—®é¢˜ã€‚\nå‘ç°ç¯‡éå¸¸å¥½çš„æ–‡ç« è¯¦ç»†ä»‹ç»äº†goä¸­çš„å¹¶å‘è®¾è®¡åŸç†ã€å†…å­˜æ¨¡å‹ã€‚å†™äº›è¯»åæ„Ÿã€‚\nå¹¶å‘ç¼–ç¨‹ ä¸Šä¸‹æ–‡ ä¸Šä¸‹æ–‡ç®€å•çš„ç†è§£ä¸ºä»£ç è¿è¡Œçš„ç¯å¢ƒï¼Œä¸Šä¸‹æ–‡ context.Context åœ¨ Go è¯­è¨€ä¸­ç”¨æ¥è®¾ç½®æˆªæ­¢æ—¥æœŸã€åŒæ­¥ä¿¡å·ï¼Œä¼ é€’è¯·æ±‚ç›¸å…³å€¼çš„ç»“æ„ä½“ã€‚context.Contextæ˜¯ Go è¯­è¨€åœ¨ 1.7 ç‰ˆæœ¬ä¸­å¼•å…¥æ ‡å‡†åº“çš„æ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰äº†å››ä¸ªéœ€è¦å®ç°çš„æ–¹æ³•ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š\næ–¹æ³• æ¦‚è¿° Deadline è¿”å› context.Context è¢«å–æ¶ˆçš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯å®Œæˆå·¥ä½œçš„æˆªæ­¢æ—¥æœŸï¼› Done è¿”å›ä¸€ä¸ª Channelï¼Œè¿™ä¸ª Channel ä¼šåœ¨å½“å‰å·¥ä½œå®Œæˆæˆ–è€…ä¸Šä¸‹æ–‡è¢«å–æ¶ˆåå…³é—­ï¼Œå¤šæ¬¡è°ƒç”¨ Done æ–¹æ³•ä¼šè¿”å›åŒä¸€ä¸ª Channelï¼› Err è¿”å› context.Context ç»“æŸçš„åŸå› ï¼Œå®ƒåªä¼šåœ¨ Done æ–¹æ³•å¯¹åº”çš„ Channel å…³é—­æ—¶è¿”å›éç©ºçš„å€¼ï¼›å¦‚æœ context.Context è¢«å–æ¶ˆï¼Œä¼šè¿”å› Canceled é”™è¯¯ï¼›å¦‚æœ context.Context è¶…æ—¶ï¼Œä¼šè¿”å› DeadlineExceeded é”™è¯¯ï¼› Value å¦‚æœ context.Context è¶…æ—¶ï¼Œä¼šè¿”å› DeadlineExceeded é”™è¯¯ï¼›ä» context.Context ä¸­è·å–é”®å¯¹åº”çš„å€¼ï¼Œå¯¹äºåŒä¸€ä¸ªä¸Šä¸‹æ–‡æ¥è¯´ï¼Œå¤šæ¬¡è°ƒç”¨ Value å¹¶ä¼ å…¥ç›¸åŒçš„ Key ä¼šè¿”å›ç›¸åŒçš„ç»“æœï¼Œè¯¥æ–¹æ³•å¯ä»¥ç”¨æ¥ä¼ é€’è¯·æ±‚ç‰¹å®šçš„æ•°æ®ï¼› Go è¯­è¨€ä¸­çš„ context.Context çš„ä¸»è¦ä½œç”¨è¿˜æ˜¯åœ¨å¤šä¸ª Goroutine ç»„æˆçš„æ ‘ä¸­åŒæ­¥å–æ¶ˆä¿¡å·ä»¥å‡å°‘å¯¹èµ„æºçš„æ¶ˆè€—å’Œå ç”¨ï¼Œä¾‹å¦‚ä½¿ç”¨context.WithCancel å‡½æ•°èƒ½å¤Ÿä» context.Context ä¸­è¡ç”Ÿå‡ºä¸€ä¸ªæ–°çš„å­ä¸Šä¸‹æ–‡å¹¶è¿”å›ç”¨äºå–æ¶ˆè¯¥ä¸Šä¸‹æ–‡çš„å‡½æ•°ã€‚ä¸€æ—¦æˆ‘ä»¬æ‰§è¡Œè¿”å›çš„å–æ¶ˆå‡½æ•°ï¼Œå½“å‰ä¸Šä¸‹æ–‡ä»¥åŠå®ƒçš„å­ä¸Šä¸‹æ–‡éƒ½ä¼šè¢«å–æ¶ˆï¼Œæ‰€æœ‰çš„ Goroutine éƒ½ä¼šåŒæ­¥æ”¶åˆ°è¿™ä¸€å–æ¶ˆä¿¡å·ï¼Œçˆ¶ä¸Šä¸‹æ–‡å–æ¶ˆæ—¶å­ä¸Šä¸‹æ–‡ä¹Ÿä¼šè¢«å–æ¶ˆã€‚è™½ç„¶å®ƒä¹Ÿæœ‰ä¼ å€¼çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬è¿˜æ˜¯å¾ˆå°‘ç”¨åˆ°ã€‚\nåœ¨çœŸæ­£ä½¿ç”¨ä¼ å€¼çš„åŠŸèƒ½æ—¶æˆ‘ä»¬ä¹Ÿåº”è¯¥éå¸¸è°¨æ…ï¼Œä½¿ç”¨ context.Context ä¼ é€’è¯·æ±‚çš„æ‰€æœ‰å‚æ•°ä¸€ç§éå¸¸å·®çš„è®¾è®¡ï¼Œæ¯”è¾ƒå¸¸è§çš„ä½¿ç”¨åœºæ™¯æ˜¯ä¼ é€’è¯·æ±‚å¯¹åº”ç”¨æˆ·çš„è®¤è¯ä»¤ç‰Œä»¥åŠç”¨äºè¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ªçš„è¯·æ±‚ IDã€‚\nchannel channelå¸¸ç”¨æ¥åšåç¨‹é—´çš„ä¿¡æ¯åŒæ­¥ï¼Œæ˜¯ä¸ªå»ºç«‹æ—¶è®¾å®šç¼“å†²åŒºï¼ˆé»˜è®¤æ˜¯0ï¼‰ç”¨äºå…±äº«æ¶ˆæ¯å…ˆå…¥å…ˆå‡ºçš„é˜Ÿåˆ—ã€‚\ntype hchan struct { qcount uint\t// Channel ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼› dataqsiz uint\t// Channel ä¸­çš„å¾ªç¯é˜Ÿåˆ—çš„é•¿åº¦ï¼› buf unsafe.Pointer // Channel çš„ç¼“å†²åŒºæ•°æ®æŒ‡é’ˆï¼› elemsize uint16 closed uint32 elemtype *_type sendx uint\t// Channel çš„å‘é€æ“ä½œå¤„ç†åˆ°çš„ä½ç½® recvx uint\t// Channel çš„å‘é€æ“ä½œå¤„ç†åˆ°çš„ä½ç½® recvq waitq sendq waitq lock mutex } å…·ä½“ç»†èŠ‚ç½‘ä¸Šèµ„æ–™å¾ˆè¯¦ç»†ï¼Œè¿™é‡Œè®°å½•å‡ ä¸ªæ˜“é”™ç‚¹ï¼š\nå½“ä¸€ä¸ªchannelè¢«å…³é—­åï¼Œå†å‘è¯¥channelå‘é€æ•°æ®å°†å¯¼è‡´panicå¼‚å¸¸ã€‚å½“ä¸€ä¸ªè¢«å…³é—­çš„channelä¸­å·²ç»å‘é€çš„æ•°æ®éƒ½è¢«æˆåŠŸæ¥æ”¶åï¼Œåç»­çš„æ¥æ”¶æ“ä½œå°†ä¸å†é˜»å¡ï¼Œå®ƒä»¬ä¼šç«‹å³è¿”å›ä¸€ä¸ªé›¶å€¼ã€‚å…³é—­ä¸Šé¢ä¾‹å­ä¸­çš„naturalså˜é‡å¯¹åº”çš„channelå¹¶ä¸èƒ½ç»ˆæ­¢å¾ªç¯ï¼Œå®ƒä¾ç„¶ä¼šæ”¶åˆ°ä¸€ä¸ªæ°¸æ— ä¼‘æ­¢çš„é›¶å€¼åºåˆ—ï¼Œç„¶åå°†å®ƒä»¬å‘é€ç»™æ‰“å°è€…goroutineã€‚\næ²¡æœ‰åŠæ³•ç›´æ¥æµ‹è¯•ä¸€ä¸ªchannelæ˜¯å¦è¢«å…³é—­ï¼Œä½†æ˜¯æ¥æ”¶æ“ä½œæœ‰ä¸€ä¸ªå˜ä½“å½¢å¼ï¼šå®ƒå¤šæ¥æ”¶ä¸€ä¸ªç»“æœï¼Œå¤šæ¥æ”¶çš„ç¬¬äºŒä¸ªç»“æœæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼okï¼Œtureè¡¨ç¤ºæˆåŠŸä»channelsæ¥æ”¶åˆ°å€¼ï¼Œfalseè¡¨ç¤ºchannelså·²ç»è¢«å…³é—­å¹¶ä¸”é‡Œé¢æ²¡æœ‰å€¼å¯æ¥æ”¶ã€‚ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹squarerå‡½æ•°ä¸­çš„å¾ªç¯ä»£ç ï¼Œå½“naturalså¯¹åº”çš„channelè¢«å…³é—­å¹¶æ²¡æœ‰å€¼å¯æ¥æ”¶æ—¶è·³å‡ºå¾ªç¯ï¼Œå¹¶ä¸”ä¹Ÿå…³é—­squareså¯¹åº”çš„channel.\ngo func() { for { x, ok := \u0026lt;-naturals if !ok { break // channel was closed and drained } squares \u0026lt;- x * x } close(squares) }() å› ä¸ºä¸Šé¢çš„è¯­æ³•æ˜¯ç¬¨æ‹™çš„ï¼Œè€Œä¸”è¿™ç§å¤„ç†æ¨¡å¼å¾ˆå¸¸è§ï¼Œå› æ­¤Goè¯­è¨€çš„rangeå¾ªç¯å¯ç›´æ¥åœ¨channelsä¸Šé¢è¿­ä»£ã€‚ä½¿ç”¨rangeå¾ªç¯æ˜¯ä¸Šé¢å¤„ç†æ¨¡å¼çš„ç®€æ´è¯­æ³•ï¼Œå®ƒä¾æ¬¡ä»channelæ¥æ”¶æ•°æ®ï¼Œå½“channelè¢«å…³é—­å¹¶ä¸”æ²¡æœ‰å€¼å¯æ¥æ”¶æ—¶è·³å‡ºå¾ªç¯ã€‚ï¼ˆchannelä¸å…³é—­ å°†ä¸€ç›´å µå¡åœ¨rangeå¤„ï¼‰\ngo func() { for x := range naturals { squares \u0026lt;- x * x } close(squares) }() chanè¦ç”¨makeç”Ÿæˆï¼Œå¯¹ç©ºå€¼çš„chè°ƒç”¨ä¼šé€ æˆå µå¡\nä¾‹å¦‚var tick \u0026lt;-chan time.Time tickå°±æ˜¯ä¸€ä¸ªç©ºå€¼çš„channelï¼ˆnilï¼‰å¯¹å…¶å†™å…¥æˆ–è¯»å–æ“ä½œéƒ½ä¼šé€ æˆå µå¡\nå‡½æ•°å½¢å‚çš„å•å‘channel å°±æ˜¯æ™®é€š channel ç”±ç¼–è¾‘å™¨æ£€æŸ¥ä¼ è¾“æ–¹å‘æ¥ç¡®ä¿å•å‘è€Œå®ç°çš„ï¼Œä¼ å‚ä¼šè¿›è¡Œéšå¼è½¬æ¢ åŒå‘å˜ä¸ºå•å‘ å•å‘ä¸å¯å˜ä¸ºåŒå‘\nnaturals := make(chan int) æ— ç¼“å­˜ ç¼“å­˜ä¸º0\nnaturals := make(chan int, 3) ç¼“å­˜ä¸º3 cap(naturals)=3 len(naturals)=0\nä¸¾ä¾‹ï¼š out in ä¸ºå½¢å‚å\nå‚æ•°ï¼šåªå‘é€ ch func count (out chan \u0026lt;- int) {} å‚æ•°ï¼šåªæ¥æ”¶ ch func counter (in \u0026lt;- chan int) {} å‚æ•°ï¼šæ™®é€šåŒå‘ func counter (chan int) {} å…±äº«å˜é‡ Go è¯­è¨€ä¹Ÿæœ‰ç±»ä¼¼unixä¸­å®ç°çš„é‚£äº›å…±äº«å˜é‡çš„å†…å®¹ã€‚åœ¨ sync åŒ…ä¸­æä¾›äº†ç”¨äºåŒæ­¥çš„ä¸€äº›åŸºæœ¬åŸè¯­ï¼ŒåŒ…æ‹¬å¸¸è§çš„ sync.Mutexã€sync.RWMutexã€sync.WaitGroupã€sync.Once å’Œ sync.Condã€‚\nåªè¦åœ¨go buildï¼Œgo runæˆ–è€…go testå‘½ä»¤åé¢åŠ ä¸Š-raceçš„flagï¼Œå°±ä¼šä½¿ç¼–è¯‘å™¨åˆ›å»ºä¸€ä¸ªä½ çš„åº”ç”¨çš„â€œä¿®æ”¹â€ç‰ˆæˆ–è€…ä¸€ä¸ªé™„å¸¦äº†èƒ½å¤Ÿè®°å½•æ‰€æœ‰è¿è¡ŒæœŸå¯¹å…±äº«å˜é‡è®¿é—®å·¥å…·çš„testï¼Œå¹¶ä¸”ä¼šè®°å½•ä¸‹æ¯ä¸€ä¸ªè¯»æˆ–è€…å†™å…±äº«å˜é‡çš„goroutineçš„èº«ä»½ä¿¡æ¯ã€‚å¦å¤–ï¼Œä¿®æ”¹ç‰ˆçš„ç¨‹åºä¼šè®°å½•ä¸‹æ‰€æœ‰çš„åŒæ­¥äº‹ä»¶ï¼Œæ¯”å¦‚goè¯­å¥ï¼Œchannelæ“ä½œï¼Œä»¥åŠå¯¹(*sync.Mutex).Lockï¼Œ(*sync.WaitGroup).Waitç­‰ç­‰çš„è°ƒç”¨ã€‚\nè¿™äº›äº’æ–¥é”ä¸cä¸­çš„ä¸€æ ·ï¼Œä¸”éƒ½ä¸æ”¯æŒé‡å…¥é”ï¼Œå†æ¬¡ä¸Šé”ä¼šæ­»é”ã€‚è¿™äº›é”ä¸»è¦æ˜¯åº”å¯¹ç«äº‰æ¡ä»¶ä¸‹å¯¹å˜é‡çš„è¯»å†™ï¼Œä»‹ç»å‡ ä¸ªå¸¸è§çš„é”ç”¨æ³•ï¼š\nsync.Mutexäº’æ–¥é”\nvar mu sync.Mutex mu.Lock() mu.Unlock() // é”è®°å¾—è¦é‡Šæ”¾ sync.RWMutexè¯»å†™é”\n// å…¶å…è®¸å¤šä¸ªåªè¯»æ“ä½œå¹¶è¡Œæ‰§è¡Œï¼Œä½†å†™æ“ä½œä¼šå®Œå…¨äº’æ–¥ã€‚ var mu sync.RWMutex mu.RLock() // readers lock mu.RUnlock() // è°ƒç”¨äº†RLockå’ŒRUnlockæ–¹æ³•æ¥è·å–å’Œé‡Šæ”¾ä¸€ä¸ªè¯»å–æˆ–è€…å…±äº«é”ã€‚(ä¸Šé”æ—¶ï¼ŒRLockä¸å µå¡) mu.Lock() mu.Unlock() // è°ƒç”¨mu.Lockå’Œmu.Unlockæ–¹æ³•æ¥è·å–å’Œé‡Šæ”¾ä¸€ä¸ªå†™æˆ–äº’æ–¥é”ã€‚ï¼ˆä¸Šé”æ—¶å…¶ä»–ä»»ä½•é”å µå¡ï¼‰ sync.Onceå•æ¬¡é”\n// ä¸€èˆ¬ç”¨äºåˆå§‹åŒ–ï¼Œåªä¸Šé”ä¸€æ¬¡ var loadIconsOnce sync.Once var icons map[string]image.Image // Concurrency-safe. func Icon(name string) image.Image { loadIconsOnce.Do(loadIcons)\t//loadIconsä¸ºè°ƒç”¨çš„å…¶ä»–å‡½æ•° return icons[name] } sync.WaitGroup ç­‰å¾…å¼€é”ç»„\n// é€’å¢çš„è®¡æ•°å™¨ï¼Œè¿™ä¸ªè®¡æ•°å™¨éœ€è¦åœ¨å¤šä¸ªgoroutineæ“ä½œæ—¶åšåˆ°å®‰å…¨å¹¶ä¸”æä¾›åœ¨å…¶å®Œæˆä¹‹å‰ä¸€ç›´ç­‰å¾…ã€‚ var wg sync.WaitGroup // number of working goroutines wg.Add(1) wg.Done() wg.Wait() //å µå¡ç­‰å¾…ä¸Šé”ç»„å†…å…¨éƒ¨done gorutineä¸çº¿ç¨‹ åœ¨å­¦ä¹ åç¨‹ æ—¶å…³äºçº¿ç¨‹ ä¸ cpuå¤„ç†ä¹‹é—´æœ‰è®¤çŸ¥ä¸å¤ªæ¸…æ™°çš„åœ°æ–¹ï¼Œçœ‹çœ‹è¿™ä½å¤§ä½¬çš„ä»‹ç»å°±èƒ½æœ‰ä¸ªç†æ€§çš„è®¤çŸ¥\nåç¨‹è‹±æ–‡åCoroutineã€‚ä½†åœ¨ Go è¯­è¨€ä¸­ï¼Œåç¨‹çš„è‹±æ–‡åæ˜¯ï¼šgorutineã€‚å®ƒå¸¸å¸¸è¢«ç”¨äºè¿›è¡Œå¤šä»»åŠ¡ï¼Œå³å¹¶å‘ä½œä¸šã€‚\nåç¨‹çš„ç‰¹ç‚¹ï¼š\nå¤šä¸ªåç¨‹å¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç®¡ç†ï¼Œåç¨‹çš„è°ƒåº¦å‘ç”Ÿåœ¨å…¶æ‰€åœ¨çš„çº¿ç¨‹ä¸­ã€‚ å¯ä»¥è¢«è°ƒåº¦ï¼Œè°ƒåº¦ç­–ç•¥ç”±åº”ç”¨å±‚ä»£ç å®šä¹‰ï¼Œå³å¯è¢«é«˜åº¦è‡ªå®šä¹‰å®ç°ã€‚ æ‰§è¡Œæ•ˆç‡é«˜ã€‚ å ç”¨å†…å­˜å°‘ã€‚ çº¿ç¨‹ åç¨‹ æ•°æ®å­˜å‚¨ å†…æ ¸æ€çš„å†…å­˜ç©ºé—´ ä¸€èˆ¬æ˜¯çº¿ç¨‹æä¾›çš„ç”¨æˆ·æ€å†…å­˜ç©ºé—´ åˆ‡æ¢æ“ä½œ æ“ä½œæœ€ç»ˆåœ¨å†…æ ¸å±‚å®Œæˆï¼Œåº”ç”¨å±‚éœ€è¦è°ƒç”¨å†…æ ¸å±‚æä¾›çš„ syscall åº•å±‚å‡½æ•° åº”ç”¨å±‚ä½¿ç”¨ä»£ç è¿›è¡Œç®€å•çš„ç°åœºä¿å­˜å’Œæ¢å¤å³å¯ ä»»åŠ¡è°ƒåº¦ ç”±å†…æ ¸å®ç°ï¼ŒæŠ¢å æ–¹å¼ï¼Œä¾èµ–å„ç§é” ç”±ç”¨æˆ·æ€çš„å®ç°çš„å…·ä½“è°ƒåº¦å™¨è¿›è¡Œã€‚ä¾‹å¦‚ go åç¨‹çš„è°ƒåº¦å™¨ è¯­éŸ³æ”¯æŒç¨‹åº¦ ç»å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€ éƒ¨åˆ†è¯­è¨€ï¼šLuaï¼ŒGoï¼ŒPython \u0026hellip; å®ç°è§„èŒƒ æŒ‰ç…§ç°ä»£æ“ä½œç³»ç»Ÿè§„èŒƒå®ç° æ— ç»Ÿä¸€è§„èŒƒã€‚åœ¨åº”ç”¨å±‚ç”±å¼€å‘è€…å®ç°ï¼Œé«˜åº¦è‡ªå®šä¹‰ï¼Œæ¯”å¦‚åªæ”¯æŒå•çº¿ç¨‹çš„çº¿ç¨‹ã€‚ä¸åŒçš„è°ƒåº¦ç­–ç•¥ï¼Œç­‰ç­‰ OSçº¿ç¨‹ä¼šè¢«æ“ä½œç³»ç»Ÿå†…æ ¸è°ƒåº¦ã€‚æ¯å‡ æ¯«ç§’ï¼Œä¸€ä¸ªç¡¬ä»¶è®¡æ—¶å™¨ä¼šä¸­æ–­å¤„ç†å™¨ï¼Œè¿™ä¼šè°ƒç”¨ä¸€ä¸ªå«ä½œschedulerçš„å†…æ ¸å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¼šæŒ‚èµ·å½“å‰æ‰§è¡Œçš„çº¿ç¨‹å¹¶å°†å®ƒçš„å¯„å­˜å™¨å†…å®¹ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œæ£€æŸ¥çº¿ç¨‹åˆ—è¡¨å¹¶å†³å®šä¸‹ä¸€æ¬¡å“ªä¸ªçº¿ç¨‹å¯ä»¥è¢«è¿è¡Œï¼Œå¹¶ä»å†…å­˜ä¸­æ¢å¤è¯¥çº¿ç¨‹çš„å¯„å­˜å™¨ä¿¡æ¯ï¼Œç„¶åæ¢å¤æ‰§è¡Œè¯¥çº¿ç¨‹çš„ç°åœºå¹¶å¼€å§‹æ‰§è¡Œçº¿ç¨‹ã€‚å› ä¸ºæ“ä½œç³»ç»Ÿçº¿ç¨‹æ˜¯è¢«å†…æ ¸æ‰€è°ƒåº¦ï¼Œæ‰€ä»¥ä»ä¸€ä¸ªçº¿ç¨‹å‘å¦ä¸€ä¸ªâ€œç§»åŠ¨â€éœ€è¦å®Œæ•´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¿å­˜ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹çš„çŠ¶æ€åˆ°å†…å­˜ï¼Œæ¢å¤å¦ä¸€ä¸ªçº¿ç¨‹çš„åˆ°å¯„å­˜å™¨ï¼Œç„¶åæ›´æ–°è°ƒåº¦å™¨çš„æ•°æ®ç»“æ„ã€‚è¿™å‡ æ­¥æ“ä½œå¾ˆæ…¢ï¼Œå› ä¸ºå…¶å±€éƒ¨æ€§å¾ˆå·®éœ€è¦å‡ æ¬¡å†…å­˜è®¿é—®ï¼Œå¹¶ä¸”ä¼šå¢åŠ è¿è¡Œçš„cpuå‘¨æœŸã€‚\nGoçš„è¿è¡Œæ—¶åŒ…å«äº†å…¶è‡ªå·±çš„è°ƒåº¦å™¨ï¼Œè¿™ä¸ªè°ƒåº¦å™¨ä½¿ç”¨äº†ä¸€äº›æŠ€æœ¯æ‰‹æ®µï¼Œæ¯”å¦‚m:nè°ƒåº¦ï¼Œå› ä¸ºå…¶ä¼šåœ¨nä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸Šå¤šå·¥ï¼ˆè°ƒåº¦ï¼‰mä¸ªgoroutineã€‚Goè°ƒåº¦å™¨çš„å·¥ä½œå’Œå†…æ ¸çš„è°ƒåº¦æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æ˜¯è¿™ä¸ªè°ƒåº¦å™¨åªå…³æ³¨å•ç‹¬çš„Goç¨‹åºä¸­çš„goroutineï¼ˆè¯‘æ³¨ï¼šæŒ‰ç¨‹åºç‹¬ç«‹ï¼‰ã€‚\nå’Œæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦ä¸åŒçš„æ˜¯ï¼ŒGoè°ƒåº¦å™¨å¹¶ä¸æ˜¯ç”¨ä¸€ä¸ªç¡¬ä»¶å®šæ—¶å™¨ï¼Œè€Œæ˜¯è¢«Goè¯­è¨€â€œå»ºç­‘â€æœ¬èº«è¿›è¡Œè°ƒåº¦çš„ã€‚ä¾‹å¦‚å½“ä¸€ä¸ªgoroutineè°ƒç”¨äº†time.Sleepï¼Œæˆ–è€…è¢«channelè°ƒç”¨æˆ–è€…mutexæ“ä½œé˜»å¡æ—¶ï¼Œè°ƒåº¦å™¨ä¼šä½¿å…¶è¿›å…¥ä¼‘çœ å¹¶å¼€å§‹æ‰§è¡Œå¦ä¸€ä¸ªgoroutineï¼Œç›´åˆ°æ—¶æœºåˆ°äº†å†å»å”¤é†’ç¬¬ä¸€ä¸ªgoroutineã€‚å› ä¸ºè¿™ç§è°ƒåº¦æ–¹å¼ä¸éœ€è¦è¿›å…¥å†…æ ¸çš„ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥é‡æ–°è°ƒåº¦ä¸€ä¸ªgoroutineæ¯”è°ƒåº¦ä¸€ä¸ªçº¿ç¨‹ä»£ä»·è¦ä½å¾—å¤šã€‚\ngoæ‹¥æœ‰å…¶åç¨‹è°ƒåº¦å™¨ï¼Œè°ƒåº¦å™¨çš„ä¸‰ä¸ªåŸºæœ¬å¯¹è±¡ï¼š\nG (Goroutine)ï¼Œä»£è¡¨åç¨‹ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡ä»£ç ä¸­ä½¿ç”¨ go å…³é”®è¯æ—¶å€™ä¼šåˆ›å»ºçš„ä¸€ä¸ªå¯¹è±¡\nM (Work Thread)ï¼Œå·¥ä½œçº¿ç¨‹\nP (Processor)ï¼Œä»£è¡¨ä¸€ä¸ªå¤„ç†å™¨ï¼Œåˆç§°ä¸Šä¸‹æ–‡\næ¯ä¸€ä¸ªè¿è¡Œçš„ M éƒ½å¿…é¡»ç»‘å®šä¸€ä¸ª Pï¼Œçº¿ç¨‹M åˆ›å»ºåä¼šå»æ£€æŸ¥å¹¶æ‰§è¡ŒG (goroutine)å¯¹è±¡ã€‚æ¯ä¸€ä¸ª P ä¿å­˜ç€ä¸€ä¸ªåç¨‹G çš„é˜Ÿåˆ—ã€‚é™¤äº†æ¯ä¸ª P è‡ªèº«ä¿å­˜çš„ G çš„é˜Ÿåˆ—å¤–ï¼Œè°ƒåº¦å™¨è¿˜æ‹¥æœ‰ä¸€ä¸ªå…¨å±€çš„ G é˜Ÿåˆ—ã€‚M ä»é˜Ÿåˆ—ä¸­æå– Gï¼Œå¹¶æ‰§è¡ŒP çš„ä¸ªæ•°å°±æ˜¯GOMAXPROCSï¼ˆæœ€å¤§256ï¼‰ï¼Œå¯åŠ¨æ—¶å›ºå®šçš„ï¼Œä¸€èˆ¬ä¸ä¿®æ”¹ã€‚ï¼ˆ go 1.5 ç‰ˆæœ¬ä¹‹å‰çš„ GOMAXPROCS é»˜è®¤æ˜¯ 1ï¼Œgo 1.5 ç‰ˆæœ¬ä¹‹åçš„ GOMAXPROCS é»˜è®¤æ˜¯ Num of cpuï¼‰M çš„ä¸ªæ•°å’Œ P çš„ä¸ªæ•°ä¸ä¸€å®šä¸€æ ·å¤šï¼ˆä¼šæœ‰ä¼‘çœ çš„M æˆ– Pä¸ç»‘å®šM ï¼‰ï¼ˆæœ€å¤§10000ï¼‰ã€‚P æ˜¯ç”¨ä¸€ä¸ªå…¨å±€æ•°ç»„ï¼ˆ255ï¼‰æ¥ä¿å­˜çš„ï¼Œå¹¶ä¸”ç»´æŠ¤ç€ä¸€ä¸ªå…¨å±€çš„ P ç©ºé—²é“¾è¡¨\nGOMAXPROCS å°±æ˜¯ go ä¸­ runtime åŒ…çš„ä¸€ä¸ªå‡½æ•°ã€‚å®ƒè®¾ç½®äº† P çš„æœ€å¤šçš„ä¸ªæ•°ã€‚è¿™ä¹Ÿå°±ç›´æ¥å¯¼è‡´äº† M æœ€å¤šçš„ä¸ªæ•°æ˜¯å¤šå°‘ï¼Œè€Œ M çš„ä¸ªæ•°å°±å†³å®šäº†å„ä¸ª G é˜Ÿåˆ—èƒ½åŒæ—¶è¢«å¤šå°‘ä¸ª M çº¿ç¨‹æ¥è¿›è¡Œè°ƒå–æ‰§è¡Œï¼å¦‚ä¸‹æ¼”ç¤º\nfor{ gofmt.Print(0) fmt.Print(1) } // $ GOMAXPROCS=1gorun hacker-clicheÌ.go111111111111111111110000000000000000000011111... // $ GOMAXPROCS=2gorun hacker-clicheÌ.go010101010101010101011001100101011010010100110... åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼Œæœ€å¤šåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªgoroutineè¢«æ‰§è¡Œã€‚åˆå§‹æƒ…å†µä¸‹åªæœ‰main goroutineè¢«æ‰§è¡Œï¼Œæ‰€ä»¥ä¼šæ‰“å°å¾ˆå¤š1ã€‚è¿‡äº†ä¸€æ®µæ—¶é—´åï¼ŒGOè°ƒåº¦å™¨ä¼šå°†å…¶ç½®ä¸ºä¼‘çœ ï¼Œå¹¶å”¤é†’å¦ä¸€ä¸ªgoroutineï¼Œè¿™æ—¶å€™å°±å¼€å§‹æ‰“å°å¾ˆå¤š0äº†ï¼Œåœ¨æ‰“å°çš„æ—¶å€™ï¼Œgoroutineæ˜¯è¢«è°ƒåº¦åˆ°æ“ä½œç³»ç»Ÿçº¿ç¨‹ä¸Šçš„ã€‚åœ¨ç¬¬äºŒæ¬¡æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œæ‰€ä»¥ä¸¤ä¸ªgoroutineå¯ä»¥ä¸€èµ·è¢«æ‰§è¡Œï¼Œä»¥åŒæ ·çš„é¢‘ç‡äº¤æ›¿æ‰“å°0å’Œ1ã€‚æˆ‘ä»¬å¿…é¡»å¼ºè°ƒçš„æ˜¯goroutineçš„è°ƒåº¦æ˜¯å—å¾ˆå¤šå› å­å½±å“çš„ï¼Œè€Œruntimeä¹Ÿæ˜¯åœ¨ä¸æ–­åœ°å‘å±•æ¼”è¿›çš„ï¼Œæ‰€ä»¥è¿™é‡Œçš„ä½ å®é™…å¾—åˆ°çš„ç»“æœå¯èƒ½ä¼šå› ä¸ºç‰ˆæœ¬çš„ä¸åŒè€Œä¸æˆ‘ä»¬è¿è¡Œçš„ç»“æœæœ‰æ‰€ä¸åŒã€‚\n","id":22,"section":"posts","summary":"å¯¹goçš„åŸºç¡€å­¦ä¹ ä¸­ï¼Œä¹Ÿäº†è§£äº†äº›ç›¸å…³çƒ­ç‚¹é—®é¢˜ã€‚ å‘ç°ç¯‡éå¸¸å¥½çš„æ–‡ç« è¯¦ç»†ä»‹ç»äº†goä¸­çš„å¹¶å‘è®¾è®¡åŸç†ã€å†…å­˜æ¨¡å‹ã€‚å†™äº›è¯»åæ„Ÿã€‚ å¹¶å‘ç¼–ç¨‹ ä¸Šä¸‹æ–‡ ä¸Šä¸‹æ–‡ç®€å•","tags":["go"],"title":"Goå¹¶å‘è§£æ","uri":"https://liangkang233.github.io/2021/09/go%E5%B9%B6%E5%8F%91%E8%A7%A3%E6%9E%90/","year":"2021"},{"content":"å¸¸ç”¨å°æŠ€å·§ leetcodeåˆ·é¢˜é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œå…³äºç®—æ³•çš„ç»“æ„æ–‡å­—æè¿°çš„æœ‰é™ï¼Œè®°å½•äº›å¸¸ç”¨çš„å•å…ƒçš„ä»£ç ï¼Œå¤‡å¿˜ã€‚\né˜²æ­¢æº¢å‡ºæ±‚å¹³å‡æ•° ä¸€èˆ¬æ±‚å¹³å‡æ•°æ—¶ä¼š (a+b)/2 æˆ– (a+b)\u0026gt;\u0026gt;1 æ¥åšï¼Œä½†æ˜¯è‹¥æ•°è¾ƒå¤§æ—¶ a + b ä¼šå‡ºç°æº¢å‡ºæƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ç§æ–¹æ³•æ¥åšï¼š\nc = a + (b - a) / 2; a\u0026amp;b + ((a^b) \u0026gt;\u0026gt; 1 ) a\u0026amp;b : è·å–ä¸¤ä¸ªæ•°åŒä¸º1çš„ä½\na^b: è·å–ä¸¤ä¸ªæ•°ä¸åŒä¸º1çš„ä½\nä¸¤ä¸ªæ•°çš„å¹³å‡å€¼ä¸ºä¸¤ä¸ªæ•°çš„æ¯ä¸€ä½å¹³å‡å€¼çš„å’Œ\næœ€å°å…¬å€æ•° æœ€å¤§å…¬çº¦æ•° åˆ©ç”¨æœ€å¤§å…¬çº¦æ•°æ±‚æœ€å°å…¬å€æ•°\nå®šç†: å·²çŸ¥a,bæœ€å¤§å…¬çº¦æ•°ä¸ºXï¼Œæœ€å°å…¬å€æ•°ä¸ºYï¼Œåˆ™æœ‰å…¬å¼ä¸ºa*b=æœ€å¤§å…¬çº¦æ•°X * æœ€å°å…¬å€æ•°Y\nè¯æ˜ï¼šç”±å·²çŸ¥å¾—a=Xc b=Xd ä¸”cä¸däº’ä¸ºç´ æ•°ï¼ˆå¦åˆ™Xå°±ä¸æ˜¯cä¸dçš„æœ€å¤§å…¬å› æ•°ï¼‰æ‰€ä»¥Y=Xcd, å³a*b = c * X * X * d = X * Y\nè¾—è½¬ç›¸é™¤æ³•æ±‚æœ€å¤§å…¬çº¦æ•°: ç”¨è¾ƒå¤§æ•°é™¤ä»¥è¾ƒå°æ•°ï¼Œå†ç”¨å‡ºç°çš„ä½™æ•°ï¼ˆç¬¬ä¸€ä½™æ•°ï¼‰å»é™¤é™¤æ•°ï¼Œå†ç”¨å‡ºç°çš„ä½™æ•°ï¼ˆç¬¬äºŒä½™æ•°ï¼‰å»é™¤ç¬¬ä¸€ä½™æ•°ï¼Œå¦‚æ­¤åå¤ï¼Œç›´åˆ°æœ€åä½™æ•°æ˜¯0ä¸ºæ­¢ã€‚å¦‚æœæ˜¯æ±‚ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°ï¼Œé‚£ä¹ˆæœ€åçš„é™¤æ•°å°±æ˜¯è¿™ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°\nå®šç†ï¼šä¸¤ä¸ªæ•´æ•°çš„æœ€å¤§å…¬çº¦æ•°ç­‰äºå…¶ä¸­è¾ƒå°çš„é‚£ä¸ªæ•°å’Œä¸¤æ•°ç›¸é™¤ä½™æ•°çš„æœ€å¤§å…¬çº¦æ•°ã€‚æœ€å¤§å…¬çº¦æ•°ï¼ˆGreatest Common Divisorï¼‰ç¼©å†™ä¸ºGCDã€‚gcd(a,b) = gcd(b,a mod b) (ä¸å¦¨è®¾a\u0026gt;b ä¸”r=a mod b ,rä¸ä¸º0)\nè¯æ˜ï¼š aå¯ä»¥è¡¨ç¤ºæˆa = kb + rï¼ˆaï¼Œbï¼Œkï¼Œrçš†ä¸ºæ­£æ•´æ•°ï¼Œä¸”r\u0026lt;bï¼‰ï¼Œåˆ™r = a mod b å‡è®¾dæ˜¯a,bçš„ä¸€ä¸ªå…¬çº¦æ•°ï¼Œè®°ä½œd|a,d|bï¼Œå³aå’Œbéƒ½å¯ä»¥è¢«dæ•´é™¤ã€‚ è€Œr = a - kbï¼Œä¸¤è¾¹åŒæ—¶é™¤ä»¥dï¼Œr/d=a/d-kb/d=mï¼Œç”±ç­‰å¼å³è¾¹å¯çŸ¥mä¸ºæ•´æ•°ï¼Œ å› æ­¤dä¹Ÿæ˜¯b,a mod bçš„å…¬çº¦æ•°ã€‚(a,b)å’Œ(b,a mod b)çš„å…¬çº¦æ•°ç›¸ç­‰ï¼Œåˆ™å…¶æœ€å¤§å…¬çº¦æ•°ä¹Ÿç›¸ç­‰ï¼Œå¾—è¯ã€‚\nint MinBei(int a, int b) {\tint tmp, count = a * b; // æ±‚æœ€å¤§å…¬çº¦æ•° è¿­ä»£å†™æ³• while (b) { tmp = b; b = a % b; a = tmp; } return count / a ; //ä¸¤æ•°ç›¸ä¹˜ç­‰äº æœ€å¤§å…¬çº¦æ•°ä¹˜æœ€å°å…¬å€æ•° } // æ±‚æœ€å¤§å…¬çº¦æ•°çš„é€’å½’å†™æ³• int gcd (int a, int b) { return b ? gcd(b, a % b) : a; } int main() {\tint a, b, c, temp; cin \u0026gt;\u0026gt; a \u0026gt;\u0026gt; b \u0026gt;\u0026gt; c; temp = MiniBei(a, b); // cout \u0026lt;\u0026lt; temp \u0026lt;\u0026lt; endl; temp = MiniBei(c, temp); // cout \u0026lt;\u0026lt; temp \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; temp; return 0; } è´¨(å› )æ•° å“¥å¾·å·´èµ«çŒœæƒ³ï¼šä»»ä¸€å¤§äº2çš„å¶æ•°ï¼Œéƒ½å¯è¡¨ç¤ºæˆä¸¤ä¸ªç´ æ•°ä¹‹å’Œã€‚\nåˆæ•°æ€§è´¨ï¼š\næ‰€æœ‰å¤§äº2çš„å¶æ•°éƒ½æ˜¯åˆæ•°ï¼Œä¹Ÿå°±æ˜¯åœ¨æ­£æ•´æ•°ä¸­é™¤äº†2ä»¥å¤–ï¼Œå…¶ä½™æ•°çš„ä¸ªä½æ•°ä¸º0ã€2ã€4ã€6ã€8è€…å‡ä¸ºåˆæ•°ã€‚4ä¸ºæœ€å°çš„åˆæ•°ã€‚ æ¯ä¸€åˆæ•°éƒ½å¯ä»¥ä»¥å”¯ä¸€å½¢å¼è¢«å†™æˆè´¨æ•°çš„ä¹˜ç§¯ã€‚ï¼ˆç®—æœ¯åŸºæœ¬å®šç†ï¼‰ æ‰€æœ‰åˆæ•°éƒ½æœ‰è‡³å°‘3ä¸ªæ­£å› æ•°ï¼Œä¾‹å¦‚4æœ‰æ­£å› æ•°1ã€2ã€4ï¼Œ6æœ‰æ­£å› æ•°1ã€2ã€3ã€6ã€‚ å¯¹ä»»ä¸€å¤§äº5çš„åˆæ•°nï¼Œ(n-1)!==0ï¼ˆå¨å°”é€Šå®šç†ï¼‰ å¯¹äºä»»æ„çš„æ­£æ•´æ•°nï¼Œéƒ½å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ­£æ•´æ•°xï¼Œä½¿å¾—xã€x+1ã€x+2ã€â€¦ã€x+n éƒ½æ˜¯åˆæ•°ã€‚ å¿«é€Ÿè®¡ç®—æ˜¯å¦ä¸ºè´¨æ•°æ–¹æ³•ï¼š\næ ¹æ®æ€§è´¨2ï¼Œä»»ä½•ä¸€ä¸ªåˆæ•°éƒ½èƒ½èƒ½åˆ†è§£æˆè´¨æ•°ç›¸ä¹˜ï¼Œé‚£ä¹ˆå¯ä»¥è¡¨ç¤ºä¸ºNï¼a1*a2*...*akï¼Œï¼ˆakå‡ä¸ºè´¨æ•°ï¼‰ ä¸Šè¿°è´¨å› æ•°æ‹†åˆ†ä¸­ k \u0026gt;= 2,æ‰€ä»¥æœ€å°è´¨å› æ•°ä¸ºa1ï¼Œå®¹æ˜“çŸ¥é“a1å°äº sqrt(N) å³åˆæ•°ä¸€å®šå­˜åœ¨ä¸€ä¸ªå°äºsqrt(N)çš„è´¨å› æ•° 6x 6x-2 6x-3 6x-4è‚¯å®šä¸æ˜¯è´¨æ•°ã€‚ æ‰€ä»¥å¦‚æœ n æ˜¯6 å€æ•°ä¸¤ä¾§çš„æ•°ï¼Œé‚£ä¹ˆnæ‰æœ‰å¯èƒ½æ˜¯è´¨æ•°ã€‚ å³ç»“è®º è´¨æ•°(å¤§äº3æ—¶)ä¸€å®šæ˜¯6x-1 æˆ–6x-5ï¼ˆx\u0026gt;=1ï¼‰ #include \u0026lt;iostream\u0026gt; #include \u0026lt;cmath\u0026gt; // æœ€åŸå§‹ bool isPrime(int n){ if (n \u0026lt;= 3) { return n \u0026gt; 1; } for(int i = 2; i \u0026lt; n; i++){ if (n % i == 0) { return false; } } return true; } // åˆæ­¥ä¼˜åŒ– // è‹¥ä¸æ˜¯è´¨æ•° å…¶ä¸€å®šå­˜åœ¨å› æ•°p1\u0026lt;=sqrt(n)ï¼Œp2\u0026gt;=sqrt(n) bool isPrime1(int n) { if (n \u0026lt;= 3) { return n \u0026gt; 1; } int s = (int)sqrt(n); for (int i = 2; i \u0026lt;= s; i++) { if(n % i == 0) { return false; } } return true; } // è´¨æ•°è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯å®ƒæ€»æ˜¯ç­‰äº 6x-1 æˆ–è€… 6x-5ï¼Œå…¶ä¸­ x æ˜¯å¤§äºç­‰äº1çš„è‡ªç„¶æ•°ã€‚ bool isPrime2(int num) { if (num \u0026lt;= 3) { return num \u0026gt; 1; } // ä¸åœ¨6çš„å€æ•°ä¸¤ä¾§çš„ä¸€å®šä¸æ˜¯è´¨æ•° if (num % 6 != 1 \u0026amp;\u0026amp; num % 6 != 5) { return false; } int s = (int)sqrt(num); // è‹¥è¿™ä¸ªæ•°æ˜¯åˆæ•°ï¼Œåˆ™å¿…æœ‰è´¨å› æ•°i,i \u0026lt;= sqrt(num) // ä¸”iä¸ºè´¨æ•°ä¸€å®šä¸º6å€æ•°ä¸¤ä¾§ï¼Œä»¥6ä¸ºæ­¥é•¿å¯»æ‰¾ // å¯»æ‰¾åœ¨ æ ¹å·n å†…æ˜¯å¦å­˜åœ¨ ç±»ä¼¼å› æ•° 6i+1 6i+5 for (int i = 6; i \u0026lt;= s; i += 6) { if (num % (i-1) == 0 || num % (i+1) == 0) { return false; } } return true; } è‹¥æ˜¯æ±‚èŒƒå›´å†…è´¨æ•°çš„ä¸ªæ•° åˆ™å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•æ±‚è§£\nåŸƒæ‹‰æ‰˜è‰²å°¼ç­›é€‰æ³•\nå…¶åŸç†ä¹Ÿååˆ†æ˜“æ‡‚:ä»1åˆ°néå†ï¼Œå‡è®¾å½“å‰éå†åˆ°m,åˆ™æŠŠæ‰€æœ‰å°äºnçš„ã€ä¸”æ˜¯mçš„å€æ•°çš„æ•´æ•°æ ‡ä¸ºå’Œæ•°;\néå†å®Œæˆåï¼Œæ²¡æœ‰è¢«æ ‡ä¸ºå’Œæ•°çš„æ•°å­—å³ä¸ºè´¨æ•°ã€‚\n// æ±‚ [1,n) èŒƒå›´å†…è´¨æ•°ä¸ªæ•° å¯ä»¥é‡‡ç”¨æ­¤æ–¹æ³• int countPrimes(int n) { if (n \u0026lt;= 2) return 0; vector\u0026lt;bool\u0026gt; prime(n, true) ; int count = n - 2; //å»æ‰ä¸æ˜¯è´¨æ•°çš„1 å’ŒèŒƒå›´å¤–çš„n for(int i = 2; i \u0026lt; n; ++i){ if (prime[i]) { for (int j = 2*i; j \u0026lt; n; j += i){ // å°†içš„æ•´æ•°å€åˆ é™¤ if (prime[j]) { prime[j] = false; --count; } } } } return count; } // ä¼˜åŒ–ç‰ˆæœ¬ int countPrimes1(int n) { if (n \u0026lt;= 2) return 0; vector\u0026lt;bool\u0026gt; prime(n, true); int i = 3, sqrtn = sqrt(n), count = n / 2; // i\u0026gt;=3çš„å¶æ•°ä¸€å®šä¸æ˜¯è´¨æ•° for (int i = 3; i \u0026lt;= sqrtn; i+=2) { if(prime[i]) { // åªå¯¹å½“å‰æ˜¯æœªè¢«æ ‡è®°çš„è´¨æ•°æ‰è¿›è¡Œ å¹³æ–¹åç´¯åŠ 2içš„æ•°è®¾å®šä¸ºåˆæ•° å‡å°‘é‡å¤éå† // iä¸º3å¼€å§‹çš„å¥‡æ•° è¿›å…¥åˆæ•°ç»Ÿè®¡æ—¶ +iå¿…å®šä¸ºå¶æ•°æ•°æ²¡å¿…è¦éå† å·²ç»æå‰æŠŠå¶æ•°ä¸ªæ•°å‡å°‘äº† for (int j = i*i; j \u0026lt; n; j += 2*i){ // jä¸æ–­ + 2i ä¸ºäº†é¿å…å¶æ•° çš„éå† if (prime[j]) { --count ; prime[j] = false; } } } } return count; } å¹³æ–¹æ ¹å‡½æ•° ç”¨ç‰›é¡¿æ³•å®ç°å¿«é€Ÿæ±‚å¹³æ–¹æ ¹çš„è¿‘ä¼¼å‡½æ•°ã€‚\nè®¡ç®—æœºé€šå¸¸ä½¿ç”¨å¾ªç¯æ¥è®¡ç®— x çš„å¹³æ–¹æ ¹ã€‚ä»æŸä¸ªçŒœæµ‹çš„å€¼ z å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ® zÂ² ä¸ x çš„è¿‘ä¼¼åº¦æ¥è°ƒæ•´ zï¼Œäº§ç”Ÿä¸€ä¸ªæ›´å¥½çš„çŒœæµ‹ï¼š\nz -= (z * z - x) / (2*z)\nä¸Šé¢çš„ zÂ² âˆ’ x æ˜¯ zÂ² åˆ°å®ƒæ‰€è¦åˆ°è¾¾çš„å€¼ï¼ˆå³ xï¼‰çš„è·ç¦»ï¼Œ é™¤ä»¥çš„ 2z ä¸º zÂ² çš„å¯¼æ•°ï¼Œæˆ‘ä»¬é€šè¿‡ zÂ² çš„å˜åŒ–é€Ÿåº¦æ¥æ”¹å˜ z çš„è°ƒæ•´é‡ã€‚Xåœ¨ä¸Šå¼ä¸­ä¸ºå›ºå®šå€¼ã€‚\nå½“æ±‚Açš„å¹³æ–¹æ ¹æ—¶ è®¾f(x) = x^2\nä¸Šé—®é¢˜å³ä¸ºæ±‚ f(x) = Açš„è§£\næ„é€ å‡½æ•° F(X) = f(x) - A = x^2 - A\nAä¸ºæ‰€æ±‚çš„å¸¸æ•° ç”¨ç‰›é¡¿æ³•æ±‚è§£ä¸æ–­è¿­ä»£ä¸‹å» ç›´åˆ° Xn+1 ä¸ Xn å·®å€¼è¶³å¤Ÿå°\nå³è¿­ä»£æ±‚ Xn+1 = Xn - F(Xn) / F\u0026rsquo;(Xn)\nè¿™ç§é€šç”¨æ–¹æ³•â€”â€”ç‰›é¡¿æ³•ã€‚ å®ƒå¯¹å¾ˆå¤šå‡½æ•°ï¼Œç‰¹åˆ«æ˜¯å¹³æ–¹æ ¹è€Œè¨€éå¸¸æœ‰æ•ˆã€‚ int main() { double x1, x2; float a; scanf(\u0026quot;%f\u0026quot;, \u0026amp;a); x2 = 1.0; do { x1 = x2; x2 = (x1 + a / x1) / 2; // x2 -= (x2 + a / x2) / 2; ä¹Ÿå¯å¦‚æ­¤ç®€å†™ } while (fabs(x1-x2)\u0026gt;pow(10,-5)); // } while (fabs(x1-x2) \u0026gt; 1e-5); printf(\u0026quot;value:%lf\u0026quot;, x2); system(\u0026quot;pause\u0026quot;); return 0; } æ‰©å±•ï¼Œé›·ç¥ä¹‹é”¤æºç å¹³æ–¹æ ¹è°ƒç”¨æ–¹æ³•ï¼Œåªçœ‹æœ€åä¸€éƒ¨åˆ†å³å¯ã€‚å°† f(x)=y è½¬ä¸º f(y)=x æ¥ç®€åŒ–è¿ç®—\nå›æ–‡æ•° æ±‚å›æ–‡æ—¶ï¼Œè‹¥æ˜¯å­—ç¬¦ä¸²å°±æ³•1æ¯”è¾ƒï¼Œè‹¥æ˜¯æ•°å­—åˆ©ç”¨è¿­ä»£ä¹˜ã€ä½™æ¥åš\n// æ³•1 while (start \u0026lt; end) { if (nums[start++] != nums[end--]) return false; } return true; //æ³•2 bool isPalindrome(int x) { if (x \u0026lt; 0 || (x % 10 == 0 \u0026amp;\u0026amp; x != 0)) return false; int revertedNumber = 0; while (x \u0026gt; revertedNumber) { revertedNumber = revertedNumber * 10 + x % 10; x /= 10; } // å½“æ•°å­—é•¿åº¦ä¸ºå¥‡æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ revertedNumber/10 å»é™¤å¤„äºä¸­ä½çš„æ•°å­—ã€‚ // ä¾‹å¦‚ï¼Œå½“è¾“å…¥ä¸º 12321 æ—¶ï¼Œåœ¨ while å¾ªç¯çš„æœ«å°¾æˆ‘ä»¬å¯ä»¥å¾—åˆ° x = 12ï¼ŒrevertedNumber = 123ï¼Œ // ç”±äºå¤„äºä¸­ä½çš„æ•°å­—ä¸å½±å“å›æ–‡ï¼ˆå®ƒæ€»æ˜¯ä¸è‡ªå·±ç›¸ç­‰ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†å…¶å»é™¤ã€‚ return x == revertedNumber || x == revertedNumber / 10; } ä½è¿ç®— æ³¨æ„ï¼šå·¦ç§»è¿ç®—ç”¨é›¶å¡«å……å³è¾¹ç©ºç¼ºçš„bitä½ï¼Œæ— ç¬¦å·æ•°çš„å³ç§»è¿ç®—ä¹Ÿæ˜¯ç”¨0å¡«å……å·¦è¾¹ç©ºç¼ºçš„bitä½ï¼Œä½†æ˜¯æœ‰ç¬¦å·æ•°çš„å³ç§»è¿ç®—ä¼šç”¨ç¬¦å·ä½çš„å€¼å¡«å……å·¦è¾¹ç©ºç¼ºçš„bitä½ã€‚\nå› ä¸ºè¿™ä¸ªåŸå› ï¼Œæœ€å¥½ç”¨æ— ç¬¦å·è¿ç®—ï¼Œè¿™æ ·ä½ å¯ä»¥å°†æ•´æ•°å®Œå…¨å½“ä½œä¸€ä¸ªbitä½æ¨¡å¼å¤„ç†ã€‚\n! é€»è¾‘é ~ ä½é ^ å¼‚æˆ– | æˆ– \u0026amp; ä¸ åŠŸèƒ½ ä½¿ç”¨æ–¹æ³• å‚è€ƒé“¾æ¥ æ ‘çŠ¶æ•°ç»„ä¸­çš„æ±‚ ä¸€ä¸ªæ•°äºŒè¿›åˆ¶çš„1çš„æœ€ä½ä½ç½® ç›´æ¥ return = x\u0026amp;(-x) lowbit æ ‘çŠ¶æ•°ç»„å…³é”®å‡½æ•° æ±‚æŸä¸ªæ•°æ®å‡ºç°æ¬¡æ•° ä½¿ç”¨ \u0026amp;æ“ä½œï¼Œå¤æ‚çš„æ·»åŠ çŠ¶æ€è¡¨ https://leetcode-cn.com/problems/single-number/ å°†xçš„æœ€ä½çš„ä¸€ä¸ªéé›¶çš„bitä½æ¸…é›¶ ä½¿ç”¨ x\u0026amp;(x-1) æŸ¥è¯¢ä¸€ä¸ª64ä½æ•°æ®çš„äºŒè¿›åˆ¶1ä¸ªæ•° å»ºè¡¨æŸ¥ï¼Œçœçš„æ¯æ¬¡éƒ½å¾ªç¯64æ¬¡ å³è¾¹mainæ–‡ä»¶å†…å«å»ºè¡¨ä»£ç  ç§»ä½æŸ¥æ•°æ®ï¼Œé™¤äº†ç›´æ¥ \u0026raquo; ä¹Ÿå¯å¦‚å³è¾¹ x\u0026amp;(1\u0026laquo;i) æ ‡å‡†äºŒåˆ†æŸ¥æ‰¾åŠå…¶è¡ç”Ÿ //äºŒåˆ†æ³•æŸ¥æ‰¾/æŠ˜åŠæŸ¥æ‰¾ int binarySearch(Element array[], int len, int key){ int low = 0, high = len - 1, middle; while(low \u0026lt;= high){ middle = (low + high) / 2; if(array[middle] == key){ //æ‰¾åˆ°,è¿”å›ä¸‹æ ‡ç´¢å¼•å€¼ return middle; }else if(array[middle] \u0026gt; key){ //æŸ¥æ‰¾å€¼åœ¨ä½åŠåŒº high = middle - 1; }else{ //æŸ¥æ‰¾å€¼åœ¨é«˜åŠåŒº low = middle + 1; } } return -1; //æ‰¾ä¸åˆ° } stdåº“ lower_bound å¯»æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºnumçš„å€¼çš„ä¸‹æ ‡ è‡ªå®ç° (æœªæ·»åŠ  è¶…å‡ºä¸Šä¸‹é™çš„åˆ¤æ–­)ï¼š\nint mylower_bound(int* array ,int size,int key){ int first = 0, middle ,last = size-1; while(first\u0026lt;last){ middle = (first+last) \u0026gt;\u0026gt; 1; if(array[middle] \u0026lt;key ) //å½“middleå°äºè¦æ‰¾çš„ä½ç½® ï¼Œ first +1 ä¹Ÿä¸ä¼šè¶…è¿‡keyçš„ä½ç½®ï¼Œæœ€å¤šç›¸åŒ first = middle + 1; else last = middle ; //middleæœ‰å¯èƒ½ç­‰äºè¦æ‰¾çš„ä½ç½® ï¼Œ last = middle ï¼Œ ç”¨firstä¸æ–­é€¼è¿‘ } return first; } leetcode: 35.æœç´¢æ’å…¥ä½ç½®\n// æœ‰é‡å¤æ•°æ®ä¹Ÿå¯æ’å‡ºç»“æœ å¯ä»¥è¿”å›å€¼èŒƒå›´ä¸º 0-size class Solution { public: int searchInsert(vector\u0026lt;int\u0026gt;\u0026amp; nums, int target) { int l = 0, r = nums.size()-1; while(l \u0026lt;= r) { int mid = (l + r) \u0026gt;\u0026gt; 1; if(nums[mid] \u0026lt; target) l = mid+1; else r = mid-1; } return l; } }; ","id":23,"section":"posts","summary":"å¸¸ç”¨å°æŠ€å·§ leetcodeåˆ·é¢˜é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œå…³äºç®—æ³•çš„ç»“æ„æ–‡å­—æè¿°çš„æœ‰é™ï¼Œè®°å½•äº›å¸¸ç”¨çš„å•å…ƒçš„ä»£ç ï¼Œå¤‡å¿˜ã€‚ é˜²æ­¢æº¢å‡ºæ±‚å¹³å‡æ•° ä¸€èˆ¬æ±‚å¹³å‡æ•°æ—¶ä¼š (a+b)/2","tags":["C/C++","ç®—æ³•"],"title":"ç¼–ç¨‹é¢˜ä¸­å¸¸è§æŠ€å·§","uri":"https://liangkang233.github.io/2021/08/%E5%B8%B8%E7%94%A8%E5%B0%8F%E6%8A%80%E5%B7%A7/","year":"2021"},{"content":"shellè„šæœ¬åœ¨linuxä½¿ç”¨ç”¨çš„ååˆ†å¹¿æ³›ï¼Œå†™ç¯‡æ€»ç»“å­¦ä¹ æ€§çš„æ–‡ç« åšè®°å½•ã€‚\nè¿™ä¸ªè¿ç»´æ‰‹å†Œå†™çš„æ¯”è¾ƒè¯¦ç»†ï¼Œå¯ä»¥åšå‚è€ƒã€‚\nå¦ä¸€ä¸ªæ¯”è¾ƒå…¨çš„å‚è€ƒ\nåŸºæœ¬è¯­æ³• if elseï¼š # then ä¸ if åŒä¸€è¡Œæ—¶è¦åŠ  ; if [ `whoami` != \u0026quot;root\u0026quot; ];then echo \u0026quot;Please run it as a superuser\u0026quot; exit 0 elif $something -gt 2 ; then echo \u0026quot;else if\u0026quot; else echo \u0026quot;else\u0026quot; fi switchï¼š read -p $'Please input a number... \\n1 means icmp,2 means udp ,3 means tcp ' case $n in 1) echo \u0026quot;you will accept icmp data\u0026quot; tcpdump icmp -c 5 -i ens33 -l -w./aaa.cap \u0026amp; ;; 2) echo \u0026quot;you will accept udp data\u0026quot; tcpdump udp -c 5 -i ens33 ;; 3) echo \u0026quot;you will accept tcp data\u0026quot; tcpdump tcp -c 5 -i ens33 ;; *) echo \u0026quot;invail command\u0026quot; ;; esac forï¼š datetime=`date +%F-%H:%M:%S` i=1 while [ $i -lt 5 ];do echo \u0026quot;start NO.$i capture data\u0026quot; # sudo tcpdump icmp -i ens33 -w ./$datetime.cap \u0026amp; # sudo tcpdump icmp -i ens33 -w ./`date +%F-%H:%M:%S` \u0026amp; tdid=`pgrep tcpdump` sleep 10s echo \u0026quot;$tdid\u0026quot; kill -9 $tdid ((i++)) done for i in ${!IdArry[@]} do echo ${IdArry[i]:1} # echo ${IdArry[i]:i:j} è¡¨ç¤ºæ‰“å°ç¬¬iä½åˆ°ç¬¬jä½æ•°æ®ï¼Œjçœç•¥è¡¨ç¤ºç¬¬iä½åˆ°æœ€åä¸€ä½ done å…³ç³»è¿ç®—ç¬¦ï¼Œå¦‚ä¸‹ï¼š æ³¨æ„ï¼š ä½¿ç”¨ [] å°±å¯ä»¥ä½¿ç”¨cä¸­å¸¸ç”¨çš„å…³ç³»ç¬¦, # [ ]ç¬¦å·æ—å¿…é¡»æœ‰ç©ºæ ¼ï¼Œå¦åˆ™ä¼šè¢«shellè®¤ä¸ºæ˜¯å‘½ä»¤æ‰§è¡Œ\n-gtï¼šå¤§äºï¼Œgreater thanã€‚ -eqï¼šç­‰äºï¼Œequalã€‚ -ltï¼šå°äºï¼Œless thanã€‚ -geï¼šå¤§äºç­‰äºï¼Œgreater than or equalã€‚ -leï¼šå°äºç­‰äºï¼Œless than or equalã€‚ -neï¼šä¸ç­‰äºï¼Œnot equalã€‚ è¿æ¥ç¬¦ï¼Œå¦‚ä¸‹ï¼š\n-aï¼šä¸”ï¼Œandã€‚ -oï¼šæˆ–ï¼Œorã€‚ æ¡ä»¶åˆ¤æ–­ï¼Œé€»è¾‘è¿ç®—ç¬¦ï¼Œå¦‚ä¸‹ï¼š\n\u0026amp;\u0026amp;ï¼šç”¨æ¥æ‰§è¡Œæ¡ä»¶æˆç«‹åæ‰§è¡Œçš„å‘½ä»¤ã€‚ ||ï¼šç”¨æ¥æ‰§è¡Œæ¡ä»¶ä¸æˆç«‹åçš„æ‰§è¡Œå‘½ä»¤ã€‚ å‡½æ•°ã€ä¼ å‚ã€è¿”å›å€¼ ç»™å®šçš„å‚æ•°ä»¥$1ï¼Œ$2ï¼Œ$3,...$nçš„å½¢å¼è®¿é—®ï¼Œå¯¹åº”äºå‡½æ•°ååå‚æ•°çš„ä½ç½®ã€‚$0å˜é‡çš„å€¼æ˜¯å‡½æ•°çš„åç§°ã€‚ $? è¡¨ç¤ºä¸Šæ¬¡è¿è¡Œçš„ç»“æœï¼Œé0è¡¨ç¤ºå¼‚å¸¸ $# å˜é‡ç”¨äºä¿å­˜èµ‹äºˆå‡½æ•°çš„ä½ç½®è‡ªå˜é‡/å‚æ•°çš„æ•°é‡ã€‚å…¶ä¸­ $* å’Œ $@ å˜é‡ç”¨äºä¿å­˜èµ‹äºˆå‡½æ•°çš„æ‰€æœ‰å‚æ•°ã€‚ ä¼ å‚æ—¶ï¼Œè‹¥$cmdä¸­å¸¦ç©ºæ ¼éœ€è¦åŠ \u0026quot;\u0026quot; , ä¸åŠ åŒå¼•å·ä¼šè‡ªåŠ¨ä»¥ç©ºæ ¼ä¸ºåˆ†å‰²ç¬¦å·ä¼ å‚ æ•°ç»„ä¼ å‚æ•°ä½¿ç”¨ ${Mymap[*]} æˆ– ${Mymap[@]}ï¼ŒåŒºåˆ«ä¸º${Mymap[*]} æ˜¯ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œ ä¾‹å¦‚â€œ1 2 3â€${Mymap[@]} æ˜¯ä¼ å…¥å¤šä¸ªå‚æ•°ï¼Œä¾‹å¦‚\u0026quot;1\u0026quot;,\u0026quot;2\u0026quot;,\u0026quot;3\u0026quot; # å£°æ˜å‡½æ•°çš„è¯­æ³•æœ‰ä¸¤ç§æ ¼å¼å®šä¹‰ï¼š # ç¬¬ä¸€ç§æ–¹æ³•ï¼šä»¥å‡½æ•°åç§°å¼€å¤´ï¼Œåè·Ÿæ‹¬å·ã€‚è¿™æ˜¯æœ€ä¼˜é€‰ä¸”æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š function_name () { commands } # å•è¡Œè¯­æ³•å¦‚ä¸‹ï¼š function_name () { commands; } # ç¬¬äºŒç§æ–¹æ³•ï¼šä»¥å‡½æ•°ä¿ç•™å­—å¼€å¤´ï¼Œåè·Ÿå‡½æ•°åç§°ï¼š function function_name { commands } # å•è¡Œè¯­æ³•å¦‚ä¸‹ï¼š function_name () { commands; } æ•°ç»„ã€å…³è”æ•°ç»„ï¼ˆå­—å…¸ï¼‰å˜é‡ ç´¢å¼•-1æ˜¯æœ€åä¸€ä¸ªå…ƒç´ çš„å‚è€ƒ\ndeclare -a ARRAY_NA å£°æ˜æ•°ç»„ declare -A ARRAY_NAME å£°æ˜å…³è”æ•°ç»„ local temp å£°æ˜å±€éƒ¨å˜é‡\næ³¨æ„è„šæœ¬ä¸­å“ªæ€•å‡½æ•°å†…å®šä¹‰å˜é‡é»˜è®¤æ˜¯å…¨å±€çš„ï¼Œåœ¨å‡½æ•°å†…å®šä¹‰çš„localå˜é‡ä¼šç»“æŸä½œç”¨åŸŸåé”€æ¯ã€‚\nå…³è”æ•°ç»„ç”¨æ³•ç¤ºä¾‹:\n# è®¿é—®å…ƒç´ ç±»ä¼¼æ•°ç»„ Mymap[${NameArry}] # æ·»åŠ å…ƒç´  Mymap[${NameArry}] = 12 # åˆ é™¤å…ƒç´  unset Mymap[$findkey] åˆ é™¤æ“ä½œ # éå†å…ƒç´  for i in ${IdArry[@]} do echo i done # ${!Mymap[@]}ä¸ºæ•°ç»„æˆ–å­—å…¸å…¨éƒ¨index ${Mymap[@]}ä¸ºå…¨éƒ¨value # \u0026amp;() ä¸ ï½€ï½€åŒºåˆ« åœ¨æ“ä½œä¸Šï¼Œè¿™ä¸¤è€…éƒ½æ˜¯è¾¾åˆ°ç›¸åº”çš„æ•ˆæœã€‚åœ¨bashä¸­ï¼Œ$( )ä¸ï½€ï½€ï¼ˆåå¼•å·,åšå®¢æ ¼å¼æœ‰é—®é¢˜ï¼Œè¿™é‡Œæ‰“ä¸­æ–‡çš„ä»£æ›¿ï¼‰éƒ½æ˜¯ç”¨æ¥ä½œå‘½ä»¤æ›¿æ¢çš„ã€‚å‘½ä»¤æ›¿æ¢ä¸å˜é‡æ›¿æ¢å·®ä¸å¤šï¼Œéƒ½æ˜¯ç”¨æ¥é‡ç»„å‘½ä»¤è¡Œçš„ï¼Œå…ˆå®Œæˆå¼•å·é‡Œçš„å‘½ä»¤è¡Œï¼Œç„¶åå°†å…¶ç»“æœæ›¿æ¢å‡ºæ¥ï¼Œå†é‡ç»„æˆæ–°çš„å‘½ä»¤è¡Œã€‚\n$ echo today is $(date \u0026quot;+%Y-%m-%d\u0026quot;) today is 2021-08-01 åœ¨å¤šå±‚æ¬¡çš„å¤åˆæ›¿æ¢ä¸­ï¼Œï½€ï½€å¿…é¡»è¦é¢å¤–çš„è·³è„±å¤„ç†ï¼ˆåæ–œçº¿ï¼‰ï¼Œè€Œ$( )æ¯”è¾ƒç›´è§‚ã€‚ æœ€åï¼Œ$( )çš„å¼Šç«¯æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç±»unixç³»ç»Ÿéƒ½æ”¯æŒè¿™ç§æ–¹å¼ï¼Œä½†åå¼•å·æ˜¯è‚¯å®šæ”¯æŒçš„ã€‚\n# å°†cmd1æ‰§è¡Œç»“æœä½œä¸ºcmd2å‚æ•°ï¼Œå†å°†cmd2ç»“æœä½œä¸ºcmd3çš„å‚æ•° cmd3 $(cmd2 $(cmd1)) # å¦‚æœæ˜¯ç”¨åå¼•å·ï¼Œç›´æ¥å¼•ç”¨æ˜¯ä¸è¡Œçš„ï¼Œè¿˜éœ€è¦ä½œè·³è„±å¤„ç† cmd3 `cmd2 \\`cmd1\\`` trap è¯¦ç»†trapä»‹ç»\nåœ¨shellä¸­ï¼Œä½¿ç”¨å†…ç½®å‘½ä»¤trap(ä¸­æ–‡å°±ç¿»è¯‘ä¸ºé™·é˜±ã€åœˆå¥—)ä¹Ÿå¯ä»¥å¸ƒç½®æ‰€è°“çš„é™·é˜±ï¼Œè¿™ä¸ªé™·é˜±å½“ç„¶ä¸æ˜¯æ•è€é¼ çš„ï¼Œè€Œæ˜¯æ•æ‰ä¿¡å·ã€‚\né€šå¸¸trapéƒ½åœ¨è„šæœ¬ä¸­ä½¿ç”¨ï¼Œä¸»è¦æœ‰2ç§åŠŸèƒ½ï¼š\n(1).å¿½ç•¥ä¿¡å·ã€‚å½“è¿è¡Œä¸­çš„è„šæœ¬è¿›ç¨‹æ¥æ”¶åˆ°æŸä¿¡å·æ—¶(ä¾‹å¦‚è¯¯æŒ‰äº†CTRL+C)ï¼Œå¯ä»¥å°†å…¶å¿½ç•¥ï¼Œå…å¾—è„šæœ¬æ‰§è¡Œåˆ°ä¸€åŠå°±è¢«ç»ˆæ­¢ (2).æ•æ‰åˆ°ä¿¡å·ååšç›¸åº”å¤„ç†ã€‚ä¸»è¦æ˜¯æ¸…ç†ä¸€äº›è„šæœ¬åˆ›å»ºçš„ä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åé€€å‡º\nè¿›ç¨‹ç»“æŸä¸´æ—¶æ–‡ä»¶é”€æ¯ç¤ºä¾‹\n# XXXä¼šè¢«éšå³å­—ç¬¦ä»£æ›¿ä¿è¯å”¯ä¸€ï¼Œ-dç”Ÿæˆç›®å½•ï¼Œ-tè¡¨ç¤ºç”Ÿæˆåœ¨/tempä¸­ï¼Œ # è„šæœ¬ä¸´æ—¶æ–‡ä»¶å…¨éƒ¨å­˜åœ¨æ­¤å¤„ï¼Œç¨‹åºæ•è·åˆ°EXITåæ‰§è¡Œfinishåˆ é™¤ä¸´æ—¶æ–‡ä»¶å¤¹ scratch=$(mktemp -d -t coretmp.XXX) function finish { rm -rf \u0026quot;$scratch\u0026quot; } trap finish EXIT è°ƒç”¨core apiç¤ºä¾‹ awk grep sed æ˜¯å¤„ç†æ–‡æœ¬çš„ä¸‰å¤§åˆ©å™¨ï¼Œåé¢ç¤ºä¾‹ç”¨åˆ°äº†ç”¨åˆ°äº†awkï¼Œç›´æ¥å°†å…¶è¿”å›ä¸€ä¸ªå˜é‡ä¼šä¼ è¾“åˆ°æ•°ç»„ä¸­ã€‚\n#!/bin/bash scratch=$(mktemp -d -t coretmp.XXX) function finish { rm -rf \u0026quot;$scratch\u0026quot; } trap finish EXIT function ApiCall { local nodeId=$1; local cmd=$2; # teeä¸€è¾¹é‡å®šå‘åˆ°æ–‡ä»¶ä¸€è¾¹æ‰“å°ï¼Œé˜²æ­¢ç­‰å¾…responseå¡æ­»ï¼Œä¹Ÿæ–¹ä¾¿æ‰“å°æŠ¥é”™ä¿¡æ¯ coresendmsg execute flags=tty node=$nodeId number=1001 command=\u0026quot;$cmd\u0026quot; -l | tee $scratch/core_msg res=$(awk -F ': ' '{if($1 ~ /RESULT/) print $2}' $scratch/core_msg) if [ \u0026quot;$res\u0026quot; == \u0026quot;\u0026quot; ]; then exit 0 else echo -e \u0026quot;excute core api command: \\n$res\\n\u0026quot; fi eval $res } function SetMap { file=$1 Mymap=$2 local IdArry=(`awk '$1==\u0026quot;node\u0026quot; {print $2}' $file`) local NameArry=(`awk '$1==\u0026quot;hostname\u0026quot; {print $2}' $file`) for i in ${!IdArry[@]} do Mymap[${NameArry[i]}]=${IdArry[i]:1} done # echo ${!Mymap[@]} ${Mymap[@]} } # é»˜è®¤å‘½ä»¤ã€åœºæ™¯æ–‡ä»¶å‚æ•° nodeId='1' protocol='icmp' interface='eth0' imnPwd=$(echo $HOME/.core/configs/) scene='sample1' declare -A Mymap # è¯»å–å‚æ•° if [ $# == 0 ]; then echo -e \u0026quot;The required parameters are imn scenario name and node name\\n\\ When \\$3 is CMD, \\$4 is the command to execute... Otherwise, \\$3 indicates the NIC ID and \\$4 indicates the packet capture protocol (optional).\\n\\ !! default: nodename=n1, interface=$interface, protocol=$protocol(options) !! sense file: echo $imnPwd$scene.imn\u0026quot; else scene=$1 file=$(echo $imnPwd$scene.imn) echo -e \u0026quot;sense file: $file\u0026quot; SetMap $file ${Mymap[*]} # echo \u0026quot;åœºæ™¯èŠ‚ç‚¹å: ${!Mymap[@]} \\n åœºæ™¯èŠ‚ç‚¹id: ${Mymap[@]}\u0026quot; nodeId=${Mymap[$2]} interface=$3 protocol=$4 if [ ! -n \u0026quot;$nodeId\u0026quot; ]; then echo \u0026quot;node name error!\u0026quot; exit 0 fi fi if [ \u0026quot;$3\u0026quot; == \u0026quot;cmd\u0026quot; ] ; then ApiCall $nodeId \u0026quot;$4\u0026quot; elif [ $# -ge 3 ] || [ $# == 0 ]; then cmd=$(echo tcpdump $protocol -i $interface -l) ApiCall $nodeId \u0026quot;$cmd\u0026quot; else echo \u0026quot;Invalid input parameter\u0026quot; exit 0 fi ","id":24,"section":"posts","summary":"shellè„šæœ¬åœ¨linuxä½¿ç”¨ç”¨çš„ååˆ†å¹¿æ³›ï¼Œå†™ç¯‡æ€»ç»“å­¦ä¹ æ€§çš„æ–‡ç« åšè®°å½•ã€‚ è¿™ä¸ªè¿ç»´æ‰‹å†Œå†™çš„æ¯”è¾ƒè¯¦ç»†ï¼Œå¯ä»¥åšå‚è€ƒã€‚ å¦ä¸€ä¸ªæ¯”è¾ƒå…¨çš„å‚è€ƒ åŸºæœ¬è¯­æ³• if e","tags":["linux"],"title":"SHELLè„šæœ¬è¯­æ³•ç¤ºä¾‹","uri":"https://liangkang233.github.io/2021/08/shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/","year":"2021"},{"content":"åŸºç¡€å¤ªè–„å¼±ï¼Œæœ€è¿‘åšä¸€ä¸ªå…³äºä¸»æœºè·¯ç”±è½¬å‘çš„ä¸œè¥¿æŠ˜è…¾äº†æŒºä¹…ã€‚åšä¸ªè®°å½• ğŸ˜•\né»˜è®¤ç½‘å…³ã€è·¯ç”± åŒºåˆ« ä¸¤è€…å…¶å®æ˜¯ä¸€ç±»åŠŸèƒ½ï¼Œåœ¨ä¸åŒåº”ç”¨çš„äº§ç”Ÿçš„ä¸åŒå«æ³•ã€‚\nå†…ç½‘ä¸»æœºå‘å…¬ç½‘å‘é€æ•°æ®åŒ…æ—¶ï¼Œç”±äºç›®çš„ä¸»æœºè·Ÿæºä¸»æœºä¸åœ¨åŒä¸€ç½‘æ®µï¼Œæ‰€ä»¥æ•°æ®åŒ…æš‚æ—¶å‘å¾€å†…ç½‘é»˜è®¤ç½‘å…³å¤„ç†ï¼Œè€Œæœ¬ç½‘æ®µçš„ä¸»æœºå¯¹æ­¤æ•°æ®åŒ…ä¸åšä»»ä½•å›åº”ã€‚\nç”±äºæºä¸»æœºipæ˜¯ç§æœ‰çš„ï¼Œç¦æ­¢åœ¨å…¬ç½‘ä½¿ç”¨ï¼Œæ‰€ä»¥å¿…é¡»å°†æ•°æ®åŒ…çš„æºå‘é€åœ°å€ä¿®æ”¹æˆå…¬ç½‘ä¸Šçš„å¯ç”¨ipï¼Œè¿™å°±æ˜¯ç½‘å…³æ”¶åˆ°æ•°æ®åŒ…ä¹‹åé¦–å…ˆè¦åšçš„å·¥ä½œ\u0026ndash;ipè½¬æ¢ã€‚\nç„¶åç½‘å…³å†æŠŠæ•°æ®åŒ…å‘å¾€ç›®çš„ä¸»æœºã€‚ç›®çš„ä¸»æœºæ”¶åˆ°æ•°æ®åŒ…ä¹‹åï¼Œåªè®¤ä¸ºè¿™æ˜¯ç½‘å…³å‘é€çš„è¯·æ±‚ï¼Œå¹¶ä¸çŸ¥é“å†…ç½‘ä¸»æœºçš„å­˜åœ¨ï¼Œä¹Ÿæ²¡å¿…è¦çŸ¥é“ï¼Œç›®çš„ä¸»æœºå¤„ç†å®Œè¯·æ±‚ï¼ŒæŠŠå›åº”ä¿¡æ¯å‘è¿˜ç»™ç½‘å…³ã€‚ç½‘å…³æ”¶åˆ°åï¼Œå°†ç›®çš„ä¸»æœºå‘è¿˜çš„æ•°æ®åŒ…çš„ç›®çš„ipåœ°å€ä¿®æ”¹ä¸ºå‘å‡ºè¯·æ±‚çš„å†…ç½‘ä¸»æœºçš„ipåœ°å€ï¼Œå¹¶å°†å…¶å‘ç»™å†…ç½‘ä¸»æœºã€‚\nè¿™å°±æ˜¯ç½‘å…³çš„ç¬¬äºŒä¸ªå·¥ä½œ\u0026ndash;æ•°æ®åŒ…çš„è·¯ç”±è½¬å‘ã€‚å†…ç½‘çš„ä¸»æœºåªè¦æŸ¥çœ‹æ•°æ®åŒ…çš„ç›®çš„ipä¸å‘é€è¯·æ±‚çš„æºä¸»æœºipåœ°å€ç›¸åŒï¼Œå°±ä¼šå›åº”ï¼Œè¿™å°±å®Œæˆäº†ä¸€æ¬¡è¯·æ±‚ã€‚ å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒLinuxç³»ç»Ÿé»˜è®¤æ˜¯ç¦æ­¢æ•°æ®åŒ…è½¬å‘çš„ã€‚æ‰€è°“è½¬å‘å³å½“ä¸»æœºæ‹¥æœ‰å¤šäºä¸€å—çš„ç½‘å¡æ—¶ï¼Œå…¶ä¸­ä¸€å—æ”¶åˆ°æ•°æ®åŒ…ï¼Œæ ¹æ®æ•°æ®åŒ…çš„ç›®çš„ipåœ°å€å°†åŒ…å‘å¾€æœ¬æœºå¦ä¸€ç½‘å¡ï¼Œè¯¥ç½‘å¡æ ¹æ®è·¯ç”±è¡¨ç»§ç»­å‘é€æ•°æ®åŒ…ã€‚è¿™é€šå¸¸å°±æ˜¯è·¯ç”±å™¨æ‰€è¦å®ç°çš„åŠŸèƒ½ã€‚\nåœºæ™¯ä»‹ç» ä»¥ä¸‹å›¾ä¸ºä¾‹\nä¸€å…±æœ‰ä¸‰ä¸ªåœºæ™¯ï¼š\nåœºæ™¯ä¸€ï¼šå³ä¸Šè§’ä¸ºè·¯ç”±å™¨åšè½¬å‘æ— éœ€ä»»ä½•é…ç½®çš„å±€åŸŸç½‘ï¼Œ\nåœºæ™¯äºŒï¼šå…¶ä¸‹ä¸ºä¸‰å°ä¸»æœºåˆ†åˆ«æ¡¥æ¥çš„å±€åŸŸç½‘ï¼Œå…¶ä¸­n10å·¦å³æ¡¥æ¥çš„ä¸¤ä¸ªç½‘å¡å¯¹åº”ä¸¤ä¸ªç½‘æ®µï¼Œn10åšè·¯ç”±è½¬å‘\nåœºæ™¯ä¸‰ï¼š å·¦è¾¹çš„åœºæ™¯ä¸ºä¸Šæ–¹æ¡¥æ¥å±€åŸŸç½‘ä¸ä¸‹æ–¹æ¡¥æ¥å±€åŸŸç½‘é€šè¿‡ä¸­é—´ä¸¤å°æœºå™¨çš„æ— çº¿äº’ç›¸è½¬å‘è·¯ç”±\né…ç½®ä¸»æœºè·¯ç”±è½¬å‘ Linuxç³»ç»Ÿç¼ºçœå¹¶æ²¡æœ‰æ‰“å¼€IPè½¬å‘åŠŸèƒ½ï¼Œè¦ç¡®è®¤IPè½¬å‘åŠŸèƒ½çš„çŠ¶æ€ï¼Œå¯ä»¥æŸ¥çœ‹/procæ–‡ä»¶ç³»ç»Ÿï¼Œ ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼š cat /proc/sys/net/ipv4/ip_forward æŸ¥çœ‹æ˜¯å¦å¼€å¯\nåœ¨æµ‹è¯•ä¸­æ˜¯n10 n1 n4 éƒ½å¼€å¯äº†IP forward\nè¿™é‡Œé‡‡ç”¨coreä»¿çœŸçš„é…ç½®æ¥è®¾å®šè½¬å‘\n# auto-generated by IPForward service (utility.py) sysctl -w net.ipv4.conf.all.forwarding=1 sysctl -w net.ipv4.conf.default.forwarding=1 sysctl -w net.ipv6.conf.all.forwarding=1 sysctl -w net.ipv6.conf.default.forwarding=1 sysctl -w net.ipv4.conf.all.send_redirects=0 sysctl -w net.ipv4.conf.default.send_redirects=0 sysctl -w net.ipv4.conf.all.rp_filter=0 sysctl -w net.ipv4.conf.default.rp_filter=0 sysctl -w net.ipv4.conf.eth0.forwarding=1 sysctl -w net.ipv4.conf.eth0.send_redirects=0 sysctl -w net.ipv4.conf.eth0.rp_filter=0 sysctl -w net.ipv4.conf.eth1.forwarding=1 sysctl -w net.ipv4.conf.eth1.send_redirects=0 sysctl -w net.ipv4.conf.eth1.rp_filter=0 é…ç½®åä¸»æœºå°±å¼€å¯äº†ä¸Šé¢è·¯ç”±å™¨é»˜è®¤å¼€å¯çš„è·¯ç”±è½¬å‘æœåŠ¡ï¼ˆip_forwardï¼‰\né…ç½®è½¬å‘ç½‘å…³è·¯ç”± ç»è¿‡å¤šæ¬¡æµ‹è¯•ï¼Œå‘ç°ä¸€ç›´é’»äº†æ­»èƒ¡åŒï¼Œåªé…ä¸­è½¬çš„è·¯ç”±è€Œä¸æ˜¯ç½‘å…³è·¯ç”±æ‰€ä»¥æ²¡æœ‰å°†è·¯ç”±è½¬å‘å‡ºå»ã€‚æŠ“n10åŒ…åªæœ‰ä¸€ç«¯æœ‰æ•°æ®ï¼Œè¿˜ä»¥ä¸ºæ˜¯ç½‘å¡è½¬å‘æœªå¼€å¯æˆåŠŸã€‚\né”™è¯¯å¤ç›˜ï¼š åœºæ™¯äºŒèŠ‚ç‚¹ n6 n7é…é»˜è®¤è·¯ç”±éƒ½æ˜¯æŒ‡å‘è‡ªå·±çš„ç½‘å¡ï¼Œä»¥ä¸ºåªè¦é…n10çš„è·¯ç”±è½¬å‘å°±èƒ½æ­£ç¡®ä¼ è¾“ã€‚ å³åœ¨n10è®¾å®šå³è¾¹ç½‘å¡æ”¶åˆ°çš„10.0.0.0/24ç½‘æ®µå…¨ç”±å·¦ç½‘å¡å‡ºå»ï¼Œå·¦ç½‘å¡æ”¶åˆ°çš„10.0.2.0/24ç”±å³è¾¹ç½‘å¡å‘å‡ºã€‚ è¿™æ ·æ˜¯æ— æ³•é€šè¿‡æµ‹è¯•çš„ã€‚ å¯¹äºèŠ‚ç‚¹n6ï¼Œåªé…é»˜è®¤è·¯ç”±åˆ°æœ¬åœ°ç½‘å¡10.0.2.20æ˜¯æ— æ³•è®©ä¸»æœºn10è½¬å‘è¯¥æ•°æ®çš„ï¼Œåº”è¯¥é…n6è·¯ç”±ä¸ºä¸‹ä¸€è·³ç½‘å…³ã€‚ n10æ— éœ€é…ç½®è·¯ç”±åªè¦å¼€ipè½¬å‘å³å¯ã€‚ å…¶å®ä»”ç»†æƒ³æƒ³ï¼Œæœ¬åœ°è·¯ç”±åªæ˜¯é’ˆå¯¹å½“å‰ç½‘æ®µå±€åŸŸç½‘å†…çš„è½¬å‘ï¼Œè·¨ç½‘æ®µä¼šæ‰¾ä¸åˆ°è·¯ç›´æ¥ä¸¢å¼ƒåŒ…çš„ è·¯ç”±é…ç½®æ–¹æ³•ï¼Œç»Ÿä¸€ä½¿ç”¨ ip routeï¼Œrouteå‘½ä»¤å½“ç„¶ä¹Ÿå¯é…ç½®ï¼Œä¸æ¨èã€‚\nåœ¨åœºæ™¯2ä¸­\n# (ç½‘å…³ipè¦ä¸ºä¸‹ä¸€è·³åœ°å€) # é…ç½®åˆ°ç½‘æ®µçš„é™æ€è·¯ç”± ip route add 10.0.2.20/24 via 10.0.0.20 # é…ç½®ç‰¹å®šåˆ°ç‰¹å®šä¸»æœºçš„ç½‘å…³/è·¯ç”± ip route add ip ç›®æ ‡ä¸»æœº via ç½‘å…³ # é…ç½®é»˜è®¤ç½‘å…³/è·¯ç”± ip route add default via 10.0.2.21 åœ¨åœºæ™¯3ä¸­ï¼Œç±»æ¯”åœºæ™¯2\nåˆ†åˆ«é…ç½® n2 -\u0026gt; n4 n4 -\u0026gt; n1 n1 -\u0026gt; n4 n11 -\u0026gt;n1 è¿™å››æ¡é»˜è®¤ç½‘å…³å³å¯ ","id":25,"section":"posts","summary":"åŸºç¡€å¤ªè–„å¼±ï¼Œæœ€è¿‘åšä¸€ä¸ªå…³äºä¸»æœºè·¯ç”±è½¬å‘çš„ä¸œè¥¿æŠ˜è…¾äº†æŒºä¹…ã€‚åšä¸ªè®°å½• ğŸ˜• é»˜è®¤ç½‘å…³ã€è·¯ç”± åŒºåˆ« ä¸¤è€…å…¶å®æ˜¯ä¸€ç±»åŠŸèƒ½ï¼Œåœ¨ä¸åŒåº”ç”¨çš„äº§ç”Ÿçš„ä¸åŒå«æ³•ã€‚ å†…ç½‘ä¸»æœº","tags":["Linux","network"],"title":"linuxé…ç½®ä¸»æœºè·¯ç”±è½¬å‘","uri":"https://liangkang233.github.io/2021/07/linux%E4%B8%BB%E6%9C%BA%E8%B7%AF%E7%94%B1%E8%BD%AC%E5%8F%91/","year":"2021"},{"content":" ç¬”è®°å®æ—¶æ›´æ–°ä¸­ã€‚ã€‚\nCoreã€Emane ä»‹ç» å®˜æ–¹æ–‡æ¡£\nä¸€å¥è¯æ¦‚æ‹¬: COREä¾§é‡äºæ¨¡æ‹Ÿå¦‚ç½‘ç»œå±‚ä¼ è¾“å±‚ã€ä¼šè¯å±‚å’Œåº”ç”¨å±‚ï¼Œæä¾›äº†ç”¨æˆ·æ„å»ºè™šæ‹Ÿç½‘ç»œçš„å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼›åœ¨ä¸€å°æˆ–å¤šå°è®¡ç¬¦æœºä¸Šè¿›è¡Œç½‘ç»œæ¨¡æ‹Ÿçš„å·¥å…·ï¼Œå®æ—¶è¿è¡Œçš„æ¨¡æ‹Ÿã€‚è¿™äº›æ¨¡æ‹Ÿçš„ç½‘ç»œå¯ä»¥å®æ—¶è¿æ¥åˆ°ç‰©ç†ç½‘ç»œå’Œè·¯ç”±å™¨ï¼Œå¯ä»¥åœ¨ä½¿ç”¨ç›¸å¯¹å»‰ä»·çš„ç¡¬ä»¶çš„å‰æä¸‹ï¼Œä¿è¯åœ¨æ¨¡æ‹Ÿç½‘ç»œä¸Šè¿è¡Œå®æ—¶çš„åº”ç”¨ç¨‹åºçš„çœŸå®æ€§ã€‚\nEMANEä¸»è¦é’ˆå¯¹ç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚å·¥ä½œï¼Œä¸ºæ¨¡æ‹Ÿé“¾è·¯å±‚å’Œç‰©ç†å±‚çš„æ— çº¿ç½‘ç»œæä¾›äº†å¿…éœ€çš„å¯æ’æ‹”æ¡†æ¶ã€‚å…³äºç½‘ç»œå±‚è·¯ç”±åè®®å¯ä»¥é€‰ç”¨é€‚ç”¨ç§»åŠ¨è‡ªç»„ç½‘çš„ OSPF MDR åè®®ã€‚\nCore Coreæºç \né€šç”¨å¼€æ”¾å¼ç ”ç©¶ä»¿çœŸå™¨ï¼ˆCommon Open Research Emulatorï¼‰æ˜¯ä¸€ç§æ„å»ºè™šæ‹Ÿç½‘ç»œçš„å·¥å…·ã€‚ä½œä¸ºæ¨¡æ‹Ÿå™¨ï¼ŒCORE æ„å»ºäº†å®æ—¶è¿è¡Œçš„çœŸå®è®¡ç®—æœºç½‘ç»œçš„è¡¨ç¤ºï¼Œè€Œä¸æ˜¯ä½¿ç”¨æŠ½è±¡æ¨¡å‹çš„æ¨¡æ‹Ÿã€‚å®æ—¶è¿è¡Œçš„ä»¿çœŸå¯ä»¥è¿æ¥åˆ°ç‰©ç†ç½‘ç»œå’Œè·¯ç”±å™¨ã€‚å®ƒæä¾›äº†è¿è¡ŒçœŸå®åº”ç”¨ç¨‹åºå’Œåè®®çš„ç¯å¢ƒï¼Œåˆ©ç”¨äº† Linux æ“ä½œç³»ç»Ÿæä¾›çš„å·¥å…·ã€‚\nCORE é€šå¸¸ç”¨äºç½‘ç»œå’Œåè®®ç ”ç©¶ã€æ¼”ç¤ºã€åº”ç”¨ç¨‹åºå’Œå¹³å°æµ‹è¯•ã€è¯„ä¼°ç½‘ç»œåœºæ™¯ã€å®‰å…¨ç ”ç©¶ä»¥åŠå¢åŠ ç‰©ç†æµ‹è¯•ç½‘ç»œçš„è§„æ¨¡ã€‚\nä»¥ä¸‹æ‰€æœ‰è®°å½•åŸºäº coreç‰ˆæœ¬ 7.5.1 Ubuntu20.4ç³»ç»Ÿæµ‹è¯•\nä¸»é¢˜ æè¿° æ€»ç»“æˆ–ç¿»è¯‘ Architecture ä½“ç³»ç»“æ„æ¦‚è¿°ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨Pythonã€gRPCç›´æ¥æ§åˆ¶Core æ¶æ„ Installation COREçš„å®‰è£…æ–¹æ³•åŠè¦æ±‚ ç¯å¢ƒæ­å»º GUI å¦‚ä½•ä½¿ç”¨GUI ç•Œé¢æ•™ç¨‹ Node Types COREæ”¯æŒçš„èŠ‚ç‚¹ç±»å‹æ¦‚è¿° èŠ‚ç‚¹ç±»å‹ (BETA) Python GUI å¦‚ä½•ä½¿ç”¨åŸºäºPythonçš„BETA GUI Python API ä»‹ç»å¦‚ä½•ä½¿ç”¨Pythonç›´æ¥æ§åˆ¶Core (è‡ªå·±å®ç°core-daemon) Python API gRPC API ä»‹ç»å¦‚ä½•ä½¿ç”¨gRPCæ§åˆ¶Core (è¿æ¥core-daemon è°ƒç”¨å…¶api) gRPC API Distributed åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šè¿è¡ŒCOREçš„åˆ†å¸ƒå¼ç»†èŠ‚ åˆ†å¸ƒå¼ CTRLNET å¦‚ä½•æ§åˆ¶ç½‘ç»œä»ä¸»æœºä¸èŠ‚ç‚¹é€šä¿¡ æ§åˆ¶ç½‘ç»œ Services æ¦‚è¿°æ‰€æä¾›çš„æœåŠ¡å¹¶åˆ›å»ºè‡ªå®šä¹‰æœåŠ¡ æœåŠ¡é…ç½® Performance ä½¿ç”¨COREæ—¶çš„æ€§èƒ½è¯´æ˜ Core æ€§èƒ½åˆ†æ Developers Guide æ¦‚è¿°å¦‚ä½•å¯¹COREå¼€å‘ Core å¼€å‘ç›¸å…³ Core Emane COREä¸­è¿è¡Œå’Œä½¿ç”¨EMANEçš„é«˜çº§ä¸»é¢˜å’Œç¤ºä¾‹ Emane Emaneå¼€å‘æ‰‹å†Œ Emaneçš„æ¶æ„ä»‹ç» å¼€å‘ç›¸å…³ Emaneæ¨¡å‹è°ƒç ” ç»‘å®šSDT-3Dåˆ°coreä»¿çœŸä¸­ï¼Œæºç  SDT 3Då®‰è£… Core å¸¸è§é—®é¢˜ åŸºç¡€å†…å®¹å­¦ä¹  TLVç¼–ç æ ¼å¼è¯¦è§£\näº†è§£ gRPCåè®®\nä»€ä¹ˆæ˜¯GREéš§é“\nOSPF MDR OSPFå³å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆ(Open Shortest Path First)æ˜¯ä¸ºæœ‰çº¿ç½‘ç»œè®¾è®¡çš„æ ‡å‡†è·¯ç”±åè®®ã€‚\næ¯ä¸ªè‡ªæ²»ç³»ç»ŸASï¼ˆAutonomous Systemï¼‰å†…éƒ¨çš„è·¯ç”±é€‰è·¯åè®®ï¼Œä½äºç½‘ç»œå±‚ã€‚\nOSPF MDRå³OSPFæŒ‡å®šè·¯ç”±å™¨ç§»åŠ¨è‡ªç»„ç½‘åè®®ï¼ˆOSPF MANET Designated Routersï¼‰ä¹Ÿæ˜¯ç¾å›½æµ·å†›ç ”ç©¶å®éªŒå®¤(NRL)å¼€å‘ï¼Œå…¶æºç åœ¨è¿™å¯ä»¥æ‰¾åˆ°ã€‚Quagga ä¸­OSPFv3çš„OSPF MDRæ˜¯ä¾ç…§ç§»åŠ¨è‡ªç»„ç»‡ç½‘ç»œ(MANETs: Mobile Ad Hoc Networks)ä¸­æœ‰æ•ˆè·¯ç”±çš„ RFC 5614 (OSPF MDR), RFC 5243 (OSPF Database Exchange Optimization), å’Œ RFC 5838 (OSPFv3 Address Families)æ¥å®ç°çš„ã€‚\nè¯¥è½¯ä»¶åŸºäºå¼€æºçš„Quaggaè·¯ç”±å¥—ä»¶ï¼Œæœ€åˆç”±Richard Ogierå’Œæ³¢éŸ³å¹»å½±å·¥ç¨‹å…¬å¸å¼€å‘ï¼Œç°åœ¨ç”±NRLçš„ç§»åŠ¨è·¯ç”±é¡¹ç›®ç»´æŠ¤ã€‚\nLinuxåŸºç¡€ç½‘ç»œè®¾å¤‡è¯¦è§£ï¼šCoreçš„é“¾è·¯å®ç°å°±æ˜¯ä¾èµ–è¿™äº›è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œåˆ©ç”¨Linuxå‘½åç©ºé—´ç‰¹æ€§åˆ›å»ºå„ä¸ªç‹¬ç«‹çš„è™šæ‹ŸèŠ‚ç‚¹ã€‚\nCore å¼€å‘ç›¸å…³ æºç æ¦‚è¿° ç”±äºå†å²åŸå› ï¼ŒCOREæºä»£ç ç”±å‡ ç§ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ç»„æˆã€‚ç›®å‰çš„å¼€å‘é‡ç‚¹æ˜¯Pythonæ¨¡å—å’Œå®ˆæŠ¤è¿›ç¨‹ã€‚ä¸‹é¢æ˜¯æºç›®å½•çš„ç®€è¦æè¿°ã€‚(netns = network nodes)\nç›®å½• æè¿° daemon å¤„ç†æ¥æ”¶APIè°ƒç”¨å’Œåˆ›å»ºå®¹å™¨çš„Python CORE daemonï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰ä»£ç  docs æ‰˜ç®¡åœ¨GitHubä¸Šçš„ä½¿ç”¨æ–‡æ¡£ gui Tcl/Tk GUI man ä¸ºå„ç§COREå‘½ä»¤è¡Œå®ç”¨ç¨‹åºåˆ›å»ºæ‰‹å†Œé¡µçš„æ¨¡æ¿æ–‡ä»¶ netns ç”¨äºåˆ›å»ºCOREå®¹å™¨çš„Cç¨‹åº å…¶åˆ‡æ¢å¼€å‘ç‰ˆæœ¬åˆ†æ”¯\ngit clone https://github.com/coreemu/core.git cd core git checkout develop å®‰è£…å¼€å‘ç¯å¢ƒ æ­¤å‘½ä»¤å°†è‡ªåŠ¨å®‰è£…ç³»ç»Ÿä¾èµ–é¡¹ã€å…‹éš†å’Œæ„å»º OSPF-MDR, æ­å»ºCORE, è®¾ç½®CORE poetry ç¯å¢ƒ, ç„¶åå®‰è£… pre-commit hooks.æ‚¨å¯ä»¥å‚è€ƒinstall docsæ¥äº†è§£ä¸åŒå‘è¡Œç‰ˆçš„ç›¸å…³é—®é¢˜ã€‚\n./install -d å…¶ä¸­pre-commitå¸®åŠ©è‡ªåŠ¨è¿è¡Œå·¥å…·æ£€æŸ¥ä¿®æ”¹çš„ä»£ç ã€‚æ¯æ¬¡æäº¤æ—¶ï¼Œéƒ½ä¼šè¿è¡Œpythonå®ç”¨ç¨‹åºæ¥æ£€æŸ¥ä»£ç çš„æœ‰æ•ˆæ€§ï¼Œå¯èƒ½ä¼šå¤±è´¥å¹¶é€€å‡ºæäº¤ã€‚è¿™äº›æ›´æ”¹ç›®å‰æ˜¯ä½œä¸ºå½“å‰CIçš„ä¸€éƒ¨åˆ†å¼ºåˆ¶æ‰§è¡Œçš„ï¼Œå› æ­¤æ·»åŠ æ›´æ”¹å¹¶å†æ¬¡æäº¤ã€‚\nè¿è¡Œcore æ‚¨ç°åœ¨å¯ä»¥åƒå¹³å¸¸ä¸€æ ·è¿è¡Œcoreï¼Œæˆ–è€…åˆ©ç”¨ä¸€äº›è°ƒç”¨ä»»åŠ¡æ¥æ–¹ä¾¿åœ°è¿è¡Œæµ‹è¯•ç­‰ã€‚\n# run core-daemon sudo core-daemon # run python gui core-pygui # run tcl gui core-gui # run mocked å•å…ƒæµ‹è¯• cd \u0026lt;CORE_REPO\u0026gt; inv test-mock å®¹å™¨å‘½ä»¤ Linux namespace containersé€šå¸¸ä½¿ç”¨Linuxå®¹å™¨å·¥å…·æˆ–lxc-toolsåŒ…è¿›è¡Œç®¡ç†ã€‚lxc-toolsç½‘ç«™å¯åœ¨è¿™é‡Œhttp://lxc.sourceforge.net/è·å¾—æ›´å¤šä¿¡æ¯ã€‚COREä¸ä½¿ç”¨è¿™äº›ç®¡ç†coreå®ç”¨å·¥å…·(utilities)ï¼Œcoreè‡ªå·±å®ç°äº†ä¸€ç»„ç”¨äºå®ä¾‹åŒ–å’Œé…ç½®ç½‘ç»œåç§°ç©ºé—´å®¹å™¨çš„å·¥å…·ã€‚è¿™äº›å·¥å…·å¤§ä½“åˆ†ä¸ºï¼š\nvnoded (Virtual nodes daemon )\nvnoded daemonæ˜¯ç”¨äºåˆ›å»ºæ–°åç§°ç©ºé—´çš„ç¨‹åºï¼Œå¹¶åœ¨æ§åˆ¶é€šé“ä¸Šä¾¦å¬å¯èƒ½å®ä¾‹åŒ–å…¶ä»–è¿›ç¨‹çš„å‘½ä»¤ã€‚è¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹åœ¨å®¹å™¨ä¸­ä½œä¸ºPID 1è¿è¡Œã€‚å®ƒç”±COREå®ˆæŠ¤è¿›ç¨‹è‡ªåŠ¨å¯åŠ¨ã€‚æ§åˆ¶é€šé“æ˜¯UNIXåŸŸå¥—æ¥å­—ï¼Œé€šå¸¸å‘½åä¸º/tmp/pycoreã€‚å¯¹äºè¿è¡Œåœ¨COREä¼šè¯23098ä¸Šçš„èŠ‚ç‚¹3ï¼Œä¾‹å¦‚:23098/n3ã€‚åˆ›å»ºä¸€ä¸ªæ–°çš„å‘½åç©ºé—´éœ€è¦Rootç‰¹æƒã€‚\nvcmd (Virtual cmd )\nvcmdç¨‹åºç”¨äºè¿æ¥Linuxç½‘ç»œå‘½åç©ºé—´ä¸­çš„vnodedï¼Œç”¨äºè¿è¡Œå‘½åç©ºé—´å®¹å™¨ä¸­çš„å‘½ä»¤ã€‚COREå®ˆæŠ¤è¿›ç¨‹ä½¿ç”¨ç›¸åŒçš„é€šé“è®¾ç½®èŠ‚ç‚¹å¹¶åœ¨å…¶ä¸­è¿è¡Œè¿›ç¨‹ã€‚è¿™ä¸ªç¨‹åºæœ‰ä¸¤ä¸ªå¿…éœ€çš„å‚æ•°ï¼Œæ§åˆ¶é€šé“åå’Œè¦åœ¨å‘½åç©ºé—´ä¸­è¿è¡Œçš„å‘½ä»¤è¡Œã€‚è¯¥å‘½ä»¤ä¸éœ€è¦ä»¥rootæƒé™è¿è¡Œã€‚\nå½“ä½ åœ¨è¿è¡Œæ¨¡æ‹Ÿä¸­åŒå‡»ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼ŒCOREä¼šä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ‰“å¼€è¯¥èŠ‚ç‚¹çš„shellçª—å£:\ngnome-terminal -e vcmd -c /tmp/pycore.50160/n1 -- bash ç±»ä¼¼åœ°ï¼ŒIPv4è·¯ç”±è§‚å¯Ÿè€…å°éƒ¨ä»¶å°†è¿è¡Œä¸€ä¸ªå‘½ä»¤æ¥æ˜¾ç¤ºè·¯ç”±è¡¨ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤:\nvcmd -c /tmp/pycore.50160/n1 -- /sbin/ip -4 ro core-cleanup è„šæœ¬\næä¾›äº†ä¸€ä¸ªåä¸º core-cleanup çš„è„šæœ¬æ¥æ¸…ç†ä»»ä½•æ­£åœ¨è¿è¡Œçš„COREä»¿çœŸã€‚å®ƒå°†è¯•å›¾æ€æ­»ä»»ä½•å‰©ä½™çš„vnodedè¿›ç¨‹ï¼Œæ€æ­»ä»»ä½•EMANEè¿›ç¨‹ï¼Œåˆ é™¤ :file:/tmp/pycore.* ä¼šè¯ç›®å½•ã€‚åˆ é™¤ä»»ä½•bridgeæˆ–ebtablesè§„åˆ™ã€‚ä½¿ç”¨*-d*é€‰é¡¹ï¼Œå®ƒä¹Ÿå°†æ€æ­»ä»»ä½•æ­£åœ¨è¿è¡Œçš„COREå®ˆæŠ¤è¿›ç¨‹ã€‚\nnetns å‘½ä»¤\nCOREä¸ç›´æ¥ä½¿ç”¨netnså‘½ä»¤ã€‚æ­¤å®ç”¨ç¨‹åºå¯ç”¨äºåœ¨æ–°çš„ç½‘ç»œåç§°ç©ºé—´ä¸­è¿è¡Œå‘½ä»¤ï¼Œä»¥è¿›è¡Œæµ‹è¯•ã€‚å®ƒä¸ä¼šæ‰“å¼€ä¸€ä¸ªæ§åˆ¶é€šé“æ¥æ¥æ”¶è¿›ä¸€æ­¥çš„å‘½ä»¤ã€‚\nå…¶ä»–å¸¸ç”¨å‘½ä»¤\n# æŸ¥çœ‹Linuxç½‘æ¡¥é…ç½® ip link show type bridge # æŸ¥çœ‹æŸç½‘æ¡¥è¢«attachè®¾å¤‡ brctl show bridge_name # æŸ¥çœ‹ç”¨äºåº”ç”¨é“¾æ¥æ•ˆæœçš„netemè§„åˆ™ tc qdisc show # æŸ¥çœ‹ä½¿æ— çº¿å±€åŸŸç½‘å·¥ä½œçš„è§„åˆ™ ebtables -L Core æ€§èƒ½åˆ†æ å…³äºCOREæ€§èƒ½çš„é¦–è¦é—®é¢˜é€šå¸¸æ˜¯å®ƒèƒ½å¤„ç†å¤šå°‘ä¸ªèŠ‚ç‚¹?ç­”æ¡ˆå–å†³äºå‡ ä¸ªå› ç´ :\nå› ç´  æ€§èƒ½å½±å“ ç¡¬ä»¶ è®¡ç®—æœºä¸­å¤„ç†å™¨çš„æ•°é‡å’Œé€Ÿåº¦ã€å¯ç”¨çš„å¤„ç†å™¨ç¼“å­˜ã€RAMå†…å­˜å’Œå‰ç«¯æ€»çº¿é€Ÿåº¦å¯èƒ½ä¼šæå¤§åœ°å½±å“æ•´ä½“æ€§èƒ½ã€‚ ç³»ç»Ÿç‰ˆæœ¬ Linuxçš„å‘è¡Œå’Œæ‰€ä½¿ç”¨çš„ç‰¹å®šå†…æ ¸ç‰ˆæœ¬å°†å½±å“æ•´ä½“æ€§èƒ½ã€‚ æ´»åŠ¨è¿›ç¨‹ æ‰€æœ‰èŠ‚ç‚¹å…±äº«ç›¸åŒçš„CPUèµ„æºï¼Œå› æ­¤å¦‚æœä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹æ‰§è¡ŒCPUå¯†é›†å‹ä»»åŠ¡ï¼Œæ•´ä½“æ€§èƒ½å°†å—åˆ°å½±å“ã€‚ ç½‘ç»œæµé‡ åœ¨è™šæ‹Ÿç½‘ç»œä¸­å‘é€çš„æ•°æ®åŒ…è¶Šå¤šï¼ŒCPUä½¿ç”¨ç‡å°±è¶Šé«˜ã€‚ GUIä½¿ç”¨ å®šæœŸè¿è¡Œçš„å°éƒ¨ä»¶ã€ç§»åŠ¨åœºæ™¯å’Œå…¶ä»–GUIäº¤äº’é€šå¸¸ä¼šæ¶ˆè€—æ¨¡æ‹Ÿæ‰€éœ€çš„CPUå‘¨æœŸã€‚ åœ¨å…¸å‹çš„å•cpu 3.0GHz XeonæœåŠ¡å™¨ä¸Šï¼Œ2GB RAMè¿è¡ŒLinuxï¼Œæˆ‘ä»¬å‘ç°è¿è¡Œ30-75ä¸ªèŠ‚ç‚¹è¿è¡ŒOSPFv2å’ŒOSPFv3è·¯ç”±æ˜¯åˆç†çš„ã€‚åœ¨è¿™ä¸ªç¡¬ä»¶ä¸Šï¼ŒCOREå¯ä»¥å®ä¾‹åŒ–100ä¸ªæˆ–æ›´å¤šçš„èŠ‚ç‚¹ï¼Œä½†æ˜¯åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹åœ¨åšä»€ä¹ˆå°±å˜å¾—è‡³å…³é‡è¦äº†ã€‚\nå› ä¸ºè¿™ä¸ªè½¯ä»¶ä¸»è¦æ˜¯ä¸€ä¸ªç½‘ç»œæ¨¡æ‹Ÿå™¨ï¼Œæ‰€ä»¥æ›´åˆé€‚çš„é—®é¢˜æ˜¯å®ƒèƒ½å¤„ç†å¤šå°‘ç½‘ç»œæµé‡?åœ¨ä¸Šé¢æè¿°çš„3.0GHzæœåŠ¡å™¨ä¸Šï¼Œè¿è¡ŒLinuxï¼Œå¤§çº¦æ¯ç§’å¯ä»¥é€šè¿‡ç³»ç»Ÿæ¨é€30ä¸‡ä¸ªåŒ…ã€‚è·³æ•°å’ŒæŠ¥æ–‡å¤§å°ä¸é‚£ä¹ˆé‡è¦ã€‚é™åˆ¶å› ç´ æ˜¯æ“ä½œç³»ç»Ÿéœ€è¦å¤„ç†æ•°æ®åŒ…çš„æ¬¡æ•°ã€‚300,000ppsè¡¨ç¤ºç³»ç»Ÿä½œä¸ºä¸€ä¸ªæ•´ä½“éœ€è¦å¤„ç†ä¸€ä¸ªæ•°æ®åŒ…çš„æ¬¡æ•°ã€‚éšç€æ›´å¤šçš„ç½‘ç»œè·³æ•°çš„å¢åŠ ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ•°é‡ä¼šå¢åŠ ï¼Œå¹¶ä¸”ä¼šé™ä½æ•´ä¸ªç½‘ç»œè·¯å¾„ä¸Šçš„ååé‡ã€‚\næ³¨æ„: é—®é¢˜å…³é”®åœ¨äºæ˜¯èƒ½è·‘å¤šå°‘æµé‡? è€Œä¸æ˜¯å¤šå°‘èŠ‚ç‚¹\næœ‰å…³COREæ€§èƒ½çš„æ›´è¯¦ç»†ç ”ç©¶ï¼Œè¯·å‚é˜…ä»¥ä¸‹å‡ºç‰ˆç‰©:\nJ. Ahrenholz, T. Goff, and B. Adamson, Integration of the CORE and EMANE Network Emulators, Proceedings of the IEEE Military Communications Conference 2011, November 2011. Ahrenholz, J., Comparison of CORE Network Emulation Platforms, Proceedings of the IEEE Military Communications Conference 2010, pp. 864-869, November 2010. J. Ahrenholz, C. Danilov, T. Henderson, and J.H. Kim, CORE: A real-time network emulator, Proceedings of IEEE MILCOM Conference, 2008. èŠ‚ç‚¹ç±»å‹ COREä¸­å¯ä»¥é…ç½®ä¸åŒçš„èŠ‚ç‚¹ç±»å‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç±»å‹éƒ½è¡¨ç¤ºèŠ‚ç‚¹åœ¨è¿è¡Œæ—¶å°†å¦‚ä½•è¡¨ç¤ºçš„æœºå™¨ç±»å‹ã€‚ä¸åŒçš„æœºå™¨ç±»å‹å…è®¸ä¸åŒçš„é€‰æ‹©ã€‚\nNetns èŠ‚ç‚¹ netns(net nodes) ç±»å‹æ˜¯é»˜è®¤çš„èŠ‚ç‚¹ç±»å‹ï¼Œ è¿™æ˜¯ç”¨äºç”± Linux ç½‘ç»œå‘½åç©ºé—´æ”¯æŒçš„èŠ‚ç‚¹ã€‚è¿™ç§æœºå™¨ç±»å‹å¾ˆå°‘ä½¿ç”¨ç³»ç»Ÿèµ„æºæ¥æ¨¡æ‹Ÿç½‘ç»œã€‚è¿™è¢«æŒ‡å®šä¸ºé»˜è®¤æœºå™¨ç±»å‹çš„å¦ä¸€ä¸ªåŸå› æ˜¯ï¼Œæ­¤æŠ€æœ¯é€šå¸¸ä¸éœ€è¦æ›´æ”¹å†…æ ¸ï¼Œå®ƒå¯ä»æœ€æ–°çš„ä¸»æµLinuxå‘è¡Œç‰ˆä¸­å¼€ç®±å³ç”¨ã€‚\nç‰©ç† èŠ‚ç‚¹ physical æœºå™¨ç±»å‹ç”¨äºè¡¨ç¤ºçœŸæ­£çš„åŸºäºlinuxçš„æœºå™¨çš„èŠ‚ç‚¹ï¼Œè¿™äº›æœºå™¨å°†å‚ä¸æ¨¡æ‹Ÿçš„ç½‘ç»œåœºæ™¯ã€‚è¯¥èŠ‚ç‚¹é€šå¸¸ç”¨äºåˆå¹¶æ¥è‡ªæ¨¡æ‹Ÿæµ‹è¯•å¹³å°çš„æœåŠ¡å™¨æœºç»„ã€‚ç‰©ç†èŠ‚ç‚¹æ˜¯è¿è¡ŒCOREå®ˆæŠ¤è¿›ç¨‹(CORE-daemon)çš„èŠ‚ç‚¹ï¼Œå®ƒä¸ä¼šè¢«è¿›ä¸€æ­¥åˆ†åŒºåˆ°å®¹å™¨ä¸­ã€‚åœ¨ç‰©ç†èŠ‚ç‚¹ä¸Šè¿è¡Œçš„æœåŠ¡ä¸æ˜¯åœ¨ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œè€Œæ˜¯ç›´æ¥åœ¨æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œã€‚\nå¿…é¡»ç»™ç‰©ç†èŠ‚ç‚¹åˆ†é…æœåŠ¡å™¨ï¼Œä¸ä½¿ç”¨åˆ†å¸ƒå¼ä»¿çœŸï¼ˆDistributed Emulationï¼‰å°†èŠ‚ç‚¹åˆ†é…ä»¿çœŸæœåŠ¡å™¨çš„æ–¹å¼ç›¸åŒã€‚å¯ç”¨ç‰©ç†èŠ‚ç‚¹åˆ—è¡¨å½“å‰ä¸ä»¿çœŸæœåŠ¡å™¨å…±äº«åŒä¸€ä¸ªå¯¹è¯æ¡†å’Œåˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨Sessionèœå•ä¸­çš„emulation serversâ€¦æ¡ç›®è¿›è¡Œè®¿é—®ã€‚\nå¯¹ç‰©ç†èŠ‚ç‚¹çš„æ”¯æŒæ­£åœ¨å¼€å‘ä¸­ï¼Œå¹¶å¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¾—åˆ°æ”¹è¿›ã€‚ç›®å‰ï¼Œå½“ä»»ä½•èŠ‚ç‚¹è¿æ¥åˆ°ä¸€ä¸ªç‰©ç†èŠ‚ç‚¹æ—¶ï¼Œä¼šç”»ä¸€æ¡è™šçº¿æ¥è¡¨ç¤ºç½‘ç»œéš§é“ã€‚å°†åœ¨ç‰©ç†èŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªGREéš§é“æ¥å£ï¼Œç”¨äºéš§é“é€šä¿¡æµè¿›å‡ºæ¨¡æ‹Ÿä¸–ç•Œã€‚\nåœ¨è¿è¡Œæ—¶åŒå‡»ç‰©ç†èŠ‚ç‚¹å°†æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œè¯¥ç»ˆç«¯å¸¦æœ‰æŒ‡å‘è¯¥èŠ‚ç‚¹çš„SSH shellã€‚ç”¨æˆ·åº”è¯¥åƒä½¿ç”¨ä»¿çœŸæœåŠ¡å™¨é‚£æ ·é…ç½®å…¬é’¥SSHç™»å½•ã€‚\nSDT 3Då®‰è£… é¦–å…ˆå®‰è£…å¯¹åº”Javaç¯å¢ƒï¼Œæ¨èjava8ï¼Œæ ¹æ®æºç æ‰‹å†Œä¸‹é¢ä¸ºUbuntuçš„å®‰è£…æ•™ç¨‹\ngit clone https://github.com/USNavalResearchLaboratory/sdt sudo apt-get install openjdk-8-jdk export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64/ source $HOME/.bashrc # jdkå˜é‡ç”Ÿæ•ˆ å½“å‰ç”¨æˆ· # source $HOME/.profile # jdkå˜é‡ç”Ÿæ•ˆ å…¨éƒ¨ç”¨æˆ· update-alternatives --display java update-alternatives --display javac update-alternatives --display jar sudo apt-get install libvecmath-java sudo apt-get install libpcap-dev sudo apt-get install libnetfilter-queue-dev # \u0026lt;arm64\u0026gt; æ›¿æ¢ä¸ºå®‰è£…è½¯ä»¶çš„ç³»ç»Ÿæ¶æ„ cd sdt/makefiles make -f Makefile.linux_\u0026lt;arm64\u0026gt; sdt3d sdtcmd make -f Makefile.linux_\u0026lt;arm64\u0026gt; distclean #å¸è½½åŒ…ï¼Œæœ‰é—®é¢˜éœ€è¦æ¸…ç†æ—¶è¿è¡Œ #ç»‘å®šè„šæœ¬è‡³coreä¸­ sudo make -f Makefile.linux_amd64 install /usr/local/bin/ #ä¿®æ”¹ /usr/local/bin/sdt3d.sh å†…å®¹ï¼š THISDIR=/home/$USER/sdt/makefiles/build/sdt3d ä¹‹åè®¾å®š åœºæ™¯è®¾ç½®çš„ sdtoutput ä¸ºtrueå³å¯\nåœ¨ä»¿çœŸå¯åŠ¨å‰å¼€å¯ è®¾ç½® Preferences ç‚¹å‡» 3D GUI\u0026hellip; å¼€å¯3dç•Œé¢ æ‰§è¡Œä»¿çœŸå³å¯çœ‹åˆ°èŠ‚ç‚¹åˆå§‹åŒ–è¿‡ç¨‹ Core å¸¸è§é—®é¢˜ï¼š coreå®‰è£…ã€å¸è½½é‡è£…ç­‰æŠ¥é”™é—®é¢˜\nä¸èƒ½ä½¿ç”¨sudo è¿è¡Œinstall.sh å¦åˆ™åé¢è£…ä¾èµ–åŒ…åŠç”Ÿæˆè™šæ‹Ÿç¯å¢ƒç›®å½•æƒé™ä¸ºrootç”¨æˆ·ï¼Œè‚¯å®šä¼šæŠ¥é”™ã€‚\nä¼¼ä¹ ARM æ¶æ„çš„ ubuntu æ— æ³•å®‰è£…è¯¥è½¯ä»¶çš„è™šæ‹Ÿç¯å¢ƒï¼ŒçœŸå®ç¯å¢ƒä¸‹ä¹Ÿæ˜¯å„ç§ä¸åŒ…çš„ä¾èµ–ç¯å¢ƒä¸å¯¹ã€‚\nè‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬ä¾èµ–invokeï¼Œå…¶æ‰§è¡Œæµç¨‹ç”±coreæºç æ ¹ç›®å½•çš„task.pyè„šæœ¬å®šä¹‰ã€‚å…¶å†™æ³•æ˜¯ä¸€æ—¦é‡åˆ°è£…è¿‡pipxç­‰å°±ç›´æ¥é€€å‡ºå®‰è£…è„šæœ¬ï¼Œæ‰€ä»¥å¯ä»¥ä¿®æ”¹å…¶æ‰§è¡Œè¯­å¥ï¼ˆæ·»åŠ  \u0026ndash;forceï¼‰æ¥å¼ºåˆ¶å®‰è£…å·²ç»è£…è¿‡çš„åŒ…ã€‚æˆ–è€…ç®€å•çš„åšæ³•å°±æ˜¯æŠŠè£…çš„è™šæ‹Ÿç¯å¢ƒåˆ é™¤å³å¯ï¼Œåˆ pipxçš„venvæ–‡ä»¶å¤¹(~/.local/pipx/venvs/*) å’Œpoetryç”Ÿæˆçš„è™šæ‹Ÿç¯å¢ƒæ–‡ä»¶å¤¹(~/.cache/pypoetry/virtualenvs/core-3XChpotV-py3.6)æˆ–ä½¿ç”¨å‘½ä»¤\ncd ~/core/daemon poetry env list # æŸ¥çœ‹å®‰è£…ä½ç½® poetry remove venv1 pipx uninstall poetry pipx uninstall invoke pip3 uninstall pipx poetryæˆ–pipå®‰è£…æ»¡å¯¼è‡´çš„è¶…æ—¶é”™è¯¯\npythonæ¢æº\n/home/lk233/core/daemon/pyproject.toml [[tool.poetry.source]] name = \u0026quot;tsinghua\u0026quot; default = true url = \u0026quot;https://pypi.tuna.tsinghua.edu.cn/simple\u0026quot; # æ›´æ–° poetry é”æ–‡ä»¶ poetry lock --no-update # å¦‚æœæ˜¯å®‰è£…æœ¬åœ°ç›´æ¥å¦‚ä¸‹ pip config set global.index-url http://pypi.tuna.tsinghua.edu.cn/simple pip config set global.trusted-host pypi.tuna.tsinghua.edu.cn å®‰è£… pyymal æŠ¥é”™\nå°†pipé™çº§å¯ä»¥è§£å†³pip install --upgrade --force-reinstall pip==9.0.3\npoetry å®‰è£… cffi æŠ¥é”™\nBuilding wheel for cffi (setup.py) error XXX.. Package libffi was not found in the pkg-config search path. å®‰è£…ç¼ºå°‘çš„åŒ…sudo apt-get install libffi6 libffi-devsudo local å®‰è£… lxml æ—¶æŠ¥é”™\nå®‰è£…ç¼ºå°‘çš„åŒ…\nsudo apt-get install libxml2 sudo snap install libxslt æ— æ³•ä½¿ç”¨å­èŠ‚ç‚¹ç»ˆç«¯çš„å›¾å½¢ç•Œé¢ï¼š\n# æŠ¥é”™æç¤º No protocol specified Error: Can't open display: :0 è§£å†³ï¼šXserveré»˜è®¤æƒ…å†µä¸‹ï¼Œä¸å…è®¸åˆ«çš„ç”¨æˆ·çš„å›¾å½¢ç¨‹åºçš„å›¾å½¢æ˜¾ç¤ºåœ¨å½“å‰å±å¹•ä¸Šã€‚åœ¨å›¾å½¢æ­£å¸¸çš„ç”¨æˆ·ç»ˆç«¯ä¸­è¾“å…¥ xhost +\nxhost + # access control enabled, only authorized clients can connect xhost - # access control disabled, only authorized clients can connect Xtermä¸‹çš„Tcpdump æŠ“åŒ…ä¸åˆ·æ–°é—®é¢˜ï¼š\nä½¿ç”¨ -l é€‰é¡¹ï¼Œè®¾ç½®stdoutè¡Œç¼“å†²ï¼Œ è¿™æ ·ä¹Ÿå¯ä»¥æœ‰æ•ˆæ­é…å¦‚ä¸‹å‘½ä»¤\ntcpdump -l | tee dat tcpdump -l \u0026gt; dat \u0026amp; tail -f dat\t#ç»ˆæ­¢æ—¶tcpdumpæœªç»ˆæ­¢ è®°å¾—kill pid iperf3ç­‰æµé‡æµ‹è¯•å·¥å…·åœ¨èµ°åˆ†å¸ƒå¼åœºæ™¯æ—¶ä¼šå‘ç”Ÿæ•°æ®æ— æ³•ä¼ è¾“é—®é¢˜ï¼š\nç”±äºåˆ†å¸ƒå¼ä¹‹é—´çš„æ•°æ®é€šè¿‡éš§é“é“¾æ¥ï¼Œè€Œå»ºç«‹çš„éš§é“é»˜è®¤MTUä¸º1458å­—èŠ‚ã€‚æ‰€ä»¥å½“åˆ†å¸ƒå¼æœåŠ¡å™¨çš„è·¯ç”±åŒ…çš„MTUè¿‡å¤§æ—¶ï¼Œä¸ä¼šè½¬å‘æ•°æ®ã€‚\nä»¥iperf3ä¸ºä¾‹ï¼Œè®¾å®šä¼ è¾“æµé‡åŒ…mssä¸º1024å°±èƒ½è§£å†³æ— æ³•ä¼ è¾“è·¨åˆ†å¸ƒå¼æœåŠ¡å™¨çš„åŒ…çš„æ•°æ®\niperf -c 192.168.131.161 -M 1024 #æ³¨æ„ï¼Œè¿™é‡Œçš„-Mè®¾å®šçš„æ˜¯MSSä¸ºTCPã€STCPä¼ è¾“å±‚æ¦‚å¿µï¼ŒMTUä¸ºä¼ è¾“å±‚ä¼ é€’çš„æœ€å¤§IPåŒ… å®¹å™¨éš”ç¦»é—®é¢˜\næ³¨æ„è™½ç„¶å®¹å™¨èŠ‚ç‚¹ä¸å¤–éƒ¨ç‰©ç†æœºç³»ç»Ÿéš”ç¦»æœ‰ç‹¬ç«‹çš„ç½‘ç»œã€è¿›ç¨‹å †æ ˆï¼Œä½†æ˜¯éƒ¨åˆ†æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸å¤–ç•Œå…±äº«çš„ã€‚ä¾‹å¦‚å®¶ç›®å½•éƒ½æ˜¯è®¾ç½®ä¸ºå¤–ç•Œç”¨æˆ·çš„å®¶ç›®å½•ï¼Œå…¶ä»–ç³»ç»Ÿæ–‡ä»¶ä¾‹å¦‚é…ç½®è·¯ç”±çš„è½¬å‘çš„æ–‡ä»¶/proc/sys/net/ipv4/ip_forwardå´åˆæ˜¯ç‹¬ç«‹çš„ï¼ˆåœ¨ç»ˆç«¯ä½¿ç”¨sysctlä¸å½±å“å¤–é¢è¿è¡Œä»¿çœŸçš„ç³»ç»Ÿï¼‰\nemaneshè„šæœ¬æ— å¯¼å…¥åº“é—®é¢˜\nç”±äºæ˜¯å®‰è£…åœ¨è™šæ‹Ÿç¯å¢ƒçš„pythonï¼Œæ‰€ä»¥æ‰§è¡Œå¾—ç”¨core-pythonæ‰§è¡Œã€‚æœ‰äº›è„šæœ¬ä¾‹å¦‚emaneshè¿˜æ˜¯ä½¿ç”¨å¤–éƒ¨ç‰©ç†ç¯å¢ƒçš„pythonæ‰§è¡Œï¼Œå°†ç¬¬ä¸€è¡Œçš„ æ‰§è¡Œæ–‡ä»¶ä¿®æ”¹æˆå¯¹åº”core-pythonè·¯å¾„ã€‚æˆ–è€…æ‰§è¡Œæ—¶åŠ ä¸Šcore-pythonå³å¯ã€‚\n#!/usr/bin/python3 =\u0026gt; ä¿®æ”¹ä¸ºç±»ä¼¼çš„ä¸‹é¢çš„æ‰§è¡Œè·¯å¾„ #!/home/user/.cache/pypoetry/virtualenvs/core-3XChpotV-py3.6/bin/python coreåå°è¿è¡Œbatché—®é¢˜\næœ‰ä¸€æ¡issueæåˆ°äº†è¯¥é—®é¢˜ï¼š ç¨‹åºè‡ªå¸¦çš„batché€‰é¡¹åç»­æ²¡æœ‰ç»´æŠ¤ï¼Œè¿è¡Œå¸¦æœ‰ç§»åŠ¨æ‹“æ‰‘åŠemaneæ— çº¿æ¨¡å‹ç›´æ¥æŠ¥é”™æˆ–æ˜¯ä¸åŠ è½½ã€‚è§£å†³è¯¥é—®é¢˜éœ€è¦ä½¿ç”¨å‰å°guiå¯åŠ¨æˆ–è€…å¸¦æœ‰è™šæ‹Ÿå¸§ç¼“å†²åŒºçš„å¯åŠ¨ï¼Œä½¿ç”¨Xvfbå¯ä»¥æ­£å¸¸è¿è¡Œï¼ŒXvfb åœ¨è™šæ‹Ÿå†…å­˜ä¸­æ‰§è¡Œæ‰€æœ‰å›¾å½¢æ“ä½œï¼Œè€Œä¸æ˜¾ç¤ºä»»ä½•å±å¹•è¾“å‡ºï¼Œè¿è¡Œæ—¶éƒ¨åˆ†uiæŠ¥é”™å¯å¿½ç•¥ã€‚\nä½¿ç”¨æ–¹æ³•ï¼šxvfb-run core-gui -s ~/.core/configs/sample1.imnï¼Œæç¤ºæ²¡æœ‰è¿™ä¸ªåŒ…å°±apt-getå®‰è£…å³å¯ã€‚\næˆ–è€…ç›´æ¥ä½¿ç”¨ grpc api openä¸€ä¸ªåœºæ™¯åå°æ‰§è¡Œã€‚\nå¦‚æœæ˜¯ç”Ÿæˆä¸€ä¸ªåœºæ™¯å¹¶åå°æ‰§è¡Œï¼Œä¸ªäººæ¨èä½¿ç”¨ gRPC API Python API ç›´æ¥æ„å»ºåœºæ™¯å®ä¾‹åŒ–è¿è¡Œï¼Œå¹¶ä¸”ä¹Ÿèƒ½è°ƒç”¨savexmlä¿å­˜ã€‚\nåˆ†å¸ƒå¼åœºæ™¯åˆå§‹åŒ–é—®é¢˜\nâ€‹\tç”±äº boot_nodes å’Œ boot service é»˜è®¤æ˜¯è°ƒç”¨çº¿ç¨‹æ± å¤§å°ä¸º10çš„éå µå¡ä»»åŠ¡ï¼Œæ‰€ä»¥ç¬æ—¶ä¸šåŠ¡çš„å¹¶å‘é‡ç‰¹åˆ«å¤§é€ æˆsshé€šé“é¥±å’Œè¿æ¥å¤±è´¥ã€‚å…·ä½“é—®é¢˜ç¤ºä¾‹å¦‚æ­¤å¤„[SSH BUG] Â· Issue #622 Â· coreemu/core (github.com)ã€‚éœ€è¦ä¿®æ”¹coreservices.pyä¸‹çš„ boot_services å’Œ session.pyä¸‹çš„ boot_nodes çš„è°ƒç”¨çº¿ç¨‹æ•°é‡ã€‚å½“ç„¶ä¹Ÿå¯ä»¥é‡æ„åˆ†å¸ƒå¼é€šä¿¡éƒ¨åˆ†ï¼Œå°†å¤šä¸ªè¿æ¥å‘½ä»¤åˆå¹¶ä¹‹åè§£æsshã€‚\n","id":26,"section":"posts","summary":"ç¬”è®°å®æ—¶æ›´æ–°ä¸­ã€‚ã€‚ Coreã€Emane ä»‹ç» å®˜æ–¹æ–‡æ¡£ ä¸€å¥è¯æ¦‚æ‹¬: COREä¾§é‡äºæ¨¡æ‹Ÿå¦‚ç½‘ç»œå±‚ä¼ è¾“å±‚ã€ä¼šè¯å±‚å’Œåº”ç”¨å±‚ï¼Œæä¾›äº†ç”¨æˆ·æ„å»ºè™šæ‹Ÿç½‘ç»œçš„å›¾å½¢","tags":["ä»¿çœŸ"],"title":"Core å­¦ä¹ ç¬”è®°","uri":"https://liangkang233.github.io/2021/07/core%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","year":"2021"},{"content":"CORE/EMANE Emaneæ¨¡å‹è°ƒç ” æ— çº¿ä»¿çœŸåŸºæœ¬å†…å®¹å­¦ä¹ ï¼š è¡°è½æ¨¡å‹\nemaneåªèƒ½ä½¿ç”¨äº‹ä»¶æˆ–nakagamiæ¨¡å‹\ncoreè®¾å®šçš„é»˜è®¤å€¼æ˜¯æœ‰é—®é¢˜çš„ï¼Œmå€¼è¶Šå¤§ä¿¡é“è¶Šç†æƒ³\nè·¯å¾„æŸè€—\nemaneå¯è®¾å®šä¸º2-RAYã€freespace\næ³¨æ„ï¼šé’ˆå¯¹å¤§å°ºåº¦åœºæ™¯ä¸‹çš„è·¯å¾„æŸè€—éœ€è¦ä½¿ç”¨freespaceï¼Œä¾‹å¦‚é«˜åº¦å˜åŒ–å·®å¼‚å¤§çš„åœºæ™¯ï¼Œå¦åˆ™æ•ˆæœä¸æ˜æ˜¾ã€‚\nå½“propagationmodelè®¾ç½®ä¸ºprecomputed é¢„å®šä¹‰æ¨¡å‹ï¼Œå…¶è·¯å¾„æŸè€—é€šè¿‡pathlossäº‹ä»¶è§¦å‘ã€‚\nä¸Šè¿°æ¦‚å¿µåˆ‡å‹¿æ··æ·†ï¼Œå…¶æœ¬è´¨ä¸ºä¿¡é“è¡°è½åæ˜ çš„æ˜¯æ¥æ”¶æœºè§‚å¯Ÿåˆ°çš„ä¿¡é“å¼ºå¼±å˜åŒ–ã€‚\nå®ƒé€šå¸¸æ˜¯å¤§å°ºåº¦è¡°è½ï¼ˆè·¯å¾„æŸè€—ã€é˜´å½±ï¼‰å’Œå°å°ºåº¦è¡°è½ï¼ˆå¤šå¾„æ•ˆåº”ï¼‰çš„ç»¼åˆã€‚\nemaneæ— çº¿å¹²æ‰°\næ ¹æ®ä¸‹é¢çš„å¼å­æ— çº¿ç‰©ç†å±‚å¤„ç†æ˜¯å¦æ¥å—è¯¥æ•°æ®åŒ…ï¼ˆrxPower \u0026gt; rxSensitivity å³æ¥æ”¶ï¼‰\nrxPower = txPower + txAntennaGain + rxAntennaGain âˆ’ pathloss` rxSensitivity = âˆ’174 + noiseFigure + 10log(bandWidth) å¯¹äºfrequencyofinterestç›‘è§†çš„é¢‘ç‡æ¥æ”¶åˆ°åï¼Œæ ¹æ®è®¾å®šä¸åŒçš„subidç„¶ååŒºåˆ†ä¸ºå¸¦å†…å¤–ä¿¡å·ã€‚\nèŠ‚ç‚¹è®¾å®šnoisemodä¼šè®¾å®šç‰©ç†å±‚èƒ½å¤Ÿæ ¹æ®å™ªå£°æ¨¡å¼é…ç½®å‚æ•°è®°å½•æ‰€æœ‰ä¿¡å·èƒ½é‡ã€å¸¦å¤–ä¿¡å·èƒ½é‡æˆ–æ— ä¿¡å·èƒ½é‡(å³è¯¥èŠ‚ç‚¹æ˜¯å¦æ¥å—å¸¦å†…å¤–ä¿¡å·å½±å“é€ æˆå¹²æ‰°)ã€‚å½“åœ¨ç»™å®šçš„è¯·æ±‚é—´éš”å†…æ²¡æœ‰è®°å½•ä¿¡å·èƒ½é‡æˆ–æ²¡æœ‰å‘ç”Ÿä¿¡å·èƒ½é‡æ—¶ï¼Œæ¥æ”¶æœºçµæ•åº¦è¢«ç”¨ä½œåº•å™ªã€‚802.11abg å…·ä½“ä¾‹å­\næœ€åè®¡ç®—ä¿¡å™ªæ¯”SINRåœ¨macå±‚å¯¹åº”å…·ä½“æ¨¡å‹ï¼ˆä¾‹å¦‚rfpipeæ¨¡å‹ï¼‰å†å¾—åˆ°ä¸¢åŒ…ç‡ï¼Œé‡‡é›†æœ‰æ•ˆåŒ…å‘coreä¼ è¾“ã€‚\nemaneç›¸å…³æ³¨æ„ç‚¹ï¼š åœºæ™¯é…ç½®ä¸­çš„äº‘å¹¶ä¸æ˜¯ç±»ä¼¼æœ‰çº¿åœºæ™¯çš„è·¯ç”±å™¨ï¼Œä»…ä»…æ˜¯é…ç½®é“¾æ¥ä¸Šçš„èŠ‚ç‚¹çš„ipã€æ— çº¿æ¨¡å‹ã€ç­‰phy macçš„é»˜è®¤é…ç½®ã€‚å…³äºèŠ‚ç‚¹æ˜¯å¦å¯é€šä¿¡é™¤äº†ä¸Šé¢ä¿¡å·å¼ºåº¦è¦è¾¾åˆ°rxSensitivityå¤–ï¼Œè¿˜è¦ç›‘å¬é¢‘ç‡ç¬¦åˆã€‚æ‰€ä»¥å‘å°„é¢‘ç‡å’Œæ¥æ”¶é¢‘ç‡ï¼ˆphyå±‚çš„frequencyå’Œfrequencyofinterestï¼‰ä¸åŒä¼šç»„æˆä¸Šè¡Œä¸‹è¡Œä¿¡é“ï¼Œè¿™æ ·å°±ä¸äº§ç”Ÿå¸¦å†…å¹²æ‰°ã€‚ Emane ä»‹ç» EMANE æºç \nEmane æ¶æ„\nEMANE æ•™ç¨‹æµ‹è¯•\nå¯æ‰©å±•ç§»åŠ¨è‡ªç»„ç»‡ç½‘ç»œä»¿çœŸå™¨ (The Extendable Mobile Ad-hoc Network Emulator) å…è®¸ä½¿ç”¨å¯æ’æ‹” MAC å’Œ PHY å±‚æ¶æ„è¿›è¡Œå¼‚æ„ç½‘ç»œä»¿çœŸã€‚EMANEæ˜¯ç”±ç¾å›½æµ·å†›ç ”ç©¶å®éªŒå®¤(NRL)ä»£å·5522å’Œ Adjacent Link æœ‰é™è´£ä»»å…¬å¸å¼€å‘çš„ã€‚EMANE æ¡†æ¶æä¾›äº†ä¸€ç§å®ç°æ¶æ„ï¼Œç”¨äºä»¥ç½‘ç»œä»¿çœŸæ¨¡å— (NEM: Network Emulation Modules) çš„å½¢å¼å¯¹ä¸åŒçš„æ— çº¿ç”µæ¥å£ç±»å‹è¿›è¡Œå»ºæ¨¡ï¼Œå¹¶å°†è¿™äº›æ¨¡å—åˆå¹¶åˆ°åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­è¿è¡Œçš„å®æ—¶ä»¿çœŸä¸­ã€‚\nhttp://www.adjacentlink.com/ å¯ä»¥ä½¿ç”¨ EMANE ç»‘å®šåˆ°è™šæ‹Ÿè®¾å¤‡çš„ EMANE æ¥æ¨¡æ‹Ÿé«˜ä¿çœŸæ— çº¿ç½‘ç»œï¼Œè€Œä¸æ˜¯ä½¿ç”¨ CORE æ„å»º Linux ä»¥å¤ªç½‘ç½‘æ¡¥ã€‚CORE ä»¿æ•ˆç¬¬ 3 å±‚åŠä»¥ä¸Šï¼ˆç½‘ç»œã€ä¼šè¯ã€åº”ç”¨ç¨‹åºï¼‰åŠå…¶è™šæ‹Ÿç½‘ç»œå †æ ˆå’Œå¤„ç†ç©ºé—´ï¼Œç”¨äºåè®®å’Œåº”ç”¨ç¨‹åºï¼Œè€Œ EMANE åˆ™ä½¿ç”¨å…¶å¯æ’å…¥çš„ PHY å’Œ MAC æ¨¡å‹æ¨¡æ‹Ÿç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚ã€‚å®ƒä¸ºæ— çº¿ç½‘ç»œå®éªŒäººå‘˜æä¾›äº†ä¸€ä¸ªé«˜åº¦çµæ´»çš„æ¨¡å—åŒ–ç¯å¢ƒï¼Œç”¨äºè®¾è®¡ã€å¼€å‘å’Œæµ‹è¯•ç®€å•å’Œå¤æ‚çš„ç½‘ç»œæ¶æ„ã€‚EMANEé‡‡ç”¨ç‰©ç†å±‚æ¨¡å‹æ¥è€ƒè™‘ä¿¡å·ä¼ æ’­ã€å¤©çº¿è½®å»“æ•ˆåº”å’Œå¹²æ‰°æºï¼Œä»¥ä¾¿ä¸ºæ— çº¿å®éªŒæä¾›ä¸€ä¸ªçœŸå®çš„ç¯å¢ƒã€‚å•ä¸ªæ— çº¿ç”µæ¨¡å‹æ’ä»¶ç”¨äºæ¨¡æ‹Ÿæ³¢å½¢çš„æœ€ä½å±‚ï¼Œå¹¶å¯ä»¥ä¸ç°æœ‰çš„è½¯ä»¶å®šä¹‰æ— çº¿ç”µ(SDR)ç›¸ç»“åˆã€‚\nCoreå’Œ EMANE ä¹‹é—´çš„æ¥å£æ˜¯ TAP è®¾å¤‡ã€‚CORE ä½¿ç”¨ Linux ç½‘ç»œåç§°ç©ºé—´æ„å»ºè™šæ‹ŸèŠ‚ç‚¹ï¼Œå°† TAP è®¾å¤‡å®‰è£…åˆ°åç§°ç©ºé—´ä¸­ï¼Œå¹¶åœ¨åç§°ç©ºé—´ä¸­å³æ—¶åŒ–ä¸€ä¸ª EMANE è¿‡ç¨‹ã€‚EMANE è¿‡ç¨‹å°†ç”¨æˆ·ç©ºé—´Socketä¸ TAP è®¾å¤‡ç»‘å®šï¼Œä»¥ä¾¿ä» CORE å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚\nEMANE å®ä¾‹é€šè¿‡æ§åˆ¶ç«¯å£ï¼ˆä¾‹å¦‚ctrl0 ï¼Œctrl1ï¼‰å‘é€å’Œæ¥æ”¶ OTAï¼ˆç©ºä¸­ï¼‰æµé‡æ¥å¾€äºå…¶ä»– EMANE å®ä¾‹ã€‚å®ƒè¿˜ä½¿ç”¨ç›¸åŒæˆ–ä¸åŒçš„æ§åˆ¶ç«¯å£å‘é€å’Œæ¥æ”¶äº‹ä»¶æ¥å›äº‹ä»¶æœåŠ¡ã€‚é€šè¿‡ CORE çš„WLANé…ç½®å¯¹è¯é…ç½® EMANE æ¨¡å‹ã€‚æ¯ä¸ªæ”¯æŒçš„ EMANE æ¨¡å‹éƒ½æœ‰ç›¸ç›¸åº”çš„Emane Python å­ç±»ï¼Œä»¥æä¾›é…ç½®é¡¹ç›®åŠå…¶å¯¹ XML æ–‡ä»¶çš„æ˜ å°„ã€‚è¿™æ ·ï¼Œæ–°é…ç½®å°±å¯ä»¥å¾ˆå®¹æ˜“åœ°å¾—åˆ°æ”¯æŒã€‚å½“ CORE å¼€å§‹æ¨¡æ‹Ÿæ—¶ï¼Œå®ƒä¼šç”ŸæˆæŒ‡å®š EMANE NEM é…ç½®çš„ç›¸åº” XML æ–‡ä»¶ï¼Œå¹¶å¯åŠ¨ EMANE daemon\næŸäº› EMANE æ¨¡å‹æ”¯æŒä½ç½®ä¿¡æ¯ï¼Œä»¥ç¡®å®šä½•æ—¶åº”ä¸¢å¼ƒæ•°æ®åŒ…ã€‚EMANE å…·æœ‰ä¸€ä¸ªäº‹ä»¶ç³»ç»Ÿï¼Œå…¶ä¸­ä½ç½®äº‹ä»¶å¹¿æ’­ç»™æ‰€æœ‰ NEMã€‚å½“èŠ‚ç‚¹åœ¨ç”»å¸ƒä¸Šç§»åŠ¨æ—¶ï¼ŒCORE å¯ä»¥ç”Ÿæˆè¿™äº›ä½ç½®äº‹ä»¶ã€‚ç”»å¸ƒå¤§å°å’Œæ¯”ä¾‹å¯¹è¯å…·æœ‰å°† Xï¼ŒY åæ ‡ç³»ç»Ÿæ˜ å°„åˆ° EMANE ä½¿ç”¨çš„çº¬åº¦ã€ç»åº¦åœ°ç†ç³»ç»Ÿçš„æ§ä»¶ã€‚è¿˜å¯ä»¥åœ¨core.confé…ç½®æ–‡ä»¶è®¾å®šCOREè®¢é˜… EMANE ä½ç½®äº‹ä»¶ï¼Œè¿™æ ·core guiç”»å¸ƒä¸Šçš„èŠ‚ç‚¹ä¸EMANE ä»¿çœŸä¸­æ—¶èŠ‚ç‚¹çš„ä¼šåŒæ­¥ç§»åŠ¨ã€‚ä¾‹å¦‚ï¼Œå½“æ¨¡æ‹Ÿè„šæœ¬ç”Ÿæˆå™¨è¿è¡Œç§»åŠ¨è„šæœ¬æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚\nä¸‹é¢çš„æ¯ä¸ªä¸»é¢˜éƒ½å‡è®¾å·²ç»å®‰è£…äº†COREã€EMANEå’ŒOSPF MDRã€‚æ¼”ç¤ºæ–‡ä»¶å°†åœ¨ core-pygui ä¸­æ‰¾åˆ°\nä¸»é¢˜ æ¨¡å‹ æè¿° æ€»ç»“ XML Files RF Pipe æ¦‚è¿°ç”Ÿæˆçš„ç”¨äºé©±åŠ¨EMANEçš„XMLæ–‡ä»¶ XML Files GPSD RF Pipe æ¦‚è¿°gpsdä¸EMANEçš„è¿è¡Œå’Œé›†æˆ gpsd Precomputed RF Pipe æ¦‚è¿°å¦‚ä½•ä½¿ç”¨é¢„è®¡ç®—ä¼ æ’­æ¨¡å‹ é¢„è®¡ç®—ä¼ æ’­æ¨¡å‹ EEL RF Pipe æ¦‚è¿°å¦‚ä½•ä½¿ç”¨ä»¿çœŸäº‹ä»¶æ—¥å¿—(EEL)ç”Ÿæˆå™¨ EELç”Ÿæˆå™¨ Antenna Profiles RF Pipe æ¦‚è¿°å¦‚ä½•åœ¨EMANEä¸­ä½¿ç”¨å¤©çº¿é…ç½®æ–‡ä»¶ å¤©çº¿é…ç½® EMANE Configuration åŠ äº‹ä»¶ç›‘å¬ CORE é…ç½®æ–‡ä»¶ /etc/core/core.conf åŒ…å«EMANEç‰¹æœ‰é€‰é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n# EMANE é…ç½® emane_platform_port = 8101 emane_transform_port = 8201 emane_event_monitor = False # emane_models_dir = /home/username/.core/myemane # EMANE log èŒƒå›´[0,4] é»˜è®¤: 2 emane_log_level = 2 emane_realtime = True # emaneå®‰è£…åœ°å€å‰ç¼€ # emane_prefix = /usr å¯ä»¥æ‰‹åŠ¨æ‹–åŠ¨ç”»å¸ƒä¸Šçš„èŠ‚ç‚¹æ¥æ›´æ–°å®ƒä»¬åœ¨EMANEä¸­çš„ä½ç½®ï¼Œä¼šå°†core çš„ xy æ¢ç®—ä¸º emaneçš„ç»çº¬åº¦äº‹ä»¶å‘é€ã€‚ns-2ç§»åŠ¨è„šæœ¬æ”¹å˜guiä¼šåŒæ­¥å‘é€emaneäº‹ä»¶è§¦å‘emane gpsæ•°æ®çš„åŒæ­¥ å¯ä»¥ä¸ä¿®æ”¹æ”¹æ­¤é¡¹ï¼Œ ä½†æ˜¯å‘é€çš„emaneäº‹ä»¶æ— æ³•è§¦å‘guiçš„å˜åŒ–ã€‚\nå¦‚æœä½ æœ‰ä¸€ä¸ªEMANEäº‹ä»¶ç”Ÿæˆå™¨(ä¾‹å¦‚ç§»åŠ¨æˆ–pathlossè„šæœ¬)ï¼Œå¹¶ä¸”æƒ³è®©COREè®¢é˜…EMANEä½ç½®äº‹ä»¶ï¼Œå³åå°å‘é€emaneä½ç½®äº‹ä»¶æ›´æ–°ï¼Œuiç•Œé¢åˆ·æ–°å…¶æ˜ å°„çš„xyåæ ‡ã€‚åœ¨ CORE.conf é…ç½®æ–‡ä»¶ä¸­æŠŠemane_event_monitorè®¾ç½®ä¸º Trueï¼Œé»˜è®¤æ˜¯ Falseã€‚\nå¦‚æœæ˜¯é€šè¿‡coreå®‰è£…çš„emane å°±ä¼šè‡ªåŠ¨å®‰è£…emaneç›®å½•ä¸‹çš„pythonåŒ…ï¼Œå¯ä»¥è°ƒç”¨è¿™äº›åŒ…è£…å¥½çš„åŒ…å»æ‰§è¡Œä¸€äº›emaneäº‹ä»¶çš„apiã€‚emaneäº‹ä»¶ç›‘å¬çš„æ¥å£ä½¿ç”¨grpcå®ç°çš„ã€‚ä¾‹å¦‚è¿™é‡Œçš„emaneä½ç½®äº‹ä»¶ï¼Œå¯ä»¥è°ƒç”¨ /usr/bin/emaneevent-location ä¸‹çš„pythonä»£ç  ä½¿ç”¨çš„è¯ çœ‹çœ‹æºç å¤§æ¦‚å°±æ˜ç™½äº†ã€‚è‡ªå·±å‘é€emaneäº‹ä»¶æ›´æ–°ä½ç½®ã€‚\nå¦‚æœcoreè£…åœ¨è™šæ‹Ÿç¯å¢ƒåŒ… æ‰§è¡Œemaneevent-location é‡Œçš„çš„pythonæ‰§è¡Œå™¨è·¯å¾„è¦æ”¹ä¸ºä½ çš„core-pythonè·¯å¾„ï¼Œè€Œä¸æ˜¯é»˜è®¤python3çš„è·¯å¾„ ä¸ç„¶æ˜¯æ²¡æœ‰é‚£ä¹ˆemaneä¾èµ–åŒ…çš„ emane_event_monitorè®¾ç½®ä¸º True\nå¦‚æœæŠ¥è¿™ä¸ªé”™ERROR - emanemanager:starteventmonitor - Warning: EMANE events will not be generated because the emaneeventservice binding was unable to load (install the python-emaneeventservice bindings) ä¸”ç¡®ä¿å®‰è£…äº†emaneçš„æ”¯æŒåŒ…ï¼Œå¯ä»¥è¯•ç€å¦‚ä¸‹ä¿®æ”¹æºç ï¼š\n# æ–‡ä»¶ core/daemon/core/emane/emanemanager.py *** self.starteventmonitor() self.buildeventservicexml() # ä¿®æ”¹æ‰§è¡Œé¡ºåº å¦‚ä¸‹æ‰€ç¤º ç¡®ä¿ emanemangeerå…ˆåˆå§‹åŒ– event_service å†æ‰§è¡Œå¼€å¯ç›‘å¬å‘½ä»¤ self.buildeventservicexml() self.starteventmonitor() *** å¦ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœä»æºä»£ç å®‰è£…EMANEï¼Œé»˜è®¤é…ç½®å‰ç¼€å°†æŠŠDTDæ–‡ä»¶æ”¾åœ¨ /usr/local/share/emane/dtd\nè€Œcore.comå¸Œæœ›ä»–ä»¬åœ¨ /usr/share/emane/dtd\næ›´æ–°EMANEå‰ç¼€é…ç½®å¯ä»¥è§£å†³æ­¤é—®é¢˜ã€‚\nemane_prefix = /usr/local è‡ªå®šä¹‰EMANEæ¨¡å‹ COREé€šè¿‡åŠ¨æ€åŠ è½½ç”¨æˆ·åˆ›å»ºçš„è¡¨ç¤ºæ¨¡å‹çš„pythonæ–‡ä»¶æ¥æ”¯æŒè‡ªå®šä¹‰å¼€å‘çš„EMANEæ¨¡å‹ã€‚\nè‡ªå®šä¹‰çš„EMANEæ¨¡å‹åº”è¯¥æ”¾åœ¨COREé…ç½®æ–‡ä»¶ä¸­ emane_models_dir æ‰€å®šä¹‰çš„è·¯å¾„ä¸­ã€‚è¿™ä¸ªè·¯å¾„ä¸èƒ½ä»¥ /emane ç»“å°¾ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªç”¨æ–‡æ¡£æè¿°åŠŸèƒ½çš„ç¤ºä¾‹æ¨¡å‹:\n\u0026quot;\u0026quot;\u0026quot; Example custom emane model. \u0026quot;\u0026quot;\u0026quot; from typing import Dict, List, Optional, Set from core.config import Configuration from core.emane import emanemanifest, emanemodel class ExampleModel(emanemodel.EmaneModel): \u0026quot;\u0026quot;\u0026quot; è‡ªå®šä¹‰ emane æ¨¡å‹. :cvar name: å®šä¹‰å°†åœ¨GUIä¸­æ˜¾ç¤ºçš„emaneæ¨¡å‹åç§° Mac Definition: :cvar mac_library: å®šä¹‰æ¨¡å‹å°†å¼•ç”¨çš„MACåº“ :cvar mac_xml: å®šä¹‰MACæ¸…å•æ–‡ä»¶ï¼Œå®ƒå°†è¢«è§£æä»¥è·å¾—é…ç½®é€‰é¡¹ï¼Œè¿™å°†åœ¨GUIä¸­æ˜¾ç¤º :cvar mac_defaults: å…è®¸æ‚¨é‡å†™ä¸Šé¢æ¸…å•æ–‡ä»¶ä¸­ç»´æŠ¤çš„é€‰é¡¹ :cvar mac_config: è§£ææ¸…å•æ–‡ä»¶å¹¶å°†é…ç½®è½¬æ¢ä¸ºcoreæ”¯æŒçš„æ ¼å¼ Phy Definition: æ³¨æ„: Phyé…ç½®å°†é»˜è®¤ä¸ºé€šç”¨æ¨¡å‹å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸‹é¢çš„éƒ¨åˆ†éå¿…é¡»åŒ…æ‹¬åœ¨å†… :cvar phy_library: å®šä¹‰æ¨¡å‹å°†å¼•ç”¨çš„phyåº“ï¼Œåœ¨éœ€è¦æä¾›è‡ªå®šä¹‰phyæ—¶ä½¿ç”¨ :cvar phy_xml: å®šä¹‰phyæ¸…å•æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†è¢«è§£æä»¥è·å¾—é…ç½®é€‰é¡¹ï¼Œå°†åœ¨GUIä¸­æ˜¾ç¤º :cvar phy_defaults: å…è®¸æ‚¨é‡å†™ä¸Šé¢æ¸…å•æ–‡ä»¶ä¸­ç»´æŠ¤çš„é€‰é¡¹æˆ–é»˜è®¤é€šç”¨æ¨¡å‹çš„é€‰é¡¹ :cvar phy_config: è§£ææ¸…å•æ–‡ä»¶å¹¶å°†é…ç½®è½¬æ¢ä¸ºCoreå¿ƒæ”¯æŒçš„æ ¼å¼ Custom Override Options: æ³¨æ„: è¿™äº›é€‰é¡¹é»˜è®¤ä¸ºä¸‹é¢æ‰€è§çš„å†…å®¹ï¼Œä¸éœ€è¦åŒ…æ‹¬åœ¨å†… :cvar config_ignore: å…è®¸æ‚¨å¿½ç•¥phy/macä¸­çš„é€‰é¡¹ï¼Œé€šå¸¸åœ¨æ‚¨éœ€è¦æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰é€‰é¡¹ä»¥åœ¨GUIä¸­æ˜¾ç¤ºæ—¶ä½¿ç”¨ \u0026quot;\u0026quot;\u0026quot; name: str = \u0026quot;emane_example\u0026quot; mac_library: str = \u0026quot;rfpipemaclayer\u0026quot; mac_xml: str = \u0026quot;/usr/share/emane/manifest/rfpipemaclayer.xml\u0026quot; mac_defaults: Dict[str, str] = { \u0026quot;pcrcurveuri\u0026quot;: \u0026quot;/usr/share/emane/xml/models/mac/rfpipe/rfpipepcr.xml\u0026quot; } mac_config: List[Configuration] = emanemanifest.parse(mac_xml, mac_defaults) phy_library: Optional[str] = None phy_xml: str = \u0026quot;/usr/share/emane/manifest/emanephy.xml\u0026quot; phy_defaults: Dict[str, str] = { \u0026quot;subid\u0026quot;: \u0026quot;1\u0026quot;, \u0026quot;propagationmodel\u0026quot;: \u0026quot;2ray\u0026quot;, \u0026quot;noisemode\u0026quot;: \u0026quot;none\u0026quot; } phy_config: List[Configuration] = emanemanifest.parse(phy_xml, phy_defaults) config_ignore: Set[str] = set() å•ä¸»æœºEMANE æœ¬èŠ‚æè¿°åœ¨å•ä¸ªæœºå™¨ä¸Šè¿è¡ŒCOREå’ŒEMANEã€‚è¿™æ˜¯ä½¿ç”¨COREæ„å»ºEMANEç½‘ç»œæ—¶çš„é»˜è®¤æ“ä½œæ¨¡å¼ã€‚\nOTAç®¡ç†å™¨å’ŒEventæœåŠ¡æ¥å£è¢«è®¾ç½®ä¸ºä½¿ç”¨ctrl0ï¼Œè™šæ‹ŸèŠ‚ç‚¹ä½¿ç”¨ä¸»æ§åˆ¶é€šé“è¿›è¡Œç›¸äº’é€šä¿¡ã€‚\nå½“æ¶‰åŠåˆ°EMANEçš„åœºæ™¯æ—¶ï¼Œä¸»æ§åˆ¶é€šé“ä¼šè‡ªåŠ¨æ¿€æ´»ã€‚ä½¿ç”¨ä¸»æ§åˆ¶é€šé“å¯ä»¥é˜²æ­¢æ¨¡æ‹Ÿä¼šè¯åœ¨æœ¬åœ°\nç½‘ç»œä¸Šå‘é€å¤šæ’­æµé‡ï¼Œå¹¶å¹²æ‰°å…¶ä»–EMANEç”¨æˆ·ã€‚\nEMANEæ˜¯é€šè¿‡ä¸€ä¸ªWLANèŠ‚ç‚¹é…ç½®çš„ï¼Œå› ä¸ºå®ƒå®Œå…¨æ˜¯å…³äºæ¨¡æ‹Ÿæ— çº¿æ— çº¿ç”µç½‘ç»œçš„ã€‚\nä¸€æ—¦èŠ‚ç‚¹è¿æ¥åˆ°ä½¿ç”¨EMANEæ¨¡å‹é…ç½®çš„WLANäº‘ï¼Œè¯¥èŠ‚ç‚¹ä¸Šçš„æ— çº¿ç”µæ¥å£ä¹Ÿå¯ä»¥å•ç‹¬é…ç½®(é™¤äº†äº‘ä¹‹å¤–)ã€‚\nåŒå‡»WLANèŠ‚ç‚¹ä»¥è°ƒç”¨WLANé…ç½®å¯¹è¯æ¡†ã€‚å•å‡»EMANEé€‰é¡¹å¡;æ­£ç¡®å®‰è£…EMANEåï¼ŒEMANEæ— çº¿æ¨¡å—åº”åˆ—åœ¨\nEMANEå‹å·åˆ—è¡¨ä¸­ã€‚(å¦‚æœåœ¨å®‰è£…EMANE Pythonç»‘å®šä¹‹å‰è¿è¡ŒCOREå®ˆæŠ¤è¿›ç¨‹ï¼Œåˆ™å¯èƒ½éœ€è¦é‡æ–°å¯åŠ¨å®ƒ)\nå•å‡»ä¸€ä¸ªæ¨¡å‹åç§°æ¥å¯ç”¨å®ƒã€‚\nå½“åœ¨ EMANE Models åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªEMANEæ¨¡å‹æ—¶ï¼Œå•å‡» model options æŒ‰é’®å¯¼è‡´GUIæŸ¥è¯¢\nCORE daemon ä»¥è·å–é…ç½®é¡¹ã€‚æ¯ä¸ªæ¨¡å‹éƒ½ä¼šæœ‰ä¸åŒçš„å‚æ•°ï¼Œè¯·å‚è€ƒæ¯ä¸ªé¡¹ç›®çš„è§£é‡Šçš„EMANEæ–‡æ¡£ã€‚\né»˜è®¤å€¼æ˜¾ç¤ºåœ¨å¯¹è¯æ¡†ä¸­ã€‚å•å‡» Apply å°†å­˜å‚¨EMANEæ¨¡å‹é€‰æ‹©ã€‚\nEMANE options æŒ‰é’®å…è®¸æŒ‡å®šä¸€äº›Emane å…¨å±€å‚æ•°ï¼Œå…¶ä¸­ä¸€äº›æ˜¯åˆ†å¸ƒå¼æ“ä½œæ‰€å¿…éœ€çš„ã€‚\nRF-PIPE å’Œ IEEE 802.11abg æ¨¡å‹ä½¿ç”¨æ”¯æŒåœ°ç†ä½ç½®ä¿¡æ¯çš„é€šç”¨PHYæ¥ç¡®å®šèŠ‚ç‚¹ä¹‹é—´çš„è·¯å¾„æŸè€—ã€‚\nä¸€ä¸ªé»˜è®¤çš„ç»çº¬åº¦ä½ç½®ç”±COREæä¾›ï¼Œè¿™ä¸ªåŸºäºä½ç½®çš„è·¯å¾„æŸè€—é»˜è®¤å¯ç”¨;è¿™æ˜¯é€šç”¨PHYçš„è·¯å¾„æŸè€—æ¨¡å¼è®¾ç½®ã€‚\nåœ¨æ¨¡æ‹Ÿè¿è¡Œæ—¶ç§»åŠ¨ç”»å¸ƒä¸Šçš„èŠ‚ç‚¹å°†ä¸ºEMANEç”Ÿæˆä½ç½®äº‹ä»¶ã€‚\nè¦æŸ¥çœ‹æˆ–æ›´æ”¹ç”»å¸ƒçš„åœ°ç†ä½ç½®æˆ–æ¯”ä¾‹ï¼Œè¯·ä½¿ç”¨ç”»å¸ƒèœå•ä¸­çš„â€œç”»å¸ƒå¤§å°å’Œæ¯”ä¾‹â€å¯¹è¯æ¡†ã€‚\næ³¨æ„ï¼Œåœ°ç†åæ ‡ç³»å’Œç¬›å¡å°”åæ ‡ç³»ä¹‹é—´çš„è½¬æ¢æ˜¯ä½¿ç”¨é€šç”¨å¢¨å¡æ‰˜æŠ•å½±(UTM: Universal Transverse Mercator)å®Œæˆçš„ï¼Œ\nå…¶ä¸­å®šä¹‰äº†6å±‚ä¸åŒçš„ç»åº¦å¸¦åŒºåŸŸã€‚å¯¹äºè·¨è¶Šå¤šä¸ªUTMåŒºåŸŸçš„éå¸¸å¤§çš„åœºæ™¯ï¼ŒCOREç”Ÿæˆçš„ä½ç½®äº‹ä»¶åœ¨åŒºåŸŸè¾¹ç•Œé™„è¿‘å¯èƒ½å˜å¾—ä¸å‡†ç¡®ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå»ºè®®ä½¿ç”¨EMANEä½ç½®è„šæœ¬æ¥å®ç°åœ°ç†ä½ç½®çš„å‡†ç¡®æ€§ã€‚\nå•å‡»ç»¿è‰²çš„ Start æŒ‰é’®å°†å¯åŠ¨æ¨¡æ‹Ÿï¼Œå¹¶å¯¼è‡´åœ¨è¿æ¥åˆ°EMANE WLANçš„è™šæ‹ŸèŠ‚ç‚¹ä¸­åˆ›å»ºTAPè®¾å¤‡ã€‚\nè¿™äº›è®¾å¤‡æ˜¾ç¤ºä¸ºæ¥å£åç§°ï¼Œå¦‚eth0ã€eth1ç­‰ã€‚EMANEè¿›ç¨‹ç°åœ¨åº”è¯¥åœ¨æ¯ä¸ªåç§°ç©ºé—´ä¸­è¿è¡Œã€‚å¦‚ä¸‹ä¸ºå››ä¸ªèŠ‚ç‚¹çš„åœºæ™¯:\nps -aef | grep emane root 1063 969 0 11:46 ? 00:00:00 emane -d --logl 3 -r -f /tmp/pycore.59992/emane4.log /tmp/pycore.59992/platform4.xml root 1117 959 0 11:46 ? 00:00:00 emane -d --logl 3 -r -f /tmp/pycore.59992/emane2.log /tmp/pycore.59992/platform2.xml root 1179 942 0 11:46 ? 00:00:00 emane -d --logl 3 -r -f /tmp/pycore.59992/emane1.log /tmp/pycore.59992/platform1.xml root 1239 979 0 11:46 ? 00:00:00 emane -d --logl 3 -r -f /tmp/pycore.59992/emane5.log /tmp/pycore.59992/platform5.xml ä¸Šé¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†COREå¯åŠ¨çš„EMANEè¿›ç¨‹ã€‚è¦æŸ¥çœ‹COREç”Ÿæˆçš„é…ç½®ï¼Œè¯·æŸ¥çœ‹/tmp/pycoreã€‚\nè¿™æ˜¯ä¸€ä¸ªç”¨äºå­˜æ”¾ platform.xml æ–‡ä»¶å’Œå…¶ä»– XMLæ–‡ä»¶çš„ sessionç›®å½•ã€‚\næŸ¥çœ‹è¿™äº›ä¿¡æ¯çš„ä¸€ç§ç®€å•æ–¹æ³•æ˜¯åŒå‡»å…¶ä¸­ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œç„¶åé”®å…¥cd ..åœ¨shellä¸­è½¬åˆ°ä¼šè¯ç›®å½•ã€‚\nåˆ†å¸ƒå¼ EMANE åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªæ¨¡æ‹ŸæœåŠ¡å™¨ä¸­è¿è¡ŒCOREå’ŒEMANEä¸åœ¨å•ä¸ªæœºå™¨ä¸Šè¿è¡Œç±»ä¼¼ã€‚ ä¸ºäº†ä»¿çœŸèƒ½å¤Ÿè¿è¡Œï¼Œéœ€è¦è®¾ç½®ä¸€äº›å…³é”®çš„é…ç½®é¡¹ï¼Œè¿™é‡Œæ¦‚è¿°äº†è¿™äº›é…ç½®é¡¹ã€‚\nç»´æŠ¤ æ•°æ®(OTAæµé‡)å’Œæ§åˆ¶æµé‡ä¸ºç‹¬ç«‹çš„ç½‘ç»œæ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ä¾‹å¦‚ï¼Œæ§åˆ¶ç½‘ç»œå¯èƒ½æ˜¯ä¸€ä¸ªå…±äº«çš„å®éªŒå®¤ç½‘ç»œï¼Œ coreä¸å¸Œæœ›æ•°æ®ç½‘ç»œä¸Šçš„å¤šæ’­é€šä¿¡å¹²æ‰°å…¶ä»–EMANEç”¨æˆ·ã€‚æ­¤å¤–ï¼Œæ§åˆ¶æµé‡å¯èƒ½ä¼šå¹²æ‰°OTAå»¶è¿Ÿå’Œååé‡ï¼Œ å¹¶å¯èƒ½å½±å“ä»¿çœŸçš„ä¿çœŸåº¦ã€‚è¿™é‡Œæè¿°çš„ç¤ºä¾‹å°†ä½¿ç”¨eth0ä½œä¸ºæ§åˆ¶æ¥å£ï¼Œä½¿ç”¨eth1ä½œä¸ºæ•°æ®æ¥å£ï¼Œ å°½ç®¡å¹¶ä¸ä¸¥æ ¼è¦æ±‚ä½¿ç”¨å•ç‹¬çš„æ¥å£ã€‚æ³¨æ„ï¼Œè¿™äº›æ¥å£åç§°æŒ‡çš„æ˜¯ç‰©ç†ä¸»æœºä¸Šçš„æ¥å£ï¼Œè€Œä¸æ˜¯èŠ‚ç‚¹å†…çš„è™šæ‹Ÿæ¥å£ã€‚\né‡è¦äº‹é¡¹:å¦‚æœä½¿ç”¨äº†è¾…åŠ©æ§åˆ¶ç½‘ç»œï¼Œåˆ™éœ€è¦å°†ä¸»æœºä¸Šçš„ä¸€ä¸ªæ¥å£åˆ†é…ç»™è¯¥ç½‘ç»œ\nä½œä¸ºæ¨¡æ‹ŸæœåŠ¡å™¨çš„æ¯å°æœºå™¨éƒ½éœ€è¦å®‰è£…COREå’ŒEMANEã€‚\nå¯ç”¨æœåŠ¡å™¨çš„IPåœ°å€ä»æ ¸å¿ƒä»¿çœŸæœåŠ¡å™¨å¯¹è¯æ¡†ä¸­é…ç½®(é€‰æ‹© Session ç„¶å Emulation servers\u0026hellip; )ã€‚ è¿™ä¸ªæœåŠ¡å™¨åˆ—è¡¨å­˜å‚¨åœ¨*~/.core/servers.conf*æ–‡ä»¶ä¸­ã€‚å¯¹è¯æ¡†æ˜¾ç¤ºäº†å¯ç”¨çš„æœåŠ¡å™¨ï¼Œ å…¶ä¸­çš„ä¸€éƒ¨åˆ†æˆ–å…¨éƒ¨å¯ä»¥åˆ†é…ç»™ç”»å¸ƒä¸Šçš„èŠ‚ç‚¹ã€‚\néœ€è¦å°†èŠ‚ç‚¹åˆ†é…ç»™ä»¿çœŸæœåŠ¡å™¨ã€‚é€‰æ‹©å‡ ä¸ªèŠ‚ç‚¹ï¼Œå³é”®å•å‡»å®ƒä»¬ï¼Œé€‰æ‹©Assign toå’Œæ‰€éœ€æœåŠ¡å™¨çš„åç§°ã€‚ å½“æœªå°†èŠ‚ç‚¹åˆ†é…ç»™ä»»ä½•ä»¿çœŸæœåŠ¡å™¨æ—¶ï¼Œå°†åœ¨æœ¬åœ°å¯¹å…¶è¿›è¡Œä»¿çœŸã€‚GUIè¿æ¥çš„æœ¬åœ°æœºå™¨è¢«è®¤ä¸ºæ˜¯â€œä¸»â€æœºå™¨ï¼Œ è€Œä¸»æœºå™¨åˆè¿æ¥åˆ°å…¶ä»–æ¨¡æ‹ŸæœåŠ¡å™¨çš„â€œä»å±â€ã€‚åº”è¯¥é…ç½®ä»ä¸»æœåŠ¡å™¨åˆ°ä»æœåŠ¡å™¨çš„å…¬é’¥SSHç™»å½• å…·ä½“è¯·çœ‹åˆ†å¸ƒå¼\næ³¨æ„ ä¸‹é¢æ˜¯ä½¿ç”¨EMANEè¿›è¡Œåˆ†å¸ƒå¼æ¨¡æ‹Ÿçš„å¿«é€Ÿæ£€æŸ¥è¡¨ã€‚\néµå¾ªå¸¸è§„COREçš„æ­¥éª¤ã€‚ åœ¨EMANE WLANçš„ EMANE æ ‡ç­¾ä¸‹ï¼Œå•å‡» EMANE options ã€‚ æ‰“å¼€ OTA Manager channel ï¼Œè®¾ç½® OTA Manager device ã€‚åŒæ—¶è®¾ç½® Event Service device ã€‚ é€‰æ‹©èŠ‚ç‚¹ç»„ï¼Œå³é”®å•å‡»å®ƒä»¬ï¼Œå¹¶ä½¿ç”¨ assign to èœå•å°†å®ƒä»¬åˆ†é…ç»™ä¸»æˆ–ä»æœåŠ¡å™¨ã€‚ åœ¨å¼€å§‹æ¨¡æ‹Ÿä¹‹å‰ï¼Œä½¿ç”¨ ntp æˆ– ptp åŒæ­¥æœºå™¨çš„æ—¶é’Ÿã€‚ä¸€äº›EMANEæ¨¡å‹å¯¹æ—¶é—´å¾ˆæ•æ„Ÿã€‚ æŒ‰ Start æŒ‰é’®å¯åŠ¨åˆ†å¸ƒå¼ä»¿çœŸã€‚ ç°åœ¨ï¼Œå½“ä½¿ç”¨StartæŒ‰é’®å®ä¾‹åŒ–æ¨¡æ‹Ÿæ—¶ï¼Œæœ¬åœ°CORE Pythonå®ˆæŠ¤è¿›ç¨‹å°†è¿æ¥åˆ°å·²åˆ†é…ç»™èŠ‚ç‚¹çš„å…¶ä»–æ¨¡æ‹ŸæœåŠ¡å™¨ã€‚ æ¯ä¸ªæœåŠ¡å™¨éƒ½æœ‰è‡ªå·±çš„ä¼šè¯ç›®å½•ï¼Œå…¶ä¸­ç”Ÿæˆplatform.xmlæ–‡ä»¶å’Œå…¶ä»–EMANE XMLæ–‡ä»¶ã€‚NEM idåœ¨æœåŠ¡å™¨ä¹‹é—´è‡ªåŠ¨åè°ƒï¼Œ å› æ­¤æ²¡æœ‰é‡å ã€‚æ¯ä¸ªæœåŠ¡å™¨è¿˜è·å¾—è‡ªå·±çš„å¹³å°IDã€‚\nä»¥å¤ªç½‘è®¾å¤‡ç”¨äºä¼ æ’­ç»„æ’­EMANEäº‹ä»¶ï¼Œå¦‚ configure EMANE å¯¹è¯æ¡†ä¸­æ‰€æŒ‡å®šçš„ã€‚EMANEçš„äº‹ä»¶æœåŠ¡å¯ä»¥é€šè¿‡ç§»åŠ¨æ€§ æˆ–è·¯å¾„æŸè€—è„šæœ¬è¿è¡Œï¼Œå¦‚å•ä¸»æœºEmaneæ‰€è¿°ã€‚ å¦‚æœCOREæ²¡æœ‰è®¢é˜…ä½ç½®äº‹ä»¶ï¼Œå®ƒå°†åœ¨ç”»å¸ƒä¸Šç§»åŠ¨èŠ‚ç‚¹æ—¶ç”Ÿæˆè¿™äº›äº‹ä»¶ã€‚\nåœ¨è¿è¡Œæ—¶åŒå‡»èŠ‚ç‚¹å°†å¯¼è‡´GUIå°è¯•SSHåˆ°è¯¥èŠ‚ç‚¹çš„ä»¿çœŸæœåŠ¡å™¨ï¼Œå¹¶è¿è¡Œäº¤äº’å¼shellã€‚åœ¨å¯åŠ¨æ¨¡æ‹Ÿä¹‹å‰ï¼Œ åº”è¯¥ä½¿ç”¨æ‰€æœ‰æ¨¡æ‹ŸæœåŠ¡å™¨å¯¹å…¬é’¥SSHé…ç½®è¿›è¡Œæµ‹è¯•ã€‚\nEmaneæ¶æ„ Emaneæ¶æ„ä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š\nEmulation Processing(ä»¿çœŸæœåŠ¡è¿‡ç¨‹) Emulation Processing ç”± ç‰©ç†å±‚æ¨¡å‹ å®ä¾‹ä¸ä¸€ä¸ªæˆ–å¤šä¸ª æ— çº¿ç”µï¼ˆæ³¢å½¢ï¼‰æ¨¡å‹ å®ä¾‹é…å¯¹ã€‚ä»¿çœŸå™¨å¤„ç†XML é…ç½®æ–‡ä»¶ä»¥ç¡®å®šè¦å®ä¾‹åŒ–çš„æ— çº¿ç”µæ¨¡å‹æ’ä»¶ç±»å‹ã€åº”å¦‚ä½•é…ç½®æ¨¡å‹å’Œç‰©ç†å±‚å®ä¾‹ä»¥åŠåº”ç”¨ä»€ä¹ˆé€šç”¨ä¸šåŠ¡è®¾ç½®ã€‚\nEMANE åˆ†å¸ƒåŒ…æ‹¬ä¸‰ç§æ— çº¿ç”µæ¨¡å‹ï¼š\nRF Pipe Model IE 802.11abg Model TDMA Model å’Œä¸€ä¸ªå®ç”¨æ–°å‹ï¼š\nComm Effect Model å½“æ¨¡æ‹Ÿå™¨å³æ—¶åŒ–æ¨¡å‹æ’ä»¶æ—¶ï¼Œå®ƒå°†æ¯ä¸ªæ’ä»¶æ”¾ç½®åœ¨ ç½‘ç»œæ¨¡æ‹Ÿæ¨¡å—ï¼ˆNEMï¼‰ ä»¥åŠæ¨¡æ‹Ÿå™¨ç‰©ç†å±‚çš„ä¸“ç”¨å®ä¾‹ä¸­ã€‚ç‰©ç†å±‚å®ä¾‹ä½¿ç”¨ Over-The-Air ï¼ˆOTAï¼‰å¤šå¹¿æ’­é€šé“ç›¸äº’è¿æ¥ã€‚æ‰€æœ‰ OTA æ¶ˆæ¯å‡ç”±æ¯ä¸ªæ¨¡æ‹Ÿå™¨å®ä¾‹ä½¿ç”¨ç›¸åŒçš„ OTA å¤šå¹¿æ’­é€šé“è¿›è¡Œå¤„ç†ã€‚è¿™å°±æ˜¯æ¨¡æ‹Ÿå™¨ç‰©ç†å±‚å¦‚ä½•è´Ÿè´£å¼‚æ„æ— çº¿ç”µæ¨¡å‹çš„ä¿¡å·ä¼ æ’­ã€å¤©çº¿æ•ˆåº”å’Œå¹²æ‰°æºã€‚\næ¯ä¸ªæ— çº¿ç”µæ¨¡å‹çš„è¿è¡Œæ–¹å¼ä¸åŒï¼Œä½†ä¸€èˆ¬çš„æƒ³æ³•æ˜¯ï¼Œæ¨¡å‹ä»åº”ç”¨ç©ºé—´æ¥æ”¶æ¶ˆæ¯ï¼Œè¿›è¡Œç©ºä¸­ä¼ è¾“ï¼Œå¹¶å°†æ¶ˆæ¯å‘é€åˆ°å…¶ç‰©ç†å±‚å®ä¾‹ï¼Œä»¥ä¾¿é€šè¿‡ OTA å¤šæ’­é€šé“ä¼ è¾“ï¼ˆå¯èƒ½åœ¨æ— çº¿ç”µæ¨¡å‹æ‰§è¡Œé€šé“è®¿é—®åŠŸèƒ½ä¹‹åï¼‰ã€‚ä½¿ç”¨åŒä¸€ OTA å¤šæ’­é€šé“çš„æ‰€æœ‰æ¨¡æ‹Ÿå™¨å®ä¾‹éƒ½ä¼šæ¥æ”¶æ¶ˆæ¯å¹¶æ‰§è¡Œæ¥æ”¶åŠŸç‡æµ‹è¯•ã€‚æ ¹æ®æ¶ˆæ¯æ¥æ”¶åŠŸç‡çš„ç‰©ç†å±‚å®ä¾‹æ˜¯å¦å¤§äºæ¥æ”¶å™¨çµæ•åº¦ï¼Œå¯å°†æ¶ˆæ¯å½’ç±»ä¸ºå™ªå£°æˆ–æœ‰æ•ˆçš„å¸¦å†…æ³¢å½¢ä¿¡å·ã€‚æœ‰æ•ˆçš„æ³¢å½¢ä¿¡å·è¢«å‘é€åˆ°æ¥æ”¶æ— çº¿ç”µæ¨¡å‹è¿›è¡Œé¢å¤–çš„å¤„ç†ã€‚å¤§å¤šæ•°æ— çº¿ç”µæ¨¡å‹ä½¿ç”¨åŸºäºæ¶ˆæ¯ Signal to Noise and Interference Ratioï¼ˆSINRï¼‰ çš„ Bit Error Rate ï¼ˆBERï¼‰ æ›²çº¿ï¼Œä½œä¸ºå†³å®šæ˜¯å¦å°†æ¶ˆæ¯ä¼ é€’åˆ°ç›¸åº”çš„åº”ç”¨ç©ºé—´è¿‡ç¨‹çš„å†³å®šçš„ä¸€éƒ¨åˆ†ã€‚\næœ¯è¯­ application space process (åº”ç”¨ç©ºé—´è¿‡ç¨‹)ä¸åº”ä¸å†…æ ¸å’Œåº”ç”¨/ç”¨æˆ·ç©ºé—´çš„æ¦‚å¿µæ··æ·†ã€‚æ‰€æœ‰ EMANE è¿›ç¨‹éƒ½åœ¨ç”¨æˆ·ç©ºé—´ä¸­è¿è¡Œã€‚æˆ‘ä»¬ä½¿ç”¨æœ¯è¯­åº”ç”¨ç¨‹åºç©ºé—´ï¼ˆé€šå¸¸ä½œä¸º application/emulation boundary ä¸»é¢˜çš„ä¸€éƒ¨åˆ†ï¼‰è¡¨ç¤ºä»»ä½•è¿›ç¨‹ï¼Œè¯¥è¿‡ç¨‹ä¸æ˜¯ä½œä¸ºæ¨¡æ‹Ÿå™¨ä¸­çš„æ’ä»¶è¿è¡Œï¼Œè€Œæ˜¯ä»¥æŸç§æ–¹å¼è¿æ¥åˆ°ï¼ˆä½¿ç”¨ï¼‰æ¨¡æ‹Ÿå™¨ã€‚\næˆ‘ä»¬ä½¿ç”¨ ä¸‹æ¸¸ æœ¯è¯­æ¥è¡¨ç¤ºæ‰€æœ‰æŒ‡å‘ OTA å¤šæ’­é€šé“çš„æ¶ˆæ¯ï¼Œä»¥åŠæ‰€æœ‰å‘åº”ç”¨ç©ºé—´è¿‡ç¨‹äº¤ä»˜çš„æ¶ˆæ¯çš„ ä¸Šæ¸¸ æœ¯è¯­ã€‚è¿™å¹¶ä¸æ„å‘³ç€ OTA å¤šæ’­é€šé“æˆ–åº”ç”¨ç©ºé—´è¿‡ç¨‹å¿…é¡»æ˜¯æœ€ç»ˆæ¶ˆæ¯ç›®çš„åœ°ã€‚å½“æ— çº¿ç”µæ¨¡å‹å‘å…¶ç›¸åº”çš„ç‰©ç†å±‚å®ä¾‹å‘é€æ§åˆ¶æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä¸‹æ¸¸æ§åˆ¶æ¶ˆæ¯ï¼Œå½“ç‰©ç†å±‚å®ä¾‹å‘æ— çº¿ç”µæ¨¡å‹å‘é€æ•°æ®åŒ…æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º ä¸Šæ¸¸æ•°æ®åŒ…æ¶ˆæ¯ ã€‚ä¸€æ—¦ä½ å¼€å§‹åˆ†ææ— çº¿ç”µæ¨¡å‹æ€§èƒ½ç»Ÿè®¡ï¼Œä½ ä¼šç†è§£å…¶ä¸­çš„åŒºåˆ«ã€‚\nApplication/Emulation Transport Boundary Processing (ä¼ è¾“è¾¹ç•Œè¿‡ç¨‹) åº”ç”¨/æ¨¡æ‹Ÿä¼ è¾“è¾¹ç•Œæ˜¯è´Ÿè´£åœ¨æ¨¡æ‹Ÿå™¨å®ä¾‹å’Œä¸€ä¸ªæˆ–å¤šä¸ªåº”ç”¨ç©ºé—´è¿‡ç¨‹ä¹‹é—´ä¼ é€’æ¶ˆæ¯çš„ä»¿çœŸç»„ä»¶ã€‚æˆ‘ä»¬ç§°è¿™ä¸ªç»„ä»¶ä¸º è¿è¾“ å·¥å…·ã€‚ä¸ºæ¨¡æ‹Ÿå™¨å’Œåº”ç”¨ç©ºé—´æ¶ˆæ¯æä¾›å‡ºå…¥å£ç‚¹ã€‚\nè¿è¾“æ’ä»¶å¯ä»¥ä½œä¸ºæ¨¡æ‹Ÿå™¨è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†åœ¨å†…éƒ¨å³æ—¶åŒ–ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå…¶ä»–åº”ç”¨çš„ä¸€éƒ¨åˆ†åœ¨å¤–éƒ¨å³æ—¶åŒ–ã€‚Transport DaemonEMANE åº”ç”¨ç¨‹åºå¤„ç†é…ç½® XMLï¼Œä»¥ç¡®å®šè¦å³æ—¶çš„å¤–éƒ¨ä¼ è¾“æ’ä»¶ç±»å‹ã€åº”å¦‚ä½•é…ç½®æ’ä»¶ä»¥åŠåº”ç”¨ä»€ä¹ˆä¸€èˆ¬åº”ç”¨çº§åˆ«è®¾ç½®ã€‚\nEMANE åŒ…å«ä¸¤ç§ä¼ è¾“æ•°æ®çš„æ–¹å¼ï¼š\nRaw Transport Virtual Transport EMANE æ”¯æŒ IP å’Œé IP æ— çº¿ä»¿çœŸï¼Œå› æ­¤ä¸ªäººä¼ è¾“æ”¯æŒçš„åº”ç”¨ç©ºé—´æ¶ˆæ¯ç±»å‹å·®å¼‚å¾ˆå¤§ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦ä¼ è¾“æœ‰æ¶ˆæ¯è¦ä¼ é€’ï¼Œå®ƒä»¬é€šå¸¸éƒ½å¿…é¡»åšåŒæ ·çš„äº‹æƒ…ã€‚åœ¨ä¸‹æ¸¸æ–¹å‘ï¼Œä¼ è¾“å¿…é¡»ç¡®å®šä¸‹ä¸€è·³æ¶ˆæ¯çš„ NEM IDï¼ˆè¿™å¯èƒ½æ˜¯ NEM å¹¿æ’­åœ°å€ï¼‰ï¼Œå¹¶å°†æ¶ˆæ¯ä¸æºå’Œç›®çš„åœ° NEM ID ä¸€èµ·å‘é€åˆ°å·²è¿æ¥çš„ NEMã€‚åœ¨ä¸Šæ¸¸æ–¹å‘ï¼Œä¼ è¾“å¿…é¡»ç¡®å®šåº”ç”¨ç©ºé—´è¿‡ç¨‹æ‰èƒ½æ¥æ”¶å¹¶å‘é€æ¶ˆæ¯ã€‚\nå½“åº”ç”¨ç¨‹åºç©ºé—´æ¶ˆæ¯é€šè¿‡Transportä¼ è¾“æ—¶ï¼Œå®ƒä»¬å°†å¤±å»å…¶å½¢å¼ï¼Œå¹¶ä½œä¸ºæŒ‡å®šå¤§å°çš„ä¸é€æ˜æœ‰æ•ˆè´Ÿè½½é€šè¿‡ä»¿çœŸå™¨å‘é€ã€‚Transportæ˜¯æ¨¡æ‹Ÿå™¨ä¸­å”¯ä¸€å¯ä»¥è¯»å†™åº”ç”¨ç¨‹åºç©ºé—´æ¶ˆæ¯ç»†èŠ‚çš„ç»„ä»¶ã€‚\nä¾‹å¦‚ï¼ŒVirtual Transportä½¿ç”¨TUN/TAPæ¥å£åˆ›å»º è™šæ‹Ÿæ¥å£ ï¼ˆvifï¼‰ ä½œä¸ºåº”ç”¨ç¨‹åº/æ¨¡æ‹Ÿè¾¹ç•Œå…¥å£/å‡ºå£ç‚¹ã€‚åœ¨ä¸‹æ¸¸æ–¹å‘ä¸Šï¼Œç”±å†…æ ¸è·¯ç”±åˆ° vif çš„ä»¥å¤ªç½‘æ¡†æ¶è¢«æ‰“åŒ…æˆæ¶ˆæ¯å¹¶å‘é€åˆ°é€‚å½“çš„ NEM è¿›è¡Œå¤„ç†ã€‚åœ¨ä¸Šæ¸¸æ–¹å‘ï¼ŒNEM æ¶ˆæ¯è¢«æ‹†åŒ…å¹¶ä½œä¸ºä»¥å¤ªç½‘å¸§å†™å…¥åˆ° TUN/TAP ç•Œé¢ã€‚\nåº”ç”¨/æ¨¡æ‹Ÿè¾¹ç•Œä¸é™äºç”±ä»¿çœŸå™¨å†…éƒ¨åŠ è½½çš„æ’ä»¶æˆ–ç”±è¿è¾“å®ˆæŠ¤è¿›ç¨‹ä»å¤–éƒ¨åŠ è½½çš„æ’ä»¶ã€‚å½“å°† è½¯ä»¶å®šä¹‰æ— çº¿ç”µï¼ˆSDRï¼‰æ³¢å½¢è¿æ¥åˆ° EMANE æ—¶ï¼Œåº”å¼€å‘è‡ªå®šä¹‰ä¼ è¾“å¹¶åµŒå…¥*Modem Hardware Abstraction Layer *ï¼ˆMHALï¼‰ çš„ SDR ä¸­ã€‚EMANE æä¾›åº”ç”¨çº§åˆ«çš„ APIï¼Œä½¿å¼€å‘è‡ªå®šä¹‰ä¼ è¾“éå¸¸å®¹æ˜“ã€‚\nEvent Processing (ä»¿çœŸäº‹ä»¶è¿‡ç¨‹) ä¸ºäº†æœ‰è¶£ï¼Œè¿è¡Œæ¨¡æ‹Ÿéœ€è¦ä¸€ä¸ªåœºæ™¯ã€‚åœºæ™¯æ˜¯å‘é€åˆ°ä¸€ä¸ªæˆ–å¤šä¸ª NEM ä»¥æ›´æ”¹ç¯å¢ƒç‰¹å¾çš„ä¸€ç»„äº‹ä»¶ã€‚äº‹ä»¶ä¸é€æ˜åœ°ä¼ é€’ç»™æ³¨å†Œçš„æ— çº¿ç”µæ¨¡å‹å®ä¾‹ï¼Œå› æ­¤å•ä¸ªæ— çº¿ç”µæ¨¡å‹å¯èƒ½éœ€è¦è‡ªå·±çš„ä¸“ä¸šæ´»åŠ¨ã€‚åªè¦æœ‰å¯èƒ½ï¼Œæˆ‘ä»¬ä¸»å¼ é‡å¤ä½¿ç”¨ EMANE æ ‡å‡†äº‹ä»¶ï¼Œè€Œä¸æ˜¯åˆ›å»ºåšåŒæ ·çš„äº‹æƒ…çš„æ–°äº‹ä»¶ã€‚\nEMANE åˆ†å¸ƒåŒ…æ‹¬ä»¥ä¸‹äº‹ä»¶ï¼š\nAntenna Profile Event Comm Effect Event Location Event Pathloss Event TDMA Schedule Event Fading Selection Event äº‹ä»¶ç”±äº‹ä»¶ç”Ÿæˆå™¨åˆ›å»ºã€‚Event ServiceEMANE åº”ç”¨ç¨‹åºå¤„ç†XMLé…ç½®æ–‡ä»¶ä»¥ç¡®å®šè¦å³æ—¶å¤„ç†çš„äº‹ä»¶ç”Ÿæˆå™¨æ’ä»¶çš„ç±»å‹ã€åº”å¦‚ä½•é…ç½®æ’ä»¶ä»¥åŠåº”ç”¨ä»€ä¹ˆä¸šåŠ¡ã€‚\nEMANE åˆ†å¸ƒåŒ…å«ä¸€ä¸ªäº‹ä»¶ç”Ÿæˆå™¨ï¼Œå°†åˆ›å»ºæ‰€æœ‰æ ‡å‡†äº‹ä»¶ï¼š\nEEL Generator å¹¶æä¾›python modulesï¼Œè®©æ‚¨åˆ›å»ºè‡ªå·±çš„äº‹ä»¶ç”Ÿæˆå™¨åº”ç”¨ç¨‹åºï¼š\nemane.events.EventService emane.events.AntennaProfileEvent emane.events.CommEffectEvent emane.events.LocationEvent emane.events.PathlossEvent emane.events.TDMAScheduleEvent emane.events.FadingSelectionEvent Emaneæ•™ç¨‹åŠæµ‹è¯• EMANE æ•™ç¨‹ æµ‹è¯•å®ä¾‹ Emane shellç”¨æ³• æœ¬æ•™ç¨‹ä¸­çš„æ¯ä¸ªæ¼”ç¤ºéƒ½æ—¨åœ¨çªå‡ºæ˜¾ç¤ºæ¨¡æ‹Ÿå™¨çš„ç‰¹å®šåŠŸèƒ½ã€‚æœ¬æ•™ç¨‹æä¾›äº†ä¸€ä¸ªä½¿ç”¨LXC Containers åˆ›å»ºä¸€ç»„æµ‹è¯•èŠ‚ç‚¹çš„ç®€å•æµ‹è¯•æµï¼Œè¿™äº›æµ‹è¯•èŠ‚ç‚¹è¿è¡Œæ¨¡æ‹Ÿå™¨å®ä¾‹ä»¥åŠMANET(ç§»åŠ¨è‡ªç»„ç½‘)ä¸–ç•Œä¸­é€šå¸¸ä½¿ç”¨çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚\nå…¶ä¸­å…³äºç¯å¢ƒå’Œæµ‹è¯•ç”¨ä¾‹çš„é…ç½®æ–¹æ³•ä¸ºäº†æ–¹ä¾¿çœäº‹ï¼Œç›´æ¥ç”¨å®˜æ–¹ç»™çš„è™šæ‹Ÿæœºæ¥åšæµ‹è¯•ã€‚\næ•™ç¨‹è™šæ‹Ÿæœº (Tutorial VM) æ˜¯ä¸€ä¸ªCentOS 7 VirtualBoxé•œåƒï¼Œå¸¦æœ‰EMANE 1.2.1ã€‚æ•™ç¨‹æ¼”ç¤ºçš„ä¿çœŸåº¦å°†æ ¹æ®ä¸»æœºç³»ç»Ÿé…ç½®çš„ä¸åŒè€Œå˜åŒ–ã€‚\nç”¨æˆ·åï¼šemane å¯†ç : emanedemo è™šæ‹Ÿæœºsha1sum: 9fb689eff14b43f700935e8514abb62aebc13761 # é¦–å…ˆè¿›è¡Œç¼–è¯‘å®‰è£… cd ~/emane-tutorial make æ•™ç¨‹ä¸­æœ‰9ä¸ªdemoæµ‹è¯•ï¼š\nDemo å®¹å™¨æ•° æ¨¡å‹ ä¼ è¾“ æè¿° 0 2 Bypass Virtual ä»‹ç»ä»¿çœŸå™¨å­ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åº 1 10 RF Pipe Virtual ä»‹ç»äº‹ä»¶ç”Ÿæˆã€EMANE Shellå’Œä¸€èˆ¬ç‰©ç†å±‚çš„æ¦‚å¿µ 2 7 RF Pipe Virtual ä»‹ç»å°„é¢‘ç®¡æ— çº¿ç”µæ¨¡å‹(RF Pipe radio) 3 10 IEEE 802.11abg Virtual ä»‹ç»IEEE 802.11abgæ— çº¿æ¨¡å‹ 5 4 IEEE 802.11abg, RF Pipe Virtual äº†è§£ä»¿çœŸå™¨é¢‘è°±ç›‘æµ‹å’Œå™ªå£°å¤„ç† 6 4 RF Pipe Virtual å¦‚ä½•ä½¿ç”¨ç‰©ç†å±‚å¤©çº¿é…ç½®æ–‡ä»¶ 7 10 Comm Effect Raw ä»‹ç»äº†Comm Effectå®ç”¨æ¨¡å‹å’Œé»‘ç›’æµ‹è¯• 8 10 TDMA Virtual ä»‹ç»TDMAäº‹ä»¶è°ƒåº¦å™¨æ— çº¿ç”µæ¨¡å‹ æ³¨æ„ï¼š\næ­¤æ•™ç¨‹ä»…ä»…å±•ç¤ºEmaneå·¥ä½œæµç¨‹æ— éœ€ä¸“é—¨å­¦ä¹ å…¶é…ç½®æµç¨‹ï¼Œåœ¨coreä¸­é…ç½®èŠ‚ç‚¹Emaneç­‰æ“ä½œæœ‰ä¸“é—¨çš„æ§åˆ¶æµç¨‹ã€‚å¹¶ä¸”Emaneçš„å®ç°å¹¶ä¸ä¸€å®šéœ€è¦LXCå®¹å™¨ï¼Œä½†æ˜¯è¿™é‡Œå±•ç¤ºå’Œcoreçš„èŠ‚ç‚¹å®ç°æ˜¯é‡‡ç”¨lxcå®¹å™¨åšçš„ã€‚\næ³¨æ„ï¼šä¹‹åçš„å‡ ç« èŠ‚æµ‹è¯•ä½¿ç”¨corepyguiæ‰“å¼€å›¾ç‰‡è·¯å¾„ä¸ä¼šæŠ¥é”™ï¼Œè¿™å‡ ä¸ªemaneæµ‹è¯•åœºæ™¯è·¯å¾„ä¸º ~/.coregui/xmls æ³¨æ„ï¼šemane çš„å‡ ä¸ªpythonç¨‹åºé»˜è®¤ç”¨çš„æ˜¯ä¸»æœºpythonï¼Œå®‰è£…åœ¨è™šæ‹Ÿç¯å¢ƒçš„coreéœ€è¦å°†pythonè¿è¡Œè·¯å¾„æ›¿æ¢ä¸ºcore-pythonï¼Œæˆ–è€…ä½¿ç”¨core-pythonè¿è¡Œã€‚å…¶ä½¿ç”¨è¯´æ˜åœ¨emaneä»‹ç»ä¸­å¯ä»¥çœ‹åˆ°ã€‚\nXML Files åœ¨é…ç½®å¥½emaneçš„åœºæ™¯æˆ–ç›´æ¥è¿è¡Œ emane-demo-files.xml åï¼Œåœ¨ä¼šè¯çš„ä¸´æ—¶ç›®å½•(ä¾‹å¦‚/tmp/pycore.44151/n8.conf) ä¸­å°±ä¼šç”Ÿæˆå¯¹åº”emaneé…ç½®çš„xmlæ–‡ä»¶ã€‚å°±åƒ emane-demo ä¸­é…ç½®çš„xmlæ–‡ä»¶é‚£æ ·ã€‚ï¼ˆemane demo0ï¼‰\nç”¨äºèŠ‚ç‚¹è¿è¡ŒEMANEçš„æ ¹é…ç½®æ–‡ä»¶æ˜¯ platform.xml æ–‡ä»¶ã€‚å…¶ä½œç”¨ä¸ºï¼š\nåˆ—å‡ºä¸ºEmaneè®¾å®šçš„æ‰€æœ‰æ€»é…ç½®å€¼ ä¸ºèŠ‚ç‚¹åˆ›å»ºçš„æ¯ä¸ªæ¥å£ç»™å®šçš„å”¯ä¸€çš„ nem id ç”¨äºå®šä¹‰ä½¿ç”¨çš„ nem.xml è·¯å¾„ nem.xmlæ–‡ä»¶å®šä¹‰å°†åŒ…å«å¯¹ç»™å®šnemæ‰€ä½¿ç”¨çš„ transport mac phy xmlæ–‡ä»¶çš„çš„å®šä¹‰åŠå¼•ç”¨ã€‚\næ–‡ä»¶å æè¿° -platform.xml emaneä»¿çœŸå®ä¾‹åŒ–çš„é…ç½®æ–‡ä»¶ -nem.xml åˆ›é€ NEMçš„é…ç½®æ–‡ä»¶ (NEM: Network Emulation Modules) -mac.xml ç”¨äºå®šä¹‰NEMs MACå±‚çš„é…ç½® -phy.xml ç”¨äºå®šä¹‰NEMs PHYå±‚çš„é…ç½® -trans-virtual.xml ä½¿ç”¨ virtual ä¼ è¾“æ—¶çš„é…ç½® -trans.xml ä½¿ç”¨ raw ä¼ è¾“æ—¶çš„é…ç½® Gpsd GPSDæ˜¯ä¸€ä¸ªè®¡ç®—æœºè½¯ä»¶ç¨‹åºï¼Œä»å…¨çƒå®šä½ç³»ç»Ÿï¼ˆGPSï¼‰æ¥æ”¶å™¨æ”¶é›†æ•°æ®ï¼Œå¹¶é€šè¿‡äº’è”ç½‘åè®®ï¼ˆIPï¼‰ç½‘ç»œå‘æœåŠ¡å™¨-å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæ¶æ„ä¸­æ½œåœ¨çš„å¤šä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæä¾›æ•°æ®ã€‚Gpsd å¯ä»¥ä½œä¸ºä¸€ä¸ªdaemonè¿è¡Œï¼Œä»¥é€æ˜çš„æ–¹å¼è¿è¡Œä¸ºæœåŠ¡å™¨çš„åå°ä»»åŠ¡ã€‚ç½‘ç»œç•Œé¢ä¸ºå¤šä¸ªå¹¶å‘å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼ˆå¦‚Kismetæˆ– GPSå¯¼èˆªè½¯ä»¶ï¼‰æä¾›äº†æ ‡å‡†åŒ–çš„æ•°æ®æ ¼å¼ã€‚Emaneçš„ä½ç½®æ•°æ®å°±æ˜¯å¦‚æ­¤è·å–çš„ï¼ˆEMANEä»¿çœŸä¸­è¿è¡Œgpsdä½ç½®ä»£ç†ï¼Œè¯¥ä»£ç†å°†æŠŠä½ç½®è¾“å‡ºåˆ°ä¼ªç»ˆç«¯æ–‡ä»¶gps.ptyã€‚gpsdæœåŠ¡å™¨å¯ä»¥è¯»å…¥è¯¥æ–‡ä»¶ï¼Œä½¿gpsdå®¢æˆ·æœºå¯ä»¥ä½¿ç”¨EMANEä½ç½®äº‹ä»¶ã€‚ï¼‰\nç‰©ç†æœºä¸Šå®‰è£…gpsdè½¯ä»¶ï¼š\nsudo apt-get install gpsd sudo apt-get install gpsd-clients gpsdå®¢æˆ·ç«¯åŠdaemonçš„å®˜æ–¹ä»‹ç»\nè¿è¡Œç¤ºä¾‹ emane-demo-gpsd.xmlï¼ˆemane demo0ï¼‰\nEMANE GPSD Event Daemon å…·ä½“æµç¨‹:\né¦–å…ˆåœ¨ä¼šè¯ç›®å½•å¯¹åº”çš„n1èŠ‚ç‚¹æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºemane çš„äº‹ä»¶å®ˆæŠ¤è¿›ç¨‹é…ç½®æ–‡ä»¶ eventdaemon.xmlã€‚ \u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;!DOCTYPE eventdaemon SYSTEM \u0026quot;file:///usr/share/emane/dtd/eventdaemon.dtd\u0026quot;\u0026gt; \u0026lt;eventdaemon nemid=\u0026quot;1\u0026quot;\u0026gt; \u0026lt;param name=\u0026quot;eventservicegroup\u0026quot; value=\u0026quot;224.1.2.8:45703\u0026quot;/\u0026gt; \u0026lt;param name=\u0026quot;eventservicedevice\u0026quot; value=\u0026quot;ctrl0\u0026quot;/\u0026gt; \u0026lt;agent definition=\u0026quot;gpsdlocationagent.xml\u0026quot;/\u0026gt; \u0026lt;/eventdaemon\u0026gt; ä¸Šé¢çš„é…ç½®ä¼šç”Ÿæˆå¦‚ä¸‹çš„ gpsdlocationagent.xml æ–‡ä»¶ã€‚ \u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;!DOCTYPE eventagent SYSTEM \u0026quot;file:///usr/share/emane/dtd/eventagent.dtd\u0026quot;\u0026gt; \u0026lt;eventagent library=\u0026quot;gpsdlocationagent\u0026quot;\u0026gt; \u0026lt;param name=\u0026quot;pseudoterminalfile\u0026quot; value=\u0026quot;gps.pty\u0026quot;/\u0026gt; \u0026lt;/eventagent\u0026gt; å¯åŠ¨EMANEäº‹ä»¶ä»£ç†ã€‚è¿™å°†æœ‰åŠ©äºå°†ä½ç½®äº‹ä»¶è¾“å‡ºåˆ°ä¸Šé¢å®šä¹‰çš„ä¼ªç»ˆç«¯æ–‡ä»¶ã€‚ emaneeventd eventdaemon.xml -r -d -l 3 -f emaneeventd.log å¯åŠ¨gpsdï¼Œè¯»å–ä¼ªç»ˆç«¯æ–‡ä»¶ã€‚ gpsd -G -n -b $(cat gps.pty) EMANE EEL Event Daemon å…·ä½“æµç¨‹:\nEEL äº‹ä»¶å°†é€šè¿‡æŒ‡å®šçš„æ§åˆ¶ç½‘ç»œæ¥å£ä»å®é™…ä¸»æœºè¿è¡Œã€‚åœ¨ä¸»æœºä¸Šçš„åŒä¸€ç›®å½•ä¸­åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼Œåœ¨ä¸»æœºç»ˆç«¯æ‰“å¼€å¯¹åº”æ–‡ä»¶å¤¹\næ³¨æ„ï¼šç¡®ä¿ä»¥ä¸‹ eventservicedevice ä¸ä¸»æœºä¸Šç”¨äº EMANE çš„æ§åˆ¶ç½‘ç»œè®¾å¤‡åŒ¹é…\nåˆ›å»º eventservice.xml æ–‡ä»¶ \u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;!DOCTYPE eventservice SYSTEM \u0026quot;file:///usr/share/emane/dtd/eventservice.dtd\u0026quot;\u0026gt; \u0026lt;eventservice\u0026gt; \u0026lt;param name=\u0026quot;eventservicegroup\u0026quot; value=\u0026quot;224.1.2.8:45703\u0026quot;/\u0026gt; \u0026lt;param name=\u0026quot;eventservicedevice\u0026quot; value=\u0026quot;b.9001.1\u0026quot;/\u0026gt; \u0026lt;generator definition=\u0026quot;eelgenerator.xml\u0026quot;/\u0026gt; \u0026lt;/eventservice\u0026gt; åˆ›å»º eelgenerator.xml æ–‡ä»¶ \u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;!DOCTYPE eventgenerator SYSTEM \u0026quot;file:///usr/share/emane/dtd/eventgenerator.dtd\u0026quot;\u0026gt; \u0026lt;eventgenerator library=\u0026quot;eelgenerator\u0026quot;\u0026gt; \u0026lt;param name=\u0026quot;inputfile\u0026quot; value=\u0026quot;scenario.eel\u0026quot; /\u0026gt; \u0026lt;paramlist name=\u0026quot;loader\u0026quot;\u0026gt; \u0026lt;item value=\u0026quot;commeffect:eelloadercommeffect:delta\u0026quot;/\u0026gt; \u0026lt;item value=\u0026quot;location,velocity,orientation:eelloaderlocation:delta\u0026quot;/\u0026gt; \u0026lt;item value=\u0026quot;pathloss:eelloaderpathloss:delta\u0026quot;/\u0026gt; \u0026lt;item value=\u0026quot;antennaprofile:eelloaderantennaprofile:delta\u0026quot;/\u0026gt; \u0026lt;/paramlist\u0026gt; \u0026lt;/eventgenerator\u0026gt; åˆ›å»º scenario.eel æ–‡ä»¶ 0.0 nem:1 location gps 40.031075,-74.523518,3.000000 0.0 nem:2 location gps 40.031165,-74.523412,3.000000 å¯åŠ¨ EEL äº‹ä»¶æœåŠ¡ï¼Œå®ƒå°†é€šè¿‡æ§åˆ¶ç½‘ç»œå°†ä¸Šè¿°æ–‡ä»¶ä¸­å®šä¹‰çš„äº‹ä»¶å‘é€åˆ°æ‰€æœ‰ EMANE èŠ‚ç‚¹ã€‚è¿™äº›ä½ç½®äº‹ä»¶å°†è¢«æ¥æ”¶å¹¶æä¾›ç»™ gpsdã€‚è¿™å…è®¸ gpsd å®¢æˆ·ç«¯è¿æ¥å¹¶è·å– gps ä½ç½®ã€‚ emaneeventservice eventservice.xml -l 3 é¢„è®¡ç®—ä¼ æ’­æ¨¡å‹ ç‰©ç†å±‚æ¨¡å‹ä¸­çš„è·¯å¾„æŸè€—åŸºäºä½ç½®æˆ–è·¯å¾„æŸè€—äº‹ä»¶ã€‚å½“ä¼ æ’­æ¨¡å‹é…ç½®å‚æ•°è®¾ç½®ä¸º2rayæˆ–freespaceæ—¶ï¼Œè·¯å¾„æŸè€—æ˜¯åŸºäºä½ç½®äº‹ä»¶åŠ¨æ€è®¡ç®—çš„ï¼Œè¿™å°†åˆ†åˆ«åœ¨2-ray flat earthæˆ–freespaceä¼ æ’­æ¨¡å‹ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å¤–éƒ¨ä¼ æ’­çš„è·¯å¾„æŸè€—äº‹ä»¶è®¡ç®—å®æ—¶çš„è·¯å¾„æŸè€—ï¼Œéœ€è¦å°†propagationmodelå‚æ•°è®¾ç½®ä¸ºé¢„å…ˆè®¡ç®—æ¨¡å‹precomputed,ä»¥å¤„ç†æ¥æ”¶çš„è·¯å¾„æŸè€—pathlossäº‹ä»¶ã€‚\nä»‹ç»é¢„å…ˆè®¡ç®—æ¨¡å‹ï¼ˆEMANE Demo 1ï¼‰ï¼Œè¿è¡Œ emane-demo-precomputed.xml åœºæ™¯ï¼Œï¼ˆç›¸å¯¹äºä¸Šé¢çš„åœºæ™¯å³æ”¹å˜rf-pipeé€‰é¡¹-\u0026gt;PHY Parameters-\u0026gt;propagationmodel-\u0026gt;precomputedï¼‰\næ‰“å¼€n1ä¸­ç»ˆç«¯,ç”±äºä½¿ç”¨äº†é¢„è®¡ç®—çš„è·¯å¾„æŸè€—äº‹ä»¶ï¼Œå¹¶ä¸”è¿˜æ²¡æœ‰å‘é€ä»»ä½•è·¯å¾„æŸè€—äº‹ä»¶ï¼ŒèŠ‚ç‚¹ä¹‹é—´è¿˜ä¸èƒ½pingé€šã€‚\næ‚¨å¯ä»¥åˆ©ç”¨ EMANE Shell æ¥è°ƒæŸ¥æ•°æ®åŒ…è¢«ä¸¢å¼ƒçš„åŸå› ã€‚\nroot@n1:/tmp/pycore.46777/n1.conf# emanesh localhost get table nems phy BroadcastPacketDropTable0 UnicastPacketDropTable0 nem 1 phy BroadcastPacketDropTable0 | NEM | Out-of-Band | Rx Sensitivity | Propagation Model | Gain Location | Gain Horizon | Gain Profile | Not FOI | Spectrum Clamp | Fade Location | Fade Algorithm | Fade Select | | 2 | 0 | 0 | 169 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | nem 1 phy UnicastPacketDropTable0 | NEM | Out-of-Band | Rx Sensitivity | Propagation Model | Gain Location | Gain Horizon | Gain Profile | Not FOI | Spectrum Clamp | Fade Location | Fade Algorithm | Fade Select | åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•°æ®åŒ…è¢«ä¸¢å¼ƒçš„åŸå› æ˜¯ç”±äºä¼ æ’­æ¨¡å‹ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å‘å‡ºä»»ä½•è·¯å¾„æŸè€—äº‹ä»¶ã€‚æ‚¨å¯ä»¥è¿è¡Œå¦ä¸€ä¸ªå‘½ä»¤æ¥éªŒè¯æ‚¨æ˜¯å¦æ”¶åˆ°äº†ä»»ä½•è·¯å¾„æŸè€—äº‹ä»¶ã€‚\nroot@n1:/tmp/pycore.46777/n1.conf# emanesh localhost get table nems phy PathlossEventInfoTable nem 1 phy PathlossEventInfoTable | NEM | Forward Pathloss | Reverse Pathloss | Pathloss Events åœ¨ä¸»æœºä¸Šï¼Œæˆ‘ä»¬å°†ä»æ‰€æœ‰nemå‘æ‰€æœ‰å…¶ä»–nemå‘é€è·¯å¾„æŸè€—äº‹ä»¶ã€‚\næ³¨æ„:ç¡®ä¿æ­£ç¡®æŒ‡å®šæ§åˆ¶ç½‘ç»œè®¾å¤‡\nemaneevent-pathloss 1:2 90 -i \u0026lt;controlnet device\u0026gt; ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æ£€æŸ¥n2ä¸Šçš„è·¯å¾„æŸè€—äº‹ä»¶ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°åˆšæ‰å‘é€çš„å†…å®¹ã€‚\nroot@n1:/tmp/pycore.46777/n1.conf# emanesh localhost get table nems phy PathlossEventInfoTable nem 1 phy PathlossEventInfoTable | NEM | Forward Pathloss | Reverse Pathloss | | 2 | 90.0 | 90.0 è¿™ä¹‹åå°±å¯ä»¥ ping é€šn1 n2ã€‚ï¼ˆéœ€è¦ä¸¤è¾¹éƒ½æ·»åŠ é»˜è®¤ç½‘å…³è·¯ç”± ip link default add 10.0.0.2[1]ï¼‰\nå…¶å®ç›´æ¥çœ‹guiä¸Šæœ‰æ— ç»¿çº¿å°±çŸ¥æ˜¯å¦è”é€šï¼Œæœ‰ç»¿çº¿pingä¸é€šå¤§æ¦‚ç‡æ˜¯è·¯ç”±é—®é¢˜ã€‚\nEELç”Ÿæˆå™¨ è¿™é‡Œå°†ä»‹ç»å¦‚ä½•ä½¿ç”¨EMANEäº‹ä»¶æœåŠ¡å’Œeelæ–‡ä»¶æä¾›äº‹ä»¶ã€‚å¯ä»¥åŠ è½½ä¸€ä¸ªåˆå§‹åœºæ™¯ emane-demo-eel.xmlï¼ˆEMANE Demo 1ï¼‰\nåœ¨n1ä¸Šï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ EMANE event dump utility ç›‘å¬äº‹ä»¶ã€‚\nroot@n1:/tmp/pycore.46777/n1.conf# emaneevent-dump -i ctrl0 å‘é€äº‹ä»¶ ä½¿ç”¨ä»¥ä¸‹å†…å®¹åˆ›å»ºeventservice.xmlã€‚ï¼ˆåœ¨å¤–éƒ¨ä¸»æœºåˆ›å»ºè¿è¡Œï¼‰\næµ‹è¯•å‘ç° å¦‚æœ emane_event_monitor æ²¡æœ‰è®¾ç½®ä¸º Trueï¼Œ å‘é€æ”¹å˜èŠ‚ç‚¹gpsä½ç½®äº‹ä»¶ï¼ŒèŠ‚ç‚¹GPSçš„ç¡®æ”¹å˜ï¼Œä½†æ˜¯å¯¹åº”core UIä¸ä¼šæ”¹å˜ã€‚\n\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;!DOCTYPE eventservice SYSTEM \u0026quot;file:///usr/share/emane/dtd/eventservice.dtd\u0026quot;\u0026gt; \u0026lt;eventservice\u0026gt; \u0026lt;param name=\u0026quot;eventservicegroup\u0026quot; value=\u0026quot;224.1.2.8:45703\u0026quot;/\u0026gt; \u0026lt;param name=\u0026quot;eventservicedevice\u0026quot; value=\u0026quot;b.9001.f\u0026quot;/\u0026gt; \u0026lt;generator definition=\u0026quot;eelgenerator.xml\u0026quot;/\u0026gt; \u0026lt;/eventservice\u0026gt; æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºeelgenerator.xmlæ–‡ä»¶ã€‚\nEEL Generatorå®é™…ä¸Šæ˜¯ä¸€ä¸ªsentenceåŠ è½½å¹¶è§£æçš„æ’ä»¶ã€‚ è§£ææ’ä»¶çŸ¥é“å¦‚ä½•å°†æŸäº›æŒ‡ä»¤(commeffectã€locationã€velocityã€orientationã€pathlosså’Œantennaprofile )è½¬æ¢æˆç›¸åº”çš„emaneäº‹ä»¶ã€‚\ncommeffect : eelloadercommeffect : delta location, velocity, orientation : eelloaderlocation:delta pathloss : eelloaderpathloss : delta antennaprofile : eelloaderantennaprofile : delta è¿™äº›é…ç½®é¡¹å‘Šè¯‰EEL Generator å“ªäº› sentences è¦æ˜ å°„åˆ°å“ªä¸ªæ’ä»¶ï¼Œä»¥åŠæ˜¯å‘å¸ƒå¢é‡æ›´æ–°è¿˜æ˜¯å®Œæ•´æ›´æ–°ã€‚\n\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;!DOCTYPE eventgenerator SYSTEM \u0026quot;file:///usr/share/emane/dtd/eventgenerator.dtd\u0026quot;\u0026gt; \u0026lt;eventgenerator library=\u0026quot;eelgenerator\u0026quot;\u0026gt; \u0026lt;param name=\u0026quot;inputfile\u0026quot; value=\u0026quot;scenario.eel\u0026quot; /\u0026gt; \u0026lt;paramlist name=\u0026quot;loader\u0026quot;\u0026gt; \u0026lt;item value=\u0026quot;commeffect:eelloadercommeffect:delta\u0026quot;/\u0026gt; \u0026lt;item value=\u0026quot;location,velocity,orientation:eelloaderlocation:delta\u0026quot;/\u0026gt; \u0026lt;item value=\u0026quot;pathloss:eelloaderpathloss:delta\u0026quot;/\u0026gt; \u0026lt;item value=\u0026quot;antennaprofile:eelloaderantennaprofile:delta\u0026quot;/\u0026gt; \u0026lt;/paramlist\u0026gt; \u0026lt;/eventgenerator\u0026gt; æœ€å,åˆ›å»º scenario.eel\n0.0 nem:1 pathloss nem:2,90.0 0.0 nem:2 pathloss nem:1,90.0 0.0 nem:1 location gps 40.031075,-74.523518,3.000000 0.0 nem:2 location gps 40.031165,-74.523412,3.000000 emaneeventservice eventservice.xml -l 3 å¦‚æœæˆ‘ä»¬è¿”å›æŸ¥çœ‹åŸå§‹ç»ˆç«¯ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°äº‹ä»¶æ³¨é”€åˆ°ç»ˆç«¯ã€‚\nroot@n1:/tmp/pycore.46777/n1.conf# emaneevent-dump -i ctrl0 [1601858142.917224] nem: 0 event: 100 len: 66 seq: 1 [Location] UUID: 0af267be-17d3-4103-9f76-6f697e13bcec (1, {'latitude': 40.031075, 'altitude': 3.0, 'longitude': -74.823518}) (2, {'latitude': 40.031165, 'altitude': 3.0, 'longitude': -74.523412}) [1601858142.917466] nem: 1 event: 101 len: 14 seq: 2 [Pathloss] UUID: 0af267be-17d3-4103-9f76-6f697e13bcec (2, {'forward': 90.0, 'reverse': 90.0}) [1601858142.917889] nem: 2 event: 101 len: 14 seq: 3 [Pathloss] UUID: 0af267be-17d3-4103-9f76-6f697e13bcec (1, {'forward': 90.0, 'reverse': 90.0}) å¤©çº¿é…ç½® ä»‹ç»åœ¨COREä¸­ä½¿ç”¨EMANEå¤©çº¿å‰–é¢ï¼ŒåŸºäºä¸‹é¢é“¾æ¥çš„EMANEæ¼”ç¤ºç¤ºä¾‹ã€‚ï¼ˆEMANE Demo 6ï¼‰\nåœ¨å¼€å§‹è¿™ä¸ªä¼šè¯ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€äº›æ–‡ä»¶ã€‚åˆ›å»ºç›®å½•æ”¾ç½®å¤©çº¿é…ç½®æ–‡ä»¶ã€‚\nmkdir /tmp/emane åˆ›å»º /tmp/emane/antennaprofile.xml\n\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;!DOCTYPE profiles SYSTEM \u0026quot;file:///usr/share/emane/dtd/antennaprofile.dtd\u0026quot;\u0026gt; \u0026lt;profiles\u0026gt; \u0026lt;profile id=\u0026quot;1\u0026quot; antennapatternuri=\u0026quot;/tmp/emane/antenna30dsector.xml\u0026quot; blockagepatternuri=\u0026quot;/tmp/emane/blockageaft.xml\u0026quot;\u0026gt; \u0026lt;placement north=\u0026quot;0\u0026quot; east=\u0026quot;0\u0026quot; up=\u0026quot;0\u0026quot;/\u0026gt; \u0026lt;/profile\u0026gt; \u0026lt;profile id=\u0026quot;2\u0026quot; antennapatternuri=\u0026quot;/tmp/emane/antenna30dsector.xml\u0026quot;\u0026gt; \u0026lt;placement north=\u0026quot;0\u0026quot; east=\u0026quot;0\u0026quot; up=\u0026quot;0\u0026quot;/\u0026gt; \u0026lt;/profile\u0026gt; \u0026lt;/profiles\u0026gt; åˆ›å»º /tmp/emane/antenna30dsector.xml\n\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;!DOCTYPE antennaprofile SYSTEM \u0026quot;file:///usr/share/emane/dtd/antennaprofile.dtd\u0026quot;\u0026gt; \u0026lt;!-- 30degree sector antenna pattern with main beam at +6dB and gain decreasing by 3dB every 5 degrees in elevation or bearing.--\u0026gt; \u0026lt;antennaprofile\u0026gt; \u0026lt;antennapattern\u0026gt; \u0026lt;elevation min='-90' max='-16'\u0026gt; \u0026lt;bearing min='0' max='359'\u0026gt; \u0026lt;gain value='-200'/\u0026gt; \u0026lt;/bearing\u0026gt; \u0026lt;/elevation\u0026gt; /* ç•¥ */ \u0026lt;elevation min='16' max='90'\u0026gt; \u0026lt;bearing min='0' max='359'\u0026gt; \u0026lt;gain value='-200'/\u0026gt; \u0026lt;/bearing\u0026gt; \u0026lt;/elevation\u0026gt; \u0026lt;/antennapattern\u0026gt; \u0026lt;/antennaprofile\u0026gt; åˆ›å»º /tmp/emane/blockageaft.xml\n\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;!DOCTYPE antennaprofile SYSTEM \u0026quot;file:///usr/share/emane/dtd/antennaprofile.dtd\u0026quot;\u0026gt; \u0026lt;!-- blockage pattern: 1) entire aft in bearing (90 to 270) blocked 2) elevation below -10 blocked, 3) elevation from -10 to -1 is at -10dB to -1 dB 3) elevation from 0 to 90 no blockage--\u0026gt; \u0026lt;antennaprofile\u0026gt; \u0026lt;blockagepattern\u0026gt; \u0026lt;elevation min='-90' max='-11'\u0026gt; \u0026lt;bearing min='0' max='359'\u0026gt; \u0026lt;gain value='-200'/\u0026gt; \u0026lt;/bearing\u0026gt; \u0026lt;/elevation\u0026gt; /* ç•¥ */ \u0026lt;/bearing\u0026gt; \u0026lt;/elevation\u0026gt; \u0026lt;/blockagepattern\u0026gt; \u0026lt;/antennaprofile\u0026gt; åŠ è½½åœºæ™¯ emane-demo-antenna.xmlï¼ŒåŒå‡» n1ç»ˆç«¯\næœ¬æ¼”ç¤ºå°†ä»‹ç»å¦‚ä½•è¿è¡ŒEMANEäº‹ä»¶æœåŠ¡æ¥æä¾›å¤©çº¿ã€ä½ç½®å’Œè·¯å¾„æŸè€—äº‹ä»¶ï¼Œä»¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨å¤©çº¿å‰–é¢ã€‚\nä¸ä¹‹å‰ç±»ä¼¼çš„é…ç½®æ–‡ä»¶ eventservice.xml eelgenerator.xml (å¤–éƒ¨ä¸»æœºè¿è¡Œemaneeventservice -l 3 eventservice.xml)\nscenario.eel å†…å®¹ä¸º\n0.0 nem:1 antennaprofile 1,0.0,0.0 0.0 nem:4 antennaprofile 2,0.0,0.0 # 0.0 nem:1 pathloss nem:2,60 nem:3,60 nem:4,60 0.0 nem:2 pathloss nem:3,60 nem:4,60 0.0 nem:3 pathloss nem:4,60 # 0.0 nem:1 location gps 40.025495,-74.315441,3.0 0.0 nem:2 location gps 40.025495,-74.312501,3.0 0.0 nem:3 location gps 40.023235,-74.315441,3.0 0.0 nem:4 location gps 40.023235,-74.312501,3.0 0.0 nem:4 velocity 180.0,0.0,10.0 # 30.0 nem:1 velocity 20.0,0.0,10.0 30.0 nem:1 orientation 0.0,0.0,10.0 30.0 nem:1 antennaprofile 1,60.0,0.0 30.0 nem:4 velocity 270.0,0.0,10.0 # 60.0 nem:1 antennaprofile 1,105.0,0.0 60.0 nem:4 antennaprofile 2,45.0,0.0 # 90.0 nem:1 velocity 90.0,0.0,10.0 90.0 nem:1 orientation 0.0,0.0,0.0 90.0 nem:1 antennaprofile 1,45.0,0.0 å‘é€çš„äº‹ä»¶å°†è§¦å‘4ç§ä¸åŒçš„çŠ¶æ€ã€‚\nçŠ¶æ€1 N2å’ŒN3ç›¸äº’çœ‹åˆ° N4å’ŒN3æŒ‡å‘å¤– çŠ¶æ€2 N2å’ŒN3ç›¸äº’çœ‹åˆ° N1å’ŒN2ç›¸äº’çœ‹åˆ° N4å’ŒN3ç›¸äº’çœ‹åˆ° çŠ¶æ€3 N2å’ŒN3ç›¸äº’çœ‹åˆ° N4å’ŒN3æ­£å¯¹ç€å¯¹æ–¹ï¼Œä½†æ˜¯è¢«é˜»å¡äº† çŠ¶æ€4 N2å’ŒN3ç›¸äº’çœ‹åˆ° N4å’ŒN3ç›¸äº’çœ‹åˆ° ","id":27,"section":"posts","summary":"CORE/EMANE Emaneæ¨¡å‹è°ƒç ” æ— çº¿ä»¿çœŸåŸºæœ¬å†…å®¹å­¦ä¹ ï¼š è¡°è½æ¨¡å‹ emaneåªèƒ½ä½¿ç”¨äº‹ä»¶æˆ–nakagamiæ¨¡å‹ coreè®¾å®šçš„é»˜è®¤å€¼æ˜¯æœ‰é—®é¢˜çš„ï¼Œmå€¼è¶Šå¤§ä¿¡é“è¶Š","tags":["ä»¿çœŸ","C/C++","Emane"],"title":"EmaneåŸºç¡€ä½¿ç”¨","uri":"https://liangkang233.github.io/2021/07/emane/","year":"2021"},{"content":"æœåŠ¡ CORE ä½¿ç”¨æœåŠ¡çš„æ¦‚å¿µæ¥æŒ‡å®šèŠ‚ç‚¹å¯åŠ¨æ—¶è¿è¡Œå“ªäº›è¿›ç¨‹æˆ–è„šæœ¬ã€‚è·¯ç”±å™¨å’ŒPCç­‰ç¬¬ä¸‰å±‚èŠ‚ç‚¹æ˜¯ç”±ä»–ä»¬æ‰€è¿è¡Œçš„æœåŠ¡æ¥å®šä¹‰çš„ã€‚\nå¯ä»¥ä¸ºæ¯ä¸ªèŠ‚ç‚¹å®šåˆ¶æœåŠ¡ï¼Œä¹Ÿå¯ä»¥åˆ›é€ æ–°çš„è‡ªå®šä¹‰æœåŠ¡ã€‚å¯ä»¥åˆ›å»ºå…·æœ‰ä¸åŒåç§°ã€å›¾æ ‡å’Œé»˜è®¤æœåŠ¡é›†çš„æ–°èŠ‚ç‚¹ç±»å‹ã€‚ æ¯ä¸ªæœåŠ¡å®šä¹‰æ¯ä¸ªèŠ‚ç‚¹çš„è·¯å¾„ã€é…ç½®æ–‡ä»¶ã€å¯åŠ¨ç´¢å¼•ã€å¯åŠ¨å‘½ä»¤ã€éªŒè¯å‘½ä»¤ã€å…³é—­å‘½ä»¤å’Œä¸èŠ‚ç‚¹å…³è”çš„å…ƒæ•°æ®ã€‚\næ³¨æ„: ä½¿ç”¨ init, upstart, æˆ– systemd æ¡†æ¶æ—¶ï¼Œç½‘ç»œåç§°èŠ‚ç‚¹ç©ºé—´ä¸ä¼šç»å†æ­£å¸¸çš„Linuxå¼•å¯¼è¿‡ç¨‹ ï¼Œè¿™äº›è½»é‡èŠ‚ç‚¹ä½¿ç”¨å·²ç»é…ç½®å¥½çš„COREæœåŠ¡ã€‚\næä¾›çš„æœåŠ¡ æœåŠ¡ç»„ æœåŠ¡ æ€»ç»“ BIRD BGP, OSPF, RADV, RIP, Static EMANE Transport Service FRR BABEL, BGP, OSPFv2, OSPFv3, PIMD, RIP, RIPNG, Zebra NRL arouted, MGEN Sink, MGEN Actor, NHDP, OLSR, OLSRORG, OLSRv2, SMF Quagga BABEL, BGP, OSPFv2, OSPFv3, OSPFv3 MDR, RIP, RIPNG, XPIMD, Zebra SDN OVS, RYU Security Firewall, IPsec, NAT, VPN Client, VPN Server Utility ATD, Routing Utils, DHCP, FTP, IP Forward, PCAP, RADVD, SSF, UCARP XORP BGP, OLSR, OSPFv2, OSPFv3, PIMSM4, PIMSM6, RIP, RIPNG, Router Manager èŠ‚ç‚¹ç±»å‹å’Œé»˜è®¤æœåŠ¡ ä»¥ä¸‹æ˜¯é»˜è®¤èŠ‚ç‚¹ç±»å‹å’Œä»–ä»¬çš„æœåŠ¡:\nèŠ‚ç‚¹ç±»å‹ æœåŠ¡ router é’ˆå¯¹IGPé“¾è·¯çŠ¶æ€è·¯ç”±çš„ zebra, OSFPv2, OSPFv3, and IPForward æœåŠ¡ã€‚ host é»˜è®¤è·¯ç”±å’ŒSSHæœåŠ¡, å…¶è¡¨ç¤ºç›´æ¥è¿æ¥åˆ°è·¯ç”±å™¨æ—¶ï¼ŒSSHå…·æœ‰é»˜è®¤è·¯ç”±ã€‚ PC ä¸ºæ‹¥æœ‰é»˜è®¤è·¯ç”±ä¸”ç›´æ¥è¿æ¥åˆ°è·¯ç”±å™¨çš„èŠ‚ç‚¹æä¾›é»˜è®¤è·¯ç”±æœåŠ¡. mdr é’ˆå¯¹æ— çº¿ä¼˜åŒ–çš„ MANET æŒ‡å®šè·¯ç”±çš„ zebraã€ OSPFv3MDR å’Œ IPForward æœåŠ¡ã€‚ prouter å’Œ è·¯ç”±å™¨ èŠ‚ç‚¹ç±»å‹å…·æœ‰ç›¸åŒé»˜è®¤æœåŠ¡çš„ç‰©ç†è·¯ç”±å™¨; ç”¨äºå°†Linuxæµ‹è¯•å¹³å°è®¾å¤‡åˆå¹¶åˆ°ä»¿çœŸä¸­ã€‚ é…ç½®æ–‡ä»¶å¯ä»¥ç”±æ¯ä¸ªæœåŠ¡è‡ªåŠ¨ç”Ÿæˆã€‚ä¾‹å¦‚ï¼ŒCORE ä¼šè‡ªåŠ¨ä¸ºè·¯ç”±å™¨èŠ‚ç‚¹ç”Ÿæˆè·¯ç”±åè®®é…ç½®ï¼Œæ¥ç®€åŒ–è™šæ‹Ÿç½‘ç»œçš„åˆ›å»ºã€‚\næ›´æ”¹ä¸èŠ‚ç‚¹ç›¸å…³è”çš„æœåŠ¡ï¼Œå¯ä»¥åŒå‡»èŠ‚ç‚¹æ¥è°ƒç”¨é…ç½®å¯¹è¯æ¡†, ç„¶åå•å‡» æœåŠ¡\u0026hellip; æŒ‰é’®ï¼Œæˆ–è€…å³é”®å•å‡»æŸä¸ªèŠ‚ç‚¹ï¼Œä»å³é”®èœå•ä¸­é€‰æ‹© æœåŠ¡\u0026hellip; é€‰é¡¹ã€‚é€šè¿‡å•å‡»æœåŠ¡çš„åç§°å¯ä»¥å¯ç”¨æˆ–ç¦æ­¢è¯¥æœåŠ¡ã€‚æ¯ä¸ªæœåŠ¡åç§°æ—è¾¹çš„æŒ‰é’®å…è®¸æ‚¨ä¸ºè¯¥èŠ‚ç‚¹è‡ªå®šä¹‰æ­¤æœåŠ¡çš„æ‰€æœ‰æ–¹é¢ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†ç‰¹æ®Šçš„è·¯ç”±é‡åˆ†å‘å‘½ä»¤æ’å…¥åˆ°ä¸ zebra æœåŠ¡å…³è”çš„ Quagga è·¯ç”±é…ç½®ä¸­ã€‚\nè‹¥è¦æ›´æ”¹ä¸èŠ‚ç‚¹ç±»å‹ç›¸å…³çš„é»˜è®¤æœåŠ¡, è¯·ä½¿ç”¨ç¬¬ä¸‰å±‚èŠ‚ç‚¹å·¥å…·æ æœ«ç«¯çš„ ç¼–è¾‘ æŒ‰é’®ä¸­çš„ èŠ‚ç‚¹ç±»å‹\u0026hellip; å¯¹è¯æ¡†ï¼Œæˆ–æ˜¯ä» ä¼šè¯ èœå•ä¸­é€‰æ‹© èŠ‚ç‚¹ç±»å‹\u0026hellip;ã€‚ æ³¨æ„ï¼Œå¦‚æœå·²ç»å®šåˆ¶äº†èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ‰€é€‰æ‹©çš„ä»»ä½•æ–°æœåŠ¡éƒ½ä¸ä¼šåº”ç”¨äºç°æœ‰èŠ‚ç‚¹ã€‚\nèŠ‚ç‚¹ç±»å‹è¢«ä¿å­˜åœ¨ ~/.core/nodes.conf æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯ .imn æ–‡ä»¶ã€‚åœ¨æ›´æ”¹ç°æœ‰èŠ‚ç‚¹çš„é»˜è®¤æœåŠ¡æ—¶è¯·è®°ä½è¿™ä¸€ç‚¹; æœ€å¥½åªåˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ç±»å‹ã€‚å¹¶ä¸”å»ºè®®ä¸è¦æ›´æ”¹é»˜è®¤çš„å†…ç½®èŠ‚ç‚¹ç±»å‹ã€‚å¯ä»¥åœ¨ CORE è®¾å¤‡ä¹‹é—´å¤åˆ¶nodes.conf æ–‡ä»¶æ¥ä¿å­˜ä½ çš„è‡ªå®šä¹‰ç±»å‹ã€‚\nå®šåˆ¶æœåŠ¡ å¯ä»¥ä¸ºç‰¹å®šèŠ‚ç‚¹å®Œå…¨å®šåˆ¶æœåŠ¡ã€‚ ä»èŠ‚ç‚¹çš„é…ç½®å¯¹è¯æ¡†ä¸­ï¼Œå•å‡»æœåŠ¡åç§°æ—è¾¹çš„æŒ‰é’®ï¼Œæ¥è°ƒç”¨è¯¥æœåŠ¡çš„æœåŠ¡å®šåˆ¶å¯¹è¯æ¡†ã€‚è¯¥å¯¹è¯æ¡†æœ‰ä¸‰ä¸ªé€‰é¡¹å¡ç”¨äºé…ç½®æœåŠ¡çš„ä¸åŒæ–¹é¢ï¼šFilesï¼Œ Directorieså’Œtartup/shutdownã€‚\næœåŠ¡æ—è¾¹çš„ é»„è‰² è‡ªå®šä¹‰å›¾æ ‡è¡¨ç¤ºæœåŠ¡éœ€è¦è‡ªå®šä¹‰ï¼ˆä¾‹å¦‚ Firewall æœåŠ¡ï¼‰ã€‚ç»¿è‰² çš„è‡ªå®šä¹‰å›¾æ ‡è¡¨ç¤ºå­˜åœ¨è‡ªå®šä¹‰é…ç½®ã€‚åœ¨è‡ªå®šä¹‰æœåŠ¡æ—¶å•å‡» default æŒ‰é’®ä¼šç§»é™¤æ‰€æœ‰è‡ªå®šä¹‰é€‰é¡¹ã€‚\nFilesé€‰é¡¹å¡ç”¨äºæ˜¾ç¤ºæˆ–ç¼–è¾‘ç”¨äºè¯¥æœåŠ¡çš„é…ç½®æ–‡ä»¶æˆ–è„šæœ¬ã€‚æ–‡ä»¶å¯ä»¥ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©ï¼Œå®ƒä»¬çš„å†…å®¹å°†æ˜¾ç¤ºåœ¨ä¸‹é¢çš„æ–‡æœ¬æ¡†ä¸­ã€‚æ–‡ä»¶çš„å†…å®¹ç”± CORE daemonæ ¹æ®è‡ªå®šä¹‰å¯¹è¯æ¡†è°ƒç”¨æ—¶å­˜åœ¨çš„ç½‘ç»œæ‹“æ‰‘è¿›ç¨‹ç”Ÿæˆã€‚\nDirectoriesé€‰é¡¹å¡æ˜¾ç¤ºè¯¥æœåŠ¡çš„æ¯ä¸ªèŠ‚ç‚¹çš„è·¯å¾„ã€‚å¯¹äºé»˜è®¤ç±»å‹ï¼ŒCOREèŠ‚ç‚¹å…±äº«ç›¸åŒçš„æ–‡ä»¶ç³»ç»Ÿæ ‘ï¼Œä½†è¢«æœåŠ¡å®šä¹‰çš„æ¯ä¸ªèŠ‚ç‚¹é™¤å¤–ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæ¯ä¸ªè¿è¡Œ Zebra æœåŠ¡çš„èŠ‚ç‚¹ï¼Œå…¶ /var/run/quagga è·¯å¾„å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå› ä¸ºåœ¨æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œçš„ Quagga éœ€è¦å‘è¯¥è·¯å¾„å†™å…¥å•ç‹¬çš„ PID æ–‡ä»¶ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œ /var/log å’Œ /var/run è·¯å¾„æŒ‰ç…§æ¯ä¸ªèŠ‚ç‚¹å”¯ä¸€æŒ‚è½½ã€‚æ¯ä¸ªèŠ‚ç‚¹çš„æŒ‚è½½ç›®æ ‡å¯ä»¥åœ¨ /tmp/pycore.nnnnn/nN.conf/ ï¼ˆå…¶ä¸­ nnnnn æ˜¯ä¼šè¯ç¼–å·ï¼ŒNæ˜¯èŠ‚ç‚¹ç¼–å·ï¼‰ä¸­æ‰¾åˆ°ã€‚\nStartup/shutdown é€‰é¡¹å¡åˆ—å‡ºç”¨äºå¯åŠ¨å’Œåœæ­¢è¯¥æœåŠ¡çš„å‘½ä»¤ã€‚ startup indexå…è®¸åœ¨è¯¥æœåŠ¡å¯åŠ¨æ—¶å¯¹ä¸ºè¯¥èŠ‚ç‚¹å¯ç”¨çš„å…¶ä»–ç›¸å…³æœåŠ¡è¿›è¡Œé…ç½®ï¼›Startupè¾ƒä½çš„æœåŠ¡å…ˆäºStartupè¾ƒé«˜çš„æœåŠ¡. ç”±äºFilesé€‰é¡¹å¡ç”Ÿæˆçš„shellè„šæœ¬æ²¡æœ‰æ‰§è¡Œæƒé™è®¾ç½®ï¼Œå› æ­¤å¯åŠ¨å‘½ä»¤åº”åŒ…å«shellåç§°ï¼Œç±»ä¼¼äº sh script.shã€‚\næ³¨æ„! å…¶ä¸­çš„ start time åŠindex é€‰é¡¹æˆ‘ç®€å•æµè§ˆäº† core/daemon/core/services/coreservices.py çš„ CoreServiceç±»ï¼Œä¼¼ä¹ä½œè€…ç§»é™¤äº†è¿™ä¸¤é¡¹çš„å®ç°ã€‚åœ¨åç»­çš„ ServiceShim çš„ tovaluelist æ–¹æ³•ä¸­ç›´æ¥å¡«å…¥å†™æ­»çš„index = 0ä»¥åŠtime = 0ã€‚å¯èƒ½æ˜¯åŸæœ‰çš„bugå¯¼è‡´ä½œè€…æ”¾å¼ƒäº†å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚\nShutdown å‘½ä»¤å¯é€‰æ‹©ç»ˆæ­¢ä¸æ­¤æœåŠ¡å…³è”çš„è¿›ç¨‹ã€‚é€šå¸¸ï¼Œå®ƒä»¬ä½¿ç”¨ kill æˆ– killall å‘½ä»¤å‘æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹å‘é€kill ä¿¡å·ã€‚å¦‚æœæœåŠ¡æ²¡æœ‰ä½¿ç”¨ Shutdown å‘½ä»¤ç»ˆæ­¢æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œé‚£ä¹ˆå½“ç»ˆæ­¢ vnoded å®ˆæŠ¤è¿›ç¨‹(ä½¿ç”¨ kill -9å‘½ä»¤)å¹¶æ‘§æ¯å‘½åç©ºé—´æ—¶ï¼Œè¿›ç¨‹å°†è¢«æ€æ­»ã€‚æŒ‡å®š shutdown å‘½ä»¤æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®è·µï¼Œè¿™å°†å…è®¸é€‚å½“çš„è¿›ç¨‹ç»ˆæ­¢ï¼Œä»¥åŠåœæ­¢å’Œé‡å¯æœåŠ¡çš„è¿è¡Œæ§åˆ¶ã€‚\nValidate å‘½ä»¤æŒ‰ç…§å¯åŠ¨å‘½ä»¤æ‰§è¡Œã€‚ Validate å‘½ä»¤å¯ä»¥æ‰§è¡Œåº”è¿”å›0å€¼çš„æµç¨‹æˆ–è€…è„šæœ¬ï¼Œå¯¹äºå¯åŠ¨å‡ºç°é—®é¢˜çš„æœåŠ¡è¿”å›é0å€¼ã€‚ä¾‹å¦‚ï¼Œpidof å‘½ä»¤å°†æ£€æŸ¥æŸä¸ªè¿›ç¨‹æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Œæ˜¯åˆ™è¿”å›0å€¼ã€‚å½“ Validate å‘½ä»¤ç”Ÿæˆäº†ä¸€ä¸ªéé›¶è¿”å›å€¼ï¼Œè¿™å°†äº§ç”Ÿä¸€ä¸ªå¼‚å¸¸è€Œå¯¼è‡´åœ¨ Check Emulation Light ä¸­æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ã€‚\nåœ¨è¿è¡Œæ—¶å¯åŠ¨ã€åœæ­¢å’Œé‡å¯æœåŠ¡ï¼Œéœ€è¦å³é”®å•å‡»èŠ‚ç‚¹å¹¶ä½¿ç”¨ æœåŠ¡\u0026hellip; èœå•ã€‚\næ–°çš„æœåŠ¡ æœåŠ¡å¯ä»¥èŠ‚çœé…ç½®èŠ‚ç‚¹æ‰€éœ€çš„æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯å½“å¤§é‡èŠ‚ç‚¹éƒ½éœ€è¦ç±»ä¼¼çš„é…ç½®ç¨‹åºæ—¶ã€‚æ­¤æ—¶å¯ä»¥å¼•å…¥æ–°çš„æœåŠ¡æ¥ä½¿ä»»åŠ¡è‡ªåŠ¨åŒ–ã€‚\nå¦‚æœä½¿ç”¨tlvç­‰ç•Œé¢apié…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š\nå…¶ä¸­File nameå’Œstartupä¸ºå¿…é€‰é¡¹ï¼Œå…¶ä½œç”¨ä¸ºèŠ‚ç‚¹å®¹å™¨åˆå§‹åŒ–åå¤åˆ¶ä¸€ä»½è„šæœ¬åä¸ºFile nameçš„è„šæœ¬è‡³äºtempä¸­çš„èŠ‚ç‚¹æ–‡ä»¶å¤¹ï¼Œstartupç­‰å‘½ä»¤é™¤äº†åˆå§‹åŒ–ä»¿çœŸä¼šè°ƒç”¨ä¹Ÿå¯é€šè¿‡ç•Œé¢é€‰é¡¹æ¥ä½¿ç”¨ï¼Œå…·ä½“å‚è€ƒå…¶ä»–serveré€‰é¡¹åšæ³•ã€‚\nåˆ©ç”¨ç”¨æˆ·è‡ªå®šä¹‰ å°†æ–°æµç¨‹çš„é…ç½®æ•è·åˆ°æœåŠ¡ä¸­çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ UserDefined æœåŠ¡ã€‚è¿™æ˜¯ä¸€ä¸ªç©ºç™½æœåŠ¡ï¼Œå¯ä»¥è‡ªå®šä¹‰å…¶ä¸­çš„ä»»ä½•æ–¹é¢ã€‚ UserDefined æœåŠ¡ä¾¿äºåœ¨æ·»åŠ æ–°çš„æœåŠ¡ç±»å‹ä¹‹å‰æµ‹è¯•æœåŠ¡ã€‚\nåˆ›å»ºæ–°çš„æœåŠ¡ ä¿®æ”¹å¦‚ä¸‹æ‰€ç¤ºçš„å®ä¾‹æœåŠ¡ï¼Œä»¥ä¾¿åšæ‚¨æƒ³åšçš„äº‹æƒ…ã€‚å®ƒå¯ä»¥ç”Ÿæˆé…ç½®/è„šæœ¬æ–‡ä»¶ã€æ¯ä¸ªèŠ‚ç‚¹çš„æŒ‚è½½è·¯å¾„ã€å¯åŠ¨è¿›ç¨‹/è„šæœ¬ç­‰ã€‚sample.py æ˜¯ä¸€ä¸ª Python æ–‡ä»¶ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªæˆ–æ›´å¤šéœ€è¦å¯¼å…¥çš„ç±»ã€‚æ‚¨å¯ä»¥åˆ›å»ºå¤šä¸ªå°†è¢«å¯¼å…¥çš„Pythonæ–‡ä»¶ã€‚å°†ä»»ä½•æ–°æ–‡ä»¶åæ·»åŠ åˆ° init.py æ–‡ä»¶ä¸­ã€‚\næŠŠè¿™äº›æ–‡ä»¶æ”¾åœ¨è¯¸å¦‚ /home/username/.core/myservices è¿™æ ·çš„è·¯å¾„ä¸­ã€‚ä½†åº”æ³¨æ„è·¯å¾„æœ€åçš„åç§° myservices ä¸åº”è¯¥å‘½åä¸ºç±»ä¼¼äºä¸ç°æœ‰çš„Pythonåç§°å†²çªçš„ æœåŠ¡ï¼ˆä½¿ç”¨çš„è¯­æ³•æ˜¯ from myservices import *\u0026rsquo;ï¼‰\næ·»åŠ å‘½ä»¤ custom_services_dir = /home/username/.core/myservices åˆ° /etc/core/core.conf æ–‡ä»¶ä¸­ã€‚\næ³¨æ„: åœ¨ custom_services_dir ä½¿ç”¨çš„è·¯å¾„ååº”è¯¥æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”ä¸åº”è¯¥å¯¹åº”äºä»»ä½•ç°æœ‰çš„Pythonæ¨¡å—åã€‚ä¾‹å¦‚ï¼Œä¸è¦ä½¿ç”¨ subprocess æˆ–æ˜¯ services åç§°ã€‚\né‡å¯ CORE å®ˆæŠ¤è¿›ç¨‹ (core-daemon). ä»»ä½•å¯¼å…¥é”™è¯¯ (Python è¯­æ³•)éƒ½åº”æ˜¾ç¤ºåœ¨ /var/log/core-daemon.log æ—¥å¿—æ–‡ä»¶ä¸Šï¼ˆæˆ–æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼‰ã€‚\nå¼€å§‹åœ¨èŠ‚ç‚¹ä¸Šä½¿ç”¨è‡ªå®šä¹‰æœåŠ¡å§ã€‚æ‚¨å¯ä»¥åˆ›å»ºä½¿ç”¨æ‚¨çš„æœåŠ¡çš„æ–°èŠ‚ç‚¹ç±»å‹ï¼Œæˆ–è€…æ›´æ”¹ç°æœ‰èŠ‚ç‚¹çš„é»˜è®¤æœåŠ¡ï¼Œåˆæˆ–è€…æ›´ æ”¹å•ä¸ªèŠ‚ç‚¹ã€‚\nå¦‚æœæ‚¨å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå¯èƒ½å¯¹ä»–äººæœ‰ç”¨çš„æ–°æœåŠ¡ç±»å‹ï¼Œè¯·è€ƒè™‘å°†å…¶è´¡çŒ®ç»™ CORE é¡¹ç›®ã€‚\nè‡ªå®šä¹‰æœåŠ¡ç¤ºä¾‹ ä¸‹é¢æ˜¯å¸¦æœ‰ä¸€äº›è¯´æ˜æ–‡æ¡£çš„è‡ªå®šä¹‰æœåŠ¡æ¡†æ¶ã€‚å¤§å¤šæ•°äººå¯èƒ½åªä¼šè®¾ç½®æ‰€éœ€çš„ç±»å˜é‡ (name/group)ã€‚ç„¶åå®šä¹‰ configs ï¼ˆä»–ä»¬æƒ³è¦ç”Ÿæˆçš„æ–‡ä»¶ï¼‰ï¼Œå¹¶å®ç° generate_config å‡½æ•°æ¥åŠ¨æ€åˆ›å»ºæ‰€éœ€çš„æ–‡ä»¶ã€‚æœ€åï¼Œè¢«æä¾›çš„ startup å‘½ä»¤é€šå¸¸å€¾å‘äºè¿è¡Œç”Ÿæˆçš„shellæ–‡ä»¶ã€‚\n\u0026quot;\u0026quot;\u0026quot; Simple example custom service, used to drive shell commands on a node. \u0026quot;\u0026quot;\u0026quot; from typing import Tuple from core.nodes.base import CoreNode from core.services.coreservices import CoreService, ServiceMode class ExampleService(CoreService): \u0026quot;\u0026quot;\u0026quot; Example Custom CORE Service :cvar name: name used as a unique ID for this service and is required, no spaces :cvar group: allows you to group services within the GUI under a common name :cvar executables: executables this service depends on to function, if executable is not on the path, service will not be loaded :cvar dependencies: services that this service depends on for startup, tuple of service names :cvar dirs: directories that this service will create within a node :cvar configs: files that this service will generate, without a full path this file goes in the node's directory e.g. /tmp/pycore.12345/n1.conf/myfile :cvar startup: commands used to start this service, any non-zero exit code will cause a failure :cvar validate: commands used to validate that a service was started, any non-zero exit code will cause a failure :cvar validation_mode: validation mode, used to determine startup success. NON_BLOCKING - runs startup commands, and validates success with validation commands BLOCKING - runs startup commands, and validates success with the startup commands themselves TIMER - runs startup commands, and validates success by waiting for \u0026quot;validation_timer\u0026quot; alone :cvar validation_timer: time in seconds for a service to wait for validation, before determining success in TIMER/NON_BLOCKING modes. :cvar validation_period: period in seconds to wait before retrying validation, only used in NON_BLOCKING mode :cvar shutdown: shutdown commands to stop this service \u0026quot;\u0026quot;\u0026quot; name: str = \u0026quot;ExampleService\u0026quot; group: str = \u0026quot;Utility\u0026quot; executables: Tuple[str, ...] = () dependencies: Tuple[str, ...] = () dirs: Tuple[str, ...] = () configs: Tuple[str, ...] = (\u0026quot;myservice1.sh\u0026quot;, \u0026quot;myservice2.sh\u0026quot;) startup: Tuple[str, ...] = tuple(f\u0026quot;sh {x}\u0026quot; for x in configs) validate: Tuple[str, ...] = () validation_mode: ServiceMode = ServiceMode.NON_BLOCKING validation_timer: int = 5 validation_period: float = 0.5 shutdown: Tuple[str, ...] = () @classmethod def on_load(cls) -\u0026gt; None: \u0026quot;\u0026quot;\u0026quot; Provides a way to run some arbitrary logic when the service is loaded, possibly to help facilitate dynamic settings for the environment. :return: nothing \u0026quot;\u0026quot;\u0026quot; pass @classmethod def get_configs(cls, node: CoreNode) -\u0026gt; Tuple[str, ...]: \u0026quot;\u0026quot;\u0026quot; Provides a way to dynamically generate the config files from the node a service will run. Defaults to the class definition and can be left out entirely if not needed. :param node: core node that the service is being ran on :return: tuple of config files to create \u0026quot;\u0026quot;\u0026quot; return cls.configs @classmethod def generate_config(cls, node: CoreNode, filename: str) -\u0026gt; str: \u0026quot;\u0026quot;\u0026quot; Returns a string representation for a file, given the node the service is starting on the config filename that this information will be used for. This must be defined, if \u0026quot;configs\u0026quot; are defined. :param node: core node that the service is being ran on :param filename: configuration file to generate :return: configuration file content \u0026quot;\u0026quot;\u0026quot; cfg = \u0026quot;#!/bin/sh\\n\u0026quot; if filename == cls.configs[0]: cfg += \u0026quot;# auto-generated by MyService (sample.py)\\n\u0026quot; for iface in node.get_ifaces(): cfg += f'echo \u0026quot;Node {node.name} has interface {iface.name}\u0026quot;\\n' elif filename == cls.configs[1]: cfg += \u0026quot;echo hello\u0026quot; return cfg @classmethod def get_startup(cls, node: CoreNode) -\u0026gt; Tuple[str, ...]: \u0026quot;\u0026quot;\u0026quot; Provides a way to dynamically generate the startup commands from the node a service will run. Defaults to the class definition and can be left out entirely if not needed. :param node: core node that the service is being ran on :return: tuple of startup commands to run \u0026quot;\u0026quot;\u0026quot; return cls.startup @classmethod def get_validate(cls, node: CoreNode) -\u0026gt; Tuple[str, ...]: \u0026quot;\u0026quot;\u0026quot; Provides a way to dynamically generate the validate commands from the node a service will run. Defaults to the class definition and can be left out entirely if not needed. :param node: core node that the service is being ran on :return: tuple of commands to validate service startup with \u0026quot;\u0026quot;\u0026quot; return cls.validate ","id":28,"section":"posts","summary":"æœåŠ¡ CORE ä½¿ç”¨æœåŠ¡çš„æ¦‚å¿µæ¥æŒ‡å®šèŠ‚ç‚¹å¯åŠ¨æ—¶è¿è¡Œå“ªäº›è¿›ç¨‹æˆ–è„šæœ¬ã€‚è·¯ç”±å™¨å’ŒPCç­‰ç¬¬ä¸‰å±‚èŠ‚ç‚¹æ˜¯ç”±ä»–ä»¬æ‰€è¿è¡Œçš„æœåŠ¡æ¥å®šä¹‰çš„ã€‚ å¯ä»¥ä¸ºæ¯ä¸ªèŠ‚ç‚¹å®šåˆ¶æœåŠ¡ï¼Œä¹Ÿå¯ä»¥","tags":["ä»¿çœŸ"],"title":"Core services","uri":"https://liangkang233.github.io/2021/07/services/","year":"2021"},{"content":"CORE åˆ†å¸ƒå¼ä»¿çœŸ æ¦‚è¿° å¤§å‹æ¨¡æ‹Ÿåœºæ™¯å¯ä»¥éƒ¨ç½²åœ¨å¤šä¸ªæ¨¡æ‹ŸæœåŠ¡å™¨ä¸Šç”±å•ä¸ªCore-GUIæ§åˆ¶ã€‚è¡¨ç¤ºæ•´ä¸ªæ‹“æ‰‘çš„GUIå¯ä»¥æ˜¯ å…¶ä¸­ä¸€å°æ¨¡æ‹ŸæœåŠ¡å™¨æˆ–å•ç‹¬çš„åªè¿è¡ŒGUIçš„æœºå™¨ã€‚\nä½œä¸ºæ¨¡æ‹Ÿçš„æ¯å°æœºå™¨éƒ½éœ€è¦å®‰è£…ä¸€ä¸ªåˆ†å¸ƒå¼COREåŒ…å’Œä¸€äº›å…è®¸rootç”¨æˆ·ä½¿ç”¨sshçš„é…ç½®ã€‚\nCORE é…ç½® ä½¿ç”¨åˆ†å¸ƒå¼åŠŸèƒ½æ‰€éœ€çš„æ ¸å¿ƒé…ç½®è®¾ç½®ï¼š\næœ€å¥½å…ˆäº†è§£COREçš„æ§åˆ¶ç½‘ç»œç« èŠ‚å†…å®¹\ncoreè¿è¡Œçš„é…ç½®æ–‡ä»¶é»˜è®¤ä¸º /etc/core/core.conf å¯ä»¥ä¿®æ”¹è¯¥æ–‡ä»¶æ¥é…ç½®coreçš„ç›¸å…³å‚æ•°ï¼Œæˆ–è€…è¿è¡Œcore-daemonæ—¶æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶(-f é€‰é¡¹)\n# å–æ¶ˆæ³¨é‡Šå¹¶å°†å…¶è®¾ç½®ä¸ºè¿œç¨‹æœåŠ¡å™¨çš„åœ°å€ # æ­¤åœ°å€ç”¨äºä¸»æ§ç½‘ç»œè¿”å›è‡³ä¸»æœºï¼Œå³ä¸ºä¸»æœåŠ¡å™¨çœŸå®IPåœ°å€ distributed_address = 129.168.0.101 # ä¸é…ç½®Emanceé»˜è®¤æ‰€æœ‰åˆ†å¸ƒå¼æœåŠ¡å™¨å’Œä¸»æ§åˆ¶æœåŠ¡å™¨ä½¿ç”¨åŒä¸€ä¸»æ§åˆ¶ç½‘æ®µ # ä»¿çœŸä¸­æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šåˆ†é…ä¸€ä¸ªè¯¥ç½‘æ®µå†…IPå¹¶å°†èŠ‚ç‚¹attachæ¯å°æœåŠ¡å™¨å¯¹åº”çš„ä¸»æ§ç½‘æ¡¥ä¸Š # å„åˆ†å¸ƒå¼ä¸»ç½‘æ¡¥æ•°æ®ä¼šç›´æ¥æ±‡æ€»åˆ°ä¸»æœåŠ¡å™¨çš„æ§åˆ¶ç½‘æ¡¥ï¼ŒæœåŠ¡å™¨çš„ä¸»æ§åˆ¶ç½‘ç»œä¼šè‡ªåŠ¨å»ºç«‹ä¸€ä¸ªéš§é“è”é€šç‰©ç†ç½‘å¡eth0å’Œä¸»æ§ç½‘æ¡¥ controlnet = 172.16.0.0/24 è‹¥æ˜¯å•ç‹¬è·‘åˆ†å¸ƒå¼æ•°æ®ï¼Œè¿™é‡Œä¸»æ§ç½‘ä¸é…ç½®ä¹Ÿæ˜¯èƒ½èµ°é€šçš„ï¼Œå¯ä¸å¼€å¯ã€‚\nåˆ†å¸ƒå¼ EMANE ç‰¹å®šé…ç½® EMANE éœ€è¦åœ¨ core.conf ä¸­é…ç½® controlnet æ‰èƒ½æ­£ç¡®å¯åŠ¨ã€‚ åœ°å€å‰çš„åç§°éœ€è¦ä¸é…ç½®çš„åˆ†å¸ƒå¼æœåŠ¡å™¨çš„åç§°ç›¸åŒ¹é…ã€‚\n# ä¸ä¸Šé¢æ‰€æœ‰åˆ†å¸ƒå¼æœåŠ¡å™¨çš„ä¸»æ§åˆ¶ç½‘æ¡¥ä½¿ç”¨åŒä¸€ç½‘æ®µï¼ˆåœ¨åŒä¸€å±€åŸŸç½‘å†…ï¼‰ä¸åŒ # åˆ†å¸ƒå¼Emanceè¦æ±‚æ¯ä¸€å°åˆ†å¸ƒæœåŠ¡å™¨çš„ä¸»æ§åˆ¶ç½‘æ¡¥å·¥ä½œåœ¨ä¸åŒç½‘æ®µ # æœ€åå„åˆ†å¸ƒå¼æœåŠ¡å™¨ä¸»æ§ç½‘æ¡¥çš„æ•°æ®ä¼šé€šè¿‡éš§é“æ±‡æ€»åˆ°ä¸»æ§ç½‘ç»œ controlnet = 172.16.0.0/24 controlnet1 = 172.16.1.0/24 emane_event_generate = True é…ç½® SSH åˆ†å¸ƒå¼COREä½¿ç”¨python fabricåº“åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šé€šè¿‡SSHè¿è¡Œå‘½ä»¤ã€‚\nè¿œç¨‹ GUI ç»ˆç«¯ æ‚¨éœ€è¦ç¡®ä¿æ¯ä¸ªæœåŠ¡å™¨ä¸Šçš„ç”¨æˆ·åç›¸åŒï¼Œå› ä¸ºè¿è¡ŒCORE GUIçš„ç”¨æˆ·ä¼šç™»å½•ç›¸åŒç”¨æˆ·çš„è¿œç¨‹bashï¼ˆsshï¼‰\nEdit -\u0026gt; Preferences\u0026hellip; -\u0026gt; Terminal program: ç›®å‰å»ºè®®å°†æ­¤è®¾ç½®ä¸ºxterm -eä½œä¸ºé»˜è®¤å€¼ï¼Œgnome-terminalæ— æ³•å·¥ä½œã€‚ å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œå¯èƒ½éœ€è¦å®‰è£…xterm\nsudo apt install xterm åˆ†å¸ƒå¼æœåŠ¡å™¨SSHé…ç½® é¦–å…ˆï¼Œå¿…é¡»å°†åˆ†å¸ƒå¼æœåŠ¡å™¨é…ç½®ä¸ºå…è®¸é€šè¿‡SSHè¿›è¡Œæ— å¯†ç çš„rootç”¨æˆ·ç™»å½•ï¼Œæˆ–è€…åˆ†å¸ƒå¼æœåŠ¡å™¨æ’å…¥ä¸»æœåŠ¡å™¨çš„å…¬é’¥å…å¯†ç™»å½•ã€‚\nåœ¨åˆ†å¸ƒå¼æœåŠ¡å™¨ä¸Šå¦‚æ­¤é…ç½®ï¼š\n# å®‰è£… openssh-server sudo apt install openssh-server # æ‰“å¼€ sshd é…ç½® vi /etc/ssh/sshd_config # éªŒè¯è¿™äº›é…ç½®æ˜¯å¦å¯ç”¨ PermitRootLogin yes PasswordAuthentication yes # å¦‚æœéœ€è¦ï¼Œæ·»åŠ /ä¿®æ”¹ä»¥ä¸‹è¡Œä»¥å…è®¸SSH # æ¥å—æ‰€æœ‰envå˜é‡ AcceptEnv * # é‡å¯ sshd sudo systemctl restart sshd åœ¨ä¸»æœåŠ¡å™¨ä¸Šï¼š\n# å®‰è£…ç¯å¢ƒæ‰€éœ€åŒ… sudo apt install openssh-client æ³•1ï¼šå…¬é’¥ç™»å½•ï¼ˆæ¨èï¼‰\n# åœ¨ä¸»æœåŠ¡å™¨ä¸Šç”ŸæˆSSHå…¬ã€å¯†é’¥ # è¦ç¡®ä¿ç”Ÿæˆçš„å…¬é’¥å¯†é’¥æ–‡ä»¶çš„ç»å¯¹è·¯å¾„æ˜¯ ~/.sshï¼Œå¦‚ä¸‹æ‰€ç¤ºå¯†é’¥æ–‡ä»¶ä¸ºcoreï¼Œå…¬é’¥æ–‡ä»¶ä¸ºcore.pub ssh-keygen -o -t rsa -b 4096 -f ~/.ssh/core å¦‚æœé‡åˆ°ç±»ä¼¼ not a valid RSA private key file çš„é”™è¯¯æ—¶ä½¿ç”¨æ­¤æ¡å‘½ä»¤ã€‚\nssh-keygen -o -m PEM -t rsa -b 4096 -f ~/.ssh/core è¿™æ˜¯å› ä¸ºç°åœ¨é€šè¿‡ ssh-keygen -o ä½¿ç”¨æ–°çš„OpenSSHæ ¼å¼è€Œä¸æ˜¯æ›´å…¼å®¹çš„PEMæ ¼å¼ä¿å­˜ç§é’¥ã€‚æ–°æ ¼å¼å¢åŠ äº†å¯¹æš´åŠ›ç ´è§£å¯†ç çš„æŠµæŠ—åŠ›ï¼Œä½†OpenSSH 6.5ä¹‹å‰çš„ç‰ˆæœ¬ä¸æ”¯æŒæ‰€ä»¥è¯¥æ¨¡å—æ— æ³•è¯†åˆ«ã€‚Ed25519å¯†é’¥æ€»æ˜¯ä½¿ç”¨æ–°çš„ç§é’¥æ ¼å¼ã€‚-m æ”¯æŒæ ¼å¼æœ‰ â€œRFC4716â€(RFC4716/SSH2)ã€â€œPKCS8â€(PEM PKCS8)æˆ–â€œPEMâ€\n# å°†å…¬é’¥å¤åˆ¶åˆ°ä»æœåŠ¡å™¨åœ°å€serverçš„authorized_keysæ–‡ä»¶ä¸­ï¼ˆéœ€è¾“å…¥å¯†ç ç™»å½•ï¼‰ ssh-copy-id -i ~/.ssh/core root@server # å½“ç„¶è¿è¡Œcore-guiçš„userç”¨æˆ·ä¹Ÿéœ€è¦å¦‚ä¸Šé…ç½®ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨è¿œç¨‹ç»ˆç«¯ç•Œé¢ ssh-copy-id -i ~/.ssh/core user@server # é…ç½®fabricä½¿ç”¨Core SSHå¯†é’¥ sudo vi /etc/fabric.yml # æ·»åŠ /ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­è·¯å¾„ä¸­çš„useræ”¹ä¸ºå¯¹åº”ç”¨æˆ·å connect_kwargs: {\u0026quot;key_filename\u0026quot;: \u0026quot;/home/user/.ssh/core\u0026quot;} æ³•2ï¼šè®¾ç½®æ— éœ€å¯†ç ç™»å½•\n# åœ¨åˆ†å¸ƒå¼æœåŠ¡å™¨ä¸Šï¼Œæ‰“å¼€ sshd é…ç½® vi /etc/ssh/sshd_config # å°†rootç™»å½•çš„é…ç½®æ›´æ”¹ä¸ºä¸éœ€è¦å¯†ç  PermitRootLogin without-password # é‡å¯ sshd sudo systemctl restart sshd åœ¨ GUI ä¸­æ·»åŠ ä»¿çœŸæœåŠ¡å™¨ åœ¨ core-gui çš„å¯¼èˆªèœå•ä¸­ï¼š Session -\u0026gt; Emulation servers\u0026hellip; åœ¨å‡ºç°çš„å¯¹è¯æ¡†ä¸­ï¼Œæ·»åŠ æˆ–ä¿®æ”¹ç°æœ‰æœåŠ¡å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ä»¥ä½¿ç”¨æ‚¨è®¡åˆ’ä½¿ç”¨çš„æœåŠ¡å™¨çš„åç§°ã€åœ°å€å’Œç«¯å£ï¼ˆçœŸå®ç¯å¢ƒä¸‹å‚æ•°ï¼‰\næœåŠ¡å™¨é…ç½®é»˜è®¤åŠ è½½åˆ°ä¸‹é¢çš„GUI çš„é…ç½®æ–‡ä»¶ ~/.core/servers.conf\n# åå­— åœ°å€ ç«¯å£ server2 192.168.0.2 4038 åˆ†é…èŠ‚ç‚¹ ç”¨æˆ·éœ€è¦ä¸ºåœºæ™¯ä¸­çš„ä»¿çœŸæœåŠ¡å™¨åˆ†é…èŠ‚ç‚¹ã€‚ä¸åˆ†é…æ„å‘³ç€èŠ‚ç‚¹å°†åœ¨ä¸»æœåŠ¡å™¨ä¸Šæ¨¡æ‹Ÿã€‚åœ¨æ¯ä¸ªèŠ‚ç‚¹çš„é…ç½®çª—å£ä¸­ï¼Œä½äºNode nameå’ŒImageæŒ‰é’®ä¹‹é—´çš„ä¸‹æ‹‰æ¡†å°†é€‰æ‹©æ¨¡æ‹ŸæœåŠ¡å™¨çš„åç§°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤èœå•æ˜¾ç¤º (none)ï¼Œè¡¨ç¤ºè¯¥èŠ‚ç‚¹å°†åœ¨ master ä¸Šæœ¬åœ°æ¨¡æ‹Ÿã€‚è¿›å…¥æ‰§è¡Œæ¨¡å¼æ—¶ï¼ŒCORE GUI å°†åœ¨å…¶åˆ†é…çš„ä»¿çœŸæœåŠ¡å™¨ä¸Šéƒ¨ç½²èŠ‚ç‚¹ã€‚\nåˆ†é…ä»¿çœŸæœåŠ¡å™¨çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨é€‰æ‹©å·¥å…·é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ï¼ˆæŒ‰ä½ Ctrl é”®å•å‡»ä»¥é€‰æ‹©å¤šä¸ªï¼‰ï¼Œç„¶åå³é”®å•å‡»å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å¹¶é€‰æ‹© Assign to\u0026hellip;.\nCORE emulation serverså¯¹è¯æ¡†ä¹Ÿå¯ä»¥ç”¨äºä¸ºæœåŠ¡å™¨åˆ†é…èŠ‚ç‚¹ã€‚åˆ†é…çš„æœåŠ¡å™¨åç§°æ˜¾ç¤ºåœ¨èŠ‚ç‚¹åç§°æ—è¾¹çš„æ‹¬å·ä¸­ã€‚è¦å°†æ‰€æœ‰èŠ‚ç‚¹åˆ†é…ç»™å…¶ä¸­ä¸€å°æœåŠ¡å™¨ï¼Œè¯·å•å‡»æœåŠ¡å™¨åç§°ï¼Œç„¶åå•å‡»all nodesæŒ‰é’®. å·²åˆ†é…èŠ‚ç‚¹çš„æœåŠ¡å™¨åœ¨æœåŠ¡å™¨åˆ—è¡¨ä¸­æ˜¾ç¤ºä¸ºè“è‰². å¦ä¸€ç§é€‰æ‹©æ˜¯å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹å­é›†, ç„¶åæ‰“å¼€CORE emulation servers é€‰é¡¹å¹¶ä½¿ç”¨ selected nodes æŒ‰é’®.\næ³¨æ„: å¦‚æœè¦åœ¨ä¸»æœåŠ¡å™¨ä¸Šè¿è¡Œè¿™äº›èŠ‚ç‚¹ï¼Œåˆ™ä¸è¦åˆ†é…å®ƒä»¬ã€‚æ— éœ€æ˜¾å¼åœ°å°†èŠ‚ç‚¹åˆ†é…ç»™ä¸»æœåŠ¡å™¨\nGUI å¯è§†åŒ– å¦‚æœä½äºä¸åŒæœåŠ¡å™¨ä¸Šçš„ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´å­˜åœ¨é“¾æ¥ï¼ŒGUIå°†ç”¨è™šçº¿ç»˜åˆ¶é“¾æ¥ã€‚\né—®é¢˜å’Œå±€é™æ€§ æ— çº¿æ¨¡å‹\nåªæœ‰å½“ EMANE æ¨¡å‹ç”¨äº WLAN æ—¶ï¼Œæ— çº¿èŠ‚ç‚¹ï¼Œå³è¿æ¥åˆ° WLAN èŠ‚ç‚¹çš„é‚£äº›èŠ‚ç‚¹ï¼Œæ‰èƒ½è¢«åˆ†é…åˆ°ä¸åŒçš„ä»¿çœŸæœåŠ¡å™¨å¹¶å‚ä¸ç›¸åŒçš„æ— çº¿ç½‘ç»œã€‚ç”±äºä½¿ç”¨äº† Linux ç½‘æ¡¥å’Œ ebtables è§„åˆ™ï¼Œbasicæ— çº¿æ¨¡å‹ä¸èƒ½è·¨å¤šä¸ªæœåŠ¡å™¨å·¥ä½œ\nä¸»ä»æœåŠ¡å™¨æµé‡\nè‡ªå·±æµ‹è¯•å‘ç°ï¼Œæ‰€æœ‰ä»¿çœŸä¸­èŠ‚ç‚¹è·¨ä»æœåŠ¡å™¨æ•°æ®éƒ½æ˜¯å…ˆå‘é€åˆ°ä¸»æœåŠ¡å™¨ä¸Šå†è½¬å‘è‡³ä»æœåŠ¡å™¨ï¼Œè€Œä¸”ä¸»æ§åˆ¶ç½‘ç»œè·¯ç”±ä¹Ÿæ˜¯éœ€è¦ä¸»æœåŠ¡å™¨è½¬å‘ã€‚ä»æœåŠ¡å™¨æ•°é‡å¢å¤šååŠ¿å¿…å¯¼è‡´ä¸»æœåŠ¡å™¨è½¬å‘è·¯ç”±è´Ÿè·è¿‡å¤§ã€‚æ­£åœ¨æµ‹è¯•èƒ½å¦ä½¿ç”¨æ§åˆ¶ç½‘é—´çš„éš§é“æˆ–å…¶ä»–æ–¹æ³•ä½¿ä»æœåŠ¡å™¨é—´æœ‰ç›´æ¥è”é€šçš„é“¾è·¯ï¼Œè€Œéä¸»æœåŠ¡å™¨è½¬å‘ã€‚\næ³¨æ„: basicæ— çº¿æ¨¡å‹ä¸æ”¯æŒåˆ†å¸ƒå¼ä»¿çœŸï¼Œä½†EMANEæ”¯æŒ\nå½“èŠ‚ç‚¹è·¨æœåŠ¡å™¨é“¾æ¥æ—¶ï¼Œ core-daemonså°†åœ¨æ‰§è¡Œæ—¶è‡ªåŠ¨åœ¨èŠ‚ç‚¹ä¹‹é—´åˆ›å»ºå¿…è¦çš„éš§é“ã€‚åº”æ³¨æ„å®‰æ’æ‹“æ‰‘ä»¥ä½¿éš§é“çš„æ•°é‡æœ€å°åŒ–ã€‚éš§é“åœ¨æœåŠ¡å™¨ä¹‹é—´ä¼ é€æ•°æ®ä»¥è¿æ¥æ‹“æ‰‘ä¸­æŒ‡å®šçš„èŠ‚ç‚¹ã€‚è¿™äº›éš§é“æ˜¯ä½¿ç”¨ GRE éš§é“åˆ›å»ºçš„ï¼Œç±»ä¼¼äºéš§é“å·¥å…·\nåˆ†å¸ƒå¼é…ç½®æ¸…å• åœ¨ä¸»æœåŠ¡å™¨ä¸Šå®‰è£… CORE åœ¨æ‰€æœ‰éœ€è¦çš„æœåŠ¡å™¨ä¸Šå®‰è£…åˆ†å¸ƒå¼ CORE åŒ… åœ¨æ‰€æœ‰æœåŠ¡å™¨ä¸Šå®‰è£…å’Œé…ç½®å…¬é’¥ SSH è®¿é—®ï¼ˆå¦‚æœæƒ³è¦ä½¿ç”¨åŒå‡»æ‰“å¼€ç»ˆç«¯æˆ–æ˜¯çª—å£éƒ¨ä»¶ï¼‰ä¸º GUI ç”¨æˆ·ï¼ˆç”¨äºç»ˆç«¯ï¼‰å’Œ root è¿è¡Œ CORE å‘½ä»¤ æ ¹æ®éœ€è¦æ›´æ–° CORE é…ç½® é€‰æ‹©å‚ä¸åˆ†å¸ƒå¼ä»¿çœŸçš„æœåŠ¡å™¨ å°†èŠ‚ç‚¹åˆ†é…ç»™æ‰€éœ€çš„æœåŠ¡å™¨ï¼Œè‹¥æ˜¯èŠ‚ç‚¹åœ¨ä¸»æœåŠ¡å™¨ä»¿çœŸåˆ™ä¸åˆ†é…ï¼ˆNONEï¼‰ã€‚ ä¸»æœåŠ¡å™¨æŒ‰startæŒ‰é’®å¯åŠ¨åˆ†å¸ƒå¼ä»¿çœŸï¼Œåˆ†æœåŠ¡å™¨æ— é¡»å¼€å¯guiå’Œdaemon ","id":29,"section":"posts","summary":"CORE åˆ†å¸ƒå¼ä»¿çœŸ æ¦‚è¿° å¤§å‹æ¨¡æ‹Ÿåœºæ™¯å¯ä»¥éƒ¨ç½²åœ¨å¤šä¸ªæ¨¡æ‹ŸæœåŠ¡å™¨ä¸Šç”±å•ä¸ªCore-GUIæ§åˆ¶ã€‚è¡¨ç¤ºæ•´ä¸ªæ‹“æ‰‘çš„GUIå¯ä»¥æ˜¯ å…¶ä¸­ä¸€å°æ¨¡æ‹ŸæœåŠ¡å™¨æˆ–å•ç‹¬çš„åªè¿è¡Œ","tags":[""],"title":"Core åˆ†å¸ƒå¼","uri":"https://liangkang233.github.io/2021/07/distributed/","year":"2021"},{"content":"CORE æ§åˆ¶ç½‘ç»œï¼ˆCTRL NETï¼‰ æ¦‚è¿° CORE æ§åˆ¶ç½‘ç»œå…è®¸è™šæ‹ŸèŠ‚ç‚¹ä¸å…¶å®¿ä¸»ç¯å¢ƒè¿›è¡Œé€šä¿¡ã€‚æœ‰ä¸¤ç§ç±»å‹ï¼šä¸»æ§åˆ¶ç½‘ç»œå’Œè¾…åŠ©æ§åˆ¶ç½‘ç»œã€‚ä¸»æ§åˆ¶ç½‘ç»œä¸»è¦ç”¨äºä¸ä¸»æœºçš„è™šæ‹ŸèŠ‚ç‚¹é€šä¿¡ä»¥åŠå¤šæœåŠ¡å™¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„ä¸»ä»é€šä¿¡ã€‚è¾…åŠ©æ§åˆ¶ç½‘ç»œçš„åŠŸèƒ½ä¸ºå°†ç”±å‘½åç©ºé—´æ‰˜ç®¡çš„ä»¿çœŸè½¯ä»¶æµé‡è·¯ç”±è‡³æµ‹è¯•ç½‘ç»œåœºæ™¯ã€‚\næ¿€æ´»ä¸»æ§åˆ¶ç½‘ç»œ åœ¨ Session Menuæœ‰ä¸€ä¸ªé€‰é¡¹æ¥è®¾ç½® control network prefix.\nè¿™å¯ä»¥è®¾ç½®ä¸ºç½‘ç»œå‰ç¼€ï¼ˆç½‘æ®µï¼‰ï¼Œä¾‹å¦‚ 172.16.0.0/24ã€‚å°†åœ¨ç½‘æ®µèŒƒå›´å†…çš„æœ€åä¸€ä¸ªåœ°å€ï¼ˆä¾‹å¦‚ 172.16.0.254ï¼‰çš„ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªç½‘æ¡¥ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹å°†æœ‰ä¸€ä¸ªé¢å¤–çš„ ctrl0 æ§åˆ¶æ¥å£ï¼Œå¹¶é…ç½®ä¸€ä¸ªä¸å…¶èŠ‚ç‚¹å·ç›¸å¯¹åº”çš„ipåœ°å€ï¼ˆä¾‹å¦‚172.16.0.3 è¡¨ç¤º n3)\nè¿˜å¯ä»¥é€šè¿‡åœ¨ /etc/core/core.conf é…ç½®æ–‡ä»¶ä¸­è®¾ç½® controlnet è¡Œæ¥æŒ‡å®šä¸»æ§åˆ¶ç½‘ç»œçš„é»˜è®¤å€¼ï¼Œæ–°ä¼šè¯å°†é»˜è®¤ä½¿ç”¨è¯¥è¡Œã€‚è¦åŒæ—¶ä½¿ç”¨æ§åˆ¶ç½‘ç»œè¿è¡Œå¤šä¸ªä¼šè¯ï¼Œåº”ä½¿ç”¨ session é€‰é¡¹è€Œä¸æ˜¯ core.conf é»˜è®¤å€¼\næ³¨æ„: å¦‚æœæ‚¨æœ‰è¶…è¿‡ 253 ä¸ªèŠ‚ç‚¹çš„å¤§å‹åœºæ™¯ï¼Œè¯·ä½¿ç”¨ /23 æˆ–æ›´å¤§çš„ç½‘æ®µã€‚\næ³¨æ„: å¦‚æœå‰ä¸€ä¸ªä¼šè¯å·²è®¾ç½®æ§åˆ¶ç½‘ç»œå¹¶ä¸”å…¶ç½‘æ¡¥ä»åœ¨è¿è¡Œï¼Œåˆ™ç»§ç»­ä½¿ç”¨æ§åˆ¶ç½‘ç»œè¿è¡Œä¼šè¯å¯èƒ½ä¼šå¤±è´¥ã€‚é¦–å…ˆå…³é—­ä¸Šä¸€ä¸ªä¼šè¯æˆ–ç­‰å¾…å®ƒå®Œæˆã€‚å¦‚æœä¸èƒ½ï¼Œåˆ™å¯èƒ½éœ€è¦é‡æ–°å¯åŠ¨æ ¸å¿ƒå®ˆæŠ¤ç¨‹åºå¹¶æ‰‹åŠ¨åˆ é™¤å»¶è¿Ÿçš„æ¡¥æ¥å™¨\n# é‡å¯ CORE Daemon sudo /etc/init.d core-daemon restart # ç§»é™¤æ®‹ç•™çš„æ§åˆ¶ç½‘æ¡¥ ctrlbridges=`brctl show | grep b.ctrl | awk '{print $1}'` for cb in $ctrlbridges; do sudo ifconfig $cb down sudo brctl delbr $cb done **æ³¨æ„:**å¦‚æœåœ¨ /etc/core/core.conf ä¸­å¯¹ä¸»æ§åˆ¶ç½‘ç»œé…ç½®æ‰€åšçš„è°ƒæ•´ä¼¼ä¹æ²¡æœ‰ç”Ÿæ•ˆï¼Œè¯·æ£€æŸ¥Session Menu, the *Options\u0026hellip;*å¯¹è¯æ¡†ä¸­æ˜¯å¦æœ‰ä»»ä½•è®¾ç½®ï¼Œå®ƒä»¬å¯èƒ½éœ€è¦æ¸…é™¤ã€‚è¿™äº›ä¼šè¯çš„è®¾ç½®ä¼šè¦†ç›– /etc/core/core.conf ä¸­çš„é»˜è®¤å€¼ã€‚\nåˆ†å¸ƒå¼ä¼šè¯ä¸­çš„æ§åˆ¶ç½‘ç»œ å½“ä¸»æ§åˆ¶ç½‘ç»œåšä¸ºåˆ†å¸ƒå¼ä¼šè¯æ¿€æ´»æ—¶ï¼Œå°†åœ¨æ¯ä¸ªä»æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ§åˆ¶ç½‘æ¡¥ï¼Œå¹¶é€šè¿‡GREéš§é“è¿”å›åˆ°ä¸»æœåŠ¡å™¨çš„ç½‘æ¡¥ã€‚ä»æ§åˆ¶ç½‘æ¡¥æ²¡æœ‰åˆ†é…åœ°å€ï¼Œå¯ä»¥ä»ä¸»æœºè®¿é—®ä»»ä½•èŠ‚ç‚¹(æœ¬åœ°æˆ–è¿œç¨‹)ï¼Œå°±åƒå•ä¸ªæœåŠ¡å™¨çš„æƒ…å†µä¸€æ ·ã€‚\nåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿œç¨‹æ¨¡æ‹ŸèŠ‚ç‚¹éœ€è¦ä¸è¿è¡Œå®ƒä»¬çš„ä¸»æœºè€Œä¸æ˜¯ä¸»æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚å¯ä»¥åœ¨ä¼šè¯é€‰é¡¹æˆ– /etc/core/core.conf ä¸­æŒ‡å®šå¤šä¸ªæ§åˆ¶ç½‘ç»œå‰ç¼€ï¼Œä»¥ç©ºæ ¼åˆ†éš”å¹¶ä»¥ä¸»æœåŠ¡å™¨å¼€å¤´ã€‚æ¯ä¸ªæ¡ç›®çš„æ ¼å¼ä¸º server:prefix ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæ›´æ”¹ /etc/core/core.conf é»˜è®¤é…ç½®ï¼Œä¸ºæœåŠ¡å™¨ core1ã€core2 å’Œ core3 åˆ†é…äº†æ§åˆ¶ç½‘ç»œç½‘æ®µã€‚ä¹Ÿå¯åœ¨ä¼šè¯sessioné€‰é¡¹ä¸­è®¾å®šã€‚\ncontrolnet=core1:172.16.1.0/24 core2:172.16.2.0/24 core3:172.16.1.0/24 ç„¶åï¼Œæ§åˆ¶ç½‘æ¡¥å°†è¢«åˆ†é…å¦‚ä¸‹\n* core1 = 172.16.1.254 ï¼ˆå‡è®¾å®ƒæ˜¯ä¸»æœåŠ¡å™¨ï¼‰ * core2 = 172.16.2.254 * core3 = 172.16.3.254 ä»å°†æ„å»ºä»æœåŠ¡å™¨å¯¼å‘ä¸»æœåŠ¡å™¨çš„éš§é“ï¼Œä½†å¦‚æœéœ€è¦åœ¨æ§åˆ¶ç½‘ç»œå‰ç¼€ä¹‹é—´å»ºç«‹ç½‘ç»œï¼Œåˆ™éœ€è¦ç”¨æˆ·æ·»åŠ é€‚å½“çš„è·¯ç”±ã€‚æ§åˆ¶ç½‘ç»œè„šæœ¬å¯èƒ½å¯¹æ­¤æœ‰æ‰€å¸®åŠ©ã€‚\næ§åˆ¶ç½‘ç»œè„šæœ¬ å¯ä»¥ä½¿ç”¨ /etc/core/core.conf æ–‡ä»¶ä¸­çš„ controlnet_updown_script é€‰é¡¹æŒ‡å®šæ§åˆ¶ç½‘ç»œè„šæœ¬ã€‚è¯¥è„šæœ¬å°†åœ¨ç½‘æ¡¥å»ºæˆï¼ˆå¹¶åˆ†é…åœ°å€ï¼‰åè¿è¡Œï¼Œå‘½ä»¤çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç½‘æ¡¥çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å…³é”®å­— â€œstartupâ€ã€‚è¯¥è„šæœ¬å°†åœ¨ç§»é™¤æ¡¥æ—¶ä¼šå†æ¬¡è¢«è°ƒç”¨ï¼Œå‘½ä»¤çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç½‘æ¡¥çš„åç§°ï¼Œå‘½ä»¤çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯å…³é”®å­— â€œshutdownâ€ã€‚è¯¥è„šæœ¬é»˜è®¤ä½ç½®åœ¨~/core/daemon/examples/controlnet_updownä¸­ã€‚\nè¾…åŠ©æ§åˆ¶ç½‘ç»œ ä» EMANE 0.9.2 å¼€å§‹ï¼ŒCORE å°†åœ¨å‘½åç©ºé—´å†…è¿è¡Œ EMANE å®ä¾‹ã€‚ç”±äºå»ºè®®å°† OTA æµé‡ä¸å…¶ä»–æµé‡åˆ†å¼€ï¼Œå› æ­¤æˆ‘ä»¬å°†éœ€è¦å¤šä¸ªä»å‘½åç©ºé—´å¯¼å‡ºçš„é€šé“ã€‚æœ€å¤šå¯ä»¥å®šä¹‰ä¸‰ä¸ªè¾…åŠ©æ§åˆ¶ç½‘ç»œã€‚ /etc/core/core.conf æ–‡ä»¶ä¸­è®¾ç½®äº†å¤šä¸ªæ§åˆ¶ç½‘ç»œã€‚çº¿è·¯ controlnet1ã€controlnet2 å’Œ controlnet3 å®šä¹‰è¾…åŠ©ç½‘ç»œã€‚\nä¾‹å¦‚ /etc/core/core.conf ä¸­é…ç½®å¦‚ä¸‹\ncontrolnet = core1:172.17.1.0/24 core2:172.17.2.0/24 core3:172.17.3.0/24 controlnet1 = core1:172.18.1.0/24 core2:172.18.2.0/24 core3:172.18.3.0/24 controlnet2 = core1:172.19.1.0/24 core2:172.19.2.0/24 core3:172.19.3.0/24 # ç»è¿‡æµ‹è¯•å‘ç°ï¼Œæºç å·²ç»æ”¹å˜è¯»å–é…ç½®æ–¹å¼ï¼Œè¾…åŠ©æ§åˆ¶ç½‘åªä¼šæ¥å…¥ç¬¬ä¸€ä¸ªç½‘æ®µã€‚å¦‚ä¸‹é…ç½®å³å¯ controlnet0 = 172.17.1.0/24 controlnet1 = 172.18.1.0/24 controlnet2 = 172.19.1.0/24 # controlneté…ç½®ä¸”controlnet0æœªé…ç½®æ—¶ï¼Œcontrolnetå°±æ˜¯ä¸»æ§ç½‘ï¼Œå¦åˆ™ä¸»æ§ç½‘ç½‘æ®µä¸ºcontrolnet0 # è¾…åŠ©æ§åˆ¶ç½‘æ¥å£åªåœ¨é…ç½®äº†emaneçš„èŠ‚ç‚¹å®¹å™¨ä¸Šç”Ÿæˆï¼Œä¸»æ§ç½‘é—´é€šä¿¡éƒ½æ˜¯greé€šå‘ä¸»æœåŠ¡å™¨è½¬å‘ã€‚ # è€Œè¾…åŠ©æ§åˆ¶ç½‘æ¥å£attachèŠ‚ç‚¹å¤–ç‰©ç†ä¸»æœºçš„ç½‘æ¡¥ï¼Œå¹¶ä¸”å„åˆ†å¸ƒå¼è¾…åŠ©ç½‘åœ¨åŒä¸€å±€åŸŸç½‘é…ç½®è·¯ç”±åæ— è§†ä»¿çœŸæ‹“æ‰‘å¯ç›´æ¥é€šä¿¡ã€‚ è¿™å°†æ¿€æ´»ä¸»æ§åˆ¶ç½‘ç»œcontrolnetå’Œä¸¤ä¸ªè¾…åŠ©æ§åˆ¶ç½‘ç»œï¼Œå¹¶å‘æ¯ä¸ªèŠ‚ç‚¹æ·»åŠ æ¥å£ ctrl0ã€ctrl1ã€ctrl2ã€‚ä¾‹å¦‚åœ¨ EMANE é€‰é¡¹å¯¹è¯æ¡†ä¸­å°† ctrl1 åˆ†é…ç»™ OTA ç®¡ç†å™¨è®¾å¤‡ï¼Œå°† ctrl2 åˆ†é…ç»™äº‹ä»¶æœåŠ¡è®¾å¤‡ï¼Œå¹¶å°† ctrl0 ç•™ç»™ CORE æ§åˆ¶æµé‡ï¼ˆä¸»æ§ç½‘ç»œï¼‰\nNOTE: controlnet0 å¯ä»¥ç”¨æ¥ä»£æ›¿ controlnet æ¥é…ç½®ä¸»æ§åˆ¶ç½‘ç»œ\nä¸ä¸»æ§åˆ¶ç½‘ç»œä¸åŒï¼Œè¾…åŠ©æ§åˆ¶ç½‘ç»œä¸ä¼šä½¿ç”¨éš§é“ï¼Œå› ä¸ºå®ƒä»¬çš„ä¸»è¦ç›®çš„æ˜¯æœ‰æ•ˆåœ°ä¼ è¾“å¤šæ’­ EMANE OTA å’Œäº‹ä»¶æµé‡ã€‚\nè¯·æ³¨æ„ï¼Œè¾…åŠ©æ§åˆ¶ç½‘ç»œæ²¡æœ‰é’ˆå¯¹æ¯ä¸ªä¼šè¯çš„é…ç½®\nä¸ºäº†åœ¨åˆ†å¸ƒå¼æµ‹è¯•ç¯å¢ƒä¸­æ‰©å±•è¾…åŠ©æ§åˆ¶ç½‘ç»œï¼Œéœ€è¦å‘å…¶ä¸­æ·»åŠ ä¸»æœºç½‘ç»œæ¥å£ã€‚ /etc/core/core.conf ä¸­çš„ä»¥ä¸‹å‡ è¡Œå°†ä¸»æœºè®¾å¤‡çš„ eth1ã€eth2 æ·»åŠ åˆ° controlnet1ã€controlnet2ï¼š\ncontrolnetif1 = eth1 controlnetif2 = eth2 NOTE: æ— éœ€ä¸ºä¸»æ§åˆ¶ç½‘ç»œåˆ†é…æ¥å£ï¼Œå› ä¸ºä½¿ç”¨servers.conf ä¸­æä¾›çš„IP åœ°å€åœ¨ä¸»è®¾å¤‡å’Œä»è®¾å¤‡ä¹‹é—´å½¢æˆéš§é“\nä¸‹å›¾æ˜¯ä¸Šè¿°é…ç½®çš„ç¤ºæ„å›¾ï¼š\n","id":30,"section":"posts","summary":"CORE æ§åˆ¶ç½‘ç»œï¼ˆCTRL NETï¼‰ æ¦‚è¿° CORE æ§åˆ¶ç½‘ç»œå…è®¸è™šæ‹ŸèŠ‚ç‚¹ä¸å…¶å®¿ä¸»ç¯å¢ƒè¿›è¡Œé€šä¿¡ã€‚æœ‰ä¸¤ç§ç±»å‹ï¼šä¸»æ§åˆ¶ç½‘ç»œå’Œè¾…åŠ©æ§åˆ¶ç½‘ç»œã€‚ä¸»æ§åˆ¶ç½‘ç»œä¸»è¦ç”¨äºä¸ä¸»æœºçš„","tags":[""],"title":"Core æ§åˆ¶ç½‘ç»œ","uri":"https://liangkang233.github.io/2021/07/ctrlnet/","year":"2021"},{"content":"Core ç¯å¢ƒæ­å»º æ¨èä½¿ç”¨Vscodeç¼–è¾‘ä»£ç ï¼Œå¯ä»¥å®‰è£…å¯¹åº”pythonæ‰©å±•è·³è½¬å®šä¹‰å£°æ˜ç­‰ã€‚\n# æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•ï¼Œå¹¶ä¸”å®‰è£…ä¾èµ–è½¯ä»¶ï¼š sudo apt update # å¯ç”¨ Visual Studio Code æºä»“åº“ï¼Œè¾“å…¥ï¼š sudo apt install software-properties-common apt-transport-https wget # ä½¿ç”¨ wget å‘½ä»¤æ’å…¥ Microsoft GPG key ï¼š wget -q https://packages.microsoft.com/keys/microsoft.asc -O- | sudo apt-key add - # å¯ç”¨ Visual Studio Code æºä»“åº“: sudo add-apt-repository \u0026quot;deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main\u0026quot; sudo apt install code å®‰è£…æŠ“åŒ…å·¥å…·å’Œsshç­‰ç»„ä»¶\nsudo apt-get install openssh-client openssh-server isc-dhcp-server isc-dhcp-client \\ tcpdump openvpn traceroute wireshark iperf3 sudo setcap 'CAP_NET_RAW+eip CAP_NET_ADMIN+eip' /usr/bin/dumpcap sudo adduser $USER wireshark å®‰è£…Core ä¾ç…§æ‰‹å†Œæ•™ç¨‹å³å¯ï¼šåˆ—å‡ºé‡åˆ°çš„é—®é¢˜ã€‚æ¨èå®‰è£…coreåœ¨è™šæ‹Ÿç¯å¢ƒä¸­ï¼ˆé»˜è®¤é€‰é¡¹ï¼‰\n# æ›´æ–°pythonå’Œpip python3 -m pip install -U pip # æˆ–è€…ç›´æ¥apt-get sudo apt install python3 python3-pip # clone CORE repo git clone https://github.com/coreemu/core.git cd core # è„šæœ¬ç”¨æ³•: install.sh [-v] [-d] [-l] [-p \u0026lt;prefix\u0026gt;] # -v enable verbose install # -d enable developer install # -l enable local install, not compatible with developer install # -p install prefix, defaults to /usr/local # install core to virtual environment ./install.sh -p \u0026lt;prefix\u0026gt; # install core locally ./install.sh -p \u0026lt;prefix\u0026gt; -l è‡ªåŠ¨å®‰è£…è„šæœ¬install.shå°†ä¼šæ‰§è¡Œä»¥ä¸‹å·¥ä½œ\nå®‰è£…å®‰è£…æ‰€éœ€çš„åŸºç¡€å·¥å…·python3, pip, pipx, invoke, poetry ä¸ºæ„å»ºCoreå®‰è£…ç³»ç»Ÿä¾èµ– clone/build/install OPSF MDR çš„å·¥ä½œç‰ˆæœ¬ é€šè¿‡ä¼ å…¥å‚æ•°æ ‡å¿—ï¼Œè®¾å®šå°†Coreå®‰è£…åˆ°poetryç®¡ç†çš„è™šæ‹Ÿç¯å¢ƒä¸­æˆ–çœŸå®ç¯å¢ƒä¸­ æ ¹æ®å®‰è£…ç±»å‹æ¥å®‰è£…é€‚å½“çš„Pythonä½ç½®çš„æŒ‡å‘è„šæœ¬ æ ¹æ®å®‰è£…ç±»å‹æ¥å®‰è£…é€‚å½“çš„Pythonä½ç½®çš„systemdæœåŠ¡ è¿è¡Œè½¯ä»¶å®‰è£…è„šæœ¬install.shæŠ¥é”™æˆ–æ— æ•ˆæ—¶ä¼šç›´æ¥åœæ­¢å¯¼è‡´åç»­å‘½ä»¤ä¸æ‰§è¡Œã€‚\nå¦‚æœæ˜¯å› ä¸ºæ¨¡å—å·²ç»å®‰è£…è¿‡ï¼Œæ‰“å¼€è„šæœ¬è¿›è¡ŒæŸ¥çœ‹å¯¹åº”å®‰è£…å‘½ä»¤ï¼Œå¸è½½éœ€è¦åˆ æ‰çš„ç¯å¢ƒæ¨¡å—å³å¯ã€‚\nInvokå‘½ä»¤çš„ä½¿ç”¨ï¼š\nå…¶å®installè„šæœ¬å°±æ˜¯è¿è¡Œinvokeå¯¹åº”é€‰é¡¹çš„å®‰è£…ï¼Œä½¿ç”¨å¦‚ä¸‹æ•™ç¨‹æ¥è¿›è¡Œcoreçš„å®‰è£…å¸è½½\ninv --list #list æŒ‡ä»¤é€‰é¡¹: daemon #è¿è¡Œ core-daemon install #å®‰è£… core, poetry, scripts, service, ospf mdr install-emane #å®‰è£… emane and the python bindings install-scripts #å®‰è£… core è„šæœ¬æ‰§è¡Œæ–‡ä»¶, ä¿®æ”¹ä»¥åˆ©ç”¨è™šæ‹Ÿç¯å¢ƒ install-service #å®‰è£… systemd core æœåŠ¡ test #è¿è¡Œ core tests test-emane #è¿è¡Œ core emane tests test-mock #è¿è¡Œ core tests ä½¿ç”¨ mock æ¥é¿å…ä»¥ç®¡ç†å‘˜(sudo)æ¥æ‰§è¡Œ uninstall #å¸è½½ core, scripts, service, virtual environment, æ¸…ç† build ç›®å½• #å®‰è£…çš„è¯¦ç»†å¸®åŠ©ä¿¡æ¯ inv -h install Usage: inv[oke] [--core-opts] install [--options] [other tasks here ...] Docstring: install core, poetry, scripts, service, and ospf mdr Options: -d, --dev å®‰è£…å¼€å‘æ¨¡å¼ -p STRING, --prefix=STRING è®¾ç½®è„šæœ¬å®‰è£…è·¯å¾„ï¼Œé»˜è®¤æ˜¯/usr/local -v, --verbose å¯ç”¨ verbose å…³äºæ±‰åŒ–guiç•Œé¢çš„é‡è£…\n# å…ˆå¸è½½ sudo make uninstall make clean ./bootstrap.sh clean #å®‰è£… ./bootstrap.sh ./configure make sudo make install # ä¸Šè¿°ä»£ç å°±æ˜¯æ—©æœŸç‰ˆæœ¬çš„ç”Ÿæˆå’Œå¸è½½ # æ–°ç‰ˆæœ¬ç›´æ¥ä½¿ç”¨invokeå¸è½½é‡è£…æ•´ä¸ªå³å¯,å½“ç„¶æœ‰éœ€è¦å¯ä»¥åœ¨involeè„šæœ¬å¯¹åº”çš„task.pyä¸­æ·»åŠ instal-coreï¼Œå¦‚ä¸‹æ‰€ç¤º @task() def reinstall_core( c, dev=False, verbose=False, local=False, prefix=DEFAULT_PREFIX, install_type=None ): \u0026quot;\u0026quot;\u0026quot; reinstall core by LK233 \u0026quot;\u0026quot;\u0026quot; hide = not verbose p = Progress(verbose) c.run(\u0026quot;sudo -v\u0026quot;, hide=True) print(f\u0026quot;uninstalling core with prefix: {prefix}\u0026quot;) with p.start(\u0026quot;uninstalling core\u0026quot;): c.run(\u0026quot;sudo make uninstall\u0026quot;, hide=hide) with p.start(\u0026quot;cleaning build directory\u0026quot;): c.run(\u0026quot;make clean\u0026quot;, hide=hide) c.run(\u0026quot;./bootstrap.sh clean\u0026quot;, hide=hide) print(f\u0026quot;installing core with prefix: {prefix}\u0026quot;) with p.start(\u0026quot;building core\u0026quot;): build_core(c, hide, prefix) with p.start(\u0026quot;installing vcmd/gui\u0026quot;): install_core(c, hide) æ•´ä¸ªcoreå¥—ä»¶å¸è½½é‡è£…æ—¶é‡åˆ°çš„é—®é¢˜\nç”±äºå¸è½½è„šæœ¬è¿è¡Œæ—¶æ²¡æœ‰å¸è½½è™šæ‹Ÿç¯å¢ƒä¸­çš„poetryï¼Œå¯¼è‡´ä¹‹åè¿è¡Œå®‰è£…è„šæœ¬invokeæŠ¥é”™åœæ­¢ã€‚å¯ä»¥é€šè¿‡åœ¨å®‰è£…è„šæœ¬æ·»åŠ \u0026ndash;forceå¼ºåˆ¶å®‰è£…æˆ–å¸è½½è„šæœ¬æ·»åŠ å¸è½½poetryä»£ç è§£å†³ï¼Œæœ€å¿«çš„è§£å†³åŠæ³•ï¼ˆcoreå®‰è£…åœ¨è™šæ‹Ÿç¯å¢ƒçš„æƒ…å†µï¼‰å¸è½½ååœ¨coreçš„æ ¹ç›®å½•æ‰§è¡Œ\npipx uninstall poetry\nå®‰è£…Emane è‡ªåŠ¨å®‰è£…è„šæœ¬å®‰è£…çš„Emaneç‰ˆæœ¬ä¸º1.25ï¼ŒCoreè™šæ‹Ÿç¯å¢ƒå®‰è£…ä»…æ”¯æŒEmane1.21ä»¥ä¸Šç‰ˆæœ¬\ninvokeè„šæœ¬ä»»åŠ¡èƒ½è‡ªåŠ¨å®‰è£…Emaneï¼Œå®ƒä»æºä»£ç æ¥æ„å»ºå®‰è£…Emaneï¼Œä½†åœ¨è¾ƒè€çš„Protobufç¼–è¯‘å™¨ä¸Šçš„ç³»ç»Ÿå­˜åœ¨é—®é¢˜ã€‚\n# å®‰è£…Emaneåˆ°coreè™šæ‹Ÿç¯å¢ƒä¸­ inv install-emane # å®‰è£…åˆ°çœŸå®pythonç¯å¢ƒ inv install-emane -l å¦å¤–ï¼ŒEMANEå¯ä»¥ä»debæˆ–RPMåŒ…æˆ–ä»æºä»£ç å®‰è£…ã€‚è¯¦è§EMANE GitHubã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸æ˜¯æœ¬åœ°pythonç¯å¢ƒå®‰è£…ï¼Œpythonéœ€è¦ç»‘å®šåˆ°COREçš„virtualenvä¸­ã€‚(Emaneå®‰è£…æ•™ç¨‹)éœ€è¦å°†EMANE pythonç»‘å®šå®‰è£…åˆ°COREè™šæ‹Ÿç¯å¢ƒvirtualenvä¸­ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼šï¼ˆå®‰è£…è¿‡ç¨‹ä¸invokè„šæœ¬å®‰è£…emaneç±»ä¼¼ï¼‰\n# å…‹éš†å’Œæ„å»ºEmane pythonç»‘å®š git clone https://github.com/adjacentlink/emane.git cd emane ./autogen.sh PYTHON=python3 ./configure --prefix=/usr cd src/python make # å®‰è£…åˆ°coreè™šæ‹Ÿç¯å¢ƒ cd \u0026lt;CORE_REPO\u0026gt;/daemon poetry run pip install \u0026lt;EMANE_REPO\u0026gt;/src/python è¿è¡Œcore è¦æµ‹è¯•CORE Network Emulatoræ˜¯å¦å·¥ä½œï¼Œè¯·å¯åŠ¨COREå®ˆæŠ¤è¿›ç¨‹å’ŒGUIã€‚ é¦–å…ˆï¼Œå¯åŠ¨COREå®ˆæŠ¤è¿›ç¨‹:\nsudo service core-daemon start #ç›´æ¥å¼€æ–°ç»ˆç«¯è¿è¡Œï¼Œæ–¹ä¾¿çœ‹æ—¥å¿— sudo core-daemon #å®ˆæŠ¤è¿›ç¨‹å¸®åŠ©æ‰‹å†Œ -h -f CONFIGFILE, --configfile CONFIGFILE è¯»å–é…ç½®æ–‡ä»¶CONFIGFILEï¼Œé»˜è®¤æ˜¯/etc/core/core.conf -p PORT, --port PORT è®¾å®športä¸ºå®ˆæŠ¤è¿›ç¨‹ç›‘å¬ç«¯å£ï¼Œé»˜è®¤4038 --ovs å¯ç”¨å®éªŒovsæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalse --grpc-port GRPCPORT è®¾å®šGRPCPORTä¸ºGRPCç›‘å¬ç«¯å£ï¼Œé»˜è®¤50051 --grpc-address GRPCADDRESS è®¾å®šGRPCADDRESSä¸ºç›‘å¬grpcåœ°å€;é»˜è®¤æœ¬åœ°ä¸»æœº -l LOGFILE, --logfile LOGFILE è®¾ç½®LOGFILEä¸ºå®ˆæŠ¤è¿›ç¨‹æ—¥å¿—é€‰é¡¹ï¼Œé»˜è®¤ä¸º/etc/core/logging.confï¼Œé”™è¯¯æ—¥å¿—ä¸ºcore-daemon.log å¦‚æœåœ¨å®‰è£…COREåæ²¡æœ‰é‡æ–°å¯åŠ¨ï¼Œæ­¤æ—¶å¯èƒ½ä¼šé‡åˆ°é”™è¯¯ã€‚å¦‚æœæ‚¨çœ‹åˆ°å‘Šè¯‰æ‚¨æ–‡ä»¶coreå®ˆæŠ¤è¿›ç¨‹çš„é”™è¯¯ã€‚ æœåŠ¡ä¸å­˜åœ¨ï¼Œè¯·é‡æ–°å¯åŠ¨ç³»ç»Ÿã€‚é‡æ–°å¯åŠ¨åï¼Œå†æ¬¡å°è¯•å¯åŠ¨coreå®ˆæŠ¤è¿›ç¨‹æœåŠ¡ã€‚ ç„¶åï¼Œè¿è¡ŒCORE GUI\ncore-gui å¦‚æœä½ åˆ›å»ºè‡ªå·±çš„pythonè„šæœ¬æ¥ç›´æ¥è¿è¡ŒCOREæˆ–è€…ä½¿ç”¨gRPC/TLV apiï¼Œä½ éœ€è¦ç¡®ä¿ä½ æ˜¯åœ¨å®‰è£…çš„è™šæ‹Ÿç¯å¢ƒçš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œå®ƒä»¬ã€‚ä¸ºäº†å¸®åŠ©æ”¯æŒè¿™ä¸ªCOREæä¾›äº†CORE-pythonå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å°†å…è®¸ä½ è¿›å…¥COREçš„pythonè™šæ‹Ÿç¯å¢ƒè§£é‡Šå™¨æˆ–åœ¨å…¶ä¸­è¿è¡Œè„šæœ¬ã€‚\ncore-python \u0026lt;script\u0026gt; è‹¥æ˜¯å®‰è£…åœ¨çœŸå®ç¯å¢ƒä¸­ç›´æ¥æ‰§è¡Œ\npython3 \u0026lt;script\u0026gt; Coreæ–‡ä»¶ä»‹ç» ä¸‹é¢æ˜¯è¿è¡Œè‡ªåŠ¨å®‰è£…åå°†å®‰è£…çš„æ–‡ä»¶åˆ—è¡¨ã€‚\n**æ³¨:**é»˜è®¤çš„å®‰è£…å‰ç¼€æ˜¯/usr/localï¼Œä½†å¯ä»¥æ›´æ”¹å¦‚ä¸‹æ‰€ç¤º\næ‰§è¡Œæ–‡ä»¶ \u0026lt;prefix\u0026gt;/bin/{core-daemon, core-gui, vcmd, vnoded, etc} tcl/tk gui æ–‡ä»¶ \u0026lt;prefix\u0026gt;/lib/core \u0026lt;prefix\u0026gt;/share/core/icons ç¤ºä¾‹åœºæ™¯ imn æ–‡ä»¶ \u0026lt;prefix\u0026gt;/share/core/examples python æ–‡ä»¶ poetry è™šæ‹Ÿç¯å¢ƒ cd \u0026lt;repo\u0026gt;/daemon \u0026amp;\u0026amp; poetry env info ~/.cache/pypoetry/virtualenvs/ æœ¬åœ°pythonå®‰è£… default install path for python3 installation of a wheel python3 -c \u0026quot;import core; print(core.__file__)\u0026quot; é…ç½®æ–‡ä»¶ /etc/core/{core.conf, logging.conf} ospf mdr ä»“åº“æ–‡ä»¶ \u0026lt;repo\u0026gt;/../ospf-mdr emane ä»“åº“æ–‡ä»¶ \u0026lt;repo\u0026gt;/../emane æ‰§è¡Œæ–‡ä»¶ å®‰è£…å®Œæˆåï¼Œå®ƒå°†å®‰è£…ä»¥ä¸‹è„šæœ¬ã€‚\nåç§° æè¿° core-cleanup åˆ é™¤å·¥å…·ï¼Œå¸®åŠ©åˆ é™¤Coreåˆ›å»ºçš„å®¹å™¨ï¼Œç½‘æ¡¥ï¼Œç›®å½• core-cli è¿è¡Œæ”¯æŒçš„CoreæœåŠ¡å™¨ï¼Œæä¾›TLVå’ŒgRPC api core-daemon runs the backed core server providing TLV and gRPC APIs core-gui è¿è¡Œä¼ ç»Ÿçš„åŸºäºtcl/tkçš„GUI core-imn-to-xml å¸®åŠ©è‡ªåŠ¨å°†.imnæ–‡ä»¶è½¬æ¢ä¸º.xmlæ ¼å¼çš„å·¥å…· core-manage ç”¨äºæ·»åŠ ã€ç§»é™¤æˆ–æ£€æŸ¥|ä¸­çš„æœåŠ¡ã€æ¨¡å‹å’ŒèŠ‚ç‚¹ç±»å‹çš„å·¥å…· core-pygui è¿è¡Œæ–°çš„çš„åŸºäºPythonçš„GUI core-python è¿è¡Œcoreè™šæ‹Ÿç¯å¢ƒå†…çš„python core-route-monitor å¸®åŠ©ç›‘æ§èŠ‚ç‚¹é—´çš„æµé‡å¹¶å°†å…¶æä¾›ç»™SDTçš„å·¥å…· core-service-update æ›´æ–°ä¿®æ”¹é—ç•™æœåŠ¡ä»¥åŒ¹é…å½“å‰å‘½åçš„å·¥å…· coresendmsg ä»å‘½ä»¤è¡Œå‘é€TLV APIå‘½ä»¤çš„å·¥å…· ","id":31,"section":"posts","summary":"Core ç¯å¢ƒæ­å»º æ¨èä½¿ç”¨Vscodeç¼–è¾‘ä»£ç ï¼Œå¯ä»¥å®‰è£…å¯¹åº”pythonæ‰©å±•è·³è½¬å®šä¹‰å£°æ˜ç­‰ã€‚ # æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•ï¼Œå¹¶ä¸”å®‰è£…ä¾èµ–è½¯ä»¶ï¼š sudo apt update # å¯ç”¨ Visual Studio Code æº","tags":[""],"title":"Core Emaneç¯å¢ƒæ­å»º","uri":"https://liangkang233.github.io/2021/07/installation/","year":"2021"},{"content":" Core æ¶æ„ Python API gRPC API Coreæ¶æ„ ä¸»è¦ç»„ä»¶ Coreå®ˆæŠ¤(æœåŠ¡)è¿›ç¨‹ (core-daemon)\nè¯¥ç¨‹åºæ˜¯åˆ©ç”¨å°å‹CäºŒè¿›åˆ¶æ–‡ä»¶æ¥åˆ›å»ºèŠ‚ç‚¹çš„Pythonä»¿çœŸç¨‹åº ç®¡ç†ç½‘ç»œèŠ‚ç‚¹ã€é“¾è·¯çš„ä»¿çœŸä¼šè¯ ä½¿ç”¨Linuxå‘½åç©ºé—´åˆ›å»ºèŠ‚ç‚¹ é“¾è·¯æ˜¯ç”±Linuxç½‘æ¡¥å’Œè™šæ‹Ÿä»¥å¤ªç½‘è®¾å¤‡TAPç­‰åˆ›å»ºçš„ é“¾è·¯æ•°æ®åŒ…æ˜¯é€šè¿‡æµé‡æ§åˆ¶æ¥æ“çºµçš„ ä»¿çœŸè¿‡ç¨‹å¯ä»¥ç”±CORE GUIæ§åˆ¶ æä¾›è‡ªå®šä¹‰TLV APIå’ŒgRPC API Core-gui\nGUIå’Œå®ˆæŠ¤è¿›ç¨‹é€šè¿‡è‡ªå®šä¹‰TLV APIè¿›è¡Œé€šä¿¡ æ‹–æ”¾èŠ‚ç‚¹å’Œé“¾æ¥çš„åˆ›å»º å¯ä»¥åœ¨è¿è¡Œçš„ä¼šè¯ä¸­å¯åŠ¨ä»¿çœŸèŠ‚ç‚¹çš„ç»ˆç«¯ å¯ä»¥ä¿å­˜/æ‰“å¼€åœºæ™¯æ–‡ä»¶é‡æ–°åˆ›å»ºä»¥å‰çš„ä¼šè¯ TCL/TK ç¨‹åº Coresendmsg\nç”¨äºå°†TLV APIæ¶ˆæ¯å‘é€åˆ°æ ¸å¿ƒå®ˆæŠ¤è¿›ç¨‹çš„å‘½ä»¤è¡Œå®ç”¨ç¨‹åº è™šæ‹Ÿå‘½ä»¤ç»ˆç«¯ (vcmd)\nç”¨äºå‘èŠ‚ç‚¹å‘é€shellå‘½ä»¤çš„å‘½ä»¤è¡Œå®ç”¨ç¨‹åº ä¼šè¯Sessions COREå¯ä»¥åŒæ—¶åˆ›å»ºå’Œè¿è¡Œå¤šä¸ªæ¨¡æ‹Ÿä¼šè¯ï¼Œä¸‹é¢è¡¨æ ¼ä»å·¦å‘å³æ¦‚è¿°äº†å…¸å‹GUIäº¤äº’æœŸé—´ä¼šè¯å°†è½¬æ¢çš„çŠ¶æ€ã€‚\nå®šä¹‰åˆå§‹åŒ– é…ç½®å‚æ•° å®‰è£…æ¨¡æ‹ŸèŠ‚ç‚¹ è¿è¡Œä»¿çœŸ æ•°æ®é‡‡é›† åœæ­¢ä»¿çœŸ XML/IMN ä¼šè¯ Guiç»˜åˆ¶è„šæœ¬ é…ç½®hooksã€é…ç½®æœåŠ¡ã€é…ç½®ç§»åŠ¨æ€§å’ŒWLANã€é…ç½®Emance åˆ›å»ºèŠ‚ç‚¹ã€æ¥å£æ¡¥æ¥é“¾è·¯ã€å¯åŠ¨æœåŠ¡ ç§»åŠ¨æ€§ä»¿çœŸã€äº¤äº’shellã€çŠ¶æ€è®¾å®šè„šæœ¬ å…³é—­æœåŠ¡é”€æ¯æ¥å£ã€æ¡¥æ¥é“¾è·¯ã€èŠ‚ç‚¹ å·¥ä½œåŸç† COREæ¡†æ¶è¿è¡Œåœ¨Linuxä¸Šï¼Œå¹¶ä½¿ç”¨Linuxå‘½åç©ºé—´åˆ›å»ºèŠ‚ç‚¹å®¹å™¨ã€‚è¿™äº›èŠ‚ç‚¹ä½¿ç”¨Linuxç½‘æ¡¥å’Œè™šæ‹Ÿæ¥å£è¿æ¥åœ¨ä¸€èµ·ã€‚COREä¼šè¯æ˜¯ä¸€ç»„èŠ‚ç‚¹å’Œé“¾æ¥ï¼Œå®ƒä»¬å‡ºäºç‰¹å®šç›®çš„ä¸€èµ·å·¥ä½œã€‚Linuxç½‘ç»œåç§°ç©ºé—´(ä¹Ÿç§°ä¸ºnetns: Linux network namespaces )æ˜¯COREä½¿ç”¨çš„ä¸»è¦æŠ€æœ¯ã€‚å¤§å¤šæ•°æœ€æ–°çš„Linuxå‘è¡Œç‰ˆéƒ½å…·æœ‰å¼€ç®±å³ç”¨çš„æ”¯æŒåç§°ç©ºé—´çš„å†…æ ¸ã€‚æ¯ä¸ªå‘½åç©ºé—´éƒ½æœ‰è‡ªå·±çš„è¿›ç¨‹ç¯å¢ƒå’Œç§æœ‰çš„ç½‘ç»œå †æ ˆã€‚ç½‘ç»œåç§°ç©ºé—´åœ¨COREä¸­å…±äº«ç›¸åŒçš„æ–‡ä»¶ç³»ç»Ÿã€‚COREå°†è¿™äº›åç§°ç©ºé—´ä¸Linuxä»¥å¤ªç½‘æ¡¥æ¥ç»“åˆèµ·æ¥ï¼Œå½¢æˆç½‘ç»œã€‚ä½¿ç”¨Linux Netemæ’é˜Ÿè§„åˆ™åº”ç”¨é“¾æ¥ç‰¹æ€§ã€‚Ebtablesæ˜¯Linuxæ¡¥ä¸Šçš„ä»¥å¤ªç½‘å¸§è¿‡æ»¤æ–¹æ³•ï¼Œé€šè¿‡ä½¿ç”¨ebtablesè§„åˆ™æ§åˆ¶å“ªäº›æ¥å£å¯ä»¥å‘é€å’Œæ¥æ”¶æ¥æ¨¡æ‹Ÿæ— çº¿ç½‘ç»œã€‚\nä¹‹å‰çš„å·¥ä½œ Tcl/Tk CORE GUIæœ€åˆèµ·æºäºè¨æ ¼å‹’å¸ƒå¤§å­¦çš„å¼€æºIMUNESé¡¹ç›®ï¼Œä½œä¸ºæ³¢éŸ³ç ”ç©¶ä¸æŠ€æœ¯ç½‘ç»œæŠ€æœ¯ç ”ç©¶å°ç»„2004å¹´çš„ä¸€ä¸ªå®šåˆ¶é¡¹ç›®ã€‚ä»é‚£æ—¶èµ·ï¼Œä»–ä»¬å¼€å‘äº†ä½¿ç”¨Linuxå‘½åç©ºé—´çš„COREæ¡†æ¶ï¼Œå¼€å‘äº†ä¸€ä¸ªPythonæ¡†æ¶ï¼Œå¹¶è¿›è¡Œäº†å¤§é‡çš„ç”¨æˆ·å’Œå†…æ ¸ç©ºé—´å¼€å‘ï¼Œä¾‹å¦‚æ”¯æŒæ— çº¿ç½‘ç»œã€IPsecã€åˆ†å¸ƒå¼ä»¿çœŸã€ä»¿çœŸé›†æˆç­‰ç­‰ã€‚IMUNESé¡¹ç›®è¿˜åŒ…æ‹¬ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç»„ä»¶ã€‚\nå¼€æºé¡¹ç›®å’Œèµ„æº COREå·²ç»ç”±æ³¢éŸ³åœ¨BSDè®¸å¯ä¸‹å‘å¸ƒç»™å¼€æºç¤¾åŒºã€‚å¦‚æœæ‚¨å‘ç°COREå¯¹æ‚¨çš„å·¥ä½œæœ‰ç”¨ï¼Œè¯·è¿”å›åˆ°é¡¹ç›®ä¸­ã€‚è´¡çŒ®å¯ä»¥åƒæŠ¥å‘Šbugã€å‘é‚®ä»¶åˆ—è¡¨æä¾›é¼“åŠ±æˆ–æŠ€æœ¯å»ºè®®ä¸€æ ·ç®€å•ï¼Œä¹Ÿå¯ä»¥åŒ…æ‹¬æäº¤è¡¥ä¸æˆ–ç»´æŠ¤å·¥å…·çš„å„ä¸ªæ–¹é¢ã€‚\nPython API å…³é”®è¦ç†è§£ä¸Šé¢çš„æ¶æ„å›¾ï¼Œå°±èƒ½æ˜ç™½ä¸‹é¢è¿™äº›apiçš„å…·ä½“å®ç°\nä½¿ç”¨Python APIå¯ä»¥å®Œå…¨æ§åˆ¶ä»¿çœŸçš„æ‰€æœ‰æ–¹é¢ï¼Œè¿™äº›pythonè„šæœ¬éœ€è¦ä»¥ root æƒé™è¿è¡Œï¼Œå› ä¸ºå®ƒä»¬ä¼šåˆ›å»ºæ–°çš„ç½‘ç»œå‘½åç©ºé—´ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ ä½¿ç”¨è¿™äº›python api çš„CORE Python ç¨‹åºä¸ä¼šè¿æ¥åˆ° CORE daemonï¼ˆå¯ä»¥ç†è§£ä¸ºå®ƒè‡ªå·±å°±æ˜¯ä¸€ä¸ªcore-daemonï¼‰ï¼Œå®é™…ä¸Šï¼Œcore-daemon åªæ˜¯å¦ä¸€ä¸ªä½¿ç”¨ CORE Python api æ¨¡å—å¹¶ä¸ GUI äº¤æ¢æ¶ˆæ¯çš„ Python è„šæœ¬ã€‚ç›¸å…³apiæ–‡ä»¶æŸ¥çœ‹è¯¥è·¯å¾„ core/daemon/core/emulator/data.py çš„ InterfaceDataç±»ã€‚\nå…·ä½“ä¾‹å­å°±ä¸åˆ†æäº†ï¼Œç›´æ¥çœ‹ä½¿ç”¨gRPCåè®®çš„ api å¦‚ä½•ä½¿ç”¨ã€‚\ngRPC API core-pygui ä¸ coredaemon çš„ç•Œé¢äº¤äº’å°±æ˜¯é€šè¿‡ gRPC api æ¥é©±åŠ¨coreçš„æ‰€æœ‰åŠŸèƒ½ï¼Œæ‰€ä»¥è°ƒç”¨è¿™äº›apiéœ€è¦å¯åŠ¨ core-daemonã€‚å¯ä»¥ä»åŒ…å«åœ¨ CORE ä¸­çš„åŸå§‹ç”Ÿæˆçš„ grpc æ–‡ä»¶åˆ›å»ºä¸€ä¸ª python clientï¼Œæˆ–è€…å¯ä»¥åˆ©ç”¨ core æºç ä¸­ æä¾›çš„ gRPC api æ¥å¸®åŠ©å°è£…ä¸€äº›åŠŸèƒ½åšè¿›ä¸€æ­¥çš„å¼€å‘ã€‚\ngRPC apiæ˜¯æŒ‡ä½¿ç”¨äº†gRPCæ¡†æ¶é€šä¿¡åè®®çš„apiï¼Œå…¶ä»£ç å®ç°å¯ä»¥æ˜¯python c++ç­‰è¯­è¨€(è¿™é‡Œä½¿ç”¨çš„è¿˜æ˜¯pythonè¯­è¨€)ä¸ä¸Šè¿°çš„Python apiå¹¶éåŒç§apiã€‚\nCoreGrpcClient æä¾›äº†ä¸€ä¸ª python å®¢æˆ·ç«¯åŒ…è£…å™¨å…¶å°è£…äº†ä¸€äº›å¸¸ç”¨çš„apiè°ƒç”¨ï¼Œä¸‹é¢çš„ç¤ºä¾‹å°±æ˜¯è°ƒç”¨çš„å®ƒã€‚ç”±äº gRPC åŸºäº HTTP2ï¼Œä»£ç†é…ç½®å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒgRPC å®¢æˆ·ç«¯ç¦ç”¨ä»£ç†æ”¯æŒä»¥é¿å…å¯ç”¨ä»£ç†æ—¶å‡ºç°é—®é¢˜ã€‚Proto æ–‡ä»¶ç”¨äºå®šä¹‰ç”¨äºä¸æ­¤ API æ¥å£çš„ API å’Œ protobuf æ¶ˆæ¯ã€‚ å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°å®ƒä»¬ä»¥æŸ¥çœ‹æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…çš„ç»†èŠ‚ä»¥åŠå°†è¿”å›çš„å“åº”æ¶ˆæ¯å€¼ã€‚\nå…·ä½“ä¾‹å­å’Œpython apiçš„ä¾‹å­åœ¨åŒä¸€ç›®å½•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å…¶apiçš„è°ƒç”¨ä¸åŠŸèƒ½ä¸python apiéå¸¸ç›¸ä¼¼ï¼Œä¸ªäººçŒœæµ‹æ˜¯åŸæœ‰çš„ coresendmsg core-gui ç­‰ç¨‹åºè°ƒç”¨çš„ tlv åè®®ä½œè€…æƒ³ä¸€æ­¥æ­¥å¼ƒç”¨ï¼Œæ‰€ä»¥ä¸ºäº†å…¼å®¹é™ä½å­¦ä¹ æˆæœ¬æ ¹æ®åŸæ¥tlvæ ¼å¼çš„apiä½¿ç”¨æ–¹æ³• æ¥è®¾è®¡å°è£… gRPC apiã€‚è¯¥ä¸Šçº§ç›®å½•å…¶ä¸­è¿˜åŒ…å«äº†dockerã€lxdæ˜ å°„åˆ°coreä»¿çœŸä¸­çš„æŸä¸ªèŠ‚ç‚¹çš„ç¤ºä¾‹ï¼Œåç»­æœ‰å¯èƒ½ä¼šè¿›è¡Œç›¸å…³çš„å¼€å‘ã€‚\n","id":32,"section":"posts","summary":"Core æ¶æ„ Python API gRPC API Coreæ¶æ„ ä¸»è¦ç»„ä»¶ Coreå®ˆæŠ¤(æœåŠ¡)è¿›ç¨‹ (core-daemon) è¯¥ç¨‹åºæ˜¯åˆ©ç”¨å°å‹CäºŒè¿›åˆ¶æ–‡ä»¶æ¥åˆ›å»ºèŠ‚ç‚¹çš„Pythonä»¿çœŸç¨‹åº ç®¡ç†ç½‘ç»œèŠ‚ç‚¹ã€é“¾è·¯çš„","tags":[""],"title":"Core ä»¿çœŸæ¶æ„","uri":"https://liangkang233.github.io/2021/07/architecture/","year":"2021"},{"content":"ä½¿ç”¨ CORE GUI ä¸‹å›¾æ˜¾ç¤º CORE GUI:\næ¦‚è¿° GUI ç”¨äºåœ¨ç”»å¸ƒä¸Šç»˜åˆ¶èŠ‚ç‚¹å’Œç½‘ç»œè®¾å¤‡ï¼Œå°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·ï¼Œä»¥åˆ›å»ºæ¨¡æ‹Ÿçš„ç½‘ç»œä¼šè¯ã€‚\næŒ‰ä¸‹å¯åŠ¨æŒ‰é’®åï¼ŒCORE å°†é€šè¿‡è¿™äº›é˜¶æ®µè¿›è¡Œï¼Œä¿æŒåœ¨è¿è¡Œæ—¶é˜¶æ®µã€‚ä¼šè¯åœæ­¢åï¼ŒCORE å°†è¿›å…¥æ•°æ®æ”¶é›†é˜¶æ®µï¼Œç„¶åå¸è½½æ¨¡æ‹ŸçŠ¶æ€ã€‚\nCORE å¯è‡ªå®šä¹‰ä»¥åœ¨æ¯ä¸ªçŠ¶æ€æ‰§è¡Œä»»ä½•æ“ä½œã€‚æœ‰å…³ä½•æ—¶è¾¾åˆ°è¿™äº›ä¼šè¯çŠ¶æ€ï¼Œè¯·å‚é˜…ä¼šè¯èœå•ä¸Šçš„Hooks\u0026hellip;\nå¿…è¦æ¡ä»¶ é™¤äº†å®‰è£…COREä¹‹å¤–ï¼Œè¿˜å¿…é¡»è¿è¡ŒCOREå®ˆæŠ¤è¿›ç¨‹ã€‚\nåœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨systemdæˆ–sysvã€‚\n# systemd sudo systemctl daemon-reload sudo systemctl start core-daemon # sysv sudo service core-daemon start è¿˜å¯ä»¥ç›´æ¥ä»å‘½ä»¤è¡Œè°ƒç”¨å®ˆæŠ¤è¿›ç¨‹ï¼Œå¦‚æœæ‚¨æƒ³ç›´æ¥æŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚\n# direct invocation sudo core-daemon æ“ä½œæ¨¡å¼ æ ¸å¿ƒGUIæœ‰ä¸¤ç§ä¸»è¦æ“ä½œæ¨¡å¼ï¼Œç¼–è¾‘å’Œæ‰§è¡Œæ¨¡å¼ã€‚è¿è¡ŒGUIï¼Œé€šè¿‡é”®å…¥æ²¡æœ‰é€‰é¡¹Core-guiï¼Œä»ç¼–è¾‘æ¨¡å¼å¼€å§‹ã€‚èŠ‚ç‚¹ä½¿ç”¨å·¦ä¾§çš„å·¥å…·æ ç»˜åˆ¶åœ¨ç©ºç™½ç”»å¸ƒä¸Šï¼Œå¹¶ä»å³é”®å•å‡»èœå•æˆ–åŒå‡»èœå•è¿›è¡Œé…ç½®ã€‚GUI ä¸éœ€è¦ä½œä¸ºrootè¿è¡Œã€‚\nç¼–è¾‘å®Œæˆåï¼ŒæŒ‰ä¸‹ç»¿è‰²å¼€å§‹æŒ‰é’®ï¼ˆæˆ–ä»ä¼šè¯èœå•ä¸­é€‰æ‹©æ‰§è¡Œï¼‰ä¼šå›  Linux å†…æ ¸ä¸­çš„æ‹“æ‰‘ï¼Œç„¶åè¿›å…¥æ‰§è¡Œæ¨¡å¼ã€‚åœ¨æ‰§è¡Œæ¨¡å¼ä¸‹ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡åŒå‡»æˆ–å³é”®å•å‡»è¿è¡Œæ¨¡æ‹Ÿçš„è®¡ç®—æœºè¿›è¡Œäº¤äº’ã€‚ç¼–è¾‘å·¥å…·æ æ¶ˆå¤±ï¼Œç”±æ‰§è¡Œå·¥å…·æ æ›¿æ¢ï¼Œè¯¥å·¥å…·æ åœ¨è¿è¡Œä»¿çœŸæ—¶æä¾›å·¥å…·ã€‚æŒ‰ä¸‹çº¢è‰²åœæ­¢æŒ‰é’®ï¼ˆæˆ–ä»ä¼šè¯èœå•ä¸­é€‰æ‹©ç»ˆæ­¢ï¼‰å°†ç ´åè¿è¡Œæ¨¡æ‹Ÿå¹¶å°† CORE è¿”å›åˆ°ç¼–è¾‘æ¨¡å¼ã€‚\nCOREå¯ä»¥é€šè¿‡æŒ‡å®š start å‘½ä»¤è¡Œç›´æ¥åœ¨æ‰§è¡Œæ¨¡å¼ä¸‹å¯åŠ¨åœºæ™¯ï¼š\ncore-gui --start ~/.core/configs/myfile.imn ä¸€æ—¦æ¨¡æ‹Ÿå¼€å§‹è¿è¡Œï¼Œå°±å¯ä»¥å…³é—­GUIï¼Œå¹¶å‡ºç°æç¤ºè¯¢é—®æ˜¯å¦åº”è¯¥ç»ˆæ­¢ä»¿çœŸã€‚ä¹‹åè¿è¡Œæ—¶ï¼ŒGUIä¼šæç¤ºé‡æ–°è¿æ¥åˆ°ç°æœ‰çš„ä¼šè¯ã€‚\nGUIå¯ä»¥åœ¨Linuxä¸Šä»¥æ™®é€šç”¨æˆ·çš„èº«ä»½è¿è¡Œã€‚GUIå¯ä»¥è¿æ¥åˆ°ä¸åŒçš„åœ°å€æˆ–TCPç«¯å£ä½¿ç”¨**\u0026ndash;addresså’Œ/æˆ–\u0026ndash;port**é€‰é¡¹ã€‚é»˜è®¤å€¼å¦‚ä¸‹æ‰€ç¤ºã€‚\ncore-gui --address 127.0.0.1 --port 4038 å·¥å…·æ  å·¥å…·æ æ˜¯ä¸€æ’æŒ‰é’®ï¼Œæ²¿Core guiçª—å£çš„å·¦ä¾§å‚ç›´è¿è¡Œã€‚å·¥å…·æ ä¼šæ ¹æ®æ“ä½œæ¨¡å¼è€Œå˜åŒ–ã€‚\nç¼–è¾‘å·¥å…·æ  å½“ CORE å¤„äºç¼–è¾‘æ¨¡å¼ï¼ˆé»˜è®¤å€¼ï¼‰æ—¶ï¼Œå‚ç›´ç¼–è¾‘å·¥å…·æ ä½äºæ ¸å¿ƒçª—å£çš„å·¦ä¾§ã€‚\nä»¥ä¸‹æ˜¯ä»é¡¶éƒ¨å¼€å§‹çš„æ¯ä¸ªå·¥å…·æ é¡¹çš„ç®€è¦è¯´æ˜ã€‚å¤§å¤šæ•°å·¥å…·è¢«åˆ†ç»„åˆ°ç›¸å…³çš„å­èœå•ä¸­ï¼Œå½“æ‚¨å•å‡»å…¶ç»„å›¾æ ‡æ—¶ä¼šå‡ºç°è¿™äº›å­èœå•ã€‚\nå›¾æ ‡ åå­— æè¿° é€‰æ‹©å·¥å…· ç”¨äºé€‰æ‹©ã€ç§»åŠ¨ã€é…ç½®èŠ‚ç‚¹çš„å·¥å…·ã€‚ å¯åŠ¨æŒ‰é’® å¼€å§‹æ‰§è¡Œæ¨¡å¼ï¼Œå®ä¾‹åŒ–æ¨¡æ‹ŸèŠ‚ç‚¹ã€‚ é“¾æ¥ å…è®¸é€šè¿‡å•å‡»å’Œæ‹–åŠ¨é¼ æ ‡åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´ç»˜åˆ¶ç½‘ç»œé“¾æ¥ã€‚ æ ¸å¿ƒèŠ‚ç‚¹ è¿™äº›èŠ‚ç‚¹å°†åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹å®¹å™¨å¹¶è¿è¡Œç›¸å…³æœåŠ¡ã€‚\nå›¾æ ‡ åå­— æè¿° è·¯ç”±å™¨ è¿è¡ŒQuagga OSPFv2å’ŒOSPFv3è·¯ç”±è½¬å‘æ•°æ®åŒ…ã€‚ ä¸»æœº æ¨¡æ‹ŸæœåŠ¡å™¨æœºå…·æœ‰é»˜è®¤è·¯çº¿ï¼Œè¿è¡ŒSSHæœåŠ¡å™¨ã€‚ ä¸ªäººç”µè„‘ å…·æœ‰é»˜è®¤è·¯çº¿çš„åŸºæœ¬æ¨¡æ‹Ÿæœºå™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸è¿è¡Œä»»ä½•è¿›ç¨‹ã€‚ æŒ‡å®šè·¯ç”±å™¨ç§»åŠ¨è‡ªç»„ç½‘åè®®ï¼ˆ MANET Designated Routersï¼‰ è¿è¡Œ Quagga OSPFv3 MDR è·¯ç”±ï¼Œç”¨äºç®¡ç†ä¼˜åŒ–è·¯ç”±ã€‚ï¼ˆMANETs: Mobile Ad Hoc Networks ç§»åŠ¨è‡ªç»„ç½‘ï¼‰ ç‰©ç†è·¯ç”±å™¨ï¼ˆPRouterï¼‰ ç‰©ç†è·¯ç”±å™¨ä»£è¡¨äº†ä¸€ä¸ªçœŸå®çš„è¯•éªŒæœºå™¨ã€‚ ç¼–è¾‘ ç”Ÿæˆè‡ªå®šä¹‰èŠ‚ç‚¹å¯¹è¯ã€‚ ç½‘ç»œèŠ‚ç‚¹ è¿™äº›èŠ‚ç‚¹ä¸»è¦ç”¨äºåˆ›å»ºä¸€ä¸ª Linux ç½‘æ¡¥ï¼Œç”¨äºä»¥ä¸‹ç›®çš„ã€‚\nå›¾æ ‡ åå­— æè¿° é›†çº¿å™¨hub ä»¥å¤ªç½‘é›†çº¿å™¨å°†ä¼ å…¥çš„æ•°æ®åŒ…è½¬å‘åˆ°æ¯ä¸ªè¿æ¥çš„èŠ‚ç‚¹ã€‚ äº¤æ¢æœºSwitch ä»¥å¤ªç½‘äº¤æ¢æœºä½¿ç”¨ä»¥å¤ªç½‘åœ°å€å“ˆå¸Œè¡¨æ™ºèƒ½åœ°å°†ä¼ å…¥çš„æ•°æ®åŒ…è½¬å‘ç»™é™„åŠ ä¸»æœºã€‚ Wireless LAN å½“è·¯ç”±å™¨è¿æ¥åˆ°æ­¤ WLAN èŠ‚ç‚¹æ—¶ï¼Œå®ƒä»¬ä¼šåŠ å…¥æ— çº¿ç½‘ç»œï¼Œå¹¶ç»˜åˆ¶å¤©çº¿è€Œä¸æ˜¯è¿æ¥çº¿ï¼šWLANèŠ‚ç‚¹é€šå¸¸æ ¹æ®è¿æ¥çš„è·ç¦»æ§åˆ¶è¿æ¥æ— çº¿èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥ã€‚ RJ45 RJ45ç‰©ç†æ¥å£å·¥å…·ï¼Œä»¿çœŸèŠ‚ç‚¹å¯é“¾æ¥åˆ°çœŸæ­£çš„ç‰©ç†æ¥å£ï¼šä½¿ç”¨æ­¤å·¥å…·ï¼ŒçœŸæ­£çš„ç½‘ç»œå’Œè®¾å¤‡å¯ä»¥ç‰©ç†è¿æ¥åˆ°å®æ—¶è¿è¡Œæ¨¡æ‹Ÿã€‚ Tunnel Tool allows connecting together more than one CORE emulation using GRE tunnels. æ³¨é‡Šå·¥å…· å›¾æ ‡ åå­— æè¿° Marker ç”¨äºåœ¨ç”»å¸ƒä¸Šç»˜åˆ¶æ ‡è®°ã€‚ Oval ç”¨äºåœ¨èƒŒæ™¯ä¸­æ˜¾ç¤ºçš„ç”»å¸ƒä¸Šç»˜åˆ¶åœ†åœˆã€‚ Rectangle ç”¨äºåœ¨èƒŒæ™¯ä¸­æ˜¾ç¤ºçš„ç”»å¸ƒä¸Šç»˜åˆ¶çŸ©å½¢ã€‚ Text ç”¨äºåœ¨ç”»å¸ƒä¸Šæ”¾ç½®æ–‡æœ¬å­—å¹•ã€‚ æ‰§è¡Œå·¥å…·æ  æŒ‰ä¸‹\u0026quot;å¼€å§‹\u0026quot;æŒ‰é’®åï¼ŒCORE åˆ‡æ¢åˆ°\u0026quot;æ‰§è¡Œ\u0026quot;æ¨¡å¼ï¼Œæ ¸å¿ƒçª—å£å·¦ä¾§çš„ç¼–è¾‘å·¥å…·æ æ›¿æ¢ä¸ºæ‰§è¡Œå·¥å…·æ ï¼Œä¸‹é¢æ˜¯æ­¤å·¥å…·æ ä¸Šçš„é¡¹ï¼Œä»é¡¶éƒ¨å¼€å§‹ã€‚\nå›¾æ ‡ åå­— æè¿° Selection Tool åœ¨æ‰§è¡Œæ¨¡å¼ä¸‹ï¼Œé€‰æ‹©å·¥å…·å¯ç”¨äºåœ¨ç”»å¸ƒå‘¨å›´ç§»åŠ¨èŠ‚ç‚¹ï¼Œåœ¨èŠ‚ç‚¹ä¸ŠåŒå‡»å°†æ‰“å¼€è¯¥èŠ‚ç‚¹çš„å¤–å£³çª—å£ï¼šå³é”®å•å‡»èŠ‚ç‚¹ä¼šè°ƒç”¨è¯¥èŠ‚ç‚¹çš„è¿è¡Œæ—¶é—´é€‰é¡¹çš„å¼¹å‡ºèœå•ã€‚ Stop Button åœæ­¢æ‰§è¡Œæ¨¡å¼ï¼Œç»ˆæ­¢ä»¿çœŸï¼Œå°† CORE è¿”å›åˆ°ç¼–è¾‘æ¨¡å¼ã€‚ Observer Widgets Tool å•å‡»æ­¤æ”¾å¤§é•œå›¾æ ‡å¯è°ƒç”¨èœå•ä»¥è½»æ¾é€‰æ‹©\u0026quot;è§‚å¯Ÿè€…å°éƒ¨ä»¶\u0026quot;ã€‚å½“\u0026quot;è§‚å¯Ÿè€…å°éƒ¨ä»¶\u0026quot;å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œå›¾æ ‡å…·æœ‰è¾ƒæ·±çš„ç°è‰²èƒŒæ™¯ï¼Œåœ¨æ­¤æœŸé—´ï¼Œå°†é¼ æ ‡ç§»åˆ°èŠ‚ç‚¹ä¸Šä¼šå¼¹å‡ºè¯¥èŠ‚ç‚¹çš„ä¿¡æ¯æ˜¾ç¤ºã€‚ Marker ç”¨äºåœ¨ç”»å¸ƒä¸Šç”»æ‰‹çº¿ï¼Œåœ¨æ¼”ç¤ºæœŸé—´æœ‰ç”¨ï¼šæ ‡è®°æœªä¿å­˜ã€‚ Two-node Tool å•å‡»ä»¥é€‰æ‹©å¼€å§‹å’Œç»“æŸèŠ‚ç‚¹ï¼Œå¹¶åœ¨è¿™äº›èŠ‚ç‚¹ä¹‹é—´è¿è¡Œä¸€æ¬¡æ€§è·Ÿè¸ªè·¯ç”±æˆ–èŠ‚ç‚¹ä¹‹é—´è¿ç»­*ping-Rã€‚*è¾“å‡ºå®æ—¶æ˜¾ç¤ºåœ¨ç»“æœæ¡†ä¸­ï¼Œè€Œ IP åœ°å€åˆ™è§£æï¼Œå¹¶åœ¨ CORE æ˜¾ç¤ºå±ä¸Šçªå‡ºæ˜¾ç¤ºå®Œæ•´çš„ç½‘ç»œè·¯å¾„ã€‚ Run Tool æ­¤å·¥å…·å…è®¸è½»æ¾åœ°åœ¨æ‰€æœ‰èŠ‚ç‚¹çš„å…¨éƒ¨æˆ–å­é›†ä¸Šè¿è¡Œå‘½ä»¤ã€‚åˆ—è¡¨æ¡†å…è®¸é€‰æ‹©ä»»ä½•èŠ‚ç‚¹ã€‚æ–‡æœ¬è¾“å…¥æ¡†å…è®¸è¾“å…¥ä»»ä½•å‘½ä»¤ã€‚å‘½ä»¤åº”ç«‹å³è¿”å›ï¼Œå¦åˆ™æ˜¾ç¤ºå±å°†é˜»æ­¢ç­‰å¾…å“åº”ã€‚ä¾‹å¦‚ï¼Œæ²¡æœ‰å‚æ•°çš„pingå‘½ä»¤ä¸æ˜¯ä¸ªå¥½ä¸»æ„ã€‚æ¯ä¸ªå‘½ä»¤çš„ç»“æœéƒ½æ˜¾ç¤ºåœ¨ç»“æœæ¡†ä¸­ã€‚ç‰¹æ®Šæ–‡æœ¬\u0026quot;NODE\u0026quot;çš„ç¬¬ä¸€æ¬¡å‡ºç°å°†æ›¿æ¢ä¸ºèŠ‚ç‚¹åç§°ã€‚å‘½ä»¤ä¸ä¼šå°è¯•åœ¨ä¸æ˜¯è·¯ç”±å™¨ã€PC æˆ–ä¸»æœºçš„èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå³ä½¿å®ƒä»¬è¢«é€‰ä¸­ã€‚ èœå• èœå•æ æ²¿ CORE GUI çª—å£çš„é¡¶éƒ¨è¿è¡Œï¼Œå¹¶æä¾›å¯¹å„ç§åŠŸèƒ½çš„è®¿é—®ã€‚æŸäº›èœå•å¯ä»¥é€šè¿‡å•å‡»é¡¶éƒ¨çš„è™šçº¿æ¥åˆ†ç¦»ï¼Œä¾‹å¦‚å°éƒ¨ä»¶èœå•ã€‚\næŸ¥çœ‹èœå• \u0026ldquo;è§†å›¾\u0026quot;èœå•åŒ…å«ç”¨äºæ§åˆ¶ç»˜å›¾ç”»å¸ƒä¸Šæ˜¾ç¤ºçš„å†…å®¹çš„é¡¹ç›®ã€‚\nOption Description Show Opens a submenu of items that can be displayed or hidden, such as interface names, addresses, and labels. Use these options to help declutter the display. These options are generally saved in the topology files, so scenarios have a more consistent look when copied from one computer to another. Show hidden nodes Reveal nodes that have been hidden. Nodes are hidden by selecting one or more nodes, right-clicking one and choosing hide. Locked Toggles locked view; when the view is locked, nodes cannot be moved around on the canvas with the mouse. This could be useful when sharing the topology with someone and you do not expect them to change things. 3D GUI\u0026hellip; è¿è¡ŒPreferencesï¼Œ 3D GUI commandä¸‹å®šä¹‰çš„å‘½ä»¤å¯åŠ¨3D GUIã€‚è¿™é€šå¸¸æ˜¯ä¸€ä¸ªè¿è¡ŒSDT3Dæ˜¾ç¤ºçš„è„šæœ¬ã€‚SDTæ˜¯NRLçš„è„šæœ¬æ˜¾ç¤ºå·¥å…·ï¼Œå®ƒåŸºäºç¾å›½å®‡èˆªå±€åŸºäºjavaçš„WorldWindè™šæ‹Ÿåœ°çƒè½¯ä»¶ã€‚ Zoom In Magnifies the display. You can also zoom in by clicking zoom 100% label in the status bar, or by pressing the + (plus) key. Zoom Out Reduces the size of the display. You can also zoom out by right-clicking zoom 100% label in the status bar or by pressing the - (minus) key. å·¥å…·èœå• å·¥å…·èœå•åˆ—å‡ºäº†ä¸åŒçš„å®ç”¨åŠŸèƒ½ã€‚\né€‰æ‹© æè¿° Autorearrange all è‡ªåŠ¨æ’åˆ—ç”»å¸ƒä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹ã€‚å…·æœ‰æ›´å¤šé“¾æ¥çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°ä¸­å¿ƒã€‚æ­¤æ¨¡å¼å¯ä»¥åœ¨æ”¾ç½®èŠ‚ç‚¹æ—¶ç»§ç»­è¿è¡Œã€‚è¦å…³é—­æ­¤è‡ªåŠ¨é‡æ–°æ’åˆ—æ¨¡å¼ï¼Œè¯·å•å‡»å¸¦æœ‰é€‰å®šå·¥å…·çš„ç”»å¸ƒç©ºç™½åŒºåŸŸï¼Œæˆ–å†æ¬¡é€‰æ‹©æ­¤èœå•é€‰é¡¹ã€‚ Autorearrange selected è‡ªåŠ¨æ’åˆ—ç”»å¸ƒä¸Šé€‰å®šçš„èŠ‚ç‚¹ã€‚ Align to grid å°†èŠ‚ç‚¹ç§»åŠ¨åˆ°ç½‘æ ¼å½¢æˆä¸­ï¼Œä»ç”»å¸ƒå·¦ä¸Šè§’çš„æœ€å°ç¼–å·èŠ‚ç‚¹å¼€å§‹ï¼Œåœ¨å‚ç›´æŸ±ä¸­æ’åˆ—èŠ‚ç‚¹ã€‚ Traffic\u0026hellip; è°ƒç”¨ CORE æµé‡æµå¯¹è¯æ¡†ï¼Œå…è®¸ä¸ºæ¨¡æ‹Ÿé…ç½®ã€å¯åŠ¨å’Œåœæ­¢ MGEN æµé‡æµã€‚ IP addresses\u0026hellip; è°ƒç”¨ IP åœ°å€å¯¹è¯æ¡†æ¥é…ç½®è‡ªåŠ¨å¤„ç†æ–°æ¥å£æ—¶ä½¿ç”¨çš„ IPv4/IPv6 å‰ç¼€ã€‚ MAC addresses\u0026hellip; è°ƒç”¨ MAC åœ°å€å¯¹è¯æ¡†æ¥é…ç½®ç”Ÿæˆæ¯ä¸ªæ¥å£ MAC åœ°å€æ—¶ç”¨ä½œæœ€ä½åˆ†èŠ‚çš„èµ·å§‹ç¼–å·ã€‚åœ¨è¿›è¡Œ CORE æ¨¡æ‹Ÿä¹‹é—´çš„éš§é“æ—¶ï¼Œåº”æ›´æ”¹æ­¤å€¼ï¼Œä»¥é˜²æ­¢ MAC è§£å†³å†²çªã€‚ Build hosts file\u0026hellip; è°ƒç”¨\u0026quot;æ„å»ºä¸»æœºæ–‡ä»¶\u0026quot;å¯¹è¯æ¡†ï¼Œæ ¹æ®ä»¿çœŸä¸­ä½¿ç”¨çš„ IP åœ°å€ç”Ÿæˆ /etc/host æ–‡ä»¶æ¡ç›®ã€‚ Renumber nodes\u0026hellip; è°ƒç”¨\u0026quot;é‡æ–°ç¼–å·èŠ‚ç‚¹\u0026quot;å¯¹è¯æ¡†ï¼Œå…è®¸åœ¨ç‚¹å‡»æ•°æ—¶å°†ä¸€ä¸ªèŠ‚ç‚¹ç¼–å·ä¸å¦ä¸€ä¸ªèŠ‚ç‚¹ç¼–å·äº¤æ¢ã€‚ Experimental\u0026hellip; å®éªŒé€‰é¡¹çš„èœå•ï¼Œå¦‚è½¬æ¢ns-2è„šæœ¬åˆ°IMUNES imnæ‹“æ‰‘ï¼Œåªæ”¯æŒåŸºæœ¬çš„ns-2åŠŸèƒ½ï¼Œä»¥åŠä¸€ä¸ªè‡ªåŠ¨åˆ’åˆ†æ‹“æ‰‘åˆ°åˆ†åŒºçš„å·¥å…·ã€‚ Topology generator æ‰“å¼€è¦ç”Ÿæˆçš„æ‹“æ‰‘çš„å­èœå•ã€‚æ‚¨å¯ä»¥é¦–å…ˆé€‰æ‹©æ‹“æ‰‘åº”è¯¥åŒ…å«çš„èŠ‚ç‚¹ç±»å‹ï¼Œå¦åˆ™å°†é»˜è®¤é€‰æ‹©è·¯ç”±å™¨ã€‚èŠ‚ç‚¹å¯ä»¥éšæœºæ”¾ç½®ã€åœ¨ç½‘æ ¼ä¸­å¯¹é½æˆ–å„ç§å…¶ä»–æ‹“æ‰‘æ¨¡å¼ã€‚ä¸‹è¡¨åˆ—å‡ºäº†æ‰€æœ‰å—æ”¯æŒçš„æ¨¡å¼ã€‚ Debugger\u0026hellip; æ‰“å¼€Core Debuggeræ‰§è¡Œä»»æ„ Tcl/Tk å‘½ä»¤ã€‚ æ‹“æ‰‘å‘ç”Ÿå™¨ æ¨¡å¼ æè¿° éšæœº èŠ‚ç‚¹éšæœºæ”¾ç½®åœ¨ç”»å¸ƒä¸Šï¼Œä½†æœªé“¾æ¥åœ¨ä¸€èµ·ã€‚è¿™å¯ä»¥ä¸ WLAN èŠ‚ç‚¹ä¸€èµ·å¿«é€Ÿåˆ›å»ºæ— çº¿ç½‘ç»œã€‚ ç½‘æ ¼ èŠ‚ç‚¹ä½äºæ°´å¹³è¡Œä¸­ï¼Œä»å·¦ä¸Šè§’å¼€å§‹ï¼Œå‡åŒ€åœ°å‘å³é—´éš”ï¼šèŠ‚ç‚¹ä¹‹é—´ä¸é“¾æ¥ã€‚ å·²è¿æ¥çš„ç½‘æ ¼ èŠ‚ç‚¹ä½äº N x Mï¼ˆå®½åº¦å’Œé«˜åº¦ï¼‰çŸ©å½¢ç½‘æ ¼ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½è¿æ¥åˆ°ä¸Šé¢ã€ä¸‹é¢ã€å·¦ä¾§å’Œå³ä¾§çš„èŠ‚ç‚¹ã€‚ é“¾ èŠ‚ç‚¹åœ¨é“¾æ¡ä¸­ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è¿æ¥åœ¨ä¸€èµ·ã€‚ æ˜Ÿ ä¸€ä¸ªèŠ‚ç‚¹æ”¾ç½®åœ¨ä¸­å¿ƒï¼ŒN èŠ‚ç‚¹ä»¥åœ†å½¢æ¨¡å¼ç¯ç»•ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½é“¾æ¥åˆ°ä¸­å¿ƒèŠ‚ç‚¹ã€‚ å‘¨æœŸ èŠ‚ç‚¹ä»¥åœ†å½¢æ¨¡å¼æ’åˆ—ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½è¿æ¥åˆ°å…¶é‚»å±…ï¼Œå½¢æˆå°é—­çš„åœ†å½¢è·¯å¾„ã€‚ è½®å­ è½¦è½®æ¨¡å¼å°†èŠ‚ç‚¹è¿æ¥åœ¨æ˜Ÿå½¢å’Œå¾ªç¯æ¨¡å¼çš„ç»„åˆä¸­ã€‚ ç«‹æ–¹ä½“ ç”ŸæˆèŠ‚ç‚¹çš„ç«‹æ–¹ä½“å›¾ã€‚ å…¨è¿æ¥ åˆ›å»ºä¸€ä¸ªç»“ç‚¹çš„åˆ†é˜Ÿå›¾ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½è¿æ¥åˆ°æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹ã€‚ äºŒåˆ†å›¾ åˆ›å»ºä¸¤ä¸ªèŠ‚ç‚¹çš„åŒåˆ†æ–¹å›¾ï¼Œå…·æœ‰ä¸¤ç»„è„±èŠ‚çš„é¡¶ç‚¹ã€‚ éƒ¨ä»¶èœå• å°éƒ¨ä»¶æ˜¯ GUI å…ƒç´ ï¼Œå…è®¸ä¸è¿è¡Œæ¨¡æ‹Ÿè¿›è¡Œäº¤äº’ã€‚å°éƒ¨ä»¶é€šå¸¸è‡ªåŠ¨åœ¨æ¨¡æ‹ŸèŠ‚ç‚¹ä¸Šè¿è¡Œå‘½ä»¤ï¼Œä»¥æŠ¥å‘ŠæŸç§ç±»å‹çš„çŠ¶æ€ä¿¡æ¯å¹¶åœ¨å±å¹•ä¸Šæ˜¾ç¤ºè¿™äº›ä¿¡æ¯ã€‚\nå‘¨æœŸæ€§éƒ¨ä»¶ è¿™äº›å°éƒ¨ä»¶æ˜¯ä¸»å°éƒ¨ä»¶èœå•ä¸­å¯ç”¨çš„ã€‚å…¶ä¸­å¤šä¸ªå°éƒ¨ä»¶å¯ä»¥åŒæ—¶è¿è¡Œã€‚äº‹ä»¶å¾ªç¯æ¯ç§’å‘å°„ä¸€æ¬¡ï¼Œæ¨¡æ‹Ÿæ­£åœ¨è¿è¡Œã€‚å¦‚æœå¯ç”¨äº†å…¶ä¸­ä¸€ä¸ªå°éƒ¨ä»¶ï¼Œåˆ™æ­¤æ—¶å°†è°ƒç”¨å…¶å‘¨æœŸæ€§ä¾‹ç¨‹ã€‚æ¯ä¸ªå°éƒ¨ä»¶å¯èƒ½æœ‰ä¸€ä¸ªé…ç½®å¯¹è¯æ¡†ï¼Œä¹Ÿå¯ä»¥ä»å°éƒ¨ä»¶èœå•è®¿é—®ã€‚\nä¸‹é¢æ˜¯ä¸€äº›æ ‡å‡†éƒ¨ä»¶ï¼š\nAdjacency- æ˜¾ç¤ºQuaggaâ€™s OSPFv2å’ŒOSPFv3è·¯ç”±åè®®çš„è·¯ç”±å™¨å¯¹æ¥çŠ¶æ€ã€‚ä»æ¯ä¸ªè·¯ç”±å™¨ä¸­æŠ½å–ä¸€æ¡çº¿ï¼Œä¸­é€”åˆ°ç›¸é‚»è·¯ç”±å™¨çš„è·¯ç”±å™¨ IDã€‚çº¿çš„é¢œè‰²åŸºäº OSPF çš„å¯¹ä¼šçŠ¶æ€ï¼Œå¦‚Two-way æˆ– Fullã€‚è¦äº†è§£ä¸åŒçš„é¢œè‰²ï¼Œè¯·å‚é˜…Configure Adjacencyâ€¦èœå•é¡¹ï¼Œvtyshå‘½ä»¤ç”¨äºè½¬å‚¨ OSPF é‚»å±…ä¿¡æ¯ã€‚åªç»˜åˆ¶äº†ä¸€åŠçš„çº¿ï¼Œå› ä¸ºæ¯ä¸ªè·¯ç”±å™¨å¯èƒ½å¤„äºä¸å¦ä¸€ä¸ªè·¯ç”±å™¨ä¸åŒçš„å¯¹ç­‰çŠ¶æ€ã€‚ Throughput- ä½¿ç”¨ng_pipe NetgraphèŠ‚ç‚¹æ”¶é›†çš„ç»Ÿè®¡æ•°æ®æ¥å®ç°æ˜¾ç¤ºæ¯ä¸ªé“¾æ¥ä¸Šæ–¹çš„æ¯ç§’åƒä½ååé‡ã€‚å¦‚æœååé‡è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œé“¾æ¥å°†å˜å¾—çªå‡ºæ˜¾ç¤ºã€‚å¯¹äºå‘èŒƒå›´å†…çš„æ‰€æœ‰èŠ‚ç‚¹å¹¿æ’­æ•°æ®çš„æ— çº¿èŠ‚ç‚¹ï¼Œååç‡æ˜¾ç¤ºåœ¨èŠ‚ç‚¹æ—è¾¹ï¼Œå¦‚æœé˜ˆå€¼è¶…å‡ºï¼ŒèŠ‚ç‚¹å°†å˜å¾—åœ†åœˆåŒ–ã€‚ è§‚å¯Ÿéƒ¨ä»¶ è¿™äº›å°éƒ¨ä»¶å¯ä»å°éƒ¨ä»¶èœå•çš„\u0026quot;è§‚å¯Ÿè€…å°éƒ¨ä»¶\u0026quot;å­èœå•ä»¥åŠå·¥å…·æ ä¸Šçš„\u0026quot;å°éƒ¨ä»¶å·¥å…·\u0026quot;ä¸­è·å–ã€‚ä¸€æ¬¡åªèƒ½ä½¿ç”¨ä¸€ä¸ªè§‚å¯Ÿè€…å°éƒ¨ä»¶ã€‚åœ¨ä¼šè¯è¿è¡Œæ—¶ï¼Œé¼ æ ‡åœ¨èŠ‚ç‚¹ä¸Šå¼¹å‡ºæœ‰å…³è¯¥èŠ‚ç‚¹çš„ä¿¡æ¯æ˜¾ç¤ºã€‚\nå¯ç”¨çš„è§‚å¯Ÿè€…å°éƒ¨ä»¶åŒ…æ‹¬ IPv4 å’Œ IPv6 è·¯ç”±è¡¨ã€socketä¿¡æ¯ã€è¿è¡Œè¿‡ç¨‹åˆ—è¡¨å’Œ OSPFv2/v3 é‚»å±…ä¿¡æ¯ã€‚\nè§‚å¯Ÿè€…å°éƒ¨ä»¶å¯ä»¥ç”±ç”¨æˆ·ç¼–è¾‘å¹¶é‡æ–°æ’åˆ—ã€‚ä»\u0026quot;è§‚å¯Ÿè€…å°éƒ¨ä»¶\u0026quot;èœå•ä¸­é€‰æ‹©ç¼–è¾‘å°†è°ƒç”¨\u0026quot;è§‚å¯Ÿè€…å°éƒ¨ä»¶\u0026quot;å¯¹è¯ã€‚æ˜¾ç¤ºè§‚å¯Ÿè€…å°éƒ¨ä»¶åˆ—è¡¨ä»¥åŠç”¨äºé‡æ–°æ’åˆ—åˆ—è¡¨çš„ä¸Šä¸‹ç®­å¤´ã€‚æ§ä»¶å¯ç”¨äºé‡å‘½åæ¯ä¸ªå°éƒ¨ä»¶ã€æ›´æ”¹é¼ æ ‡è¿è¡ŒæœŸé—´è¿è¡Œçš„å‘½ä»¤ä»¥åŠä»åˆ—è¡¨ä¸­æ·»åŠ å’Œåˆ é™¤é¡¹ç›®ã€‚è¯·æ³¨æ„ï¼ŒæŒ‡å®šå‘½ä»¤åº”ç«‹å³è¿”å›ï¼Œä»¥é¿å… GUI æ˜¾ç¤ºå±å‡ºç°å»¶è¿Ÿã€‚æ›´æ”¹å°†ä¿å­˜åˆ° CORE é…ç½®ç›®å½•ä¸­çš„widgets.confæ–‡ä»¶ã€‚\nä¼šè¯èœå• é™¤äº†èŠ‚ç‚¹ç±»å‹ã€æ³¨é‡Šã€é’©å­ã€æœåŠ¡å™¨å’Œé€‰é¡¹ç­‰å…¨å±€é€‰é¡¹å¤–ï¼Œä¼šè¯èœå•è¿˜æœ‰å¯åŠ¨ã€åœæ­¢å’Œç®¡ç†ä¼šè¯çš„æ¡ç›®ã€‚\nOption Description Start or Stop å¯åŠ¨æˆ–åœæ­¢ä»¿çœŸï¼Œæ‰§è¡Œä¸ç»¿è‰²å¯åŠ¨æˆ–çº¢è‰²åœæ­¢æŒ‰é’®ç›¸åŒçš„åŠŸèƒ½ã€‚ Change sessions\u0026hellip; è°ƒç”¨åŒ…å«å®ˆæŠ¤è¿›ç¨‹çš„æ´»åŠ¨COREä¼šè¯åˆ—è¡¨çš„CORE Sessionså¯¹è¯æ¡†ã€‚æ˜¾ç¤ºä¼šè¯çš„åç§°ã€èŠ‚ç‚¹æ•°ã€èµ·å§‹æ—¶é—´å’Œç¼©ç•¥å›¾ç­‰åŸºæœ¬ä¿¡æ¯ã€‚è¿™ä¸ªå¯¹è¯æ¡†å…è®¸è¿æ¥åˆ°ä¸åŒçš„ä¼šè¯ï¼Œå…³é—­ä¼šè¯ï¼Œæˆ–å¯åŠ¨ä¸€ä¸ªæ–°çš„ä¼šè¯ç­‰åŠŸèƒ½ã€‚ Node types\u0026hellip; è°ƒç”¨æ ¸å¿ƒèŠ‚ç‚¹ç±»å‹å¯¹è¯æ¡†ï¼Œæ‰§è¡Œä¸ç½‘ç»œå±‚èŠ‚ç‚¹å·¥å…·æ ä¸Šçš„ç¼–è¾‘æŒ‰é’®ç›¸åŒçš„åŠŸèƒ½ã€‚ Comments\u0026hellip; è°ƒç”¨CORE Session Commentsçª—å£ï¼Œå…¶ä¸­å¯ä»¥æŒ‡å®šå¯é€‰çš„æ–‡æœ¬æ³¨é‡Šã€‚è¿™äº›æ³¨é‡Šä¿å­˜åœ¨é…ç½®æ–‡ä»¶çš„é¡¶éƒ¨ï¼Œå¯¹äºæè¿°æ‹“æ‰‘æˆ–å¦‚ä½•ä½¿ç”¨ç½‘ç»œéå¸¸æœ‰ç”¨ã€‚ Hooks\u0026hellip; è°ƒç”¨CORE Session Hooksçª—å£ï¼Œå…¶ä¸­è„šæœ¬å¯ä»¥é…ç½®ä¸ºç‰¹å®šçš„ä¼šè¯çŠ¶æ€ã€‚ä¼šè¯çŠ¶æ€å®šä¹‰åœ¨ä¸‹é¢çš„è¡¨æ ¼ä¸­ã€‚çª—å£çš„é¡¶éƒ¨æœ‰ä¸€ä¸ªå·²é…ç½®çš„é’©å­åˆ—è¡¨ï¼Œå·¦ä¸‹æ–¹çš„æŒ‰é’®å…è®¸æ·»åŠ ã€ç¼–è¾‘å’Œåˆ é™¤é’©å­è„šæœ¬ã€‚æ–°å»ºæˆ–ç¼–è¾‘æŒ‰é’®å°†æ‰“å¼€ä¸€ä¸ªé’©å­è„šæœ¬ç¼–è¾‘çª—å£ã€‚hookè„šæœ¬æ˜¯åœ¨ä¸»æœºä¸Š(ä¸æ˜¯åœ¨è™šæ‹ŸèŠ‚ç‚¹å†…)è°ƒç”¨çš„shellè„šæœ¬ã€‚ Reset node positions å¦‚æœæ‚¨å·²ç»ä½¿ç”¨é¼ æ ‡æˆ–é€šè¿‡ç§»åŠ¨æ¨¡å—ç§»åŠ¨äº†èŠ‚ç‚¹ï¼Œé€‰æ‹©è¯¥é¡¹ç›®å°†é‡ç½®æ‰€æœ‰èŠ‚ç‚¹åˆ°å®ƒä»¬åœ¨ç”»å¸ƒä¸Šçš„åŸå§‹ä½ç½®ã€‚å½“æ‚¨ç¬¬ä¸€æ¬¡æŒ‰ä¸‹StartæŒ‰é’®æ—¶ï¼Œå°±å·²ç»è®°å½•èŠ‚ç‚¹ä½ç½®ã€‚ Emulation servers\u0026hellip; è°ƒç”¨COREä»¿çœŸæœåŠ¡å™¨å¯¹è¯æ¡†è¿›è¡Œé…ç½®ã€‚ Options\u0026hellip; æä¾›æ¯ä¸ªä¼šè¯çš„é€‰é¡¹ï¼Œå¦‚æ˜¯å¦ä½¿ç”¨çš„IPv4å‰ç¼€ï¼Œæ§åˆ¶ç½‘ç»œä¿å­˜ä¼šè¯ç›®å½•çš„èƒ½åŠ›ï¼ŒSDT3Dæ”¯æŒçš„å¼€/å…³ç­‰ã€‚ ä¼šè¯çŠ¶æ€ çŠ¶æ€ æè¿° å®šä¹‰ : DEFINITION_STATE GUI ç”¨æ¥å‘Šè¯‰åç«¯æ¸…é™¤ä¼šè¯çš„ä»»ä½•çŠ¶æ€ã€‚ é…ç½® : CONFIGURATION_STATE å½“ç”¨æˆ·æŒ‰ä¸‹å¼€å§‹æŒ‰é’®æ—¶ï¼ŒèŠ‚ç‚¹ã€é“¾æ¥å’Œå…¶ä»–é…ç½®æ•°æ®å°†å‘é€åˆ°åç«¯ã€‚å½“ç”¨æˆ·è‡ªå®šä¹‰æœåŠ¡æ—¶ï¼Œä¹Ÿä¼šè¾¾åˆ°æ­¤çŠ¶æ€ã€‚ å®ä¾‹ : INSTANTIATION_STATE è¯¥çŠ¶æ€åœ¨åˆ›å»ºèŠ‚ç‚¹ä¹‹åï¼Œå¯åŠ¨serviceå‰ã€‚ è¿è¡Œ : RUNTIME_STATE æ‰€æœ‰èŠ‚ç‚¹å’Œç½‘ç»œéƒ½å·²æ„å»ºå¹¶æ­£åœ¨è¿è¡Œã€‚(è¿™ä¸å‰é¢å‘½åçš„å…¨å±€å®éªŒè„šæœ¬è¿è¡Œæ—¶çš„çŠ¶æ€ç›¸åŒã€‚) æ•°æ®æ”¶é›† : DATACOLLECT_STATE ç”¨æˆ·å·²æŒ‰ä¸‹åœæ­¢æŒ‰é’®ï¼Œä½†åœ¨æœåŠ¡åœæ­¢å’ŒèŠ‚ç‚¹è¢«å…³é—­ä¹‹å‰ã€‚è¿™æ˜¯ä»èŠ‚ç‚¹æ”¶é›†æ—¥å¿—æ–‡ä»¶å’Œå…¶ä»–æ•°æ®çš„å¥½æ—¶æœºã€‚ å…³é—­ : SHUTDOWN_STATE æ‰€æœ‰èŠ‚ç‚¹å’Œç½‘ç»œéƒ½å·²è¢«å…³é—­å’Œé”€æ¯ã€‚ è¿æ¥ç‰©ç†ç½‘ç»œ CORE çš„æ¨¡æ‹Ÿç½‘ç»œå¯å®æ—¶è¿è¡Œï¼Œå› æ­¤å¯ä»¥è¿æ¥åˆ°å®æ—¶ç‰©ç†ç½‘ç»œã€‚RJ45 å·¥å…·å’Œéš§é“å·¥å…·æœ‰åŠ©äºè¿æ¥åˆ°ç°å®ä¸–ç•Œã€‚è¿™äº›å·¥å…·å¯ä»é“¾æ¥å±‚èŠ‚ç‚¹èœå•ä¸­è·å–ã€‚\nå½“ä¸¤ä¸ªæˆ–å¤šä¸ªCOREä»¿çœŸè¿æ¥åœ¨ä¸€èµ·æ—¶ï¼Œåº”è¯¥é¿å…MACåœ°å€å†²çªã€‚å¼€å§‹ä»¿çœŸæ—¶ï¼ŒCOREè‡ªåŠ¨ä¸ºå„æ¥å£åˆ†é…MACåœ°å€ï¼Œèµ·å§‹åœ°å€ä¸º00:00:00:aa:00:00ï¼Œä»åº•å­—èŠ‚å¼€å§‹é€’å¢ã€‚ç¬¬äºŒå°æœºå™¨ä¸Šçš„COREçš„MACèµ·å§‹åœ°å€åº”è¯¥æ”¹å˜ä»¥é¿å…å†²çªï¼Œä½¿ç”¨Toolèœå•çš„ MACåœ°å€â€¦ é€‰é¡¹æ¥è®¾å®šã€‚\nRJ45 å·¥å…· COREä¸­çš„RJ45èŠ‚ç‚¹ä»£è¡¨çœŸå®COREæœºå™¨ä¸Šçš„ä¸€ä¸ªç‰©ç†æ¥å£ã€‚ ä»»ä½•çœŸå®ä¸–ç•Œçš„ç½‘ç»œè®¾å¤‡éƒ½å¯ä»¥è¿æ¥åˆ°è¯¥æ¥å£å¹¶è¿›è¡Œé€šä¿¡å®æ—¶ä½¿ç”¨COREèŠ‚ç‚¹ã€‚\nå…¶ä¸»è¦ç¼ºç‚¹æ˜¯æ¯ä¸ªè¿æ¥éƒ½éœ€è¦ä¸€ä¸ªç‰©ç†æ¥å£ã€‚å½“ç‰©ç†æ¥å£è¢«åˆ†é…ç»™COREæ—¶ï¼Œå®ƒå¯èƒ½æ— æ³•ç”¨äºå…¶ä»–ä»»ä½•äº‹æƒ…ã€‚å¦ä¸€ä¸ªéœ€è¦è€ƒè™‘çš„é—®é¢˜æ˜¯ï¼Œæ‚¨æ‰€è¿æ¥çš„è®¡ç®—æœºæˆ–ç½‘ç»œå¿…é¡»ä¸è¿è¡ŒCOREä»¿çœŸçš„æœºå™¨ä½äºåŒä¸€å±€åŸŸç½‘ã€‚\nå•å‡»â€œé“¾è·¯å±‚èŠ‚ç‚¹â€å·¥å…·æ ä¸Šï¼Œåœ¨å­èœå•ä¸­é€‰æ‹©â€œRJ45â€ã€‚å•å‡»è¦è¿æ¥åˆ°çš„èŠ‚ç‚¹é™„è¿‘çš„ç”»å¸ƒï¼Œä¾‹å¦‚è·¯ç”±å™¨ã€é›†çº¿å™¨ã€äº¤æ¢æœºæˆ–WLANã€‚ç°åœ¨ç‚¹å‡»é“¾æ¥å·¥å…·ï¼Œåœ¨RJ-45å’Œå¦ä¸€ä¸ªèŠ‚ç‚¹ä¹‹é—´åšä¸€æ¡é“¾æ¥ã€‚è¯¥RJ45èŠ‚ç‚¹å°†æ˜¾ç¤ºâ€œUNASSIGNEDâ€ã€‚åŒå‡»RJ45èŠ‚ç‚¹ï¼Œåˆ†é…ç‰©ç†æ¥å£ã€‚å°†æ˜¾ç¤ºå¯ç”¨æ¥å£åˆ—è¡¨ï¼Œå¯ä»¥åŒå‡»åˆ—è¡¨ä¸­çš„æ¥å£åç§°è¿›è¡Œé€‰æ‹©ï¼Œä¹Ÿå¯ä»¥åœ¨æ–‡æœ¬æ¡†ä¸­è¾“å…¥æ¥å£åç§°ã€‚\næ³¨æ„:å½“ä½ æŒ‰ä¸‹StartæŒ‰é’®å®ä¾‹åŒ–ä½ çš„æ‹“æ‰‘æ—¶ï¼Œåˆ†é…ç»™RJ45çš„æ¥å£å°†è¿æ¥åˆ°COREæ‹“æ‰‘ã€‚ç³»ç»Ÿæ— æ³•å†ä½¿ç”¨è¯¥æ¥å£ã€‚\nå¦‚æœä½¿ç”¨802.1x VLANï¼Œå¯ä»¥åœ¨COREå†…éƒ¨ä½¿ç”¨å¤šä¸ªRJ45èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶åˆ†é…åˆ°åŒä¸€ä¸ªç‰©ç†æ¥å£ã€‚è¿™å…è®¸RJ45èŠ‚ç‚¹æ¯”ç‰©ç†ç½‘å£æ›´å¤šã€‚ ä½†(ä¾‹å¦‚äº¤æ¢æœº)ç¡¬ä»¶è¿æ¥åˆ°ç‰©ç†ç«¯å£å¿…é¡»æ”¯æŒVLANæ ‡ç­¾ï¼Œå¯ç”¨çš„å¸¦å®½å°†è¢«å…±äº«ã€‚\næ‚¨éœ€è¦åœ¨Linuxä¸»æœºä¸Šåˆ›å»ºå•ç‹¬çš„VLANè™šæ‹Ÿè®¾å¤‡ï¼Œç„¶åå°†è¿™äº›è®¾å¤‡åˆ†é…ç»™COREå†…éƒ¨çš„RJ45èŠ‚ç‚¹ã€‚ VLANningå®é™…ä¸Šæ˜¯åœ¨COREå¤–éƒ¨æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å½“COREæ¨¡æ‹ŸèŠ‚ç‚¹æ”¶åˆ°ä¼ è¾“ç»™Vlançš„æ•°æ®åŒ…æ—¶ï¼Œä¼šè‡ªåŠ¨å°†VLAN tagç§»é™¤ã€‚VLANåŸºæœ¬çŸ¥è¯†\nä»¥ä¸‹æ˜¯åœ¨Linuxä¸‹åˆ›å»ºVLANè®¾å¤‡çš„å‘½ä»¤ç¤ºä¾‹:\nip link add link PHYS_DEV name.1 type vlan id 1 ip link add link PHYS_DEV name.2 type vlan id 2 ip link add link PHYS_DEV name.3 type vlan id 3 éš§é“å·¥å…· éš§é“å·¥å…·åœ¨COREä»¿çœŸæˆ–å…¶ä»–ä¸»æœºä¹‹é—´æ„å»ºGREéš§é“ã€‚ å½“ç‰©ç†æ¥å£çš„æ•°é‡æœ‰é™æˆ–å¯¹ç­‰ä½“ä½äºä¸åŒçš„ç½‘ç»œæ—¶ï¼Œéš§é“æŠ€æœ¯ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚ ç‰©ç†æ¥å£ä¹Ÿä¸éœ€è¦åƒRJ45å·¥å…·é‚£æ ·ä¸“ç”¨äºCOREã€‚\nå¯¹ç«¯GREéš§é“ç«¯ç‚¹å¯èƒ½æ˜¯å¦ä¸€å°æ”¯æŒGREéš§é“çš„COREæœºå™¨æˆ–å¦ä¸€å°ä¸»æœºã€‚ å½“æ”¾ç½®ä¸€ä¸ªTunneléš§é“èŠ‚ç‚¹æ—¶ï¼Œè¯¥èŠ‚ç‚¹æœ€åˆå°†æ˜¾ç¤ºâ€œUNASSIGNEDâ€ã€‚ æ­¤å¤„éœ€è¦æ›¿æ¢ä¸ºéš§é“å¯¹æ¥å¤„çš„IPåœ°å€ã€‚è¿™æ˜¯å¦ä¸€ä¸ªCOREæœºå™¨æˆ–ç‰©ç†æœºå™¨çš„IPåœ°å€ï¼Œè€Œä¸æ˜¯å¦ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹çš„IPåœ°å€ã€‚\næ³¨æ„ GREè®¾å¤‡å¯èƒ½å­˜åœ¨çš„MTU(æœ€å¤§ä¼ è¾“å•å…ƒ)é—®é¢˜ã€‚gre tapè®¾å¤‡æ¥å£MTUä¸º1458å­—èŠ‚,å½“è¿æ¥åˆ°Linuxç½‘æ¡¥æ—¶ï¼Œç½‘æ¡¥çš„MTUä¹Ÿå˜æˆ1458å­—èŠ‚ã€‚å¦‚æœå…¶ä»–ç½‘æ¡¥ç«¯å£å…·æœ‰æ›´é«˜çš„MTU(æ¯”å¦‚1500å­—èŠ‚)ï¼Œé‚£ä¸ªLinuxç½‘æ¡¥å°†ä¸ä¼šå¯¹è¯¥å¤§æ•°æ®åŒ…æ‰§è¡Œåˆ†ç‰‡ã€‚\nGREå¯†é’¥ç”¨äºè¯†åˆ«ä½¿ç”¨GREéš§é“çš„æµã€‚è¿™ä½¿å¾—å¤šä¸ªGREéš§é“å­˜åœ¨äºåŒä¸€å¯¹éš§é“å¯¹ç­‰ä½“ä¹‹é—´ã€‚ å½“å¤šä¸ªéš§é“ä¸åŒä¸€ä¸ªå¯¹ç­‰ä½“ä½¿ç”¨æ—¶ï¼Œåº”ä½¿ç”¨ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ã€‚ å½“é…ç½®éš§é“å¯¹ç«¯æ—¶ï¼Œç¡®ä¿åŒ¹é…çš„å¯†é’¥ä¸ºä½¿ç”¨ã€‚\nä¸‹é¢æ˜¯åœ¨Linuxä¸Šæ„å»ºéš§é“å¦ä¸€ç«¯çš„ç¤ºä¾‹å‘½ä»¤ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒCOREä¸­çš„è·¯ç”±å™¨æ‹¥æœ‰è™šæ‹Ÿåœ°å€ 10.0.0.20/24 ï¼ŒCoreä¸»æœºï¼ˆè®¾ä¸ºuser1ï¼‰çš„çœŸå®åœ°å€ä¸º192.168.163.130/24ã€‚ å°†ä¸COREæœºå™¨è¿æ¥çš„Linuxæœºå™¨ï¼ˆè®¾ä¸ºuser2ï¼‰å¯ä»¥é€šè¿‡çœŸå®çš„ç½‘ç»œåœ¨192.168.163.133/24å¤„è®¿é—®ã€‚\nä»¿çœŸè·¯ç”±å™¨ä¸TunnelèŠ‚ç‚¹ç›¸è¿ã€‚åœ¨éš§é“èŠ‚ç‚¹é…ç½®å¯¹è¯æ¡†ä¸­ï¼Œè¾“å…¥åœ°å€192.168.163.133ï¼Œå¯†é’¥ä¸º1ã€‚\n# è¿™äº›å‘½ä»¤åœ¨åŒ¹é…tunnelçš„ç”¨æˆ·user2ä¸Šæ‰§è¡Œ sudo ip link add gt0 type gretap remote 192.168.163.130 local 192.168.163.133 key 1 # Linuxæœºå™¨ä¸Šçš„gretapæ¥å£å°†ä»è™šæ‹Ÿè·¯ç”±å™¨èŠ‚ç‚¹çš„å­ç½‘ä¸­åˆ†é…ä¸€ä¸ªåœ°å€10.0.0.22/24ã€‚ sudo ip addr add 10.0.0.22/24 dev gt0 sudo ip link set dev gt0 up ç°åœ¨è™šæ‹Ÿè·¯ç”±å™¨åº”è¯¥å¯ä»¥pingé€šLinuxæœºå™¨User2äº†:\n# from the CORE router node ping 10.0.0.22 # å¦‚æœæƒ³è¦ç›´æ¥pingç‰©ç†åœ°å€åŠ æ¡è·¯ç”±å³å¯ ip route add 192.168.163.133 via 10.0.0.22 User2åº”è¯¥èƒ½å¤Ÿpingé€šå†…æ ¸ä»¿çœŸå†…éƒ¨:\n# from the tunnel peer ping 10.0.0.20 è¦è°ƒè¯•æ­¤é…ç½®ï¼Œtcpdumpå¯ä»¥åœ¨gretapè®¾å¤‡ä¸Šè¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨COREæˆ–Linuxæœºå™¨çš„ç‰©ç†æ¥å£ä¸Šè¿è¡Œã€‚ ç¡®ä¿é˜²ç«å¢™æ²¡æœ‰é˜»æ–­GREæµé‡ã€‚\nä¸ä¸»æœºé€šä¿¡ èŠ‚ç‚¹ä¸ä¸€å®šè¦å¯ä»¥è®¿é—®åˆ°è¿è¡Œcore-guiæˆ–core-daemonçš„ä¸»æœºã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ªX11åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ç‰¹å®šçš„é€šä¿¡æ–¹å¼è®©åº”ç”¨ç¨‹åºè¿æ¥åˆ°XæœåŠ¡å™¨ä»¥è¿›è¡Œå›¾å½¢åŒ–æ˜¾ç¤ºã€‚æœ‰å‡ ç§ä¸åŒçš„æ–¹å¼å¯ä»¥ä»èŠ‚ç‚¹è¿æ¥åˆ°ä¸»æœºï¼Œåä¹‹äº¦ç„¶ã€‚\næ§åˆ¶ç½‘ç»œ é€šè¿‡æ§åˆ¶ç½‘ç»œæ˜¯ä¸ä¸»æœºè¿æ¥çš„æœ€å¿«æ–¹å¼ã€‚ é€šè¿‡æ§åˆ¶ç½‘ç»œï¼Œä¸»æœºå¯ä»¥åœ¨èŠ‚ç‚¹ä¸Šå¯åŠ¨X11åº”ç”¨ç¨‹åºã€‚é¦–å…ˆè¦åœ¨è¯¥èŠ‚ç‚¹ä¸Šå¯ç”¨SSHæœåŠ¡ï¼Œå¹¶ä¸”ä½¿ç”¨SSHæ¥è¿›è¡Œä»ä¸»æœºåˆ°è¯¥èŠ‚ç‚¹çš„X11æœåŠ¡è½¬å‘ã€‚\nSSHåŸç†ä¸è¿ç”¨ï¼ˆä¸€ï¼‰ï¼šè¿œç¨‹ç™»å½• SSHåŸç†ä¸è¿ç”¨ï¼ˆäºŒï¼‰ï¼šè¿œç¨‹æ“ä½œä¸ç«¯å£è½¬å‘\n# èŠ‚ç‚¹n5ä½¿ç”¨sshæ¥è½¬å‘ä¸»æœºè¿è¡Œxåè®®æ ‡å‡†çš„æ—¶é’Ÿxclockç¨‹åºç•Œé¢ ssh -X 172.16.0.5 xclock æ³¨æ„ï¼Œå¯ä»¥ä½¿ç”¨coresendmsgå°†æ¶ˆæ¯å‘é€åˆ°ä¸»æœºä¸Šè¿è¡Œçš„COREå®ˆæŠ¤è¿›ç¨‹ä¸è¿è¡Œçš„ä»¿çœŸäº¤äº’ (éœ€è¦ /etc/core/core.conf çš„é…ç½®æ–‡ä»¶ä¸­è®¾å®šç›‘å¬åœ°å€ä¸ºå¹¿æ’­å³ listenaddr = 0.0.0.0 ) ä¾‹å¦‚ï¼Œä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥é€šè¿‡ä¸Šè¿°æ–¹æ³•ç§»åŠ¨è‡ªå·±æˆ–å…¶ä»–èŠ‚ç‚¹ï¼Œæˆ–è€…æ ¹æ®æŸä¸ªèŠ‚ç‚¹çš„çŠ¶æ€æ›´æ”¹å…¶å›¾æ ‡ã€‚\nå…¶ä»–æ–¹æ³• è¿˜æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥å°†ä¸»æœºä¸èŠ‚ç‚¹è¿æ¥èµ·æ¥ã€‚RJ-45å·¥å…·å¯ä»¥é…åˆè™šæ‹Ÿæ¥å£è®¿é—®èŠ‚ç‚¹:\n# æˆ–è€…ä½¿ç”¨modprobeå‘½ä»¤åˆ›å»ºdummyè®¾å¤‡ sudo modprobe dummy numdummies=1 # ä½†æ˜¯ä½¿ç”¨ip link showæ— æ³•æŸ¥çœ‹åˆ°ï¼Œä¸çŸ¥æ˜¯å¦å¤±æ•ˆï¼Œ # æ¨èä½¿ç”¨ipå‘½ä»¤åˆ›å»º sudo ip link add dummy0 type dummy # ä½¿ç”¨æ–¹æ³• ip link del dev \u0026lt;dummy-interface\u0026gt; ip link add dev \u0026lt;dummy-interface\u0026gt; type dummy ip addr add \u0026lt;IPv4\u0026gt;/32 dev \u0026lt;dummy-interface\u0026gt; ip link set \u0026lt;dummy-interface\u0026gt; up ä¸»æœºä¸Šåº”è¯¥å‡ºç°ä¸€ä¸ª dummy0 æ¥å£ã€‚ä½¿ç”¨RJ45å·¥å…·åˆ†é…ç»™dummy0ï¼Œå¹¶å°†å…¶é“¾æ¥åˆ°æ‚¨çš„åœºæ™¯ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ã€‚(ç›¸å½“äºcoreä»¿çœŸåä¼šå»ºç«‹ä¸€ä¸ªç½‘æ¡¥ï¼Œä¸Šè¿°dummy0è®¾å¤‡ä¼šattachåˆ°è¯¥ç½‘æ¡¥)ä¼šè¯å¯åŠ¨åï¼Œéœ€è¦åœ¨ä¸»æœºä¸Šé…ç½®åœ°å€ã€‚\nip link show type bridge # æ ¹æ®ä¸Šè¿°å‘½ä»¤ç¡®å®šcoreä»¿çœŸçš„ç½‘æ¡¥åç§° # åœ¨ä¸é“¾æ¥èŠ‚ç‚¹ç›¸åŒçš„ç½‘ç»œä¸Šåˆ†é…ä¸€ä¸ªIPåœ°å€ sudo ip addr add 10.0.1.2/24 dev è¯¥è®¾å¤‡å åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¸»æœºå°†æœ‰åœ°å€10.0.1.2ï¼Œè€Œè¿æ¥åˆ°RJ45çš„èŠ‚ç‚¹å¯èƒ½æœ‰åœ°å€10.0.1.1ã€‚\næ„å»ºæ ·æœ¬ç½‘ç»œ æœ‰çº¿ç½‘ç»œ æœ‰çº¿ç½‘ç»œæ˜¯ä½¿ç”¨é“¾æ¥å·¥å…·åˆ›å»ºçš„ï¼Œä»¥ç»˜åˆ¶ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„é“¾æ¥ã€‚è¿™å°†è‡ªåŠ¨ç»˜åˆ¶ä¸€æ¡ä»£è¡¨ä»¥å¤ªç½‘é“¾è·¯çš„çº¢çº¿ï¼Œå¹¶åœ¨ç½‘ç»œå±‚èŠ‚ç‚¹ä¸Šåˆ›å»ºæ–°çš„æ¥å£ã€‚\nåŒå‡»é“¾æ¥ä»¥è°ƒç”¨é“¾æ¥é…ç½®å¯¹è¯æ¡†ã€‚åœ¨è¿™é‡Œæ‚¨å¯ä»¥æ›´æ”¹è¯¥é“¾è·¯çš„å¸¦å®½ã€å»¶è¿Ÿã€ä¸¢å¤±å’Œé‡å¤é€Ÿç‡å‚æ•°ã€‚æ‚¨è¿˜å¯ä»¥ä¿®æ”¹é“¾æ¥çš„é¢œè‰²å’Œå®½åº¦ï¼Œä»è€Œå½±å“å…¶æ˜¾ç¤ºã€‚\né“¾è·¯å±‚èŠ‚ç‚¹ç”¨äºå¯¹æœ‰çº¿ç½‘ç»œè¿›è¡Œå»ºæ¨¡ã€‚è¿™äº›ä¸ä¼šäº§ç”Ÿ ä¸€ä¸ªå•ç‹¬çš„ç½‘ç»œå †æ ˆï¼Œè€Œæ˜¯ä½¿ç”¨Linuxç½‘æ¡¥å®ç°ã€‚ è¿™äº›æ˜¯é›†çº¿å™¨ã€äº¤æ¢æœºå’Œæ— çº¿å±€åŸŸç½‘èŠ‚ç‚¹ã€‚é›†çº¿å™¨ä» æ¯ä¸ªè¿æ¥çš„é“¾è·¯çš„ä¼ å…¥é“¾è·¯ï¼Œè€Œäº¤æ¢æœºçš„è¡Œä¸ºæ›´åƒæ˜¯ ä»¥å¤ªç½‘äº¤æ¢æœºï¼Œå¹¶è·Ÿè¸ªè¿æ¥çš„å¯¹ç­‰ä½“çš„ä»¥å¤ªç½‘åœ°å€ï¼Œ åªè½¬å‘å•æ’­æµé‡åˆ°é€‚å½“çš„ç«¯å£ã€‚\næ— çº¿ç½‘ç»œ WLANèŠ‚ç‚¹å…è®¸æ‚¨æ„å»ºæ— çº¿ç½‘ç»œï¼Œç§»åŠ¨èŠ‚ç‚¹ä¼šå½±å“å®ƒä»¬ä¹‹é—´çš„è¿æ¥ã€‚ä¸€å¯¹èŠ‚ç‚¹ä¹‹é—´è¶Šç´§å¯†ï¼Œè¿æ¥è¶Šå¼º;èŠ‚ç‚¹ä¹‹é—´è¶Šè¿œè¿æ¥è¶Šå¼±ã€‚æ— çº¿å±€åŸŸç½‘(WLAN)èŠ‚ç‚¹ä»¥å°äº‘çš„å½¢å¼å‡ºç°ã€‚æ ¹æ®æ‚¨çš„å»ºæ¨¡éœ€æ±‚ï¼ŒWLANæä¾›äº†å¤šä¸ªçº§åˆ«çš„æ— çº¿ä»¿çœŸä¿çœŸåº¦ã€‚\nWLANå·¥å…·å¯ä»¥é€šè¿‡æ’ä»¶è¿›è¡Œæ‰©å±•ï¼Œä»¥å®ç°ä¸åŒçº§åˆ«çš„æ— çº¿ä¿çœŸåº¦ã€‚åŸºæœ¬çš„å¼€/å…³èŒƒå›´æ˜¯æ‰€æœ‰å¹³å°ä¸Šå¯ç”¨çš„é»˜è®¤è®¾ç½®ã€‚å…¶ä»–æ’ä»¶ä»¥æ›´é«˜çš„å¤æ‚æ€§å’ŒCPUä½¿ç”¨é‡ä¸ºä»£ä»·æä¾›æ›´é«˜çš„ä¿çœŸåº¦ã€‚æŸäº›æ’ä»¶çš„å¯ç”¨æ€§å› å¹³å°è€Œå¼‚ã€‚å…³äºæ— çº¿æ¨¡å‹ç±»å‹çš„ç®€è¦æ¦‚è¿°ï¼Œè¯·å‚è§ä¸‹è¡¨ã€‚\næ¨¡å‹ ç±»å‹ æ”¯æŒå¹³å° ä¿çœŸåº¦ æè¿° basic on/off Linux Low ä½¿ç”¨ebtablesçš„ä»¥å¤ªç½‘æ¡¥æ¥ EMANE Plug-in Linux High TAPè®¾å¤‡è¿æ¥åˆ°EMANEæ¨¡æ‹Ÿå™¨çš„å¯æ’æ‹”çš„MACå’ŒPHYæ— çº¿å°„é¢‘æ¨¡å‹ è¦å¿«é€Ÿæ„å»ºæ— çº¿ç½‘ç»œï¼Œæ‚¨å¯ä»¥é¦–å…ˆå°†å¤šä¸ªè·¯ç”±å™¨èŠ‚ç‚¹æ”¾ç½®åœ¨ç”»å¸ƒä¸Šã€‚å¦‚æœæ‚¨å®‰è£…äº† Quagga MDR è½¯ä»¶ï¼Œå»ºè®®æ‚¨ä½¿ç”¨mdrèŠ‚ç‚¹ç±»å‹æ¥å‡å°‘å¼€é”€è·¯ç”±ã€‚æ¥ä¸‹æ¥ä»é“¾æ¥å±‚èŠ‚ç‚¹å­èœå•é€‰æ‹©æ— çº¿å±€åŸŸç½‘ã€‚é¦–å…ˆé€šè¿‡åŒå‡»äº‘å›¾æ ‡è®¾ç½®æ‰€éœ€çš„ WLAN å‚æ•°ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡å³é”®å•å‡» WLAN å¹¶é€‰æ‹©é“¾æ¥åˆ°æ‰€æœ‰è·¯ç”±å™¨æ¥é“¾æ¥æ‰€æœ‰è·¯ç”±å™¨ã€‚\nå°†è·¯ç”±å™¨è¿æ¥åˆ° WLAN ä¼šå¯¼è‡´å‡ºç°å°å¤©çº¿ï¼Œä½†ä¸ä¼šç»˜åˆ¶çº¢è‰²é“¾æ¥çº¿ã€‚è·¯ç”±å™¨å¯ä»¥å…·æœ‰å¤šä¸ªæ— çº¿é“¾æ¥ä»¥åŠæ— çº¿å’Œæœ‰çº¿é“¾æ¥ï¼ˆä½†æ˜¯æ‚¨éœ€è¦é‡æ–°æ‰‹åŠ¨è®¾ç½®è·¯ç”±ã€‚mdr èŠ‚ç‚¹ç±»å‹å°†ç”Ÿæˆè·¯ç”±é…ç½®ï¼Œä½¿ OSPFv3 å…·æœ‰ MANET æ‰©å±•ã€‚è¿™æ˜¯æ³¢éŸ³å…¬å¸å¼€å‘çš„å¯¹QuaggaOSPFv3çš„æ‰©å±•ï¼Œå¯å‡å°‘æ´ªæ³›è´¹ç”¨ï¼Œå¹¶ä¼˜åŒ–ç§»åŠ¨ä¸´æ—¶ï¼ˆMANETï¼‰ç§»åŠ¨è‡ªç»„ç½‘ç»œçš„æ´ªæ³›è¿‡ç¨‹ã€‚\nWLAN çš„é»˜è®¤é…ç½®è®¾ç½®ä¸ºä½¿ç”¨åŸºæœ¬basicæ¨¡å‹ï¼Œä½¿ç”¨ WLAN é…ç½®å¯¹è¯æ¡†ä¸­çš„åŸºæœ¬é€‰é¡¹å¡ã€‚é€‰æ‹©æ­¤æ¨¡å‹ä¼šå¯¼è‡´core-daemonåŸºäºå±å¹•åƒç´ ä½ç½®æ¥è®¡ç®—èŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚ä½¿ç”¨ èŒƒå›´æ»‘å—ï¼ˆRange sliderï¼‰ ä¸ºæ— çº¿ç½‘ç»œè®¾ç½®å±å¹•åƒç´ çš„æ•°å­—èŒƒå›´ã€‚å½“ä¸¤ä¸ªæ— çº¿èŠ‚ç‚¹åœ¨å®ƒä»¬ä¹‹é—´ç”»äº†ä¸€æ¡ç»¿çº¿ï¼Œå®ƒä»¬æ˜¯ç›¸è¿çš„ã€‚ä¸¤ä¸ªè·ç¦»è¶…è¿‡åƒç´ è·ç¦»çš„æ— çº¿èŠ‚ç‚¹ä¸è¢«è¿æ¥ã€‚åœ¨æ‰§è¡Œæ¨¡å¼ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å•å‡»å’Œç§»åŠ¨æ— çº¿èŠ‚ç‚¹æ‹–åŠ¨å®ƒä»¬ï¼Œæ— çº¿é“¾æ¥å°±ä¼šè¢«åŠ¨æ€åˆ›å»ºæˆ–æ–­å¼€ã€‚\nEMANE é€‰é¡¹å¡åˆ—å‡ºäº†å¯ç”¨äºæ— çº¿ç½‘ç»œçš„å¯ç”¨ EMANE æ¨¡å‹ã€‚æœ‰å…³ä½¿ç”¨ EMANE çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Emaneã€‚\nç§»åŠ¨æ€§è„šæœ¬ COREä¸‹è¿°æ–¹æ³•æ¥è®¾ç½®è„šæœ¬ç§»åŠ¨æ€§ã€‚\né€‰é¡¹ æè¿° ns-2 script è¯¥è„šæœ¬æŒ‡å®šäº†ç»å¯¹ä½ç½®æˆ–å…·æœ‰é€Ÿåº¦çš„è·¯å¾„ç‚¹ã€‚ä½ç½®ç”¨ç¬›å¡å°”åæ ‡ç»™å‡ºã€‚ CORE API å¤–éƒ¨å®ä½“å¯ä»¥é€šè¿‡å‘é€å¸¦æœ‰æ›´æ–°çš„X,Yåæ ‡çš„CORE API Nodeæ¶ˆæ¯æ¥ç§»åŠ¨èŠ‚ç‚¹;coresendmsgå®ç”¨ç¨‹åºå…è®¸shellè„šæœ¬ç”Ÿæˆè¿™äº›æ¶ˆæ¯ã€‚ EMANE events æœ‰å…³ä½¿ç”¨EMANEè„šæœ¬ç§»åŠ¨èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§[EMANE .md]ã€‚ä½ç½®ä¿¡æ¯é€šå¸¸ä»¥çº¬åº¦ã€ç»åº¦å’Œé«˜åº¦ç»™å‡ºã€‚ å¯¹äºç¬¬ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æˆ–BonnMotionä¹‹ç±»çš„å·¥å…·åˆ›å»ºç§»åŠ¨è„šæœ¬ï¼Œå¹¶å°†è„šæœ¬ä¸ä½¿ç”¨WLANé…ç½®å¯¹è¯æ¡†ä¸­çš„ä¸€ä¸ªæ— çº¿è¿æ¥èµ·æ¥ï¼Œç‚¹å‡» ns-2 mobility script\u0026hellip; æŒ‰é’®, å¹¶åœ¨ ns2script ä¸­çš„é…ç½®å¯¹è¯æ¡†è®¾ç½® mobility script file å­—æ®µ\nBonnMotionå®‰è£…æ•™ç¨‹ï¼šå®˜ç½‘ä¸‹è½½ BonnMotion å®‰è£…åŒ…ï¼Œè§£å‹ï¼Œè¿›å…¥ç›®å½•è¿è¡Œ./installå³å¯(éœ€è¦äº‹å…ˆå®‰è£…jdkï¼Œsudo apt-get install default-jdk)ã€‚å®˜æ–¹ä½¿ç”¨æŒ‡å—ç‚¹è¿™é‡Œè¿›è¡Œä¸‹è½½ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä¸º10ä¸ªèŠ‚ç‚¹åˆ›å»ºBonnMotionè„šæœ¬çš„ç¤ºä¾‹:\nbm -f sample RandomWaypoint -n 10 -d 60 -x 1000 -y 750 bm NSFile -f sample # ç¬¬äºŒè¡Œæ˜¯å°†sample.movementsè½¬ä¸ºsample.ns_movements nsè„šæœ¬ç§»åŠ¨æ•°æ® # è‡ªå·±æµ‹è¯•å‘ç° /usr/bin/ä¸­å¹¶æ²¡æœ‰ bmï¼Œæ‰§è¡Œæ–‡ä»¶åœ¨å®‰è£…åŒ…æ–‡ä»¶å¤¹ä¸‹ ./bin/bm # åˆ›å»ºä¸ªè½¯é“¾æ¥ sudo ln -s ~/æ¡Œé¢/bonnmotion-3.0.1/bin/bm /usr/bin åœ¨å¯åŠ¨Executeæ¨¡å¼å¹¶ä¸”å…¶ä¸­ä¸€ä¸ªWLANèŠ‚ç‚¹å…·æœ‰ç§»åŠ¨æ€§æ—¶ è„šæœ¬æ—¶ï¼Œå°†å‡ºç°ä¸€ä¸ªç§»åŠ¨è„šæœ¬çª—å£ã€‚æ­¤çª—å£åŒ…å«æ§ä»¶ å¯åŠ¨ã€åœæ­¢å’Œé‡ç½®ç§»åŠ¨æ€§è„šæœ¬çš„è¿è¡Œæ—¶é—´ï¼Œloop å¤é€‰æ¡†è®¾ç½®è„šæœ¬è¿ç»­é‡å¤è°ƒç”¨ã€‚åˆ†è¾¨ç‡resolution æ–‡æœ¬æ¡†åŒ…å«æ¯ä¸ªè®¡æ—¶å™¨äº‹ä»¶ä¹‹é—´çš„æ¯«ç§’æ•°;è¾ƒä½çš„å€¼ä½¿ç§»åŠ¨æ€§çœ‹èµ·æ¥æ›´æµç•…ï¼Œä½†æ¶ˆè€—æ›´å¤šçš„CPUæ—¶é—´ã€‚\nns-2ç§»åŠ¨è„šæœ¬çš„æ ¼å¼å¦‚ä¸‹:\n# nodes: 3, max time: 35.000000, max x: 600.00, max y: 600.00 $node_(2) set X_ 144.0 $node_(2) set Y_ 240.0 $node_(2) set Z_ 0.00 $ns_ at 1.00 \u0026quot;$node_(2) setdest 130.0 280.0 15.0\u0026quot; å‰ä¸‰è¡Œè®¾ç½®èŠ‚ç‚¹2çš„åˆå§‹ä½ç½®ã€‚ä¸Šé¢ä¾‹å­ä¸­çš„æœ€åä¸€è¡Œå¯¼è‡´èŠ‚ç‚¹2ä»¥é€Ÿåº¦ 15 å‘ç›®çš„åœ° (130,280) ç§»åŠ¨ã€‚æ‰€æœ‰å•ä½éƒ½æ˜¯å±å¹•åæ ‡ï¼Œé€Ÿåº¦ä»¥æ¯ç§’ä¸ºå•ä½ã€‚æ€»è„šæœ¬æ—¶é—´æ˜¯åœ¨æ‰€æœ‰èŠ‚ç‚¹åˆ°è¾¾å®ƒä»¬çš„è·¯å¾„ç‚¹ä¹‹åå¾—åˆ°çš„ã€‚ æœ€åˆï¼Œç§»åŠ¨è„šæœ¬å¯¹è¯æ¡†ä¸­çš„æ—¶é—´æ»‘å—å¹¶ä¸å‡†ç¡®ã€‚\nç¤ºä¾‹ç§»åŠ¨è„šæœ¬(åŠå…¶ç›¸å…³çš„æ‹“æ‰‘æ–‡ä»¶)å¯ä»¥åœ¨ configs/ ç›®å½•ä¸­æ‰¾åˆ°ã€‚\nå¤šç”»å¸ƒ CORE æ”¯æŒå¤šä¸ªç”»å¸ƒï¼Œç”¨äºç»„ç»‡æ¨¡æ‹ŸèŠ‚ç‚¹ã€‚åœ¨ä¸åŒçš„ç”»å¸ƒä¸Šè¿è¡Œçš„èŠ‚ç‚¹å¯ä»¥é“¾æ¥åœ¨ä¸€èµ·ã€‚è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ç”»å¸ƒï¼Œä» canvas èœå•ä¸­é€‰æ‹© new ã€‚ä¸€ä¸ªæ–°çš„ç”»å¸ƒæ ‡ç­¾å‡ºç°åœ¨å·¦ä¸‹è§’ã€‚ç‚¹å‡»ä¸€ä¸ªç”»å¸ƒæ ‡ç­¾åˆ‡æ¢åˆ°å®ƒç”»å¸ƒã€‚åŒå‡»å…¶ä¸­ä¸€ä¸ªé€‰é¡¹å¡æ¥è°ƒç”¨ Manage Canvases å¯¹è¯æ¡†ç›’å­ã€‚åœ¨è¿™é‡Œï¼Œç”»å¸ƒå¯ä»¥é‡å‘½åå’Œé‡æ–°æ’åºï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ‡æ¢åˆ°å¹¶é€‰æ‹©å…¶ä¸­ä¸€å¹…ç”»å¸ƒã€‚\næ¯ä¸ªç”»å¸ƒç»´æŠ¤è‡ªå·±çš„ä¸€ç»„èŠ‚ç‚¹å’Œæ³¨é‡Šã€‚ç”»å¸ƒä¹‹é—´è¦æ„å»ºè”ç³»é¦–å…ˆé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå³é”®å•å‡»å®ƒï¼Œé€‰æ‹© Create link to ï¼Œé€‰æ‹©åˆ—è¡¨ä¸­çš„ç›®æ ‡ç”»å¸ƒï¼Œä»¥åŠè¯¥å­èœå•ä¸­çš„æ‰€éœ€èŠ‚ç‚¹ã€‚ä¹‹åå°†ç»˜åˆ¶ä¸€ä¸ªä¼ªé“¾æ¥ï¼Œè¡¨ç¤ºä¸Šä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„é“¾æ¥åˆ°ä¸åŒçš„ç”»å¸ƒã€‚åŒå‡»ç®­å¤´æœ«ç«¯çš„æ ‡ç­¾å³å¯è·³è½¬åˆ°å®ƒæ‰€é“¾æ¥çš„ç”»å¸ƒã€‚\næ£€æŸ¥ä»¿çœŸç¯ï¼ˆCELï¼‰ CELï¼ˆCheck Emulation Lightï¼‰ä½äºGUIçš„å³ä¸‹è§’ï¼Œè¿™æ˜¯ä¸€ä¸ªé»„è‰²å›¾æ ‡ï¼ŒæŒ‡ç¤ºè¿è¡Œæ¨¡æ‹Ÿä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªé—®é¢˜ã€‚å•å‡»CELå°†è°ƒç”¨CEL å¯¹è¯æ¡†ã€‚Check Emulation Lightå¯¹è¯æ¡†åŒ…å«ä»COREå®ˆæŠ¤è¿›ç¨‹æ¥æ”¶åˆ°çš„å¼‚å¸¸åˆ—è¡¨ã€‚å¼‚å¸¸åˆ—è¡¨åŒ…å«æœ‰æ—¶é—´ã€ä¸¥é‡çº§åˆ«ã€å¯é€‰èŠ‚ç‚¹å·å’Œæ¥æºè¿™äº›ä¿¡æ¯ã€‚å½“CELé—ªçƒæ—¶ï¼Œè¿™è¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªè‡´å‘½å¼‚å¸¸ã€‚\nå…·æœ‰è‡´å‘½ä¸¥é‡çº§åˆ«çš„å¼‚å¸¸è¡¨æ˜æ— æ³•åˆ›å»ºæ¨¡æ‹Ÿçš„ä¸€ä¸ªæˆ–å¤šä¸ªåŸºæœ¬éƒ¨åˆ†ï¼Œä¾‹å¦‚æ— æ³•åˆ›å»ºæ¡¥æˆ–åç§°ç©ºé—´ï¼Œæˆ–è€…æ— æ³•ä¸ºåŸºäºeman1çš„ç½‘ç»œå¯åŠ¨eman1è¿›ç¨‹ã€‚å•å‡»å¼‚å¸¸å°†æ˜¾ç¤ºè¯¥å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ã€‚å¦‚æœæŒ‡å®šäº†èŠ‚ç‚¹å·ï¼Œå½“é€‰ä¸­å¼‚å¸¸æ—¶ï¼Œè¯¥èŠ‚ç‚¹å°†åœ¨ç”»å¸ƒä¸Šé«˜äº®æ˜¾ç¤ºã€‚å¼‚å¸¸æºæ˜¯ä¸€ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²ï¼Œç”¨äºå¸®åŠ©è·Ÿè¸ªå¼‚å¸¸å‘ç”Ÿçš„ä½ç½®;ä¾‹å¦‚ï¼ŒUserDefinedæœåŠ¡çš„éªŒè¯å‘½ä»¤å¤±è´¥æ—¶ï¼Œä¼šå‡ºç° \u0026ldquo;service:UserDefined\u0026rdquo; ã€‚\nå¯¹è¯æ¡†åº•éƒ¨æœ‰ä¸€äº›æŒ‰é’®ï¼Œç”¨äºæ¸…é™¤å¼‚å¸¸åˆ—è¡¨å’ŒæŸ¥çœ‹COREå®ˆæŠ¤è¿›ç¨‹å’ŒèŠ‚ç‚¹æ—¥å¿—æ–‡ä»¶ã€‚\næ³¨æ„: åœ¨æ‰¹å¤„ç†æ¨¡å¼ä¸‹ï¼Œä»COREå®ˆæŠ¤è¿›ç¨‹æ¥æ”¶åˆ°çš„å¼‚å¸¸å°†æ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸Šã€‚\nåœºæ™¯é…ç½®æ–‡ä»¶ åœºæ™¯é…ç½®æ‹“æ‰‘æ–‡ä»¶ä¿å­˜ä¸º .xml æˆ– .imn ã€‚ä½ å¯ä»¥è½»æ¾åœ°ç¼–è¾‘è¿™äº›æ–‡ä»¶ä¸æ–‡æœ¬ç¼–è¾‘å™¨ã€‚å½“æ‚¨ç¼–è¾‘æ‹“æ‰‘æ—¶æ–‡ä»¶ï¼Œæ‚¨å°†éœ€è¦åœæ­¢æ¨¡æ‹Ÿ(å¦‚æœå®ƒæ­£åœ¨è¿è¡Œ)å¹¶é‡æ–°åŠ è½½æ–‡ä»¶ã€‚\n.imn æ–‡ä»¶æ ¼å¼æ¥è‡ªIMUNESï¼Œä¸»è¦æˆåˆ†æ˜¯ èŠ‚ç‚¹ã€é“¾æ¥ã€etcçš„Tclé“¾è¡¨ã€‚ æ‹“æ‰‘æ–‡ä»¶ä¸­çš„åˆ¶è¡¨ç¬¦Tabå’Œç©ºæ ¼æœ‰ä¸¥æ ¼è§„èŒƒã€‚è¯¥æ–‡ä»¶é¦–å…ˆåˆ—å‡ºæ¯ä¸ªèŠ‚ç‚¹ï¼Œç„¶ååˆ—å‡ºé“¾æ¥ã€æ³¨é‡Šã€ç”»å¸ƒå’Œé€‰é¡¹ã€‚æ¯ä¸ªå®ä½“éƒ½æœ‰ä¸€ä¸ªåŒ…å«åœ¨èŠ±æ‹¬å·ä¸­çš„å—ã€‚ç¬¬ä¸€ä¸ªå—ç¼©è¿›å››ä¸ªç©ºæ ¼ã€‚ åœ¨ network-config å—(ä»¥åŠä»»ä½• custom\u0026ndash;config å—)ä¸­ï¼Œç¼©è¿›æ˜¯ä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚\næ³¨æ„: æœ‰å‡ ä¸ªæ‹“æ‰‘ç¤ºä¾‹åŒ…æ‹¬åœ¨COREä¸­çš„ï¼š ~/.core/configs, å¦‚æœCoreå®‰è£…åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­åˆ™åœ¨ /usr[/local]/share/examples/configs.\næ³¨æ„: å½“ä½¿ç”¨ Imn æ–‡ä»¶æ ¼å¼ï¼Œç‰¹å®šæ–‡ä»¶è·¯å¾„ï¼š CORE_DATA_DIR = /usr/share/core, CONFDIR = ~/.core/configs\næ³¨æ„: æ‚¨å¯ä»¥ä½¿ç”¨æœ€å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨ç›´æ¥ç¼–è¾‘æ–‡ä»¶ã€‚\nå®šåˆ¶æ‚¨çš„æ‹“æ‰‘å¤–è§‚ æä¾›å¤šä¸ªæ³¨é‡Šå·¥å…·æ¥æ”¹å˜æ‚¨çš„æ‹“æ‰‘å‘ˆç°æ–¹å¼ã€‚æ–‡å­—å·¥å…·å¯ä»¥æ·»åŠ å­—å¹•ã€‚æ¤­åœ†å½¢å’ŒçŸ©å½¢å¯èƒ½ç»˜åˆ¶åœ¨åå°ï¼Œæœ‰åŠ©äºåœ¨è§†è§‰ä¸Šå°†èŠ‚ç‚¹åˆ†ç»„åœ¨ä¸€èµ·ã€‚\nåœ¨å®æ—¶æ¼”ç¤ºæœŸé—´ï¼Œæ ‡è®°å·¥å…·å¯èƒ½æœ‰åŠ©äºåœ¨ç”»å¸ƒä¸Šç»˜åˆ¶å¯èƒ½å¾ˆå¿«è¢«æ“¦é™¤çš„ä¸´æ—¶æ³¨é‡Šã€‚é€‰æ‹©æ ‡è®°å·¥å…·æ—¶ï¼Œå·¥å…·æ åº•éƒ¨ä¼šå‡ºç°å¤§å°å’Œè°ƒè‰²æ¿ã€‚æ ‡è®°åªæ˜¯æš‚æ—¶çš„ï¼Œä¸ä¼šä¿å­˜åœ¨æ‹“æ‰‘æ–‡ä»¶ä¸­ã€‚\nåŸºæœ¬èŠ‚ç‚¹å›¾æ ‡å¯ä»¥æ›¿æ¢ä¸ºæ‚¨é€‰æ‹©çš„è‡ªå®šä¹‰å›¾åƒã€‚å›¾æ ‡åœ¨ä½¿ç”¨å…·æœ‰é€æ˜èƒŒæ™¯çš„ GIF æˆ– PNG æ ¼å¼æ—¶æ˜¾ç¤ºå¾—æœ€å¥½ã€‚è¦æ›´æ”¹èŠ‚ç‚¹çš„å›¾æ ‡ï¼Œè¯·åŒå‡»èŠ‚ç‚¹ä»¥è°ƒç”¨å…¶é…ç½®å¯¹è¯æ¡†ï¼Œç„¶åå•å‡»æ˜¾ç¤ºèŠ‚ç‚¹å½“å‰å›¾æ ‡çš„èŠ‚ç‚¹åç§°å³ä¾§çš„æŒ‰é’®ã€‚\nç”»å¸ƒçš„èƒŒæ™¯å›¾åƒå¯ä»¥ä½¿ç”¨ canvas èœå•ä¸­çš„ Wallpaperâ€¦ è®¾ç½®ã€‚å›¾åƒå¯ä»¥å±…ä¸­ã€å¹³é“ºæˆ–ä»¥ä¸­å¿ƒåšç¼©æ”¾æ¥é€‚åº”ç”»å¸ƒå¤§å°ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ç°æœ‰çš„åœ°å½¢ã€åœ°å›¾æˆ–ç½‘ç»œå›¾å¯ä»¥ç”¨ä½œèƒŒæ™¯ï¼Œå¹¶å°†COREèŠ‚ç‚¹ç»˜åˆ¶åœ¨é¡¶éƒ¨ã€‚ã€‚\nåå¥½ Preferences å¯¹è¯æ¡†å¯ä»¥ä» Edit_Menu è®¿é—®ã€‚æ­¤å¯¹è¯å¯ä»¥è®¾ç½®è®¸å¤šé»˜è®¤å€¼ï¼Œè¿™äº›é»˜è®¤å€¼å­˜å‚¨åœ¨ ~/.core/prefs.conf é¦–é€‰é¡¹æ–‡ä»¶ä¸­ã€‚\n","id":33,"section":"posts","summary":"ä½¿ç”¨ CORE GUI ä¸‹å›¾æ˜¾ç¤º CORE GUI: æ¦‚è¿° GUI ç”¨äºåœ¨ç”»å¸ƒä¸Šç»˜åˆ¶èŠ‚ç‚¹å’Œç½‘ç»œè®¾å¤‡ï¼Œå°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·ï¼Œä»¥åˆ›å»ºæ¨¡æ‹Ÿçš„ç½‘ç»œä¼šè¯ã€‚ æŒ‰ä¸‹å¯åŠ¨æŒ‰é’®åï¼ŒCORE å°†é€šè¿‡è¿™äº›é˜¶æ®µè¿›è¡Œ","tags":[""],"title":"Core Gui","uri":"https://liangkang233.github.io/2021/07/gui/","year":"2021"},{"content":"goæŒ‡å—ç»ƒä¹  æ–°æ‰‹åˆå­¦Goè¯­è¨€ï¼Œçœ‹åˆ°è¿™ä¸ªgoæŒ‡å—ç½‘ç«™åœ¨çº¿æµ‹è¯•å¾ˆæ–¹ä¾¿åšäº†å‡ é“ç»ƒä¹ åå°±åœ¨ä¸Šé¢å­¦ä¹ ã€‚ å…¶ä¸­æœ€åä¸€é¡µçš„æµ‹è¯•ï¼š goæŒ‡å—ç»ƒä¹ :webçˆ¬è™« å­¦äº†goçš„å¹¶å‘åŸºæœ¬ä½¿ç”¨æ–¹æ³•åï¼Œè§‰å¾—æ¯”cçš„å¤šçº¿ç¨‹å¥½å†™å¤šäº†ï¼Œæ‰€ä»¥æœ€åçš„æ¨¡æ‹Ÿwebçˆ¬è™«ç»ƒä¹ çš„ä»£ç è´´å‡ºæ¥ï¼Œå¸Œæœ›æŒ‡æ•™ä¸‹æ€ä¹ˆå†™æ›´å®‰å…¨ã€é«˜æ•ˆã€‚\né¢˜ç›®è¦æ±‚ /* ç»ƒä¹ ï¼šWeb çˆ¬è™« åœ¨è¿™ä¸ªç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨ Go çš„å¹¶å‘ç‰¹æ€§æ¥å¹¶è¡ŒåŒ–ä¸€ä¸ª Web çˆ¬è™«ã€‚ ä¿®æ”¹ Crawl å‡½æ•°æ¥å¹¶è¡Œåœ°æŠ“å– URLï¼Œå¹¶ä¸”ä¿è¯ä¸é‡å¤ã€‚ æç¤ºï¼šä½ å¯ä»¥ç”¨ä¸€ä¸ª map æ¥ç¼“å­˜å·²ç»è·å–çš„ URLï¼Œ ä½†æ˜¯è¦æ³¨æ„ map æœ¬èº«å¹¶ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼ */ // TODO: å¹¶è¡Œçš„æŠ“å– URLã€‚ // TODO: ä¸é‡å¤æŠ“å–é¡µé¢ã€‚ // Crawl å¹¶æ²¡æœ‰å®ç°ä¸Šé¢ä¸¤ç§æƒ…å†µï¼š ä¿®æ”¹éƒ¨åˆ† è¯¥ä»£ç å…¶å®æ˜¯å¯¹ä¼ªé€ çš„fakeFetcherè¿›è¡ŒæŠ“å–ï¼Œæ¯ä¸ªä¼ªé€ ç»“æœmapå†…çš„å…ƒç´ æ˜¯ä¸€ä¸ªç»“æ„ä½“fakeResultã€‚ è¯¥ç»“æ„ä½“å…ƒç´ ç”±bodyå­—æ®µï¼ˆçœŸæ­£è¦å±•ç¤ºçš„å†…å®¹ï¼‰å’Œå½’å±çš„urlsã€‚ Crawlå‡½æ•°è°ƒç”¨Fetcheræ¥å£çš„fetcheræ–¹æ³•å¯¹fakeResultçš„bodyå­—æ®µåŒ¹é…ï¼Œå¹¶æ‰“å°åŒ¹é…åˆ°çš„bodyå‡ºæ¥ï¼Œæ²¡æ‰¾åˆ°å°±æ‰“å°æŠ¥é”™ã€‚ è‹¥æ˜¯åŒ¹é…æˆåŠŸï¼ŒCrawlæ·±åº¦å‡ä¸€é€’å½’çš„è°ƒç”¨Crawlï¼Œurlä½¿ç”¨åŒ¹é…bodyå¯¹åº”çš„fakeResultä¸‹çš„urlsåˆ‡ç‰‡æ¯ä¸€ä¸ªurlå€¼ã€‚\nè¦æ±‚ä½¿ç”¨å¹¶å‘çš„å®ç° æ‰€ä»¥ä¸ºäº†ä¸æ”¹å˜åŸå‡½æ•°æ¨¡æ¿é‡‡ç”¨sync.WaitGroupæ¥è¿›è¡Œä¸»è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸã€‚ // sync.WaitGroup ç”¨æ³• var wg sync.WaitGroup wg.Add(i int) //æ·»åŠ iä¸ªworkeråç¨‹ wg.Done()\t//è¯¥å­è¿›ç¨‹ç»“æŸï¼Œåšè®°å½• wg.Wait() //å½“workeråç¨‹æœªå…¨éƒ¨æ‰§è¡Œç»“æŸï¼Œä¼šä¸€ç›´å µå¡ è¦æ±‚ä½¿ç”¨mapè®°å½•å·²ç»çˆ¬å–çš„é¡µé¢é¿å…é‡å¤æŠ“å– ç”±äºmapéå¹¶å‘å®‰å…¨ï¼ˆå¤šä¸ªgoroutineåŒæ—¶å†™å…¥mapä¼šæŠ¥é”™ï¼‰ï¼Œæ·»åŠ äº’æ–¥é”è§£å†³ã€‚ // å¸¦äº’æ–¥é”çš„mapï¼Œé˜²æ­¢å¹¶è¡Œçš„å†™å…¥ type SafeUrlMap struct { set map[string]int mux sync.Mutex } func (myset SafeUrlMap) add(url string) { myset.mux.Lock() // elem, ok = set[url] myset.set[url]++ myset.mux.Unlock() } func (myset SafeUrlMap) have(url string) bool { myset.mux.Lock() if myset.set[url] != 0 { defer myset.mux.Unlock() return true } return false }\tå®Œæ•´ä»£ç  package main import ( \u0026quot;fmt\u0026quot; \u0026quot;sync\u0026quot; ) type Fetcher interface { // Fetch è¿”å› URL çš„ body å†…å®¹ï¼Œå¹¶ä¸”å°†åœ¨è¿™ä¸ªé¡µé¢ä¸Šæ‰¾åˆ°çš„ URL æ”¾åˆ°ä¸€ä¸ª slice ä¸­ã€‚ Fetch(url string) (body string, urls []string, err error) } // Crawl ä½¿ç”¨ fetcher ä»æŸä¸ª URL å¼€å§‹é€’å½’çš„çˆ¬å–é¡µé¢ï¼Œç›´åˆ°è¾¾åˆ°æœ€å¤§æ·±åº¦ã€‚ func Crawl(url string, depth int, fetcher Fetcher) { if depth \u0026lt;= 0 { wg.Done() return } if myset.have(url) { wg.Done() return } body, urls, err := fetcher.Fetch(url) myset.add(url) // æ— è®ºè¯¥ç½‘é¡µæ˜¯å¦æ‰¾åˆ°ï¼Œéƒ½åšä¸€æ¬¡è®°å½•é˜²æ­¢ä¸‹æ¬¡é‡å¤æŠ“å– if err != nil { fmt.Println(err) wg.Done() return } fmt.Printf(\u0026quot;found: %s %q\\n\u0026quot;, url, body) for _, u := range urls { wg.Add(1) go Crawl(u, depth-1, fetcher) } wg.Done() return } func main() { myset = SafeUrlMap{set: make(map[string]int)} wg.Add(1) Crawl(\u0026quot;https://golang.org/\u0026quot;, 4, fetcher) wg.Wait() } // å¸¦äº’æ–¥é”çš„mapï¼Œé˜²æ­¢å¹¶è¡Œçš„å†™å…¥ type SafeUrlMap struct { set map[string]int mux sync.Mutex } // urlè®°å½•çš„æŸ¥è¯¢æ–¹æ³• func (myset SafeUrlMap) add(url string) { myset.mux.Lock() // elem, ok = set[url] myset.set[url]++ myset.mux.Unlock() } // urlè®°å½•çš„æ·»åŠ æ–¹æ³• func (myset SafeUrlMap) have(url string) bool { myset.mux.Lock() if myset.set[url] != 0 { defer myset.mux.Unlock() return true } return false } // fakeFetcher æ˜¯è¿”å›è‹¥å¹²ç»“æœçš„ Fetcherã€‚ type fakeFetcher map[string]*fakeResult type fakeResult struct { body string urls []string } func (f fakeFetcher) Fetch(url string) (string, []string, error) { if res, ok := f[url]; ok { return res.body, res.urls, nil } return \u0026quot;\u0026quot;, nil, fmt.Errorf(\u0026quot;not found: %s\u0026quot;, url) } // å·²é‡‡é›†çš„Urlæ¸…å•,é‡‡é›†è¿›ç¨‹ç»„ var ( myset SafeUrlMap wg sync.WaitGroup ) // fetcher æ˜¯å¡«å……åçš„ fakeFetcherã€‚ var fetcher = fakeFetcher{ \u0026quot;https://golang.org/\u0026quot;: \u0026amp;fakeResult{ \u0026quot;The Go Programming Language\u0026quot;, []string{ \u0026quot;https://golang.org/pkg/\u0026quot;, \u0026quot;https://golang.org/cmd/\u0026quot;, }, }, \u0026quot;https://golang.org/pkg/\u0026quot;: \u0026amp;fakeResult{ \u0026quot;Packages\u0026quot;, []string{ \u0026quot;https://golang.org/\u0026quot;, \u0026quot;https://golang.org/cmd/\u0026quot;, \u0026quot;https://golang.org/pkg/fmt/\u0026quot;, \u0026quot;https://golang.org/pkg/os/\u0026quot;, }, }, \u0026quot;https://golang.org/pkg/fmt/\u0026quot;: \u0026amp;fakeResult{ \u0026quot;Package fmt\u0026quot;, []string{ \u0026quot;https://golang.org/\u0026quot;, \u0026quot;https://golang.org/pkg/\u0026quot;, }, }, \u0026quot;https://golang.org/pkg/os/\u0026quot;: \u0026amp;fakeResult{ \u0026quot;Package os\u0026quot;, []string{ \u0026quot;https://golang.org/\u0026quot;, \u0026quot;https://golang.org/pkg/\u0026quot;, }, }, } ","id":34,"section":"posts","summary":"goæŒ‡å—ç»ƒä¹  æ–°æ‰‹åˆå­¦Goè¯­è¨€ï¼Œçœ‹åˆ°è¿™ä¸ªgoæŒ‡å—ç½‘ç«™åœ¨çº¿æµ‹è¯•å¾ˆæ–¹ä¾¿åšäº†å‡ é“ç»ƒä¹ åå°±åœ¨ä¸Šé¢å­¦ä¹ ã€‚ å…¶ä¸­æœ€åä¸€é¡µçš„æµ‹è¯•ï¼š goæŒ‡å—ç»ƒä¹ :webçˆ¬è™« å­¦äº†","tags":["go"],"title":"GoæŒ‡å—ç»ƒä¹ ","uri":"https://liangkang233.github.io/2021/06/go%E6%8C%87%E5%8D%97%E7%BB%83%E4%B9%A0-web%E7%88%AC%E8%99%AB/","year":"2021"},{"content":"VScodeæ˜¯ä¸€æ¬¾éå¸¸å¥½ç”¨çš„ä»£ç ç¼–è¾‘å™¨ï¼Œè¿˜æ‹¥æœ‰å¼ºå¤§çš„åœ¨çº¿æ‰©å±•æ’ä»¶ã€‚ç”šè‡³å¯ä»¥è¿›è¡Œä»£ç çš„debugï¼Œæ•´ç†äº†ä¸‹é…ç½®è¿‡ç¨‹é‡åˆ°çš„é—®é¢˜åˆ†äº«å‡ºæ¥ã€‚ æˆ‘ä½¿ç”¨çš„windowså¹³å°vscodeç‰ˆæœ¬ä¸ºV1.56ã€‚\né€šç”¨é…ç½® VS Codeå†…ç½®äº†å¯¹Node.jsè¿è¡Œæ—¶çš„è°ƒè¯•æ”¯æŒï¼Œå¯ä»¥è°ƒè¯•JavaScriptã€TypeScriptæˆ–JavaScriptè¯­è¨€ã€‚\nè¦è°ƒè¯•å…¶ä»–è¯­è¨€(åŒ…æ‹¬PHP, Ruby, Go, c#ï¼Œ Python, C++ï¼Œ PowerShellç­‰)æ—¶ï¼Œåœ¨VS Codeæ‰©å±•ä¸­å¯»æ‰¾è°ƒè¯•å™¨æ‰©å±•ï¼Œæˆ–è€…åœ¨é¡¶çº§è¿è¡Œèœå•ä¸­é€‰æ‹©å®‰è£…é¢å¤–çš„è°ƒè¯•å™¨ã€‚\nç¡®å®šå®‰è£…å¯ä»¥ç¼–è¯‘è°ƒè¯•çš„æ‰©å±•æˆ–è½¯ä»¶å†è¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\nå³å‡»å·¥ç¨‹æ–‡ä»¶å¤¹ä½¿ç”¨VScodeæ‰“å¼€ã€‚ æ‰“å¼€éœ€è¦ç¼–è¯‘ã€è¿è¡Œçš„æ–‡ä»¶ï¼Œç‚¹å‡»é¡¶éƒ¨èœå•-\u0026gt;è¿è¡Œ-\u0026gt;æ·»åŠ é…ç½®\u0026hellip;é€‰æ‹©éœ€è¦debugçš„ç±»å‹ï¼Œä¹‹åæ ¹æ®è¯­è¨€åŠå³å¯åœ¨ .vscodeæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆlaunch.jsonæ–‡ä»¶ã€‚ç”Ÿæˆçš„jsonæ–‡ä»¶å¯¹æ•´ä¸ªæ–‡ä»¶å¤¹å’Œå­æ–‡ä»¶å¤¹ç”Ÿæ•ˆã€‚\nä¸¾ä¾‹å¦‚ä½•debug go ä»¥goè¯­è¨€ä¸ºä¾‹ï¼Œè·¯å¾„åˆ‡æ¢è‡³å½“å‰å·¥ç¨‹æ–‡ä»¶å¤¹ã€‚é¦–å…ˆå®‰è£…è°ƒè¯•è½¯ä»¶æ¨èä½¿ç”¨dlvï¼Œç»ˆç«¯ä¸­è¾“å…¥\ngo get -u github.com/go-delve/delve/cmd/dlv # æœªç”Ÿæˆmodè¿˜å¾—æ·»åŠ modæ‰èƒ½è°ƒè¯•\tgo mod init yourProjectName ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œç‚¹å‡»ä¸Šè¿°æ­¥éª¤ç”Ÿæˆlaunch.jsonæ–‡ä»¶ï¼Œæ­¤å¤„ä¼šè®©ä½ é€‰æ‹©è°ƒè¯•åŒ…è¿˜æ˜¯é™„ç€åˆ°æœ¬åœ°è¿›ç¨‹æˆ–è¿œç¨‹æœåŠ¡å™¨è°ƒè¯•ã€‚ é€‰æ‹©é»˜è®¤çš„è°ƒè¯•packageï¼Œè¿™é‡Œæ‰“å¼€ç”Ÿæˆçš„é»˜è®¤json\n{ // ä½¿ç”¨ IntelliSense äº†è§£ç›¸å…³å±æ€§ã€‚ // æ‚¬åœä»¥æŸ¥çœ‹ç°æœ‰å±æ€§çš„æè¿°ã€‚ // æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: https://go.microsoft.com/fwlink/?linkid=830387 \u0026quot;version\u0026quot;: \u0026quot;0.2.0\u0026quot;, \u0026quot;configurations\u0026quot;: [ { \u0026quot;name\u0026quot;: \u0026quot;Launch Package\u0026quot;, \u0026quot;type\u0026quot;: \u0026quot;go\u0026quot;, \u0026quot;request\u0026quot;: \u0026quot;launch\u0026quot;, \u0026quot;mode\u0026quot;: \u0026quot;auto\u0026quot;, \u0026quot;program\u0026quot;: \u0026quot;${workspaceFolder}\u0026quot; } ] } éœ€è¦æ·»åŠ æ–°çš„é…ç½®ç›´æ¥ç‚¹å‡»å³ä¸‹è§’å³å¯ï¼Œ\u0026ldquo;name\u0026quot;çš„å€¼ä¸ºå·¦æ ‡ç­¾é¡µè°ƒè¯•å™¨çš„åå­—ç”¨äºåŒºåˆ†ç”¨ã€‚\nâ€œtypeâ€è¯­è¨€ç±»å‹è®¾ç½®ä¸ºgoï¼Œvs code ç”¨äºè®¾å®šè°ƒè¯•ä»£ç æ‰©å±•ç±»å‹ã€‚â€modeâ€œå¯ä»¥è®¾ç½®ä¸º auto, debug, remote, test, exec ä¸­çš„ä¸€ä¸ªã€‚\nâ€programâ€œè°ƒè¯•ç¨‹åºçš„è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„ï¼‰ï¼Œè¿™é‡Œä½¿ç”¨workspaceFolderè¯´æ˜å¯¹æ•´ä¸ªå·¥ä½œåŒºç›®å½•æ–‡ä»¶è¿›è¡Œè°ƒè¯•ã€‚\nå„é…ç½®å˜é‡çš„å«ä¹‰ å…¶ä¸­æœ‰è®¸å¤švscodeå®šä¹‰çš„å˜é‡ï¼Œè¿™é‡Œåˆ—å‡ºå¸¸ç”¨çš„ï¼š\n${workspaceFolder} - åœ¨VS Codeä¸­æ‰“å¼€çš„æ–‡ä»¶å¤¹è·¯å¾„ ${workspaceFolderBasename} - åœ¨VS Codeä¸­æ‰“å¼€çš„æ–‡ä»¶å¤¹çš„åç§°æ²¡æœ‰ä»»ä½•æ–œæ (/) ${file} - å½“å‰æ‰“å¼€çš„æ–‡ä»¶å ${fileWorkspaceFolder} - å½“å‰æ‰“å¼€çš„æ–‡ä»¶çš„å·¥ä½œåŒºæ–‡ä»¶å¤¹ ${relativeFile} - å½“å‰æ‰“å¼€çš„æ–‡ä»¶åç›¸å¯¹äºworkspaceFolder ${relativeFileDirname} - å½“å‰æ‰“å¼€çš„æ–‡ä»¶çš„ç›®å½•åç›¸å¯¹äºworkspaceFolder ${fileBasename} - å½“å‰æ‰“å¼€çš„æ–‡ä»¶çš„åŸºå ${fileBasenameNoExtension} - å½“å‰æ‰“å¼€çš„æ–‡ä»¶çš„åŸºåæ²¡æœ‰æ–‡ä»¶æ‰©å±•å ${fileDirname} - å½“å‰æ‰“å¼€æ–‡ä»¶çš„ç›®å½•å ${fileExtname} - å½“å‰æ‰“å¼€çš„æ–‡ä»¶çš„æ‰©å±•å ${cwd} - ä»»åŠ¡è¿è¡Œå™¨å¯åŠ¨æ—¶çš„å½“å‰å·¥ä½œç›®å½• ${lineNumber} - å½“å‰é€‰ä¸­çš„è¡Œå·åœ¨æ´»åŠ¨æ–‡ä»¶ä¸­ ${selectedText} - æ´»åŠ¨æ–‡ä»¶ä¸­å½“å‰é€‰å®šçš„æ–‡æœ¬ ${execPath} - è¿è¡ŒVS Codeå¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ ${defaultBuildTask} - é»˜è®¤æ„å»ºä»»åŠ¡çš„åç§° ${pathSeparator} - æ“ä½œç³»ç»Ÿç”¨äºåˆ†éš”æ–‡ä»¶è·¯å¾„ä¸­çš„ç»„ä»¶çš„å­—ç¬¦ ${pathSeparator} - åœ¨macOSæˆ–linuxç³»ç»Ÿä¸º/, åœ¨Windowsä¸Šä¸º\\ å…³äºdebug C/C++ è¯¥æ–‡ä»¶è®¾ç½®debugçš„å„é¡¹é…ç½®æ ¹æ®è¯­è¨€çš„ä¸åŒï¼Œè®¾ç½®ä¹Ÿä¸å°½ç›¸åŒã€‚è¿™é‡Œä»‹ç»c/c++çš„å…·ä½“é…ç½®æµç¨‹ã€‚ æ€»ç»“å„æ–‡ä»¶ä½œç”¨ ä¸å…¶ä»–è¯­è¨€ç±»ä¼¼çš„ï¼Œdebugçš„é…ç½®æ–‡ä»¶ä¹Ÿæ˜¯ç”Ÿæˆåœ¨.vscodeæ–‡ä»¶å¤¹ä¸­ã€‚ c/c++ç¨‹åºé…ç½®ä¸€èˆ¬æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼š\ntasks.jsonï¼ˆå¦‚ä½•ç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºï¼‰ launch.jsonï¼ˆè°ƒè¯•è®¾ç½®ï¼‰ c_cpp_properties.jsonï¼ˆç¼–è¯‘å™¨è·¯å¾„å’Œvscodeæ„ŸçŸ¥è®¾ç½®ï¼‰ å…¶ä¸­c_cpp_propertieséå¸¸å‘ï¼Œç”±äºæˆ‘ä½¿ç”¨äº†è‡ªå·±å†™çš„å¤´æ–‡ä»¶åœ¨c_cpp_properties.jsonçš„includePathé¡¹ç›®é…ç½®å„ç§è·¯å¾„ç±»å‹éƒ½ä¸ç”Ÿæ•ˆï¼Œåé¢æ‰çœ‹æ‡‚è¿™ä¸ªåªæ˜¯è®©vscodeè¯†åˆ«å¤´æ–‡ä»¶è¯¥è·³è½¬çš„è·¯å¾„è€Œå·²ï¼ŒçœŸæ­£è¦æ·»åŠ å¤–éƒ¨åº“æˆ–å¤´æ–‡ä»¶çš„è¯è¦ä¹ˆæ”¾åœ¨ç³»ç»Ÿé»˜è®¤åº“ã€å¤´æ–‡ä»¶è·¯å¾„ï¼Œè¦ä¹ˆåœ¨task.jsonä¸­é…ç½®ç”Ÿæˆã€‚ å…·ä½“æµç¨‹ c/c++ä»£ç éœ€è¦å…ˆç¼–è¯‘é“¾æ¥ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºï¼ˆtasks.jsonï¼‰ï¼Œå†ä½¿ç”¨gdbè°ƒè¯•ï¼ˆlaunch.jsonï¼‰ï¼Œc_cpp_properties.jsonè®¾ç½®c/c++ä½¿ç”¨è¯­è¨€æ ‡å‡†ä¾‹å¦‚c++11ç­‰ã€‚æ³¨æ„ï¼šè°ƒè¯•å‰ç¡®ä¿ç³»ç»Ÿç¯å¢ƒå·²é…ç½®g++ã€gdbã€‚éªŒè¯æ–¹æ³•ï¼š\nè¦æ£€æŸ¥æ‚¨çš„ Mingw-w64 å·¥å…·æ˜¯å¦æ­£ç¡®å®‰è£…å’Œå¯ç”¨ï¼Œè¯·æ‰“å¼€æ–°çš„å‘½ä»¤æç¤ºå¹¶é”®å…¥ï¼š g++ \u0026ndash;version gdb \u0026ndash;version ä»¥æ­¤å·¥ç¨‹æ–‡ä»¶å¤¹ä¸ºä¾‹ï¼Œmainå‡½æ•°è°ƒç”¨äº†libæ–‡ä»¶å¤¹ä¸‹çš„stu_rw.hæ–‡ä»¶\næ‰“å¼€main.cppæ–‡ä»¶ï¼Œç‚¹å‡»é¡¶éƒ¨èœå•-\u0026gt;ç»ˆç«¯-\u0026gt;é…ç½®é»˜è®¤ç”Ÿæˆä»»åŠ¡ï¼Œé€‰æ‹©ä½¿ç”¨g++ç”Ÿæˆæ´»åŠ¨æ–‡ä»¶ã€‚æ‰“å¼€ç”Ÿæˆçš„task.jsonæ–‡ä»¶\n{ \u0026quot;version\u0026quot;: \u0026quot;2.0.0\u0026quot;, \u0026quot;tasks\u0026quot;: [ { \u0026quot;type\u0026quot;: \u0026quot;cppbuild\u0026quot;, \u0026quot;label\u0026quot;: \u0026quot;C/C++: g++.exe ç”Ÿæˆæ´»åŠ¨æ–‡ä»¶\u0026quot;, \u0026quot;command\u0026quot;: \u0026quot;C:\\\\Program Files\\\\mingw-w64\\\\x86_64-8.1.0-posix-seh-rt_v6-rev0\\\\mingw64\\\\bin\\\\g++.exe\u0026quot;, \u0026quot;args\u0026quot;: [ \u0026quot;-g\u0026quot;, \u0026quot;-Wall\u0026quot;, //æ˜¾ç¤ºå…¨éƒ¨è¯¦ç»†è­¦å‘Š \u0026quot;-std=c++11\u0026quot;, //æ”¯æŒC11 \u0026quot;${file}\u0026quot;,\t\u0026quot;-I\u0026quot;, \u0026quot;${workspaceFolder}\\\\lib\u0026quot;, \u0026quot;-o\u0026quot;, \u0026quot;${fileDirname}\\\\${fileBasenameNoExtension}.exe\u0026quot; ], \u0026quot;options\u0026quot;: { \u0026quot;cwd\u0026quot;: \u0026quot;${fileDirname}\u0026quot; }, \u0026quot;problemMatcher\u0026quot;: [ \u0026quot;$gcc\u0026quot; ], \u0026quot;group\u0026quot;: { \u0026quot;kind\u0026quot;: \u0026quot;build\u0026quot;, \u0026quot;isDefault\u0026quot;: true }, \u0026quot;detail\u0026quot;: \u0026quot;ç¼–è¯‘å™¨: \\\u0026quot;C:\\\\Program Files\\\\mingw-w64\\\\x86_64-8.1.0-posix-seh-rt_v6-rev0\\\\mingw64\\\\bin\\\\g++.exe\\\u0026quot;\u0026quot; } ] } å…¶ä¸­argsé€‰é¡¹å³ä¸ºg++ç¼–è¯‘é“¾æ¥é€‰é¡¹ï¼Œå¦‚ä¸Šæ‰€ç¤ºæˆ‘å·²ç»æ·»åŠ äº†\u0026rdquo;-I\u0026quot;ç›¸å…³å‚æ•°æ·»åŠ å¤´æ–‡ä»¶è·¯å¾„ï¼Œc11æ ‡å‡†ã€‚é™æ€åº“é“¾æ¥ç­‰å°±æ”¾-oé€‰é¡¹åï¼Œé™¤æœ€åä¸€è¡Œé…ç½®æ–‡ä»¶æ¯è¡Œéƒ½å¾—åŠ é€—å·ã€‚\nä¹‹åæ‰“å¼€main.cppç‚¹å‡»é¡¶éƒ¨èœå•-\u0026gt;ç»ˆç«¯-\u0026gt;è¿è¡Œç”Ÿæˆä»»åŠ¡ï¼Œçœ‹æ˜¯å¦ç”ŸæˆæˆåŠŸã€‚\nä¹‹åè®¾å®šdebugé€‰é¡¹ï¼Œç‚¹å‡»é¡¶éƒ¨èœå•-\u0026gt;è¿è¡Œ-\u0026gt;æ·»åŠ é…ç½®ï¼Œé€‰æ‹©gdbã€ä¹‹åé€‰g++ç”Ÿæˆé»˜è®¤é…ç½®ã€‚ ä¸‹é¢å±•ç¤ºé…ç½®çš„è¯´æ˜ï¼š\n{ // ä½¿ç”¨ IntelliSense äº†è§£ç›¸å…³å±æ€§ã€‚ // æ‚¬åœä»¥æŸ¥çœ‹ç°æœ‰å±æ€§çš„æè¿°ã€‚ // æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: https://go.microsoft.com/fwlink/?linkid=830387 \u0026quot;version\u0026quot;: \u0026quot;0.2.0\u0026quot;, \u0026quot;configurations\u0026quot;: [ { \u0026quot;name\u0026quot;: \u0026quot;g++.exe - ç”Ÿæˆå’Œè°ƒè¯•æ´»åŠ¨æ–‡ä»¶\u0026quot;,\t// é…ç½®åç§°ï¼Œå°†ä¼šåœ¨å¯åŠ¨é…ç½®çš„ä¸‹æ‹‰èœå•ä¸­æ˜¾ç¤º \u0026quot;type\u0026quot;: \u0026quot;cppdbg\u0026quot;, \u0026quot;request\u0026quot;: \u0026quot;launch\u0026quot;,\t// è¯·æ±‚é…ç½®ç±»å‹ï¼Œå¯ä»¥ä¸ºlaunchï¼ˆå¯åŠ¨ï¼‰æˆ–attachï¼ˆé™„åŠ ï¼‰ \u0026quot;program\u0026quot;: \u0026quot;${fileDirname}\\\\${fileBasenameNoExtension}.exe\u0026quot;,\t// å°†è¦è¿›è¡Œè°ƒè¯•çš„ç¨‹åºçš„è·¯å¾„ \u0026quot;args\u0026quot;: [],\t// ç¨‹åºè°ƒè¯•æ—¶ä¼ é€’ç»™ç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•°ï¼Œä¸€èˆ¬è®¾ä¸ºç©ºå³å¯ \u0026quot;stopAtEntry\u0026quot;: false, \u0026quot;cwd\u0026quot;: \u0026quot;${fileDirname}\u0026quot;, \u0026quot;environment\u0026quot;: [], \u0026quot;externalConsole\u0026quot;: false, \u0026quot;MIMode\u0026quot;: \u0026quot;gdb\u0026quot;, \u0026quot;miDebuggerPath\u0026quot;: \u0026quot;C:\\\\Program Files\\\\mingw-w64\\\\x86_64-8.1.0-posix-seh-rt_v6-rev0\\\\mingw64\\\\bin\\\\gdb.exe\u0026quot;, \u0026quot;setupCommands\u0026quot;: [ { \u0026quot;description\u0026quot;: \u0026quot;ä¸º gdb å¯ç”¨æ•´é½æ‰“å°\u0026quot;, \u0026quot;text\u0026quot;: \u0026quot;-enable-pretty-printing\u0026quot;, \u0026quot;ignoreFailures\u0026quot;: true } ], \u0026quot;preLaunchTask\u0026quot;: \u0026quot;C/C++: g++.exe ç”Ÿæˆæ´»åŠ¨æ–‡ä»¶\u0026quot; } ] } å¦‚æœæ‚¨æƒ³è¦å¯¹ C/C++æ‰©å±•è¿›è¡Œæ›´å¤šæ§åˆ¶ï¼Œc_cpp_properties.jsonå°†é…ç½®å¦‚ç¼–è¯‘å™¨çš„è·¯å¾„ï¼Œincludeè·¯å¾„ã€C++æ ‡å‡†ï¼ˆé»˜è®¤å€¼ä¸º C++17ï¼‰ç­‰ç­‰ã€‚\né€šè¿‡å‘½ä»¤ç»ˆç«¯ï¼ˆCtrl+Shift+Pï¼‰è¾“å…¥\u0026gt;c/c++ï¼Œæœ‰ä¸¤ä¸ªé€‰é¡¹ä¸€ä¸ªæ˜¯ç›´æ¥é…ç½®jsonä¸€ä¸ªæ˜¯é€šè¿‡UIç•Œé¢é…ç½®ã€‚\nè¿™é‡Œçš„C/C++ é…ç½®UIé¡µé¢ï¼ŒåŸºæœ¬ä¿æŒé»˜è®¤å³å¯ã€‚æ³¨æ„è¿™é‡Œçš„é…ç½®ç¼–è¾‘å™¨æ˜¯ç»™vscodeå’Œæ‰©å±•ä½¿ç”¨çš„ï¼Œä¸å½±å“task.jsonæ¥é…ç½®çœŸæ­£ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºçš„è¿‡ç¨‹ã€‚\n","id":35,"section":"posts","summary":"VScodeæ˜¯ä¸€æ¬¾éå¸¸å¥½ç”¨çš„ä»£ç ç¼–è¾‘å™¨ï¼Œè¿˜æ‹¥æœ‰å¼ºå¤§çš„åœ¨çº¿æ‰©å±•æ’ä»¶ã€‚ç”šè‡³å¯ä»¥è¿›è¡Œä»£ç çš„debugï¼Œæ•´ç†äº†ä¸‹é…ç½®è¿‡ç¨‹é‡åˆ°çš„é—®é¢˜åˆ†äº«å‡ºæ¥ã€‚ æˆ‘ä½¿ç”¨çš„","tags":[""],"title":"Vscodeé…ç½®debug","uri":"https://liangkang233.github.io/2021/06/vsode%E9%85%8D%E7%BD%AEdebug/","year":"2021"},{"content":"èƒŒæ™¯ æˆ‘ç›®å‰éœ€è¦è§£å†³ä¸€ä¸ªéœ€æ±‚ï¼Œå°†ä¸€ä¸ªcå·¥ç¨‹ä¸­çš„ç‰¹å®šæ•°æ®è½¬å‘åˆ°VUEå‰ç«¯æ¡†æ¶ä¸Šåšç•Œé¢å±•ç¤ºï¼Œä¸”è¯¥æ¡†æ¶å·²ç»æœ‰åç«¯ä¸ºflaskæ¡†æ¶ã€‚\næ‰€ä»¥å¾—è€ƒè™‘å¦‚ä½•å°†cå·¥ç¨‹ä¸­çš„æ•°æ®å‘é€åˆ°pythonä¸­ã€‚å®¹æ˜“çŸ¥é“ï¼Œè¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼æœ‰ç®¡é“ã€ä¿¡å·é‡ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜ã€å¥—æ¥å­—ç­‰ã€‚ä¸ºäº†ç®€æ˜“å®ç°ä¸Šè¿°åŠŸèƒ½å’Œå°½é‡ä¸å½±å“ä»–ä»¬ä¸¤è¾¹åŸå…ˆè¿›ç¨‹çš„åŠŸèƒ½ï¼Œä½¿ç”¨å¥—æ¥å­—å‘é€å°è£…çš„æ•°æ®åšhttpè¯·æ±‚ç»™flaskåç«¯ï¼Œè¿™æ ·æ¥å®ç°æ•°æ®è½¬å‘ã€‚\nHTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯ä¸€ç§ç”¨äºåˆ†å¸ƒå¼ã€åä½œå¼å’Œè¶…åª’ä½“ä¿¡æ¯ç³»ç»Ÿçš„åº”ç”¨å±‚åè®®ã€‚HTTPè¯·æ±‚çš„èµ„æºç”±ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼ˆUniform Resource Identifiersï¼ŒURIï¼‰æ¥æ ‡è¯†ã€‚å…·ä½“åŒºåˆ«è¿™ç¯‡åšå®¢è®²çš„å¾ˆè¯¦ç»†ã€‚æ€»è€Œè¨€ä¹‹httpè¿æ¥=ä»¥httpåè®®ä¸ºé€šä¿¡åè®®çš„tcpè¿æ¥ï¼Œhttpåè®®å¯ä»¥ç”±tcpåè®®å°è£…æŠ¥æ–‡è€Œæ¥ï¼Œç°åœ¨è¦è§£å†³çš„å°±æ˜¯cçš„å¥—æ¥å­—å¦‚ä½•å°è£…æˆç¬¦åˆhttpåè®®çš„get/postè¯·æ±‚ã€‚\nå‚è€ƒæ¡ˆä¾‹ æœ€å¼€å§‹æ‰¾äº†ç½‘ä¸Šå¾ˆå¤šæ¡ˆä¾‹ï¼Œtcpå¥—æ¥å­—ç»†èŠ‚æ­¤å¤„ä¸èµ˜è¿°ã€‚httpè¯·æ±‚å°±æ˜¯å…¶tcpä¼ è¾“é™„ä¸Šå¯¹åº”httpè¯·æ±‚çš„æŠ¥æ–‡ï¼Œä½†æ˜¯å®é™…æµ‹è¯•ä¸å¯¹ï¼Œæ²¡æœ‰ç›¸åº”è¿”å›ã€‚çŒœæƒ³åˆ°å¯èƒ½æµ‹è¯•ç¯å¢ƒä¸åŒå°è£…æ ¼å¼ä¹Ÿè¦æ”¹å˜ï¼Œæ‰€ä»¥ä½¿ç”¨wiresharkæŠ“åŒ…è½¯ä»¶æŠ“äº†ä¸ªå…·ä½“çš„æ•°æ®åŒ…æ¥åˆ†æã€‚ ä½¿ç”¨çš„getã€postè¯·æ±‚çš„htmlé¡µé¢\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;UTF-8\u0026quot;\u0026gt; \u0026lt;title\u0026gt;GET and POST\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;form action = \u0026quot;http://localhost:5000\u0026quot; method = \u0026quot;get\u0026quot;\u0026gt; \u0026lt;table\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;Name\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;\u0026lt;input type =\u0026quot;text\u0026quot; name =\u0026quot;username\u0026quot;\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;Password\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;\u0026lt;input type =\u0026quot;password\u0026quot; name =\u0026quot;password\u0026quot;\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;\u0026lt;input type = \u0026quot;get submit\u0026quot;\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;form action = \u0026quot;http://localhost:5000\u0026quot; method = \u0026quot;post\u0026quot;\u0026gt; \u0026lt;table\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;Name\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;\u0026lt;input type =\u0026quot;text\u0026quot; name =\u0026quot;username\u0026quot;\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;Password\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;\u0026lt;input type =\u0026quot;password\u0026quot; name =\u0026quot;password\u0026quot;\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;\u0026lt;input type = \u0026quot;post submit\u0026quot;\u0026gt;\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; åç«¯flaskæ¥æ”¶ä»£ç \nfrom flask import Flask, request app = Flask(__name__) @app.route('/', methods=['GET']) def index(): username = request.args.get('username') password = request.args.get('password') if username == \u0026quot;xugaoxiang\u0026quot; and password == \u0026quot;xugaoxiang\u0026quot;: return f\u0026quot;\u0026lt;html\u0026gt;\u0026lt;body\u0026gt;Welcome {username}\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026quot; else: return f\u0026quot;\u0026lt;html\u0026gt;\u0026lt;body\u0026gt;Welcome!\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026quot; @app.route('/', methods=['POST']) def index(): username = request.form['username'] password = request.form['password'] if username == \u0026quot;xugaoxiang\u0026quot; and password == \u0026quot;xugaoxiang\u0026quot;: return f\u0026quot;\u0026lt;html\u0026gt;\u0026lt;body\u0026gt;Welcome {username}\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026quot; else: return f\u0026quot;\u0026lt;html\u0026gt;\u0026lt;body\u0026gt;Welcome!\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026quot; if __name__ == '__main__': app.run(debug=True) æµ‹è¯•æ¡ˆä¾‹å–è‡ªæ­¤æ•™ç¨‹ï¼Œè´´å‡ºæ•™ç¨‹æºç é“¾æ¥ï¼šhttps://github.com/xugaoxiang/FlaskTutorial å…¶æŠ“åŒ…ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š åªéœ€è¦å…³æ³¨httpæ•°æ®åŒ…ä¸­çš„tcpæŠ¥æ–‡å†…å®¹å³å¯ã€‚ å…·ä½“å®ç° æ³¨ï¼šä¸ºäº†è§£å†³å¤§å°ç«¯å’Œæ•°æ®ä½æ•°ä¸ç»Ÿä¸€çš„é—®é¢˜ï¼Œæˆ‘æ˜¯å°†æ‰€æœ‰æ•°æ®è½¬ä¸ºå­—ç¬¦ä¸²æ¥å‘é€ã€‚å¦‚æœæƒ³è¦å‘é€jsonç­‰æ•°æ®æ ¼å¼åŒæ ·ç”¨æŠ“åŒ…çœ‹ä¸‹å…·ä½“å¦‚ä½•å°è£…å³å¯ï¼Œæ­¤å¤„ç®€æ˜“çš„å®ç°å…ˆä¸è€ƒè™‘é‚£äº›åŠŸèƒ½ã€‚ æœ‰äº†ä¸Šé¢çš„æ•°æ®æ ·æœ¬ï¼Œè¿›è¡Œä¸‹é¢cä»£ç çš„å°è£…è½¬å‘ã€‚ä½¿ç”¨ç¯å¢ƒä¸åŒï¼Œéƒ¨åˆ†å‡½æ•°å¯èƒ½æœ‰æ‰€å˜åŒ–ã€‚è¿™é‡Œåªå±•ç¤ºåŸºç¡€æ¨¡æ¿ã€‚ çœŸæ­£é€šç”¨çš„æ˜¯ä¸‹é¢è¿™æ®µè¡¥é½ä¿¡ä»¤çš„å‡½æ•°\nvoid addget(const char* str1) //è¡¥é½getä¿¡ä»¤æ•°æ® { strcat(str1, \u0026quot;Host: 127.0.0.1\\r\\n\u0026quot;);//cnameè®°å½•ä¸å½±å“è¿æ¥ï¼Œæ­¤å¤„ä¸åšä¿®æ”¹ strcat(str1, \u0026quot;Content-Type: text/html\\r\\n\\r\\n\u0026quot;); } void addpost(char* str1, const char* data) //è¡¥é½postä¿¡ä»¤æ•°æ® { char postlength[128]; sprintf(postlength, \u0026quot;%d\\r\\n\u0026quot;, strlen(data + 1)); strcat(str1, \u0026quot;Host: 127.0.0.1\\r\\n\u0026quot;);//cnameè®°å½•ä¸å½±å“è¿æ¥ï¼Œæ­¤å¤„ä¸åšä¿®æ”¹ strcat(str1, \u0026quot;Content-Type: application/x-www-form-urlencoded\\r\\n\u0026quot;); strcat(str1, \u0026quot;Content-Length: \u0026quot;); strcat(str1, postlength); strcat(str1, \u0026quot;\\r\\n\\r\\n\u0026quot;); strcat(str1, data + 1);\t} /* è°ƒç”¨æ–¹å¼ //dataå³ä¸ºä¼ è¾“è€Œæ¥çš„æ•°æ® case get_test:{\t// å°è£…æˆhttpçš„getè¯·æ±‚ strcpy(str1, \u0026quot;GET /getsometing?\u0026quot;); strcat(str1, data + 1); strcat(str1, \u0026quot; HTTP/1.1\\r\\n\u0026quot;); addget(str1); break; } case post_test:{\t// å°è£…æˆhttpçš„postè¯·æ±‚ strcpy(str1, \u0026quot;POST /postsometing HTTP/1.1\\r\\n\u0026quot;); addpost(str1, data); break;\t} */ è¯·æ±‚ä»£ç æ¨¡æ¿ åªè®¨è®ºhttpè¯·æ±‚æ–¹é¢å†…å®¹ï¼Œå±•ç¤ºåŸºç¡€çš„tcpå¥—æ¥å­—ç»‘å®šåŠå°è£…httpè¯·æ±‚æµç¨‹\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;errno.h\u0026gt; #include \u0026lt;signal.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;winsock2.h\u0026gt; #include \u0026lt;windows.h\u0026gt; #include \u0026lt;pthread.h\u0026gt; #include \u0026lt;assert.h\u0026gt; #define PORT 5000\t// è®¾å®šå‘é€ç«¯å£ #define BUFSIZE 1024 #define DATASIZE 2000 enum send_flask_type { start=1, accomplish, get_test, post_test }; // å®ç°å‡½æ•°ï¼Œflaskipä¸ºhttpè¯·æ±‚çš„ipåœ°å€ æ­¤å¤„ä¸ºç¯å›åœ°å€127.0.0.1 dataä¸ºä¼ è¾“æ•°æ®(ä¾‹å¦‚type=start) send_typeè®¾å®šä¼ è¾“æ–¹å¼ int HandleFlask(const char* flaskip, const char* data, int send_type) { int i, sockfd_flask; fd_set t_set1; struct timeval timeset; struct sockaddr_in flaskaddr; char str1[2 * DATASIZE], buf[BUFSIZE]; //* åˆ›å»ºflaskè¿æ¥å¥—æ¥å­— *// if ((sockfd_flask = socket(AF_INET, SOCK_STREAM, 0)) \u0026lt; 0 ) { printf(\u0026quot;åˆ›å»ºç½‘ç»œè¿æ¥å¤±è´¥,æœ¬çº¿ç¨‹å³å°†ç»ˆæ­¢!\\n\u0026quot;); return -1; } flaskaddr.sin_family = AF_INET; flaskaddr.sin_addr.s_addr = inet_addr(flaskip); flaskaddr.sin_port = htons(PORT); memset(\u0026amp;flaskaddr.sin_zero, 0, 8); if (connect(sockfd_flask, (struct sockaddr *)\u0026amp;flaskaddr, sizeof(flaskaddr)) \u0026lt; 0){ printf(\u0026quot;è¿æ¥åˆ°flaskæœåŠ¡å™¨å¤±è´¥!\\n\u0026quot;); return -1; } // printf(\u0026quot;è¿æ¥FlaskæœåŠ¡å™¨æˆåŠŸ\\n\u0026quot;); switch(send_type) { case get_test:{\t/* å°è£…æˆhttpçš„getè¯·æ±‚ */ strcpy(str1, \u0026quot;GET /getsometing?\u0026quot;); // if(SplitStr(data + 1, str1) \u0026lt; 0) { //å°†dataä¸­çš„tpyeæ•°å­—ç±»å‹è½¬æˆå­—ç¬¦ä¸²å¹¶æ·»åŠ è‡³str1 // printf(\u0026quot;éœ€è¦è½¬å‘çš„æŠ¥æ–‡æ ¼å¼æœ‰è¯¯\\n\u0026quot;); // return -1; // } strcat(str1, data + 1); strcat(str1, \u0026quot; HTTP/1.1\\r\\n\u0026quot;); addget(str1); break; } case post_test:{\t/* å°è£…æˆhttpçš„postè¯·æ±‚ */ strcpy(str1, \u0026quot;POST /postsometing HTTP/1.1\\r\\n\u0026quot;); addpost(str1, data); break;\t} default:{ printf(\u0026quot;æ¥æ”¶åˆ°æ— æ•ˆæ ¼å¼ï¼Œèˆå¼ƒ\\n\u0026quot;); return 0; } } i = send(sockfd_flask, str1, strlen(str1), 0); if (i \u0026lt; 0) { // printf(\u0026quot;å‘é€å¤±è´¥ï¼é”™è¯¯ä»£ç æ˜¯%dï¼Œé”™è¯¯ä¿¡æ¯æ˜¯'%s'\\n\u0026quot;,errno, strerror(errno)); printf(\u0026quot;å‘é€æ•°æ®ç»™flaskå¤±è´¥ï¼é”™è¯¯ä»£ç æ˜¯%d\\n\u0026quot;, WSAGetLastError());//windowsè·å–erron closesocket(sockfd_flask); return -1; } else { // printf(\u0026quot;æ¶ˆæ¯å‘é€è‡³flaskæˆåŠŸï¼Œå…±å‘é€äº†%dä¸ªå­—èŠ‚ï¼send_type=%d \\n\u0026quot;, i, send_type); } // pythonå®‰è£…æ’ä»¶eventletåï¼Œå¤–éƒ¨httpè®¿é—®åflaskä¸ä¼šç«‹å³å…³é—­å¥—æ¥å­— // (å³falsk returnåä¸ä¼šå‘é€ç©ºçš„tcpæŠ¥æ–‡)ï¼Œ // æ‰€ä»¥æ­¤ä¿®æ”¹ä¸ºä¸è€ƒè™‘å¤æ‚åœºæ™¯åªæ¥æ”¶ä¸€æ¬¡flaskçš„httpè¿”å›æ•°æ®åå°±å…³é—­å¥—æ¥å­— FD_ZERO(\u0026amp;t_set1); FD_SET(sockfd_flask, \u0026amp;t_set1); timeset.tv_sec= 0; timeset.tv_usec= 100000; //æ‰«æå µå¡æ—¶é—´100ms i= select(sockfd_flask +1, \u0026amp;t_set1, NULL, NULL, \u0026amp;timeset); if (i == 0) { // printf(\u0026quot;é•¿æ—¶é—´æœªæ¥æ”¶åˆ°flask httpå“åº”ï¼Œè·³è¿‡\\n\u0026quot;); // continue; // break; } else if (i \u0026lt; 0) { printf(\u0026quot;åœ¨è¯»å–flaskæ•°æ®æŠ¥æ–‡æ—¶SELECTæ£€æµ‹åˆ°å¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸å¯¼è‡´çº¿ç¨‹ç»ˆæ­¢ï¼\\n\u0026quot;); closesocket(sockfd_flask); return -1; } else { memset(buf, 0, sizeof(buf) ); i = recv(sockfd_flask, buf, sizeof(buf), 0); if (i \u0026lt;= 0) { closesocket(sockfd_flask); if (i == 0) { // printf(\u0026quot;ä¸flaské€šä¿¡çš„httpå¥—æ¥å­—å…³é—­\\n\u0026quot;); return 0; } else { printf(\u0026quot;æ¥æ”¶flaskæ•°æ®æŠ¥å‡ºç°é”™è¯¯ï¼é”™è¯¯ä»£ç æ˜¯%d\\n\u0026quot;, WSAGetLastError()); //windowsè·å–erron return -1; } } else { //å¯¹httpè¿”å›å€¼è¿›è¡Œå¤„ç† // printf(\u0026quot;flaskè¿”å›å€¼%s\\n\u0026quot;, buf); // continue; // break; } } closesocket(sockfd_flask); return 0; } flaskæ¥æ”¶ç¤ºä¾‹ # flaskåç«¯æµ‹è¯•ç”¨ @app.route('/getsometing', methods=['GET']) def gettest(): type = request.args.get('type') src = request.args.get('src') dst = request.args.get('dst') print(f\u0026quot;get data: type={type},src={src},dst={dst}\u0026quot;) return f\u0026quot;\u0026lt;html\u0026gt;\u0026lt;body\u0026gt;get return: type={type},src={src},dst={dst}\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026quot; @app.route('/postsometing', methods=['POST']) def posttest(): type = request.form['type'] src = request.form['src'] dst = request.form['dst'] print(f\u0026quot;post data: type={type},src={src},dst={dst}\u0026quot;) return f\u0026quot;\u0026lt;html\u0026gt;\u0026lt;body\u0026gt;post return: type={type},src={src},dst={dst}\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026quot; å¦‚æœæ•°æ®é‡æ¯”è¾ƒå¤§å¯ä»¥è¿™æ ·å†™\n@app.route('/getsometing', methods=['GET']) def gettest(): get_data=request.args.to_dict() type = get_data['type'] cur_time=time.strftime(\u0026quot;%Y-%m-%d %H:%M:%S\u0026quot;, time.localtime()) if type == 'Start' : #è‡ªå·±å®šä¹‰çš„å‘é€æ•°æ®çš„type pass elif type == 'Accomplish' : pass elif type == 'change' : pass else : print (\u0026quot;æ¥æ”¶åˆ°æ— æ•ˆæ•°æ®ï¼Œå°†å…¶ä¸¢å¼ƒ\u0026quot;) with open(\u0026quot;log.txt\u0026quot;, \u0026quot;a+\u0026quot;) as f: f.write('\\n# ' + cur_time + ' ---------- get errorï¼š\\n' + json.dumps(get_data)) return \u0026quot;\u0026lt;html\u0026gt;\u0026lt;body\u0026gt; Flask access invalid data \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026quot; return \u0026quot;\u0026lt;html\u0026gt;\u0026lt;body\u0026gt; data access \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026quot; @app.route('/postsometing', methods=['POST']) def posttest(): post_data = request.form.to_dict() print (post_data) type = post_data['type'] cur_time=time.strftime(\u0026quot;%Y-%m-%d %H:%M:%S\u0026quot;, time.localtime()) if type == \u0026quot;change\u0026quot;: pass else : print (\u0026quot;æ¥æ”¶åˆ°æ— æ•ˆæ•°æ®ï¼Œå°†å…¶ä¸¢å¼ƒ\u0026quot;) with open(\u0026quot;log.txt\u0026quot;, \u0026quot;a+\u0026quot;) as f: f.write('\\n# ' + cur_time + ' ---------- post errorï¼š\\n' + json.dumps(post_data)) return \u0026quot;\u0026lt;html\u0026gt;\u0026lt;body\u0026gt; Flask access invalid data \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026quot; return \u0026quot;\u0026lt;html\u0026gt;\u0026lt;body\u0026gt; data access \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\u0026quot; ","id":36,"section":"posts","summary":"èƒŒæ™¯ æˆ‘ç›®å‰éœ€è¦è§£å†³ä¸€ä¸ªéœ€æ±‚ï¼Œå°†ä¸€ä¸ªcå·¥ç¨‹ä¸­çš„ç‰¹å®šæ•°æ®è½¬å‘åˆ°VUEå‰ç«¯æ¡†æ¶ä¸Šåšç•Œé¢å±•ç¤ºï¼Œä¸”è¯¥æ¡†æ¶å·²ç»æœ‰åç«¯ä¸ºflaskæ¡†æ¶ã€‚ æ‰€ä»¥å¾—è€ƒè™‘å¦‚ä½•å°†c","tags":["C/C++"],"title":"Cè¯­è¨€å®ç°çš„httpè¯·æ±‚","uri":"https://liangkang233.github.io/2021/06/c%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0http%E8%AF%B7%E6%B1%82/","year":"2021"},{"content":"æ€è·¯ pythonçš„ç‰¹æ€§æ”¯æŒå¿«é€Ÿå¼€å‘å®ç”¨å°ç¨‹åºçš„èƒ½åŠ›ï¼Œèƒ½è®©ä½ åšäº‹æ•ˆç‡å¤§å¹…åº¦æé«˜ã€‚ç‰¹åˆ«æ˜¯åœ¨c++æ•°æ®æµ‹è¯•ä¸­ï¼Œæ£€éªŒä¸€ä¸ªç¨‹åºçš„å¯é æ€§éœ€è¦å¤§é‡æ•°æ®è¿›è¡Œæµ‹è¯•å¯é æ€§ã€‚è™½ç„¶c++ä¹Ÿæœ‰éšæœºå‡½æ•°ç­‰æ–¹æ³•ä½†æ˜¯ä¸æ–¹ä¾¿ç§»æ¤æ›´æ”¹ï¼Œç”¨Pythonç¼–å†™æ•°æ®ç”Ÿæˆå™¨æ˜¯å†åˆé€‚ä¸è¿‡çš„äº†ã€‚æ¥ä¸‹æ¥è¿›è¡Œä¸¾ä¾‹è¯´æ˜ï¼šä¸‹é¢çš„ä»£ç ç›´æ¥åœ¨python3ç»ˆç«¯ä¸­è¿è¡Œï¼Œç”Ÿæˆä¸€ä¸ªé•¿åº¦åœ¨4 ~9ä¹‹é—´ï¼Œ æ°å¥½åŒ…å«ä¸€ä¸ªå¤§å†™å­—æ¯ï¼Œ å…¶ä»–å­—ç¬¦ä¸ºå°å†™å­—æ¯çš„ç‰¹æ®Šä¸²ã€‚\n\u0026gt;\u0026gt;\u0026gt; from random import* \u0026gt;\u0026gt;\u0026gt; from string import* \u0026gt;\u0026gt;\u0026gt; L = randint(4, 9) \u0026gt;\u0026gt;\u0026gt; s =''.join([choice(ascii_lowercase) for i in range(L)]) \u0026gt;\u0026gt;\u0026gt; p = randint(0, len(s)) \u0026gt;\u0026gt;\u0026gt; s[:p] + choice(ascii_uppercase) + s[p:] ' bdsqVgke' åˆ—è¡¨è§£æClist comprehension) æ˜¯ä¸€ç§æ„é€ åˆ—è¡¨çš„ç®€å•æ–¹æ³•ã€‚range(5) ç”Ÿæˆåˆ—è¡¨[0,1,2,3,4]ã€‚è¿™æ¡è¯­å¥å°±æ˜¯ â€œå¯¹äºåˆ—è¡¨[0,1,2,3,4]ä¸­çš„æ¯ä¸ªæ•°iè°ƒç”¨ä¸€æ¬¡ choice(lowercase)ï¼ŒæŠŠç»“æœæ‹¼æˆä¸€ä¸ªåˆ—è¡¨â€ ã€‚æ¥ä¸‹æ¥ç”¨joinå‡½æ•°æŠŠåˆ—è¡¨é‡Œçš„å­—ç¬¦ä¸²è¿æ¥èµ·æ¥ã€‚ .join(L)çš„ä½œç”¨æ˜¯æŠŠå­—ç¬¦ä¸²åˆ—è¡¨Lä¸­çš„å„ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥ã€‚ æœ€åéšæœºå‡ºå°å†™å­—ç¬¦å‡ºç°çš„ä½ç½®p, ç„¶åæ’å…¥åˆ°å¤§å†™å­—æ¯ä¸²ä¸­ã€‚s[a:b]ä»£è¡¨åˆ—è¡¨æˆ–è€…å­—ç¬¦ä¸²çš„ç¬¬aä¸ªå…ƒç´ åˆ°ç¬¬b-1 ä¸ªå…ƒç´ ã€‚aå’Œbéƒ½å¯ä»¥çœç•¥ï¼Œaé»˜è®¤ä¸º0, bé»˜è®¤ä¸ºåˆ—è¡¨é•¿åº¦ã€‚L2 = L[:ï¼½çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªå’ŒL ä¸€æ ·çš„æ•°ç»„ã€‚ ç”±äºPython çš„æ‰€æœ‰å€¼éƒ½æ˜¯å¼•ç”¨ç±»å‹çš„ï¼Œ å› æ­¤L2=Låªæ˜¯æŠŠLä¸­ä¿å­˜çš„å¼•ç”¨æ‹·è´ï¼ˆæµ…æ‹·è´ï¼‰åˆ°äº†L2ï¼Œè¿™ç‚¹éœ€è¦å°å¿ƒã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼Œæ±‚å…¶åœ°å€idå¯ä»¥åˆ†æå‡ºæ¥ã€‚\n\u0026gt;\u0026gt;\u0026gt; a,b=1,2 \u0026gt;\u0026gt;\u0026gt; a= [1,3,7] \u0026gt;\u0026gt;\u0026gt; b=[1,3,7] \u0026gt;\u0026gt;\u0026gt; c,d=a,a[:] \u0026gt;\u0026gt;\u0026gt; id (a), id (b), id (c), id (d) (12598008, 12517288, 12598008, 12517208) è®¡ç®— 30!å¯ä»¥é‡‡ç”¨å¦‚ä¸‹å†™æ³•:\n\u0026gt;\u0026gt;\u0026gt; from functools import* \u0026gt;\u0026gt;\u0026gt; reduce(lambda x,y: x*y, range(1,31)) 265252859812191058636308480000000L ç®€å•å®ç° ç±»ä¼¼çš„ä¸œè¥¿è¿˜æœ‰å¾ˆå¤šã€‚ ä½¿ç”¨Pythonåï¼Œ èƒ½å¤§å¤§ç¼©çŸ­ç¼–å†™æ•°æ®ç”Ÿæˆå™¨ã€å¯¹æ‹å™¨ã€ â€œçŒœæƒ³éªŒè¯å™¨â€ ç­‰å°ç¨‹åºçš„æ—¶é—´ï¼Œè¿™é‡Œæˆ‘æ‰“ç®—æŠŠpythonç”Ÿæˆçš„æ•°æ®å…¨éƒ¨è½¬ä¸ºå­—ç¬¦æ•°æ®å­˜å…¥æ–‡æœ¬ä¸­(è½¬å­—ç¬¦æ•°æ®å°±ä¸ç”¨è€ƒè™‘intä½æ•° æµ®ç‚¹æ•°ç²¾åº¦ç­‰é—®é¢˜)ã€‚c++å†è¯»æ•°æ®å­˜å…¥å®¹å™¨è¿›è¡ŒåŸæœ¬å‡½æ•°çš„æµ‹è¯•ã€‚\npythonç”Ÿæˆæ•°æ®ä»£ç  æ¥ä¸‹æ¥çš„ä»£ç ä¸ºè¿›è¡Œæµ‹è¯•å†™å…¥æ–‡ä»¶çš„ä»£ç ï¼Œä½œä¸ºå‚è€ƒï¼š\n# !/usr/bin/env python3 # coding: utf-8 from random import * from string import * def create_element0(lines, a = 4, b = 7): elements = [] for i in range(lines): # ascii_lowercaseåœ¨stringä¸­å®šä¹‰ï¼Œä¸ºæ‰€æœ‰å°å†™å­—ç¬¦çš„åˆ—è¡¨ # choice(seq): è¿”å›åˆ—è¡¨ã€å…ƒç»„æˆ–å­—ç¬¦ä¸²seqçš„éšæœºé¡¹strã€‚ï¼ˆå¯é‡å¤ï¼‰ L = randint(a, b) s =''.join([choice(ascii_lowercase) for i in range(L)]) p = randint(0, len(s)) element = s[:p] + choice(ascii_uppercase) + s[p:] + '\\n' elements.append(element) return elements def create_element1(lines): elements = [] for i in range(lines): # sample: ä¸é‡å¤çš„å–åˆ—è¡¨ä¸­iä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¿™äº›å…ƒç´ ç»„æˆçš„åˆ—è¡¨ # ä¸å¯åƒchoiceä¸­åˆ—è¡¨æ·»åŠ for inï¼Œå› ä¸ºå…¶è¿”å›çš„æ˜¯åˆ—è¡¨ # è¦ç”Ÿæˆmä¸ªä¸é‡å¤iå…ƒç´ åˆ—è¡¨å¾—åœ¨å¤–é¢åŠ å¾ªç¯ username = ''.join(sample(ascii_letters + digits, 5)) password = randint(10000,99999) element= str(username) + \u0026quot;,\u0026quot; + str(password) + '\\n' elements.append(element) return elements def create_element2(lines): elements = [] allNum = list(range(-10000, 10000)) NumLen = len(allNum) #åœ¨allNumä¸­æŠ½å–Lenä¸ªä¸é‡å¤æ•°å­—,æœ€åä¾ç…§é¢˜æ„æ’åºï¼Œæ—‹è½¬ã€‚å…±linesç»„ for i in range(lines): s = [] num = randint(1, 256) for j in range(num) : index = randint(j, NumLen - 1) s.append(allNum[index]) # æŠŠç”¨è¿‡çš„å…ƒç´ åˆ°å‰é¢,ä»¥é˜²å†æ¬¡é€‰ä¸­ allNum[index], allNum[i] = allNum[i], allNum[index] # æ¨¡æ‹Ÿtargetæ˜¯å¦å­˜åœ¨ï¼Œæœ‰1/36çš„å‡ ç‡å¿…å®šä¸å­˜åœ¨ suiji = randint(0,35) if suiji == 35: target = 10001 else : target = s[randint(0, num-1)] #æ’åºå–å‡ºçš„ä¸é‡å¤æ•°ç»„å¹¶æ—‹è½¬ s.sort() k = randint(0, num-1) if k != 0 : s = list(reversed(s[0:k])) + list(reversed(s[k:num])) s.reverse() element = ' '.join([str(s[i]) for i in range(num)]) + '\\n' elements.append(element) elements.append(str(target) + '\\n') print(f\u0026quot;i = {i},\\t k = {k}, \\ttarget = {target}\u0026quot;) return elements C++è¯»å–æ–‡ä»¶ä»£ç  C++ä¸­å„ç§æµå¤´æ–‡ä»¶è¯´æ˜ iostreamå¤„ç†æ§åˆ¶å°IOï¼› fstreamå¤„ç†å‘½åæ–‡ä»¶IOï¼› stringstreamå®Œæˆå†…å­˜stringçš„IOã€‚ ç±»fstreamå’Œstringstreaméƒ½æ˜¯ç»§æ‰¿åœ¨ç±»iostreamçš„ã€‚ è¾“å…¥ç±»éƒ½ç»§æ‰¿è‡ªistreamï¼Œè¾“å‡ºç±»éƒ½ç»§æ‰¿è‡ªostreamã€‚ stringæµï¼šsstreamå¤´æ–‡ä»¶å®šä¹‰äº†ä¸‰ä¸ªç±»å‹æ¥æ”¯æŒå†…å­˜IOï¼Œ è¿™äº›ç±»å‹å¯ä»¥å‘stringå†™å…¥æ•°æ®ï¼Œä»stringè¯»å–æ•°æ®ï¼Œå°±åƒstringæ˜¯ä¸€ä¸ªIOæµä¸€æ ·ã€‚ å°†æ‰€æœ‰è¡Œæ•°æ®æ‰“å°å‡ºï¼š è¯¥ä»£ç ä»…ä¸ºè¯»å–æ•°æ®å¹¶è½½å…¥å®¹å™¨ä¸­ä½œä¸ºæ¨¡æ¿ä½¿ç”¨ï¼Œè‹¥è¦åŠ å…¥åˆ¤æ–­æ­£ç¡®ç­‰åŠŸèƒ½å¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ·»åŠ \n// å¯¼å…¥æ–‡æœ¬è‡³å®¹å™¨ï¼Œå°†æ¯ä¸€è¡Œçš„æ•°æ®ä»¥ç©ºæ ¼ä¸ºé—´éš”è¾“å…¥ä¸€ä¸ªå­—ç¬¦å®¹å™¨ï¼Œå°†æ‰€æœ‰è¡Œçš„æ•°æ®è¾“å…¥ int main() { string temp; ifstream myfile(\u0026quot;./date.txt\u0026quot;); if( !myfile ) { cout \u0026lt;\u0026lt; \u0026quot;open file fail!\u0026quot; \u0026lt;\u0026lt; endl; return -1; } vector\u0026lt;string\u0026gt; res; while (getline(myfile, temp)) {\t//é»˜è®¤åœæ­¢ç¬¦\\n stringstream slices(temp); string slice; while (slices \u0026gt;\u0026gt; slice) {\t// ç±»ä¼¼cinè¾“å…¥ï¼Œå°†æ¯è¡Œæ’é™¤ä¸å¯æ˜¾å­—ç¬¦ ç©ºæ ¼ç­‰å­—ç¬¦è¾“å…¥å®¹å™¨ï¼Œç›´åˆ°æ¥æ”¶å›è½¦ä¸ºæ­¢ res.push_back(slice); // stoi(int), stol(long), stof(float), stod(double) } // for( auto r : res) //\tcout \u0026lt;\u0026lt; r \u0026lt;\u0026lt; endl; res.clear(); } myfile.close(); return 0; } å®é™…æµ‹è¯•æ¡ˆä¾‹ ä¸Šè¿°æµ‹è¯•ç¡®å®šæ— é—®é¢˜åï¼Œå¼€å§‹å®é™…åšpythonæ•°æ®å¯¼å…¥c++ä¸­åšæµ‹è¯•ï¼š å…¶ä¸­c++ä»£ç ä¸ºleetcodeé¢˜ç›®æœç´¢æ—‹è½¬æ’åºæ•°ç»„ pythonç”Ÿæˆæ•°æ®å‡½æ•°å³ä¸ºä¸Šè¿°ä»£ç çš„create_element2ç”¨äºæµ‹è¯•åˆ¤æ–­c++ä»£ç æ˜¯å¦æ­£ç¡® æ¥ä¸‹æ¥æ˜¯c++çš„è¯»å–æ–‡ä»¶å¹¶è¿›è¡Œè°ƒç”¨ã€‚\n#include \u0026lt;iostream\u0026gt; #include \u0026lt;vector\u0026gt; #include \u0026lt;string\u0026gt; #include \u0026lt;sstream\u0026gt; #include \u0026lt;fstream\u0026gt; using namespace std; // è‡ªå·±å†™çš„è·Ÿå®˜æ–¹çš„æ€è·¯å·®ä¸å¤šï¼Œå®˜æ–¹ç­”æ¡ˆä¸ç”¨å…ˆæ‰¾åˆ°æœ€å¤§ä¸´ç•Œå€¼å†äºŒåˆ† ç›´æ¥è¿›è¡Œåˆ¤æ–­äºŒåˆ† // ä¸‹é¢ä¸ºå®˜æ–¹ç­”æ¡ˆï¼Œæ³¨æ„ è¾¹ç•Œ ç­‰äº é—®é¢˜ class Solution { public: int search(vector\u0026lt;int\u0026gt;\u0026amp; nums, int target) { int n = (int)nums.size(); if (!n) return -1; else if (n == 1) return nums[0] == target ? 0 : -1; int l = 0, r = n - 1; while (l \u0026lt;= r) { int mid = (l + r) / 2; if (nums[mid] == target) return mid; // targetåˆ¤æ–­æ˜¯å¦ä¸ºmid if (nums[0] \u0026lt;= nums[mid]) { // è¯´æ˜0åˆ°midæ˜¯å‡åº if (nums[0] \u0026lt;= target \u0026amp;\u0026amp; target \u0026lt; nums[mid]) // targetåœ¨è¯¥å‡åºä¸­ r = mid - 1; else l = mid + 1; } else { // è¯´æ˜midåˆ°n-1æ˜¯å‡åº if (nums[mid] \u0026lt; target \u0026amp;\u0026amp; target \u0026lt;= nums[n - 1]) // targetåœ¨è¯¥å‡åºä¸­ l = mid + 1; else r = mid - 1; } } return -1; } }; // å¯¼å…¥æ–‡æœ¬è‡³å®¹å™¨æµ‹è¯•ï¼Œå°†æ¯ä¸€è¡Œçš„æ•°æ®ä»¥ç©ºæ ¼ä¸ºé—´éš”è¾“å…¥ä¸€ä¸ªå­—ç¬¦å®¹å™¨ï¼Œå°†æ‰€æœ‰è¡Œçš„æ•°æ®è¾“å…¥ int main() { string temp; ifstream myfile(\u0026quot;./date.txt\u0026quot;); if( !myfile ) { cout \u0026lt;\u0026lt; \u0026quot;open file fail!\u0026quot; \u0026lt;\u0026lt; endl; return -1; } vector\u0026lt;vector\u0026lt;int\u0026gt;\u0026gt; ress; vector\u0026lt;int\u0026gt; res; vector\u0026lt;int\u0026gt; targets; while (getline(myfile, temp)) {\t//é»˜è®¤åœæ­¢ç¬¦\\n stringstream slices(temp); string slice; while (slices \u0026gt;\u0026gt; slice) {\t// ç±»ä¼¼cinè¾“å…¥ï¼Œå°†æ¯è¡Œæ’é™¤ä¸å¯æ˜¾å­—ç¬¦ ç©ºæ ¼ç­‰å­—ç¬¦è¾“å…¥å®¹å™¨ï¼Œç›´åˆ°æ¥æ”¶å›è½¦ä¸ºæ­¢ res.push_back(stoi(slice)); // stoi(int), stol(long), stof(float), stod(double) } getline(myfile, temp); targets.push_back(stoi(temp)); // for( auto rio : res) // cout \u0026lt;\u0026lt; rio \u0026lt;\u0026lt; endl; ress.push_back(res); res.clear(); } myfile.close(); Solution su; for (int i = 0; i \u0026lt; ress.size(); i++) { int ans = su.search(ress[i], targets[i]); cout \u0026lt;\u0026lt; targets[i] \u0026lt;\u0026lt; ' ' \u0026lt;\u0026lt; ans \u0026lt;\u0026lt;endl; } return 0; } ","id":37,"section":"posts","summary":"æ€è·¯ pythonçš„ç‰¹æ€§æ”¯æŒå¿«é€Ÿå¼€å‘å®ç”¨å°ç¨‹åºçš„èƒ½åŠ›ï¼Œèƒ½è®©ä½ åšäº‹æ•ˆç‡å¤§å¹…åº¦æé«˜ã€‚ç‰¹åˆ«æ˜¯åœ¨c++æ•°æ®æµ‹è¯•ä¸­ï¼Œæ£€éªŒä¸€ä¸ªç¨‹åºçš„å¯é æ€§éœ€è¦å¤§é‡æ•°æ®è¿›è¡Œ","tags":["python","C/C++"],"title":"Pythonéšæœºæ•°æ®ç”Ÿæˆ","uri":"https://liangkang233.github.io/2021/05/python%E9%9A%8F%E6%9C%BA%E6%95%B0%E6%8D%AE%E7%94%9F%E6%88%90/","year":"2021"},{"content":"æœ¬äººä¹ æƒ¯ä½¿ç”¨onenoteè®°å½•ä¸€äº›é—®é¢˜å’Œåšè®°å½•ï¼Œæœ€è¿‘å‘ç°å¼€å¯æœ¬åœ°httpä»£ç†æœåŠ¡å™¨åonenoteæ— æ³•åŒæ­¥ï¼Œä½†æ˜¯æˆ‘ä»£ç†é…ç½®æ˜¯æ— è¯¯çš„ã€‚ç»è¿‡æŸ¥è¯¢å‘ç°è¿™ä¸ªæ˜¯uwpåº”ç”¨çš„ç‰¹æ€§ï¼š\nUWP æ˜¯å¾®è½¯åœ¨ Windows 10 ä¸­å¼•å…¥çš„æ–°æ¦‚å¿µï¼Œç”±äºæ‰€æœ‰ UWP åº”ç”¨å‡è¿è¡Œåœ¨è¢«ç§°ä¸º App Container çš„è™šæ‹Ÿæ²™ç®±ç¯å¢ƒä¸­ï¼Œå…¶å®‰å…¨æ€§åŠçº¯å‡€åº¦è¿œèƒœäºä¼ ç»Ÿçš„ EXE åº”ç”¨ã€‚ä½† App Container æœºåˆ¶åŒæ—¶ä¹Ÿé˜»æ­¢äº†ç½‘ç»œæµé‡å‘é€åˆ°æœ¬æœºï¼ˆå³ loopbackï¼‰ï¼Œ ä½¿å¤§éƒ¨åˆ†ç½‘ç»œæŠ“åŒ…è°ƒè¯•å·¥å…·æ— æ³•å¯¹ UWP åº”ç”¨è¿›è¡Œæµé‡åˆ†æã€‚åŒæ ·çš„ï¼Œè¯¥æœºåˆ¶ä¹Ÿé˜»æ­¢äº† UWP åº”ç”¨è®¿é—® localhostï¼Œå³ä½¿ä½ åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å¯ç”¨äº†ä»£ç†ï¼Œä¹Ÿæ— æ³•ä»¤ UWP åº”ç”¨è®¿é—®æœ¬åœ°ä»£ç†æœåŠ¡å™¨ã€‚\næ‰€ä»¥åªè¦è®¾ç½®uwpåº”ç”¨å¯ä»¥è®¿é—®æœ¬åœ°ä»£ç†æœåŠ¡å™¨å°±èƒ½è§£å†³é—®é¢˜äº†ã€‚\nè§£å†³æ–¹æ³•ï¼š å‚è€ƒå®˜æ–¹ç»™çš„è§£å†³æ–¹æ¡ˆ è¦è§£å†³æ­¤é—®é¢˜ï¼Œæ‚¨éœ€è¦ä½¿ç”¨PowerShellå‘½ä»¤å°†æœ‰å…³åº”ç”¨æ·»åŠ åˆ° Windows 10 å›è·¯è±å…åˆ—è¡¨ã€‚ å°†å¸¦æœ‰\u0026quot;Microsoft.MinecraftUWP_8wekyb3d8bbwe\u0026quot;çš„åŒ…åçš„åº”ç”¨ç¨‹åºæ·»åŠ åˆ°å¾ªç¯å›è·¯è±å…åˆ—è¡¨ä¸­ã€‚ è¦æŸ¥æ‰¾åŒ…åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹powershellå‘½ä»¤ï¼š\nGet-AppxPackage #åˆ—å‡ºæ‰€æœ‰uwpåº”ç”¨ç¨‹åºã€‚ Get-AppxPackage | Select-String -Pattern \u0026quot;Minecraft\u0026quot; #åˆ—å‡ºæ‰€æœ‰åå­—ä¸­å«æœ‰â€œMinecraftâ€çš„åº”ç”¨ç¨‹åºã€‚ CheckNetIsolation LoopbackExempt -d -n=\u0026quot;Microsoft.MinecraftUWP_8wekyb3d8bbwe\u0026quot; # ä½¿ç”¨ç¨‹åºåå­—ä»è±å…åˆ—è¡¨ä¸­å‰”é™¤è¯¥ç¨‹åº CheckNetIsolation LoopbackExempt -d -p=\u0026quot;sidç¼–å·\u0026quot; # ä½¿ç”¨ç¨‹åºsidä»è±å…åˆ—è¡¨ä¸­å‰”é™¤è¯¥ç¨‹åº CheckNetIsolation LoopbackExempt -s #å±•ç¤ºè±å…åˆ—è¡¨ CheckNetIsolation LoopbackExempt -c #æ¸…é™¤è±å…åˆ—è¡¨ æ³•1 æŸ¥è¯¢æ³¨å†Œè¡¨sid ä¸¾ä¾‹ï¼š\nGet-AppxPackage | Select-String -Pattern \u0026quot;onenote\u0026quot;\t#æŸ¥æ‰¾onenoteåŒ…åç§° #æŸ¥è¯¢åˆ°onenote åŒ…åä¸º Microsoft.Office.OneNote_16001.13801.20202.0_x64__8wekyb3d8bbwe CheckNetIsolation LoopbackExempt -a -n=\u0026quot;Microsoft.Office.OneNote_16001.13801.20202.0_x64__8wekyb3d8bbwe\u0026quot; #æ·»åŠ è‡³è±å…åˆ—è¡¨ CheckNetIsolation LoopbackExempt -d -n=\u0026quot;Microsoft.Office.OneNote_16001.13801.20202.0_x64__8wekyb3d8bbwe\u0026quot; #ä»è±å…åˆ—è¡¨ä¸­ç§»é™¤ æ³•2 æ³¨å†Œè¡¨æŸ¥è¯¢ç¨‹åºåŒ…å win+r è¾“å…¥regeditï¼Œæ‰“å¼€æ³¨å†Œè¡¨ç¼–è¾‘å™¨ï¼Œåœ°å€æ ç²˜è´´ HKEY_CURRENT_USER\\Software\\Classes\\Local Settings\\Software\\Microsoft\\Windows\\CurrentVersion\\AppContainer\\Mappingsï¼Œé‡Œé¢çš„DisplayNameå€¼å°±æ˜¯åº”ç”¨åç§°ï¼ŒæŸ¥è¯¢å¯¹åº”ç¨‹åºçš„sidç±»ä¼¼S-1-15-2-3445883232-1224167743-206467785-1580939083-2750001491-3097792036-3019341970å½¢å¼\nCheckNetIsolation.exe loopbackexempt -a -p=UWPçš„SID CheckNetIsolation.exe loopbackexempt -d -p=UWPçš„SID #ä¸¾ä¾‹ï¼šè±å…onenoteèµ°ä»£ç† CheckNetIsolation.exe loopbackexempt -a -p=S-1-15-2-3445883232-1224167743-206467785-1580939083-2750001491-3097792036-3019341970 onenoteé—®é¢˜ å¯æƒœçš„æ˜¯ï¼Œæ³•1å¯¹MinecraftUWPæœ‰æ•ˆï¼Œå¯¹onenoteå¤±æ•ˆã€‚å¯èƒ½æ˜¯å…¶åŒ…åä¸å¯¹ï¼Œè¯¥åŒ…åæŒ‡å‘çš„æ˜¯officeå¥—ä»¶ä¸­çš„onenoteã€‚æ‰“å°å¦‚ä¸‹çš„è±å…è¡¨å¯çŸ¥ï¼Œæ³•äºŒç”Ÿæˆçš„è±å…è¡¨æ˜¯ç”Ÿæ•ˆçš„ æ³•2ç”Ÿæˆ\nåˆ—å‡ºç¯å›å…é™¤çš„ AppContainer [1] ----------------------------------------------------------------- åç§°: microsoft.office.onenote_8wekyb3d8bbwe SID: S-1-15-2-3445883232-1224167743-206467785-1580939083-2750001491-3097792036-3019341970 [2] ----------------------------------------------------------------- åç§°: AppContainer NOT FOUND SID: S-1-15-2-3624051433-2125758914-1423191267-1740899205-1073925389-3782572162-737981194-4043415302-551583165-304772019-4009825106 [3] ----------------------------------------------------------------- åç§°: 001 SID: S-1-15-2-3624051433-2125758914-1423191267-1740899205-1073925389-3782572162-737981194-4256926629-1688279915-2739229046-3928706915 æ³•1ç”Ÿæˆ\nåˆ—å‡ºç¯å›å…é™¤çš„ AppContainer [1] ----------------------------------------------------------------- åç§°: AppContainer NOT FOUND SID: S-1-15-2-883788003-1897955942-3642183005-638760255-2249287259-3707616651-3249579104 [2] ----------------------------------------------------------------- åç§°: AppContainer NOT FOUND SID: S-1-15-2-3624051433-2125758914-1423191267-1740899205-1073925389-3782572162-737981194-4043415302-551583165-304772019-4009825106 [3] ----------------------------------------------------------------- åç§°: 001 SID: S-1-15-2-3624051433-2125758914-1423191267-1740899205-1073925389-3782572162-737981194-4256926629-1688279915-2739229046-3928706915 ","id":38,"section":"posts","summary":"æœ¬äººä¹ æƒ¯ä½¿ç”¨onenoteè®°å½•ä¸€äº›é—®é¢˜å’Œåšè®°å½•ï¼Œæœ€è¿‘å‘ç°å¼€å¯æœ¬åœ°httpä»£ç†æœåŠ¡å™¨åonenoteæ— æ³•åŒæ­¥ï¼Œä½†æ˜¯æˆ‘ä»£ç†é…ç½®æ˜¯æ— è¯¯çš„ã€‚ç»è¿‡æŸ¥è¯¢","tags":[],"title":"uwpåº”ç”¨ä»£ç†","uri":"https://liangkang233.github.io/2021/04/uwp%E5%BA%94%E7%94%A8%E4%BB%A3%E7%90%86/","year":"2021"},{"content":"åŠŸèƒ½ ä¹‹å‰æƒ³è·å¾—ä¸€æ®µæœºå™¨é…éŸ³æ—¶ï¼Œæ€»æ˜¯ä¸€å¥ä¸€å¥ç²˜è´´åœ¨ç¿»è¯‘è½¯ä»¶ä¸Šè¯»å–ï¼Œéå¸¸éº»çƒ¦ã€‚ åæ¥çŸ¥é“ç™¾åº¦AIæä¾›äº†å…è´¹çš„è¯­éŸ³åˆæˆapiï¼Œæ‰€ä»¥ç®€å•åˆ†äº«ä¸‹ä½¿ç”¨æ–¹æ³•ã€‚\nä½¿ç”¨è¯´æ˜ ç™¾åº¦æ™ºèƒ½äº‘è¯­éŸ³è¯†åˆ«\né¦–å…ˆæ‰“å¼€ä¸Šè¿°ç½‘å€ç‚¹å‡»ç«‹å³å¼€å§‹æ³¨å†Œæˆ–ç™»å½•è´¦å·\nåˆ›å»ºä¸€ä¸ªåº”ç”¨å¹¶æŒ‰ç…§ä½ çš„éœ€æ±‚æ³¨å†Œï¼Œå½“ç„¶ä¸åªæ˜¯è¯­éŸ³è¯†åˆ«è¿˜æœ‰å…¶ä»–ç±»ä¼¼äººè„¸è¯†åˆ«å›¾åƒå¤„ç†ç­‰æ¥å£ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æ˜¯è¦æ”¶è´¹çš„ã€‚å…·ä½“å…¶ä»–ä¸šåŠ¡å¯ä»¥çœ‹çœ‹å®˜æ–¹æŒ‡å—\nè¿™äº›æˆ‘ä»¬å¯ä»¥ä¸ç®¡ï¼Œåªéœ€è¦æ³¨å†Œè¯­éŸ³è¯†åˆ«åº”ç”¨ï¼Œæ–‡æœ¬è½¬è¯­éŸ³ä¸šåŠ¡åŒ…å«åœ¨å…¶ä¸­ã€‚æ³¨å†Œå¥½å¯ä»¥å¦‚ä¸‹å›¾é¢†å–å…è´¹é¢åº¦ã€‚ æœ€åé…ç½®å®Œæˆåï¼Œä¸‹è½½pythonçš„sdkæ¥å®‰è£…,ä½¿ç”¨python setup.py install\nå…¶ä»–ç»„ä»¶ æ‰€æœ‰ç»„ä»¶githubåœ°å€: ç™¾åº¦AI python sdkåœ°å€. å…¶å®ƒåŠŸèƒ½ä¹Ÿå¯ç±»ä¼¼è°ƒç”¨æ¥å£å®ç°ï¼Œè¿™é‡Œåªæ˜¯ç®€å•ä½¿ç”¨è¯­éŸ³è¯†åˆ«çš„æ–‡æœ¬è¯­éŸ³è½¬æ¢åŠŸèƒ½ã€‚\næ–‡æœ¬è½¬è¯­éŸ³æµ‹è¯• å‚è€ƒäº†å®˜æ–¹çš„æµ‹è¯•æ¡ˆä¾‹ç¼–å†™äº†ä¸‹é¢çš„ä»£ç ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è¯•è¯•å…¶ä»–apiçš„è°ƒç”¨ï¼Œæ­¤ä»£ç python2 3çš†å¯ä½¿ç”¨ã€‚\n# coding: utf-8 # é€è¡Œè¯»å…¥source/test.txtæ–‡ä»¶ï¼Œå¹¶åˆ›å»ºaudio1.mp3 audio2.mp3 audio3.mp3å­˜å…¥sourceæ–‡ä»¶å¤¹ä¸­ ...... import sys import json IS_PY3 = sys.version_info.major == 3 if IS_PY3: from urllib.request import urlopen from urllib.request import Request from urllib.error import URLError from urllib.parse import urlencode from urllib.parse import quote_plus else: import urllib2 from urllib import quote_plus from urllib2 import urlopen from urllib2 import Request from urllib2 import URLError from urllib import urlencode API_KEY = 'æ­¤å¤„æ›¿æ¢ä¸ºä½ åº”ç”¨çš„API_KEY ' SECRET_KEY = 'æ­¤å¤„æ›¿æ¢ä¸ºä½ åº”ç”¨çš„SECRET_KEY' TEXT = \u0026quot;æ¬¢è¿ä½¿ç”¨ç™¾åº¦è¯­éŸ³åˆæˆã€‚\u0026quot; # å‘éŸ³äººé€‰æ‹©ï¼Œé»˜è®¤ä¸ºåº¦å°ç¾ # åŸºç¡€éŸ³åº“ï¼š0ä¸ºåº¦å°ç¾ï¼Œ1ä¸ºåº¦å°å®‡ï¼Œ3ä¸ºåº¦é€é¥ï¼Œ4ä¸ºåº¦ä¸«ä¸«ï¼Œ # ç²¾å“éŸ³åº“ï¼š5ä¸ºåº¦å°å¨‡ï¼Œ103ä¸ºåº¦ç±³æœµï¼Œ106ä¸ºåº¦åšæ–‡ï¼Œ110ä¸ºåº¦å°ç«¥ï¼Œ111ä¸ºåº¦å°èŒ PER = 3 # è¯­é€Ÿï¼Œå–å€¼0-15ï¼Œé»˜è®¤ä¸º5ä¸­è¯­é€Ÿ SPD = 6 # éŸ³è°ƒï¼Œå–å€¼0-15ï¼Œé»˜è®¤ä¸º5ä¸­è¯­è°ƒ PIT = 5 # éŸ³é‡ï¼Œå–å€¼0-9ï¼Œé»˜è®¤ä¸º5ä¸­éŸ³é‡ VOL = 7 # ä¸‹è½½çš„æ–‡ä»¶æ ¼å¼, 3ï¼šmp3(default) 4ï¼š pcm-16k 5ï¼š pcm-8k 6. wav AUE = 3 FORMATS = {3: \u0026quot;.mp3\u0026quot;, 4: \u0026quot;.pcm\u0026quot;, 5: \u0026quot;.pcm\u0026quot;, 6: \u0026quot;.wav\u0026quot;} FORMAT = FORMATS[AUE] CUID = \u0026quot;123456PYTHON\u0026quot; TTS_URL = 'http://tsn.baidu.com/text2audio' class DemoError(Exception): pass \u0026quot;\u0026quot;\u0026quot; TOKEN start \u0026quot;\u0026quot;\u0026quot; TOKEN_URL = 'http://openapi.baidu.com/oauth/2.0/token' SCOPE = 'audio_tts_post' # æœ‰æ­¤scopeè¡¨ç¤ºæœ‰ttsèƒ½åŠ›ï¼Œæ²¡æœ‰è¯·åœ¨ç½‘é¡µé‡Œå‹¾é€‰ def fetch_token(): print(\u0026quot;fetch token begin\u0026quot;) params = {'grant_type': 'client_credentials', 'client_id': API_KEY, 'client_secret': SECRET_KEY} post_data = urlencode(params) if (IS_PY3): post_data = post_data.encode('utf-8') req = Request(TOKEN_URL, post_data) try: f = urlopen(req, timeout=5) result_str = f.read() except URLError as err: print('token http response http code : ' + str(err.code)) result_str = err.read() if (IS_PY3): result_str = result_str.decode() print(result_str) result = json.loads(result_str) print(result) if ('access_token' in result.keys() and 'scope' in result.keys()): if not SCOPE in result['scope'].split(' '): raise DemoError('scope is not correct') print('SUCCESS WITH TOKEN: %s ; EXPIRES IN SECONDS: %s' % (result['access_token'], result['expires_in'])) return result['access_token'] else: raise DemoError('MAYBE API_KEY or SECRET_KEY not correct: access_token or scope not found in token response') \u0026quot;\u0026quot;\u0026quot; TOKEN end \u0026quot;\u0026quot;\u0026quot; def tts(str, id): # tex = quote_plus(TEXT) tex = quote_plus(text[i]) # æ­¤å¤„TEXTéœ€è¦ä¸¤æ¬¡urlencode print(tex) params = {'tok': token, 'tex': tex, 'per': PER, 'spd': SPD, 'pit': PIT, 'vol': VOL, 'aue': AUE, 'cuid': CUID, 'lan': 'zh', 'ctp': 1} # lan ctp å›ºå®šå‚æ•° data = urlencode(params) print('test on Web Browser' + TTS_URL + '?' + data) req = Request(TTS_URL, data.encode('utf-8')) has_error = False try: f = urlopen(req) result_str = f.read() headers = dict((name.lower(), value) for name, value in f.headers.items()) has_error = ('content-type' not in headers.keys() or headers['content-type'].find('audio/') \u0026lt; 0) except URLError as err: print('asr http response http code : ' + str(err.code)) result_str = err.read() has_error = True save_file = \u0026quot;error.txt\u0026quot; if has_error else \u0026quot;./source/result\u0026quot; + id + FORMAT #ä¸‰ç›®è¿ç®—ç¬¦ with open(save_file, 'wb') as of: of.write(result_str) if has_error: if (IS_PY3): result_str = str(result_str, 'utf-8') print(\u0026quot;tts api error:\u0026quot; + result_str) print(\u0026quot;result saved as :\u0026quot; + save_file) if __name__ == '__main__': token = fetch_token() text = [] file = open(\u0026quot;./source/test.txt\u0026quot;, 'r', encoding='UTF-8') while True: lines = file.readlines(100000) if not lines: break for line in lines: text.append(line) for i in range(len(text)): tts(text[i], str(i+1)) ","id":39,"section":"posts","summary":"åŠŸèƒ½ ä¹‹å‰æƒ³è·å¾—ä¸€æ®µæœºå™¨é…éŸ³æ—¶ï¼Œæ€»æ˜¯ä¸€å¥ä¸€å¥ç²˜è´´åœ¨ç¿»è¯‘è½¯ä»¶ä¸Šè¯»å–ï¼Œéå¸¸éº»çƒ¦ã€‚ åæ¥çŸ¥é“ç™¾åº¦AIæä¾›äº†å…è´¹çš„è¯­éŸ³åˆæˆapiï¼Œæ‰€ä»¥ç®€å•åˆ†äº«ä¸‹ä½¿ç”¨æ–¹æ³•","tags":["python"],"title":"æ‰¹é‡æ–‡å­—è½¬è¯­éŸ³ ttså·¥å…·","uri":"https://liangkang233.github.io/2021/04/%E6%89%B9%E9%87%8F%E6%96%87%E6%9C%AC%E8%BD%AC%E8%AF%AD%E9%9F%B3/","year":"2021"},{"content":"åŠŸèƒ½ ç”±äºåˆšå¥½æœ‰éœ€æ±‚è¦æ›´æ”¹é…ç½®æ–‡ä»¶å‚æ•°ï¼Œæƒ³åˆ°pythonç®€å•æ˜“ç”¨çš„ç‰¹ç‚¹ï¼Œæ‰€ä»¥è¾¹å­¦è¾¹åšäº†è¿™ä¸ªç¨‹åºå¸®åŠ©ä¿®æ”¹å‚æ•°ã€‚è¯¥ç¨‹åºåŠŸèƒ½ä¸ºè¯»å–ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡æœ¬å…¶ä¸­çš„å‚æ•°æŒ‰ç…§æŒ‡å®šæ ¼å¼ä¿®æ”¹ã€‚\nå‚è€ƒæ•™ç¨‹ æ–‡ä»¶è¯»å†™æ•™ç¨‹. æ­£åˆ™è¡¨è¾¾å¼æ•™ç¨‹. pythonçš„å¾ˆå¤šåŸºç¡€éƒ½æ˜¯åœ¨å»–é›ªå³°è€å¸ˆè¿™å­¦çš„ï¼Œå†™çš„å¾ˆè¯¦ç»†ä¸é”™ï¼Œæ‰€ä»¥åé¢çš„åˆ†æå°±ä¸è¯¦ç»†è¯´äº†ã€‚\næºç  #!/usr/bin/python3 # coding: utf-8 speed = int(input(\u0026quot;Please enter the adjustment speed: \u0026quot;)) #ä¿®æ”¹test.configæ–‡ä»¶ with open('test.config', 'r', encoding='utf-8') as o_config : lines = o_config.readlines() # readlinesè¿”å›æ¯è¡Œå­—ç¬¦ä¸²ç»„æˆçš„list flen=len(lines) for i in range(flen): if lines[i].startswith(\u0026quot;SIMULATION-TIME\u0026quot;) : config_value = lines[i].split(' ') value = int( config_value[1][0:-2:1] ) # ç”¨åˆ‡ç‰‡åˆ å»Så’Œå›è½¦è½¬æˆå€¼ value = int(3600 / speed) lines[i] = config_value[0] + ' ' + str(value) + 'S\\n' break else : continue with open('test.config','w', encoding='utf-8') as new_config : new_config.writelines(lines) #ä¿®æ”¹test.nodesæ–‡ä»¶ with open('test.nodes', 'r', encoding='utf-8') as o_config : lines = o_config.readlines() # readlinesè¿”å›æ¯è¡Œå­—ç¬¦ä¸²ç»„æˆçš„list flen=len(lines) for i in range(flen): if lines[i] == '\\n' : break node_value = lines[i].split(' ', 2) if node_value[1] == '0' : continue else : value = int( node_value[1][0: -1:1] ) value = int( value / speed ) lines[i] = node_value[0] + ' ' + str(value) + 'S ' + node_value[2] with open('test.nodes','w', encoding='utf-8') as new_nodes : new_nodes.writelines(lines) print(\u0026quot;Modified to complete\u0026quot;) ä»£ç åˆ†æ pythonä¿®æ”¹æ–‡æœ¬æš‚æ—¶æ²¡æ‰¾åˆ°ç›´æ¥æ›´æ”¹åŠæ³•ï¼Œä¸Šè¿°ä»£ç éƒ½æ˜¯å…ˆè¯»å–æ–‡æœ¬å¤åˆ¶åˆ°å†…å­˜ä¸­çš„åˆ—è¡¨ï¼Œä¿®æ”¹åå†å°†åˆ—è¡¨å†™å…¥æ–‡ä»¶ã€‚ ä¿®æ”¹test.configæ–‡ä»¶ä»£ç ï¼Œä½¿ç”¨readlinesè¿”å›æ¯è¡Œå­—ç¬¦ä¸²ç»„æˆçš„listã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç”¨readlineå’Œwhileè¯»å–æ¯ä¸€è¡Œæ¥è¿›è¡Œæ“ä½œã€‚ ä½¿ç”¨startswithå¯¹æ¯è¡Œè¡Œé¦–åˆ¤æ–­å¯»æ‰¾å…³é”®å­—ç¬¦ä¸²ç±»å‹ï¼Œä¹‹åä½¿ç”¨splitç©ºæ ¼åˆ†å¼€ä¸ºå­—ç¬¦ä¸²åˆ—è¡¨åç”¨åˆ‡ç‰‡æå–å‡ºå€¼å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚ ä¾‹å¦‚ä¸‹å›¾ä¸­configæ–‡ä»¶ä¼šè¯»å–åˆ°lines[8]è¿™è¡Œæœ‰å¾…å¯»æ‰¾å…³é”®å­—ï¼Œç”¨splitç”Ÿæˆlist[\u0026lsquo;SIMULATION-TIME\u0026rsquo;, \u0026lsquo;3600S\\n\u0026rsquo;], è¿›è¡Œåˆ‡ç‰‡æ“ä½œ[1:-2:1]å¾—åˆ°å­—ç¬¦ä¸²'3600\u0026rsquo; (å›è½¦\\nä¹Ÿéœ€è¦åˆ‡ç‰‡å»é™¤)ï¼Œè¿™æ ·è½¬åŒ–æˆintå‹å¤„ç†å®Œå†è½¬ä¸ºå­—ç¬¦ä¸²å¡«å……å›åŸæ¥åˆ—è¡¨ä¸­å³å¯ã€‚ ä¹‹åç±»ä¼¼çš„å¯¹test.nodesè¿›è¡Œæ“ä½œ!\næ­¤å¤„ï¼Œç”±äºå…¶é…ç½®æ–‡ä»¶è§„åˆ™ç®€å•ç”±ç©ºæ ¼åŒºåˆ†ï¼Œæ‰€ä»¥å¤„ç†èµ·æ¥åªéœ€è¦splitå’Œåˆ—è¡¨åˆ‡ç‰‡ï¼Œè‹¥æ˜¯å¤æ‚çš„å­—ç¬¦ä¸²æ•°æ®è¿˜æ˜¯å¾—ç”¨ä¸Šé¢æ•™ç¨‹ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æ¥å¤„ç†ã€‚ æ­¤å¤–ï¼Œå¦‚æœéœ€è¦æ›´æ”¹å‚æ•°ç²¾åº¦æ›´å¥½çš„æ¡ˆä¾‹è¿™é‡Œä¹Ÿæä¾›ä¸€ä»½\n#!/usr/bin/python3 #coding: utf-8 #ä¿®æ”¹ 1.nodesæ–‡ä»¶ speed = 100 with open('1.nodes', 'r', encoding='utf-8') as o_config : lines = o_config.readlines() # readlinesè¿”å›æ¯è¡Œå­—ç¬¦ä¸²ç»„æˆçš„list flen=len(lines) for i in range(flen): if lines[i] == '\\n' : break node_value = lines[i].split(' ', 5) valuex = round( float( node_value[2][1: -1:1]) / speed,14 ) valuey = round( float( node_value[3][1: -1:1]) / speed,14 ) valuez = round( float( node_value[4][1: -1:1]) / speed,14 ) # lines[i] = node_value[0] + ' ' + node_value[1] + ' (' + \\ # str(valuex) + ', ' + str(valuey) + ', ' + str(valuez) + ') ' + node_value[5] lines[i] = node_value[0] + ' ' + node_value[1] + ' (' + \\ '%.014f'%valuex + ', ' + '%.014f'%valuey + ', ' + '%.014f'%valuez + ') ' + node_value[5] with open('1.nodes','w', encoding='utf-8') as new_nodes : new_nodes.writelines(lines) print(\u0026quot;Modified to complete\u0026quot;) ","id":40,"section":"posts","summary":"åŠŸèƒ½ ç”±äºåˆšå¥½æœ‰éœ€æ±‚è¦æ›´æ”¹é…ç½®æ–‡ä»¶å‚æ•°ï¼Œæƒ³åˆ°pythonç®€å•æ˜“ç”¨çš„ç‰¹ç‚¹ï¼Œæ‰€ä»¥è¾¹å­¦è¾¹åšäº†è¿™ä¸ªç¨‹åºå¸®åŠ©ä¿®æ”¹å‚æ•°ã€‚è¯¥ç¨‹åºåŠŸèƒ½ä¸ºè¯»å–ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡æœ¬å…¶ä¸­","tags":["python"],"title":"Pythonè¯»å†™æ–‡ä»¶","uri":"https://liangkang233.github.io/2021/03/python%E8%AF%BB%E5%86%99%E6%96%87%E4%BB%B6/","year":"2021"},{"content":"hello world æµ‹è¯• è€ç”Ÿå¸¸è°ˆçš„hello worldï¼Œåœ¨æ­¤ä¹‹å‰çš„åŸblogå¸–å­ä¼šå½’æ¡£æœ¬åœ°è‰ç¨¿\nå„æµ‹è¯•é¡¹ç›®æ–‡ä»¶ draft: true,\ntag: blog test\nrich-content\nemoji-support\nmarkdown-syntax\nplaceholder-text\nvideo test ","id":41,"section":"posts","summary":"hello world æµ‹è¯• è€ç”Ÿå¸¸è°ˆçš„hello worldï¼Œåœ¨æ­¤ä¹‹å‰çš„åŸblogå¸–å­ä¼šå½’æ¡£æœ¬åœ°è‰ç¨¿ å„æµ‹è¯•é¡¹ç›®æ–‡ä»¶ draft: true, tag: blog test rich-content emoji-support markdown-syntax placeholder-text video test","tags":["blog test"],"title":"Hello World","uri":"https://liangkang233.github.io/2020/12/hello-world/","year":"2020"}],"tags":[{"title":"blog test","uri":"https://liangkang233.github.io/tags/blog-test/"},{"title":"C/C++","uri":"https://liangkang233.github.io/tags/c/c++/"},{"title":"Emane","uri":"https://liangkang233.github.io/tags/emane/"},{"title":"go","uri":"https://liangkang233.github.io/tags/go/"},{"title":"linux","uri":"https://liangkang233.github.io/tags/linux/"},{"title":"network","uri":"https://liangkang233.github.io/tags/network/"},{"title":"python","uri":"https://liangkang233.github.io/tags/python/"},{"title":"sdn","uri":"https://liangkang233.github.io/tags/sdn/"},{"title":"ä»¿çœŸ","uri":"https://liangkang233.github.io/tags/%E4%BB%BF%E7%9C%9F/"},{"title":"å®¹å™¨","uri":"https://liangkang233.github.io/tags/%E5%AE%B9%E5%99%A8/"},{"title":"å¼€å‘","uri":"https://liangkang233.github.io/tags/%E5%BC%80%E5%8F%91/"},{"title":"æ•°æ®ç»“æ„","uri":"https://liangkang233.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"title":"ç®—æ³•","uri":"https://liangkang233.github.io/tags/%E7%AE%97%E6%B3%95/"},{"title":"è·¯ç”±","uri":"https://liangkang233.github.io/tags/%E8%B7%AF%E7%94%B1/"}]}